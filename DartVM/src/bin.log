------------------------------------------------------------------------
r34790 | iposva@google.com | 2014-04-08 03:20:22 +0900 (火, 08  4月 2014) | 3 lines

- Update svn:ignore properties.


------------------------------------------------------------------------
r34661 | johnmccutchan@google.com | 2014-04-03 03:30:01 +0900 (木, 03  4月 2014) | 23 lines

Miscellaneous Observatory UI improvements

Update cursor over expander in profiler

Ressurect json-view

Show arrow in profiler tree

Clicking on <code-ref> link in profiler doesn't expand tree

<code-ref> only shows a link for Dart code

Port script-view to use script-inset

Add function source to function view

Add counters to isolate view

Add counters to isolate summary

R=turnidge@google.com

Review URL: https://codereview.chromium.org//221263002
------------------------------------------------------------------------
r34654 | zra@google.com | 2014-04-03 02:39:32 +0900 (木, 03  4月 2014) | 11 lines

Begins work on ARM64, first assembler test.

Most new code is in constants_arm64.h and
{assembler,disassembler,simulator}_arm64.{h,cc}

The rest of the CL just #def's out tests, modifies status files,
and adds UNIMPLEMENTED functions, etc.

R=regis@google.com

Review URL: https://codereview.chromium.org//221133002
------------------------------------------------------------------------
r34620 | johnmccutchan@google.com | 2014-04-02 07:05:39 +0900 (水, 02  4月 2014) | 6 lines

Redo allocationprofile options

BUG=
R=turnidge@google.com

Review URL: https://codereview.chromium.org//217323006
------------------------------------------------------------------------
r34616 | turnidge@google.com | 2014-04-02 05:18:17 +0900 (水, 02  4月 2014) | 9 lines

Add <eval-link> - a custom element for evaluating an expression.

Use <eval-link> to add a convenience toString() link for instances.

In the future I plan to use <eval-link> to provide easy access to getters.

R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//213853004
------------------------------------------------------------------------
r34612 | turnidge@google.com | 2014-04-02 04:45:57 +0900 (水, 02  4月 2014) | 17 lines

Change how we provide value previews in the vm service.

Rename the 'preview' property to 'valueAsString'.

Rework printing so that we only add 'valueAsString' when we need it
(num, String, etc.).

Change ToUserCString to be a String-only method.  Drop ToUserCString
for lists -- it was hokey and unused.  Max string length is now 1024
instead of 40.

Update tests.

BUG=
R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//219333011
------------------------------------------------------------------------
r34594 | ajohnsen@google.com | 2014-04-01 21:15:21 +0900 (火, 01  4月 2014) | 9 lines

Don't make the signal-pipe non-blocking.

This is an attempt to make it run on MIPS. The non-blocking is not
needed here.

BUG=https://code.google.com/p/dart/issues/detail?id=17826
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//220863003
------------------------------------------------------------------------
r34589 | ajohnsen@google.com | 2014-04-01 19:56:19 +0900 (火, 01  4月 2014) | 13 lines

Make non-copying version of BytesBuidler and make file-reads faster.

The non-copying version is internally, as this is always the behaviour
we want, when receiving data from the system.

File-reads are also further improved, by only reading data in chunks, if
initial length is 0. This is a special case where the file can be a
character device. Overall improvement is around a factor of 6.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//218493012
------------------------------------------------------------------------
r34542 | iposva@google.com | 2014-03-29 08:39:36 +0900 (土, 29  3月 2014) | 7 lines

- Make ports be less predictable.
- Limit the range of port numbers to 30-bits.
- Parse the ports as 64-bit values when reading from the wire in the debugger protocol.

R=hausner@google.com

Review URL: https://codereview.chromium.org//217693002
------------------------------------------------------------------------
r34530 | turnidge@google.com | 2014-03-29 07:09:53 +0900 (土, 29  3月 2014) | 5 lines

Minor fix in isolate-view.

R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//217473004
------------------------------------------------------------------------
r34528 | turnidge@google.com | 2014-03-29 06:24:24 +0900 (土, 29  3月 2014) | 13 lines

Use tokenPos instead of line/col in the vm service.

Add line number information to the Script response.

Parse line number information in the observatory.

Update <script-ref> to take a pos argument

Add a new <script-inset> element which shows a code snippet.

R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//216883008
------------------------------------------------------------------------
r34520 | turnidge@google.com | 2014-03-29 05:21:09 +0900 (土, 29  3月 2014) | 13 lines

Rework the <field-view> page.

Give fields/functions a consistent notion of ownership.

Add field's script to the JSON.

Make page reload work again.

Fixup closure printing a bit.

R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//215213003
------------------------------------------------------------------------
r34435 | turnidge@google.com | 2014-03-27 02:13:03 +0900 (木, 27  3月 2014) | 13 lines

Support Types in instance-ref/instance-view.

Refactor JSON printing for all instances to share more code.  This allows Types to act like Instances in Observatory.

Update the look and feel for the function-view page.

Add script info for functions.

Update tests.

R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//211283004
------------------------------------------------------------------------
r34408 | ajohnsen@google.com | 2014-03-26 15:21:38 +0900 (水, 26  3月 2014) | 8 lines

Don't use ThreadSignalBlocker in mac eventhandler.

Turns out kevent can modify the current sigmask.

BUG=
R=ricow@google.com

Review URL: https://codereview.chromium.org//212193002
------------------------------------------------------------------------
r34377 | johnmccutchan@google.com | 2014-03-26 03:09:02 +0900 (水, 26  3月 2014) | 8 lines

Add isolate tag-profile model and UI.
Distinction between a Dart Error and a ServiceError/ServiceException.
Better Observatory behaviour when a ServiceError/ServiceExceptions occurs.
Display isolate's sticky error.

R=turnidge@google.com

Review URL: https://codereview.chromium.org//205713004
------------------------------------------------------------------------
r34362 | ajohnsen@google.com | 2014-03-25 23:20:45 +0900 (火, 25  3月 2014) | 5 lines

Fix mac part of previous commit.

BUG=

Review URL: https://codereview.chromium.org//207553004
------------------------------------------------------------------------
r34359 | ajohnsen@google.com | 2014-03-25 22:44:01 +0900 (火, 25  3月 2014) | 6 lines

Only return eventhandler tokens in stacks of 8, to avoid runtime calls.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//208653012
------------------------------------------------------------------------
r34356 | ajohnsen@google.com | 2014-03-25 22:06:37 +0900 (火, 25  3月 2014) | 6 lines

Speed up GetRandomBytes by only entering signal-blocking scope once.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//209333014
------------------------------------------------------------------------
r34338 | johnmccutchan@google.com | 2014-03-25 06:58:45 +0900 (火, 25  3月 2014) | 6 lines

Fix PrintToJSONStream for oddball functions

BUG=
R=turnidge@google.com

Review URL: https://codereview.chromium.org//196173022
------------------------------------------------------------------------
r34333 | turnidge@google.com | 2014-03-25 06:42:26 +0900 (火, 25  3月 2014) | 21 lines

Rework how ServiceObjects are created and cached in Observatory.

We now use a single cache, rather than per-type caches which simplifies the get() logic and makes it easier to add more model-types in the future.

Rework how isolates are created/stored/retrieved.  IsolateList is gone.

Add canCache and immutable to ServiceObjects and use them to inform when an object should be cached or reloaded.

Remove cache.dart, service.dart.

Add a notion of a ServiceObjectOwner.

Cleanups.

Etc.

Etc.

R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//204983008
------------------------------------------------------------------------
r34305 | ajohnsen@google.com | 2014-03-24 22:40:29 +0900 (月, 24  3月 2014) | 6 lines

Be sure we to read all bytes requested, in GetRandomBytes.

BUG=https://code.google.com/p/dart/issues/detail?id=17723
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//209983002
------------------------------------------------------------------------
r34267 | johnmccutchan@google.com | 2014-03-22 05:06:24 +0900 (土, 22  3月 2014) | 7 lines

Allow built in Observatory to work on any port

https://code.google.com/p/dart/issues/detail?id=17537

R=turnidge@google.com

Review URL: https://codereview.chromium.org//208243006
------------------------------------------------------------------------
r34263 | johnmccutchan@google.com | 2014-03-22 03:24:07 +0900 (土, 22  3月 2014) | 5 lines

Switch to using pub build instead of custom build_.dart script

R=turnidge@google.com

Review URL: https://codereview.chromium.org//199633007
------------------------------------------------------------------------
r34236 | whesse@google.com | 2014-03-21 18:25:36 +0900 (金, 21  3月 2014) | 5 lines

Modify secure_socket.cc to use new NSS memio api.

R=kustermann@google.com

Review URL: https://codereview.chromium.org//207413003
------------------------------------------------------------------------
r34235 | whesse@google.com | 2014-03-21 18:17:08 +0900 (金, 21  3月 2014) | 5 lines

Update NSS to NSS 3.16 RTM

R=sgjesse@google.com

Review URL: https://codereview.chromium.org//201853003
------------------------------------------------------------------------
r34208 | asiva@google.com | 2014-03-21 06:45:43 +0900 (金, 21  3月 2014) | 5 lines

Auto delete persistent weak handles during finalization after invoking the callback associated with the weak handle.

R=iposva@google.com

Review URL: https://codereview.chromium.org//205153002
------------------------------------------------------------------------
r34204 | turnidge@google.com | 2014-03-21 06:00:10 +0900 (金, 21  3月 2014) | 22 lines

Add a VM page to the observatory.

Make the VM a ServiceObject.  Some refactoring in the ServiceObject
implementation.

IsolateList is no longer a ServiceObject.  It should eventually become more like our caches.

Support the /vm request in the vm.  Remove isolate list request.

Improvements to Isolate::PrintToJSONStream: always provide a
reasonable name.  Use the same code to produce isolate refs and
non-refs.

Improve isolate status message when the isolate is paused at
start/exit.  Add a resume link to the isolate view.

Add a navbar to the error page so that dartium users are less likely
to get stuck.

R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//206213004
------------------------------------------------------------------------
r34195 | koda@google.com | 2014-03-21 03:56:45 +0900 (金, 21  3月 2014) | 9 lines

Add class and address information to heap map; display on hover.

Display a string like "String @ 0xe97c3328" while hovering over the map.

Also add page separators (black).

R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//204103009
------------------------------------------------------------------------
r34190 | turnidge@google.com | 2014-03-21 03:17:16 +0900 (金, 21  3月 2014) | 5 lines

Support doubles in observatory.

R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//199443008
------------------------------------------------------------------------
r34175 | ajohnsen@google.com | 2014-03-21 00:34:03 +0900 (金, 21  3月 2014) | 6 lines

Remove previous debug printing.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//206333005
------------------------------------------------------------------------
r34168 | ajohnsen@google.com | 2014-03-20 23:24:20 +0900 (木, 20  3月 2014) | 8 lines

Add debug-printing to file, and remove from test.

Adding the debug print made the test stop failing.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//206263005
------------------------------------------------------------------------
r34109 | ajohnsen@google.com | 2014-03-19 18:23:17 +0900 (水, 19  3月 2014) | 6 lines

Close(destroy) Socket on user-generated write error.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//204343003
------------------------------------------------------------------------
r34075 | johnmccutchan@google.com | 2014-03-19 07:35:59 +0900 (水, 19  3月 2014) | 3 lines

Regenerate Observatory js

Review URL: https://codereview.chromium.org//204013004
------------------------------------------------------------------------
r34064 | johnmccutchan@google.com | 2014-03-19 06:20:41 +0900 (水, 19  3月 2014) | 5 lines

Use VM tag in profile and add stack trace trie

R=asiva@google.com, turnidge@google.com

Review URL: https://codereview.chromium.org//201213004
------------------------------------------------------------------------
r34051 | turnidge@google.com | 2014-03-19 04:14:26 +0900 (水, 19  3月 2014) | 3 lines

Move all service objects to one file ahead of refactor.

Review URL: https://codereview.chromium.org//203243006
------------------------------------------------------------------------
r33812 | turnidge@google.com | 2014-03-19 01:24:00 +0900 (水, 19  3月 2014) | 5 lines

Implement isolate view page.

R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//197873028
------------------------------------------------------------------------
r33802 | ajohnsen@google.com | 2014-03-18 21:54:20 +0900 (火, 18  3月 2014) | 6 lines

Fix comments of previous commit.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//200793006
------------------------------------------------------------------------
r33799 | ajohnsen@google.com | 2014-03-18 20:29:06 +0900 (火, 18  3月 2014) | 6 lines

Prefix io part uri's with 'dart:io/'.

BUG=https://code.google.com/p/dart/issues/detail?id=17083
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//203073004
------------------------------------------------------------------------
r33798 | ajohnsen@google.com | 2014-03-18 17:57:00 +0900 (火, 18  3月 2014) | 9 lines

Make http-imports faster to load, by hinting persistent connection on request.

Also avoids a BytesBuilder, if only one chunk is received. This speeds
up e.g. 'pub build' notably (4x speedup).

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//203213002
------------------------------------------------------------------------
r33755 | turnidge@google.com | 2014-03-18 02:43:07 +0900 (火, 18  3月 2014) | 7 lines

Rework library and class view pages.

Add expression evaluation support for libraries and classes.

R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//199363002
------------------------------------------------------------------------
r33754 | koda@google.com | 2014-03-18 02:16:53 +0900 (火, 18  3月 2014) | 5 lines

Visualize heap fragmentation in Observatory.

R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//197923005
------------------------------------------------------------------------
r33745 | ajohnsen@google.com | 2014-03-17 22:51:11 +0900 (月, 17  3月 2014) | 6 lines

Move signal_blocker to platform and use it by default in TEMP_FAILURE_RETRY.

BUG=http://code.google.com/p/dart/issues/detail?id=16927
R=johnmccutchan@google.com, sgjesse@google.com

Review URL: https://codereview.chromium.org//165723007
------------------------------------------------------------------------
r33737 | ajohnsen@google.com | 2014-03-17 19:40:19 +0900 (月, 17  3月 2014) | 6 lines

Add exitCode getter counterpart to the existing setter in dart:io.

BUG=https://code.google.com/p/dart/issues/detail?id=16217
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//200233002
------------------------------------------------------------------------
r33702 | johnmccutchan@google.com | 2014-03-15 02:03:38 +0900 (土, 15  3月 2014) | 6 lines

Show object pool on code page

BUG=
R=turnidge@google.com

Review URL: https://codereview.chromium.org//197853005
------------------------------------------------------------------------
r33690 | ajohnsen@google.com | 2014-03-14 19:25:16 +0900 (金, 14  3月 2014) | 6 lines

Use mutex around getaddrinfo on windows, as it's not thread-safe.

BUG=https://code.google.com/p/dart/issues/detail?id=17237
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//200083002
------------------------------------------------------------------------
r33665 | johnmccutchan@google.com | 2014-03-14 06:00:44 +0900 (金, 14  3月 2014) | 5 lines

Create a shadow table to track CodeRegions of reused code address space.

R=asiva@google.com, turnidge@google.com

Review URL: https://codereview.chromium.org//197803004
------------------------------------------------------------------------
r33653 | ajohnsen@google.com | 2014-03-14 00:23:08 +0900 (金, 14  3月 2014) | 5 lines

Don't act on return-token commands on Windows.

BUG=

Review URL: https://codereview.chromium.org//199063004
------------------------------------------------------------------------
r33649 | ajohnsen@google.com | 2014-03-13 21:02:47 +0900 (木, 13  3月 2014) | 8 lines

Make the event-handler handle backpreasure.

We now limit the number of active events per fd to 8.

BUG=
R=whesse@google.com

Review URL: https://codereview.chromium.org//198743002
------------------------------------------------------------------------
r33645 | ajohnsen@google.com | 2014-03-13 20:20:34 +0900 (木, 13  3月 2014) | 8 lines

Use a sync-writing StreamConsumer for stdout/stderr.

This makes stdout.write and stderr.write block, until the write is done.

BUG=https://code.google.com/p/dart/issues/detail?id=17020
R=whesse@google.com

Review URL: https://codereview.chromium.org//195893012
------------------------------------------------------------------------
r33630 | johnmccutchan@google.com | 2014-03-13 08:32:19 +0900 (木, 13  3月 2014) | 7 lines

Make service-view programmatically switch views

This has the side effect of fixing most of the Polymer exceptions when switching views.

R=turnidge@google.com

Review URL: https://codereview.chromium.org//195763005
------------------------------------------------------------------------
r33625 | koda@google.com | 2014-03-13 08:12:48 +0900 (木, 13  3月 2014) | 10 lines

Correct capacity reporting for new space; show external size in Observatory.

Before, the reported capacity included *both* semi-spaces, which seems wrong.

Also exclude external size from capacity, to be consistent with old space and
the comment on Heap::CapacityInWords.

R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//196603009
------------------------------------------------------------------------
r33592 | turnidge@google.com | 2014-03-13 02:18:14 +0900 (木, 13  3月 2014) | 9 lines

Improve the instance-view page in observatory.

Add an eval-box element which is used to evaluate expressions.

Support expression evaluation for instances in the vm service.

R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//194623006
------------------------------------------------------------------------
r33548 | johnmccutchan@google.com | 2014-03-12 04:27:52 +0900 (水, 12  3月 2014) | 6 lines

Code view tweaks and crasher fix

BUG=
R=turnidge@google.com

Review URL: https://codereview.chromium.org//194503006
------------------------------------------------------------------------
r33541 | johnmccutchan@google.com | 2014-03-12 02:48:09 +0900 (水, 12  3月 2014) | 10 lines

Switch Observatory to use only ServiceObject instances.

All fetched objects are upgraded to a ServiceObject.
ServiceObjectCache.
Uniform updating / refreshing.
Fix UTF8 string escaping in TextBuffer (should fix invalid character bug https://code.google.com/p/dart/issues/detail?id=16590)

R=turnidge@google.com

Review URL: https://codereview.chromium.org//192443004
------------------------------------------------------------------------
r33483 | whesse@google.com | 2014-03-10 21:00:36 +0900 (月, 10  3月 2014) | 8 lines

Fix type error in implementation of dart:io Directory.existsSync.

Add checked-in binary for mips architecture to tools/testing.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//190723008
------------------------------------------------------------------------
r33467 | koda@google.com | 2014-03-08 08:53:32 +0900 (土, 08  3月 2014) | 9 lines

Track external allocated memory for weak persistent handles.

The amount of external allocation is tracked per generation
and informs GC policy.

BUG=dart:11471
R=asiva@google.com

Review URL: https://codereview.chromium.org//187113003
------------------------------------------------------------------------
r33386 | turnidge@google.com | 2014-03-07 02:38:16 +0900 (金, 07  3月 2014) | 9 lines

Handle collected objects and expired handles more gracefully.

Prints <collected> or <expired>.

Added tooltips to explain these to users.

R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//177473004
------------------------------------------------------------------------
r33380 | johnmccutchan@google.com | 2014-03-07 01:48:49 +0900 (金, 07  3月 2014) | 7 lines

Display sample count and refresh time.
Fix some uninitialized variables.
Don't send disassembly by default.

R=turnidge@google.com

Review URL: https://codereview.chromium.org//185563013
------------------------------------------------------------------------
r33366 | sgjesse@google.com | 2014-03-06 20:12:08 +0900 (木, 06  3月 2014) | 7 lines

Socket I/O statistics for Observatory

This is the first part of adding I/O statistics to the observatory.

R=ajohnsen@google.com, johnmccutchan@google.com

Review URL: https://codereview.chromium.org//163903002
------------------------------------------------------------------------
r33356 | johnmccutchan@google.com | 2014-03-06 08:35:31 +0900 (木, 06  3月 2014) | 6 lines

Fix Dartium Observatory

BUG=
R=asiva@google.com

Review URL: https://codereview.chromium.org//187923009
------------------------------------------------------------------------
r33347 | johnmccutchan@google.com | 2014-03-06 06:59:48 +0900 (木, 06  3月 2014) | 11 lines

Refactor Observatory

Introduce a VM class responsible for communicating with a VM and the isolates collection
Add two new base elements: IsolateElement and VMElement which are peered to an isolate or VM respectively.
Remove request manager (functionally replaced by VM)
Remove isolate manager (functionally replaced by VM)
Link creation and network requests delegated through Isolate class.

R=turnidge@google.com

Review URL: https://codereview.chromium.org//184233007
------------------------------------------------------------------------
r33343 | koda@google.com | 2014-03-06 06:06:45 +0900 (木, 06  3月 2014) | 6 lines

Remove broken flags --all and --tests.

BUG=dart:17257
R=iposva@google.com

Review URL: https://codereview.chromium.org//187853004
------------------------------------------------------------------------
r33322 | whesse@google.com | 2014-03-05 18:26:15 +0900 (水, 05  3月 2014) | 6 lines

Remove faulty function return type in builtin.dart

BUG=
R=ricow@google.com

Review URL: https://codereview.chromium.org//183803021
------------------------------------------------------------------------
r33297 | turnidge@google.com | 2014-03-05 05:26:30 +0900 (水, 05  3月 2014) | 13 lines

Add new <curly-block> element.

This is an expandable curly-brace block.

- Show pointer cursor when over link instead of text input.
- Make the link easier to click with inline-block, &nbsp.
- Show a busy cursor and hide the link when an expand is pending.
- Use boxed +/- for expand/contract icons.  (We can change these later).

BUG=
R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//182413007
------------------------------------------------------------------------
r33292 | turnidge@google.com | 2014-03-05 04:10:52 +0900 (水, 05  3月 2014) | 5 lines

Update the navbar in the observatory

R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//185413015
------------------------------------------------------------------------
r33282 | asiva@google.com | 2014-03-05 03:11:19 +0900 (水, 05  3月 2014) | 10 lines

Pass in the isolate parameter to the weak persistent callback handler so that
there is no need to access the current isolate in the callback and delete
path (this code is run while a GC is in progress).

See https://codereview.chromium.org/185643003/ for corresponding changes
in dartium

R=iposva@google.com

Review URL: https://codereview.chromium.org//186003002
------------------------------------------------------------------------
r33275 | whesse@google.com | 2014-03-04 23:39:12 +0900 (火, 04  3月 2014) | 6 lines

Refactor native extension shared library lookup.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//186473003
------------------------------------------------------------------------
r33272 | ajohnsen@google.com | 2014-03-04 22:58:46 +0900 (火, 04  3月 2014) | 10 lines

Merge all http-outgoing transfomers into _HttpOutgoing, including simpler(better) buffering.

This speeds up the system by:
- Using a simpler buffering mechanism, where we fill up a 8kb buffer, pass it on, and allocating a new.
- Avoiding up to 4 streams for each stream added to the http-outgoing. We now only create one extra stream.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//185543004
------------------------------------------------------------------------
r33247 | koda@google.com | 2014-03-04 06:21:06 +0900 (火, 04  3月 2014) | 6 lines

Handle NUL bytes in builtin print.

BUG=dart:16761
R=asiva@google.com

Review URL: https://codereview.chromium.org//186103002
------------------------------------------------------------------------
r33235 | ajohnsen@google.com | 2014-03-04 03:33:56 +0900 (火, 04  3月 2014) | 6 lines

Add InternetAddress:rawAddress, to return the raw address as a list of bytes.

BUG=https://code.google.com/p/dart/issues/detail?id=17137
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//180163005
------------------------------------------------------------------------
r33220 | johnmccutchan@google.com | 2014-03-04 00:39:06 +0900 (火, 04  3月 2014) | 9 lines

Add user resetable accumulator to allocation profiler.
Display aggregate of new and old space in a separate table.
Speed up display of tables by 10x.
Fix heap display bug (heap stats were always for new space).
Keep sort across refreshes.

R=turnidge@google.com

Review URL: https://codereview.chromium.org//173013004
------------------------------------------------------------------------
r33219 | ajohnsen@google.com | 2014-03-04 00:38:22 +0900 (火, 04  3月 2014) | 8 lines

Use signal-block around fork() to avoid we block it.

This issue is seen on a single-core VM.

BUG=https://code.google.com/p/dart/issues/detail?id=17217
R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//176933006
------------------------------------------------------------------------
r33217 | whesse@google.com | 2014-03-04 00:04:04 +0900 (火, 04  3月 2014) | 6 lines

Fix typo in r33216

BUG=
R=ajohnsen@google.com

Review URL: https://codereview.chromium.org//184823007
------------------------------------------------------------------------
r33216 | whesse@google.com | 2014-03-03 23:51:44 +0900 (月, 03  3月 2014) | 15 lines

Change handling of dart-ext: URIs for native extensions.

With this change, a dart-ext: URI is now an opaque URI consisting of
the scheme dart-ext: followed by an actual URI, either relative, or
with a scheme like file:, http:, or package:.  Existing users are mostly
or all using relative URIs, so this change should not affect them.

This is a step toward allowing native extensions in packages to be served
over http, and also cleans up the code, and would help a future change
that replaces "dart-ext:" with metadata or an annotation.

BUG=
R=iposva@google.com

Review URL: https://codereview.chromium.org//180783008
------------------------------------------------------------------------
r33213 | ajohnsen@google.com | 2014-03-03 22:12:23 +0900 (月, 03  3月 2014) | 6 lines

Use actual length of dictionary, and not size of a pointer, in zlib.

BUG=
R=lrn@google.com

Review URL: https://codereview.chromium.org//185773004
------------------------------------------------------------------------
r33206 | ajohnsen@google.com | 2014-03-03 20:43:09 +0900 (月, 03  3月 2014) | 40 lines

[ZLIB] Add support for windowBits, memLevel, raw

BUG=159367

**BC breaks:**
All public (API) classes that used to be const are not const any more. This allow checking the validity of input parameters in the constructor body.
- ZLibCodec,
- GZipCodec,
- ZLibEncoder,
- ZLibDecoder
The globals codecs GZIP and ZLIB are now final we should be ok (the class contain only final properties, ie no state).

What should be done:
(- finer grained exceptions, -> later change)
(- Handle the flush modes but probably in an other patch as the updates might be more complex.)

Done:

Patch Set #1
- add some more docs,
- support for memLevel.

Patch Set #2:
- implement dictionaries (todo: fix mem management),
- integrate review feedback,
- fix CC,
- rebased on master

Patch Set #4:
- support for strategy,
- add some checks (ie checking the level, memLevel, ...) this could imply adding a constructor body (Codecs, Coders) but this would force making the const non const and break BC, thoughts ?
- Add ZLIB constants Dart side.
- Refactor the tests and test only some levels rather all which was unit testing rather more than the extension. It saves some test time.

Patch Set #8:
- fix mem management for dictionaries,

R=ajohnsen@google.com, lrn@google.com

Review URL: https://codereview.chromium.org//130513003
------------------------------------------------------------------------
r33202 | ajohnsen@google.com | 2014-03-03 19:17:04 +0900 (月, 03  3月 2014) | 6 lines

Don't report hasTerminal, if term-size is (0,0).

BUG=http://code.google.com/p/dart/issues/detail?id=17070
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//177863010
------------------------------------------------------------------------
r33177 | johnmccutchan@google.com | 2014-03-01 07:55:53 +0900 (土, 01  3月 2014) | 5 lines

Cleanup native, collected, and stub code handling in profiler

R=iposva@google.com, turnidge@google.com

Review URL: https://codereview.chromium.org//182703003
------------------------------------------------------------------------
r33150 | ajohnsen@google.com | 2014-02-28 17:55:04 +0900 (金, 28  2月 2014) | 9 lines

Remove rum_vm_tests.host target.

It should not be needed to compile it. If one wants to test the host,
one should compile with toolchains; 'target' == 'host'.

BUG=
R=zra@google.com

Review URL: https://codereview.chromium.org//179423003
------------------------------------------------------------------------
r33036 | johnmccutchan@google.com | 2014-02-26 06:41:57 +0900 (水, 26  2月 2014) | 8 lines

Code regions now have list of callers and callees.
Address ticks track exclusive / inclusive separately.
Code regions only receive one inclusive tick per sample regardless of how many times they appear in the sample's stack trace.
Provide useful name for most stub functions.

R=asiva@google.com, turnidge@google.com

Review URL: https://codereview.chromium.org//168833005
------------------------------------------------------------------------
r33031 | turnidge@google.com | 2014-02-26 04:08:24 +0900 (水, 26  2月 2014) | 5 lines

Add hide/show for stack frame variables.

R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//172913002
------------------------------------------------------------------------
r33012 | ajohnsen@google.com | 2014-02-25 20:40:05 +0900 (火, 25  2月 2014) | 6 lines

Make run_vm_tests on host depend on libdart_io again.

BUG=
R=ricow@google.com

Review URL: https://codereview.chromium.org//179713002
------------------------------------------------------------------------
r33010 | ajohnsen@google.com | 2014-02-25 18:59:18 +0900 (火, 25  2月 2014) | 9 lines

Don't depend on libdart_io in run_vm_tests and gen_snapshot.

This fixes an issue where we would compile the eventhandler and
file-system-watcher for the host toolchain.

BUG=https://code.google.com/p/dart/issues/detail?id=17002
R=iposva@google.com

Review URL: https://codereview.chromium.org//169753003
------------------------------------------------------------------------
r32964 | ajohnsen@google.com | 2014-02-24 23:31:39 +0900 (月, 24  2月 2014) | 6 lines

Remove non-fatal prints from windows eventhandler.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//177803002
------------------------------------------------------------------------
r32963 | ajohnsen@google.com | 2014-02-24 23:29:54 +0900 (月, 24  2月 2014) | 6 lines

Define EPOLLRDHUP in eventhandler_android if missing.

BUG=http://code.google.com/p/dart/issues/detail?id=17038
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//177753002
------------------------------------------------------------------------
r32960 | ajohnsen@google.com | 2014-02-24 21:45:16 +0900 (月, 24  2月 2014) | 6 lines

Fix error-checking when calling timerfd_create.

BUG=https://code.google.com/p/dart/issues/detail?id=17051
R=kasperl@google.com

Review URL: https://codereview.chromium.org//177643002
------------------------------------------------------------------------
r32906 | whesse@google.com | 2014-02-22 02:00:41 +0900 (土, 22  2月 2014) | 8 lines

Revert "Add lock to a file handle in windows event handler."

This reverts commit r32901.  The lock causes a deadlock, and timeouts in tests.

BUG=
R=kustermann@google.com

Review URL: https://codereview.chromium.org//175223004
------------------------------------------------------------------------
r32901 | whesse@google.com | 2014-02-22 00:29:09 +0900 (土, 22  2月 2014) | 6 lines

Add lock to a file handle in windows event handler.

BUG=
R=ajohnsen@google.com

Review URL: https://codereview.chromium.org//174013012
------------------------------------------------------------------------
r32856 | sgjesse@google.com | 2014-02-21 02:21:27 +0900 (金, 21  2月 2014) | 9 lines

Add missing mutex protection for timeout queue with mutex

Holding the timer_mutex_ is required to access the timeout_queue_ data
structure. This was missing for epoll events.

R=kustermann@google.com
BUG=

Review URL: https://codereview.chromium.org//174033002
------------------------------------------------------------------------
r32854 | rnystrom@google.com | 2014-02-21 02:06:13 +0900 (金, 21  2月 2014) | 6 lines

Don't leak file names in Windows File::Stat().

BUG=https://code.google.com/p/dart/issues/detail?id=13848
R=ajohnsen@google.com

Review URL: https://codereview.chromium.org//172153007
------------------------------------------------------------------------
r32849 | ajohnsen@google.com | 2014-02-20 21:23:20 +0900 (木, 20  2月 2014) | 8 lines

Don't try to call read, if len i 0.

Also fix a Socket_Read to handle -1 from read.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//173633002
------------------------------------------------------------------------
r32846 | ajohnsen@google.com | 2014-02-20 17:56:54 +0900 (木, 20  2月 2014) | 8 lines

Remove SocketData and now only pass the dart port to epoll.

This avoids keeping extra data alive.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//171503009
------------------------------------------------------------------------
r32831 | iposva@google.com | 2014-02-20 08:35:55 +0900 (木, 20  2月 2014) | 6 lines

Another round of cleanups for http://www.dartbug.com/15922
- Address warnings about 64-bit to 32-bit conversions.

R=ajohnsen@google.com, asiva@google.com

Review URL: https://codereview.chromium.org//169893003
------------------------------------------------------------------------
r32797 | ajohnsen@google.com | 2014-02-20 01:49:27 +0900 (木, 20  2月 2014) | 5 lines

Fix build by removing unused class member.

BUG=

Review URL: https://codereview.chromium.org//172103005
------------------------------------------------------------------------
r32794 | ajohnsen@google.com | 2014-02-20 01:15:00 +0900 (木, 20  2月 2014) | 6 lines

Remove 'mask' from SocketData, as it's not required.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//167193004
------------------------------------------------------------------------
r32791 | ajohnsen@google.com | 2014-02-19 22:29:13 +0900 (水, 19  2月 2014) | 6 lines

Also make eventhandler on Android edge-triggered.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//172133004
------------------------------------------------------------------------
r32788 | ajohnsen@google.com | 2014-02-19 22:22:46 +0900 (水, 19  2月 2014) | 8 lines

Fix Windows event-handler, where write can 'complete' with 0 bytes written.

To match our design, we now treat this as a success write, as we expect the error to come on next issued write (which is exactly what happens).

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//172363002
------------------------------------------------------------------------
r32780 | ajohnsen@google.com | 2014-02-19 18:44:26 +0900 (水, 19  2月 2014) | 8 lines

Make event-handlers edge-triggered and move socket-state to Dart.

This eliminates to pause/resume calls made in the previous one-shot based model.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//169383003
------------------------------------------------------------------------
r32772 | turnidge@google.com | 2014-02-19 09:37:18 +0900 (水, 19  2月 2014) | 16 lines

Rework <script-ref>: - optional 'line' parameter - use a shorter version of the script url in the anchor text - keep long script url in hover text

The links for script-ref's now have a ?line=### url parameter which is
currently ignored in the script view page.

Added an optional 'isolate' parameter for all service-ref's.  This
allows us to explicitly specify our "current" isolate.

Redo function/script reference in the isolate summary page to use
<function-ref> and <service-ref> now that we can specify an isolate.

Add a missing comma in observatory_element.dart.

R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//165643003
------------------------------------------------------------------------
r32769 | johnmccutchan@google.com | 2014-02-19 07:38:11 +0900 (水, 19  2月 2014) | 6 lines

Allow for embedder provided service request handlers

BUG=
R=turnidge@google.com

Review URL: https://codereview.chromium.org//170943003
------------------------------------------------------------------------
r32760 | turnidge@google.com | 2014-02-19 04:45:36 +0900 (水, 19  2月 2014) | 7 lines

Improved how closures are displayed by <instance-ref>.

Make <optimized out> look a bit nicer.

R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//167713002
------------------------------------------------------------------------
r32757 | turnidge@google.com | 2014-02-19 04:37:58 +0900 (水, 19  2月 2014) | 7 lines

Add refresh button to stack trace page.

Remove stray debugging output.

R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//167363002
------------------------------------------------------------------------
r32751 | johnmccutchan@google.com | 2014-02-19 02:50:26 +0900 (水, 19  2月 2014) | 6 lines

Trace VM service requests

BUG=
R=turnidge@google.com

Review URL: https://codereview.chromium.org//164503002
------------------------------------------------------------------------
r32716 | ajohnsen@google.com | 2014-02-17 19:08:34 +0900 (月, 17  2月 2014) | 6 lines

Fix host lookup on linux, to skip IPv6 if there are no global IPv6 addresses.

BUG=https://code.google.com/p/dart/issues/detail?id=16742
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//168943002
------------------------------------------------------------------------
r32715 | ajohnsen@google.com | 2014-02-17 19:06:35 +0900 (月, 17  2月 2014) | 10 lines

Make std* blocking file-descriptors.

This will most likely be a performance regression when piping, that
we'll have to look into in the future (copying data through
    message-passing).

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//154273003
------------------------------------------------------------------------
r32707 | turnidge@google.com | 2014-02-15 02:48:25 +0900 (土, 15  2月 2014) | 3 lines

Add expandable instances and lists to the vm service.

Review URL: https://codereview.chromium.org//164183003
------------------------------------------------------------------------
r32602 | kevmoo@google.com | 2014-02-12 23:59:54 +0900 (水, 12  2月 2014) | 6 lines

observatory indent code

BUG= https://code.google.com/p/dart/issues/detail?id=16751
R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//159903003
------------------------------------------------------------------------
r32598 | ajohnsen@google.com | 2014-02-12 18:28:55 +0900 (水, 12  2月 2014) | 5 lines

Really really fix the build...

BUG=

Review URL: https://codereview.chromium.org//144283010
------------------------------------------------------------------------
r32597 | ajohnsen@google.com | 2014-02-12 18:16:30 +0900 (水, 12  2月 2014) | 5 lines

Fix mac os x build.t

BUG=

Review URL: https://codereview.chromium.org//159723010
------------------------------------------------------------------------
r32596 | ajohnsen@google.com | 2014-02-12 17:47:01 +0900 (水, 12  2月 2014) | 6 lines

Use Thread::Compare instead of ==.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//157813011
------------------------------------------------------------------------
r32571 | ajohnsen@google.com | 2014-02-12 04:14:05 +0900 (水, 12  2月 2014) | 6 lines

Avoid over-use of futures in socket.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//159663004
------------------------------------------------------------------------
r32424 | ajohnsen@google.com | 2014-02-07 22:19:23 +0900 (金, 07  2月 2014) | 6 lines

Fix signal handler in checked mode..

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//130893010
------------------------------------------------------------------------
r32423 | ajohnsen@google.com | 2014-02-07 22:18:05 +0900 (金, 07  2月 2014) | 5 lines

Remove DEBUG ifdefs.

BUG=

Review URL: https://codereview.chromium.org//152883003
------------------------------------------------------------------------
r32421 | ajohnsen@google.com | 2014-02-07 21:49:33 +0900 (金, 07  2月 2014) | 6 lines

Move all run-loop calls into the run-loop thread, and use correct memory handling (retain/release).

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//140183004
------------------------------------------------------------------------
r32416 | ajohnsen@google.com | 2014-02-07 18:41:38 +0900 (金, 07  2月 2014) | 8 lines

Document ProcessSignal::watch.

We now also allow watching for SIGTERM.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//149253013
------------------------------------------------------------------------
r32358 | ajohnsen@google.com | 2014-02-06 23:37:21 +0900 (木, 06  2月 2014) | 6 lines

Send error-event if socket is marked for error.

BUG=http://code.google.com/p/dart/issues/detail?id=16544
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//143473006
------------------------------------------------------------------------
r32355 | ajohnsen@google.com | 2014-02-06 22:16:13 +0900 (木, 06  2月 2014) | 8 lines

Fix file-watcher on mac by always starting/stopping through the run-loop thread.

This also fixes some system error-printing and maybe also early events.

BUG=https://code.google.com/p/dart/issues/detail?id=16216
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//147083015
------------------------------------------------------------------------
r32354 | sgjesse@google.com | 2014-02-06 21:50:49 +0900 (木, 06  2月 2014) | 6 lines

Remove wrong type in file_system_entity

R=ajohnsen@google.com
BUG=

Review URL: https://codereview.chromium.org//145643010
------------------------------------------------------------------------
r32310 | ajohnsen@google.com | 2014-02-05 16:44:08 +0900 (水, 05  2月 2014) | 6 lines

Short-cut the call to Timer.run, to not go through standalone.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//150563005
------------------------------------------------------------------------
r32308 | ajohnsen@google.com | 2014-02-05 16:28:02 +0900 (水, 05  2月 2014) | 6 lines

Allow paths up to 32767 characters on Windows (so '\\?\' can be used).

BUG=https://code.google.com/p/dart/issues/detail?id=16264
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//145623011
------------------------------------------------------------------------
r32142 | johnmccutchan@google.com | 2014-01-30 06:51:25 +0900 (木, 30  1月 2014) | 5 lines

Add Google Charts to Observatory and use it in allocation profiler

R=turnidge@google.com

Review URL: https://codereview.chromium.org//148153007
------------------------------------------------------------------------
r32128 | turnidge@google.com | 2014-01-30 03:40:12 +0900 (木, 30  1月 2014) | 20 lines

Post-meetup feature extravaganza.

Remodel the top-level isolate summary page.

Add variables to stack frames in the stack trace.

Stop putting small integers and bools in the object id ring.

Rework how we pass down null references (and null-like references like
uninitialized values).

Collect all isolate timers by default.

Change the lifetime of IsolateSpawnState so that we can refer to it
later to know how an isolate started up.  Stop pretending that
IsolateSpawnState is a void*.  Clean up vestigial IsolateStartData.

R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//145323002
------------------------------------------------------------------------
r32102 | whesse@google.com | 2014-01-29 14:07:29 +0900 (水, 29  1月 2014) | 6 lines

Fix native extensions located in packages on Windows.

BUG=dartbug.com/16205
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//135403007
------------------------------------------------------------------------
r32046 | whesse@google.com | 2014-01-28 09:33:14 +0900 (火, 28  1月 2014) | 8 lines

Fix error in processing dart-ext urls with a relative path.

BUG=dartbug.com/16205
R=sgjesse@google.com

Committed: https://code.google.com/p/dart/source/detail?r=32031

Review URL: https://codereview.chromium.org//134753005
------------------------------------------------------------------------
r32031 | whesse@google.com | 2014-01-28 06:58:19 +0900 (火, 28  1月 2014) | 6 lines

Fix error in processing dart-ext urls with a relative path.

BUG=dartbug.com/16205
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//134753005
------------------------------------------------------------------------
r32003 | hausner@google.com | 2014-01-25 08:14:15 +0900 (土, 25  1月 2014) | 9 lines

Don’t call toString from debugger

Debugger no longer calls toString on objects. It continues to do so
on known basic types like numbers, booleans, strings. This is necessary
because toString() may have side effects. See issue 16229 for example.

R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//146833007
------------------------------------------------------------------------
r31978 | johnmccutchan@google.com | 2014-01-23 04:21:22 +0900 (木, 23  1月 2014) | 5 lines

Track live instance and allocation counts for classes.

R=iposva@google.com

Review URL: https://codereview.chromium.org//51653006
------------------------------------------------------------------------
r31970 | johnmccutchan@google.com | 2014-01-22 09:46:30 +0900 (水, 22  1月 2014) | 5 lines

Code coverage in Observatory

R=turnidge@google.com

Review URL: https://codereview.chromium.org//143973005
------------------------------------------------------------------------
r31931 | johnmccutchan@google.com | 2014-01-18 06:16:44 +0900 (土, 18  1月 2014) | 12 lines

Change Code object serialization format to use 50% less space.
Update observatory to support new format
Cache code objects inside observatory isolate
Profiler updates cache of code objects
Profiler can display annotated disassembly objects
Code objects now display sample ticks
Fix error viewer
Start using the logging package.

R=turnidge@google.com

Review URL: https://codereview.chromium.org//135843006
------------------------------------------------------------------------
r31877 | lrn@google.com | 2014-01-16 21:06:38 +0900 (木, 16  1月 2014) | 9 lines

Revert "Rename internal library dart:_collection-dev to dart:_internal."

Dartium needs updating too.

Committed: https://code.google.com/p/dart/source/detail?r=31827

R=floitsch@google.com

Review URL: https://codereview.chromium.org//133273011
------------------------------------------------------------------------
r31867 | iposva@google.com | 2014-01-16 14:05:35 +0900 (木, 16  1月 2014) | 7 lines

First round of http://dartbug.com/15922:
- Address warnings about 64-bit to 32-bit conversions.
- Remove heap profiler.

R=asiva@google.com

Review URL: https://codereview.chromium.org//139043003
------------------------------------------------------------------------
r31849 | turnidge@google.com | 2014-01-16 05:45:39 +0900 (木, 16  1月 2014) | 11 lines

Allow root level requests in the vm service.

Move /cpu to the root level.

Move PostReply to the command handlers.  This will allow command
handlers to reply asynchronously (by delegating elsewhere) if they
need to.

R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//131973007
------------------------------------------------------------------------
r31827 | lrn@google.com | 2014-01-15 21:27:44 +0900 (水, 15  1月 2014) | 5 lines

Revert "Rename internal library dart:_collection-dev to dart:_internal."

Dartium needs updating too.

Review URL: https://codereview.chromium.org//133273011
------------------------------------------------------------------------
r31823 | lrn@google.com | 2014-01-15 18:24:46 +0900 (水, 15  1月 2014) | 6 lines

Rename internal library dart:_collection-dev to dart:_internal.

BUG= http://dartbug.com/14140
R=floitsch@google.com

Review URL: https://codereview.chromium.org//133893007
------------------------------------------------------------------------
r31816 | asiva@google.com | 2014-01-15 09:16:45 +0900 (水, 15  1月 2014) | 5 lines

remove resource.h from bin.gypi file (should fix windows build break)

R=iposva@google.com

Review URL: https://codereview.chromium.org//137783007
------------------------------------------------------------------------
r31809 | johnmccutchan@google.com | 2014-01-15 07:34:43 +0900 (水, 15  1月 2014) | 6 lines

Split service into VM and embedder specific bits.
Move most service sources into the VM.

R=asiva@google.com

Review URL: https://codereview.chromium.org//125103004
------------------------------------------------------------------------
r31654 | ajohnsen@google.com | 2014-01-09 20:23:01 +0900 (木, 09  1月 2014) | 5 lines

Really fix Windows build.

BUG=

Review URL: https://codereview.chromium.org//130973005
------------------------------------------------------------------------
r31653 | ajohnsen@google.com | 2014-01-09 19:38:11 +0900 (木, 09  1月 2014) | 5 lines

Fix Windows impl.

BUG=

Review URL: https://codereview.chromium.org//131403002
------------------------------------------------------------------------
r31652 | ajohnsen@google.com | 2014-01-09 19:33:56 +0900 (木, 09  1月 2014) | 6 lines

Fix listing of '' and '/'.

BUG=https://code.google.com/p/dart/issues/detail?id=15966
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//131373002
------------------------------------------------------------------------
r31593 | iposva@google.com | 2014-01-08 09:12:31 +0900 (水, 08  1月 2014) | 6 lines

- Don't wait for the client to time out before finishing the load
  of source code from http.

R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//126583003
------------------------------------------------------------------------
r31468 | sgjesse@google.com | 2014-01-06 19:18:22 +0900 (月, 06  1月 2014) | 6 lines

Make the Platform.environment return value an unmodifiable map

R=ajohnsen@google.com, kustemann@google.com
BUG=http://dartbug.com/15872

Review URL: https://codereview.chromium.org//123263003
------------------------------------------------------------------------
r31447 | johnmccutchan@google.com | 2014-01-04 04:55:50 +0900 (土, 04  1月 2014) | 10 lines

Build map of code regions and address ticks for profile report.
Profile pauses should be less than 500 ms even when handling 120,000 samples (2 minutes @ 1000 hz).
Code objects are referenced by hex address: "code/cafebabe".
Test for retrieving code objects over the service.
Remove old profile tool scripts. Replaced by dprof (https://github.com/dart-lang/dprof) and Observatory UI for profiler.
Support for stable service refs to implicit closures and dispatcher functions.

R=srdjan@google.com

Review URL: https://codereview.chromium.org//100103011
------------------------------------------------------------------------
r31426 | srdjan@google.com | 2014-01-03 04:14:20 +0900 (金, 03  1月 2014) | 10 lines

Better error reporting when passing a non-UTF8 file as script:

./xcodebuild/DebugIA32/dart xcodebuild/DebugIA32/dart

Before: Dart_NewStringFromUTF8 expects argument 'str' to be valid UTF-8.
Now:    ./xcodebuild/DebugIA32/dart is not a valid UTF-8 script

R=asiva@google.com

Review URL: https://codereview.chromium.org//118123006
------------------------------------------------------------------------
r31407 | devoncarew@google.com | 2013-12-31 07:54:11 +0900 (火, 31 12月 2013) | 5 lines

Change the default cutoff for debugging toString() calls.

R=hausner@google.com

Review URL: https://codereview.chromium.org//120863004
------------------------------------------------------------------------
r31394 | iposva@google.com | 2013-12-28 05:56:23 +0900 (土, 28 12月 2013) | 5 lines

- Add used libraries to the imports of the VM service.

R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//118413004
------------------------------------------------------------------------
r31358 | johnmccutchan@google.com | 2013-12-21 07:35:55 +0900 (土, 21 12月 2013) | 10 lines

Refactor VM service IDs:

- IDs are strings which can be concatenated together like paths.
- Isolate ID is now "/isolates/XXX"
- Function, field, class, library, and script IDs are now stable.
- Introduce <type-ref> tags.

R=turnidge@google.com

Review URL: https://codereview.chromium.org//98253009
------------------------------------------------------------------------
r31340 | zra@google.com | 2013-12-21 02:51:34 +0900 (土, 21 12月 2013) | 28 lines

Simplifies standalone VM Android build.

This change also avoids the need to
do another 'gclient runhooks' when switching
between Android and Linux builds, and between
IA32 and ARM Android builds.

gyp does not allow 'libraries' sections inside of
configurations. Therefore, since some architecture
specific paths, libraries, etc. must be specified
on the Android NDK's linker command line, to avoid
re-gyping when switching between Android IA32 and ARM,
this change moves the architecture specific linker
flags to a script, android_link.py.

To avoid re-gyping when swtiching between Linux and
Android, this change creates new configurations
that specify the target OS as well as the the target
architecture, e.g. ReleaseLinuxARM or ReleaseAndroidARM
instead of ReleaseARM.

This change also adds a --toolchain flag to build.py,
and removes obsoleted logic for setting up the Android
build.

R=iposva@google.com

Review URL: https://codereview.chromium.org//105223002
------------------------------------------------------------------------
r31331 | ajohnsen@google.com | 2013-12-20 21:12:17 +0900 (金, 20 12月 2013) | 6 lines

Block other signals while handling a signal.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//118713003
------------------------------------------------------------------------
r31328 | ajohnsen@google.com | 2013-12-20 20:28:53 +0900 (金, 20 12月 2013) | 6 lines

Fix watch move event when path is a not a file.

BUG=https://code.google.com/p/dart/issues/detail?id=15458
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//110533008
------------------------------------------------------------------------
r31291 | asiva@google.com | 2013-12-20 03:42:54 +0900 (金, 20 12月 2013) | 3 lines

Fix build break (true is not defined on windows for C).

Review URL: https://codereview.chromium.org//108493003
------------------------------------------------------------------------
r31286 | asiva@google.com | 2013-12-20 02:47:56 +0900 (金, 20 12月 2013) | 8 lines

Allow the native resolver to setup whether it needs the Dart API scope to
be setup automatically or not when a native function is invoked.
This would allow the embedder to treat some native functions as leaf
functions whose invocation can be very light.

R=hausner@google.com, zra@google.com

Review URL: https://codereview.chromium.org//117723002
------------------------------------------------------------------------
r31276 | ajohnsen@google.com | 2013-12-20 00:07:48 +0900 (金, 20 12月 2013) | 6 lines

Signal handling, take 2.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//119093007
------------------------------------------------------------------------
r31275 | ajohnsen@google.com | 2013-12-19 23:03:15 +0900 (木, 19 12月 2013) | 7 lines

Revert "Signal handling."

This reverts commit r31270.

BUG=

Review URL: https://codereview.chromium.org//105083009
------------------------------------------------------------------------
r31270 | ajohnsen@google.com | 2013-12-19 22:08:26 +0900 (木, 19 12月 2013) | 6 lines

Signal handling.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//108003009
------------------------------------------------------------------------
r31265 | sgjesse@google.com | 2013-12-19 21:41:26 +0900 (木, 19 12月 2013) | 6 lines

Handle failures to AcceptEx calls on Windows

R=ajohnsen@google.com
BUG=http://dartbug.com/11165

Review URL: https://codereview.chromium.org//110223007
------------------------------------------------------------------------
r31263 | ajohnsen@google.com | 2013-12-19 21:26:27 +0900 (木, 19 12月 2013) | 5 lines

Fix Stdout in checked mode.

BUG=

Review URL: https://codereview.chromium.org//119183002
------------------------------------------------------------------------
r31257 | sgjesse@google.com | 2013-12-19 20:35:26 +0900 (木, 19 12月 2013) | 6 lines

Add missing include

TBR=ajohnsen@google.com
BUG=

Review URL: https://codereview.chromium.org//119113002
------------------------------------------------------------------------
r31255 | ajohnsen@google.com | 2013-12-19 19:59:58 +0900 (木, 19 12月 2013) | 6 lines

Add getter for hasTerminal, terminalColumns and terminalLines on stdin.

BUG=https://code.google.com/p/dart/issues/detail?id=15557
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//102123010
------------------------------------------------------------------------
r31233 | turnidge@google.com | 2013-12-19 02:45:17 +0900 (木, 19 12月 2013) | 7 lines

Handle vmservice messages while at breakpoint.

Allow rudimentary inspection of breakpoints from vmservice.

R=hausner@google.com, johnmccutchan@google.com

Review URL: https://codereview.chromium.org//113513004
------------------------------------------------------------------------
r31223 | ajohnsen@google.com | 2013-12-18 21:23:40 +0900 (水, 18 12月 2013) | 14 lines

Fix most UDP issues on Mac OS

We still do not test getting SO_BROADCAST, as it (at least on my laptop)
returns false even if it has just been turned on.

Setting SO_REUSEADDR for datagram sockets also behaves differently
compared to Linux and Windows.

IPv6 multicast as I could not test it on my laptop.

R=ajohnsen@google.com
BUG=http://dartbug.com/1975

Review URL: https://codereview.chromium.org//117723003
------------------------------------------------------------------------
r31220 | sgjesse@google.com | 2013-12-18 20:26:02 +0900 (水, 18 12月 2013) | 6 lines

Add argument checking to InternetAddress constructor

R=ajohnsen@google.com
BUG=http://dartbug.com/15687

Review URL: https://codereview.chromium.org//101913008
------------------------------------------------------------------------
r31205 | iposva@google.com | 2013-12-18 06:11:18 +0900 (水, 18 12月 2013) | 6 lines

- Remove the reply_port from the VM internal message object.
- Adjust all the uses of this API.

R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//93873015
------------------------------------------------------------------------
r31191 | sgjesse@google.com | 2013-12-18 00:35:11 +0900 (水, 18 12月 2013) | 11 lines

Only store the address bytes for an internet address in Dart

We used to store the full C "struct sockaddr_storage" in the Dart
internet address. Changed this to be only the bytes for the
address. This removes opaque platform specific binary data from Dart
(e.g. on Mac OS the "struct sockaddr" has an initial length byte).

R=ajohnsen@google.com
BUG=

Review URL: https://codereview.chromium.org//113923004
------------------------------------------------------------------------
r31170 | johnmccutchan@google.com | 2013-12-17 03:52:15 +0900 (火, 17 12月 2013) | 9 lines

* Introduce ThreadInterrupter which calls a TLS set callback when thread is interrupted.
* Threads can only register and unregister themselves with ThreadInterrupter.
* Profiler is no longer involved in interrupting threads. It's just a callback and the buffer.
* Profiler operates lock free using an atomic operation to reserve sample in sample buffer.
* Linux, Mac, and Windows done.

R=asiva@google.com

Review URL: https://codereview.chromium.org//109803002
------------------------------------------------------------------------
r31162 | ajohnsen@google.com | 2013-12-16 23:48:33 +0900 (月, 16 12月 2013) | 6 lines

Don't make timerfd non-blocking and add errno to error-mesage.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//107143005
------------------------------------------------------------------------
r31156 | ajohnsen@google.com | 2013-12-16 19:38:12 +0900 (月, 16 12月 2013) | 5 lines

Nit fix: 1024 -> KB.

BUG=

Review URL: https://codereview.chromium.org//107283003
------------------------------------------------------------------------
r31155 | ajohnsen@google.com | 2013-12-16 18:12:48 +0900 (月, 16 12月 2013) | 6 lines

Add comment to File copy on linux/android.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//102663005
------------------------------------------------------------------------
r31147 | zra@google.com | 2013-12-14 05:40:33 +0900 (土, 14 12月 2013) | 5 lines

Fixes build of file_android.cc.

Android sendfile takes an off_t offset rather than off64_t.

Review URL: https://codereview.chromium.org//109223005
------------------------------------------------------------------------
r31134 | ajohnsen@google.com | 2013-12-13 23:18:11 +0900 (金, 13 12月 2013) | 5 lines

Add fallback-implementation for sendfile on linux and android.

BUG=

Review URL: https://codereview.chromium.org//99583008
------------------------------------------------------------------------
r31129 | ajohnsen@google.com | 2013-12-13 21:42:14 +0900 (金, 13 12月 2013) | 5 lines

Fix 64-bit linux build after file-copy change.

BUG=

Review URL: https://codereview.chromium.org//115183002
------------------------------------------------------------------------
r31125 | ajohnsen@google.com | 2013-12-13 21:04:24 +0900 (金, 13 12月 2013) | 6 lines

Add File.copy(Sync) to dart:io.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//105133004
------------------------------------------------------------------------
r31116 | johnmccutchan@google.com | 2013-12-13 07:51:51 +0900 (金, 13 12月 2013) | 14 lines

WebSocket client for VM service

* Renames ServiceRequest to Message
* Renames ServiceRequestRouter to MessageRouter
* Service now tracks connected clients.
* Service responds to "clients" message with list of currently connected clients.
* Add WebSocketClient to dart:io service.
* WebSocketClient supports sequence 'seq' values.
* web socket client test.
* Update dartium service for ServiceRequest -> Message rename.

R=turnidge@google.com

Review URL: https://codereview.chromium.org//112223002
------------------------------------------------------------------------
r31107 | zra@google.com | 2013-12-13 04:32:40 +0900 (金, 13 12月 2013) | 3 lines

Fixes build of socket_android.cc

Review URL: https://codereview.chromium.org//114303002
------------------------------------------------------------------------
r31103 | ajohnsen@google.com | 2013-12-13 01:42:26 +0900 (金, 13 12月 2013) | 6 lines

Add getter for lineMode and echoMode for Stdin.

BUG=https://code.google.com/p/dart/issues/detail?id=15424
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//102953008
------------------------------------------------------------------------
r31102 | sgjesse@google.com | 2013-12-13 01:24:56 +0900 (金, 13 12月 2013) | 6 lines

Fix malformed type in socket_patch.dart

TBR=ajohnsen@google.com
BUG=

Review URL: https://codereview.chromium.org//104783006
------------------------------------------------------------------------
r31101 | sgjesse@google.com | 2013-12-13 01:20:13 +0900 (金, 13 12月 2013) | 13 lines

Fix building on Mac OS

Use VOID_TEMP_FAILURE_RETRY macro on Linux and Android as well when
the return value is not used..

TBR=ajohnsen@google.com

Fix analyzer errors in UDP test and update comment in status file

TBR=ajohnsen@google.com
BUG=

Review URL: https://codereview.chromium.org//112593003
------------------------------------------------------------------------
r31098 | sgjesse@google.com | 2013-12-13 00:45:25 +0900 (金, 13 12月 2013) | 21 lines

Add UDP support to dart:io

Initial implementation of UDP support in dart:io

Added a RawDatagramSocket which gets the same events as a RawSocket
except that READ_CLOSED is never received.

The receive from a RawDatagramSocket returns a Datagram object where
the senders address and port is presten together with the data.

The send on a RawDatagramSocket takes data and the address and port of
the destination.

Extended the number of socket options to support UDP.

Added getting the socket options.

R=ajohnsen@google.com
BUG=http://dartbug.com/1975

Review URL: https://codereview.chromium.org//85993002
------------------------------------------------------------------------
r31074 | turnidge@google.com | 2013-12-12 03:03:42 +0900 (木, 12 12月 2013) | 14 lines

Add an instance view page to the vmservice.

We can use this view to browse the field values of objects and explore
the heap a bit.

----------

Add field lists to the class and instance view pages.

Add field-ref and instance-ref elements.

R=johnmccutchan@google.com

Review URL: https://codereview.chromium.org//110703002
------------------------------------------------------------------------
r31029 | hausner@google.com | 2013-12-11 02:41:05 +0900 (水, 11 12月 2013) | 7 lines

Transmit breakpoint id on paused event

Breakpoint callback get an additional parameter to receive the id of the breakpoint that was hit, or 0 if the debugger pauses due to stepping.

R=turnidge@google.com

Review URL: https://codereview.chromium.org//110913002
------------------------------------------------------------------------
r30937 | whesse@google.com | 2013-12-06 17:44:31 +0900 (金, 06 12月 2013) | 6 lines

Update NSS version to NSPR 4.10.2. - dart repository.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//75243003
------------------------------------------------------------------------
r30926 | johnmccutchan@google.com | 2013-12-06 11:20:21 +0900 (金, 06 12月 2013) | 5 lines

Cleanup VM service

R=jacobr@google.com

Review URL: https://codereview.chromium.org//106193003
------------------------------------------------------------------------
r30925 | johnmccutchan@google.com | 2013-12-06 10:09:50 +0900 (金, 06 12月 2013) | 5 lines

Observatory frontend changes for Dartium DevTools.

R=jacobr@google.com

Review URL: https://codereview.chromium.org//105953008
------------------------------------------------------------------------
r30922 | johnmccutchan@google.com | 2013-12-06 08:29:54 +0900 (金, 06 12月 2013) | 6 lines

Add vmservice_dartium.dart script

BUG=
R=jacobr@google.com

Review URL: https://codereview.chromium.org//107173003
------------------------------------------------------------------------
r30897 | whesse@google.com | 2013-12-06 01:26:48 +0900 (金, 06 12月 2013) | 6 lines

Enable more ciphers, and TLS 1.2, in SecureSocket.

BUG=dartbug.com/14646
R=ajohnsen@google.com, wtc@chromium.org

Review URL: https://codereview.chromium.org//102033004
------------------------------------------------------------------------
r30884 | ajohnsen@google.com | 2013-12-05 18:22:07 +0900 (木, 05 12月 2013) | 6 lines

Use timerfd to handle timeouts on Linux.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//104803005
------------------------------------------------------------------------
r30850 | ajohnsen@google.com | 2013-12-04 20:00:08 +0900 (水, 04 12月 2013) | 5 lines

Fix type-error from previous commit.

BUG=

Review URL: https://codereview.chromium.org//104393002
------------------------------------------------------------------------
r30848 | ajohnsen@google.com | 2013-12-04 19:35:00 +0900 (水, 04 12月 2013) | 6 lines

Rewrite file-system-watcher to better handle the different system APIs.

BUG=http://code.google.com/p/dart/issues/detail?id=14941
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//98773002
------------------------------------------------------------------------
r30797 | floitsch@google.com | 2013-12-03 01:27:07 +0900 (火, 03 12月 2013) | 6 lines

Implement scheduleImmediate for the VM.

BUG= http://dartbug.com/9001
R=iposva@google.com

Review URL: https://codereview.chromium.org//79243002
------------------------------------------------------------------------
r30784 | ajohnsen@google.com | 2013-11-29 22:25:05 +0900 (金, 29 11月 2013) | 6 lines

Don't report multiple read-closed events.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//96763004
------------------------------------------------------------------------
r30781 | sgjesse@google.com | 2013-11-29 21:01:26 +0900 (金, 29 11月 2013) | 6 lines

Fix checked mode failure

TBR=ajohnsen@google.com
BUG=

Review URL: https://codereview.chromium.org//96413003
------------------------------------------------------------------------
r30777 | ajohnsen@google.com | 2013-11-29 20:19:57 +0900 (金, 29 11月 2013) | 6 lines

Fix socket to report write errors async.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//96203006
------------------------------------------------------------------------
r30776 | sgjesse@google.com | 2013-11-29 20:18:30 +0900 (金, 29 11月 2013) | 6 lines

Add the index information to network interface

R=ajohnsen@google.com
BUG=

Review URL: https://codereview.chromium.org//95183002
------------------------------------------------------------------------
r30775 | ajohnsen@google.com | 2013-11-29 19:26:00 +0900 (金, 29 11月 2013) | 6 lines

Add test of Zones for HttpServer and RawSocketServer.

BUG=https://code.google.com/p/dart/issues/detail?id=15367
R=floitsch@google.com, sgjesse@google.com

Review URL: https://codereview.chromium.org//93973002
------------------------------------------------------------------------
r30732 | johnmccutchan@google.com | 2013-11-28 04:54:52 +0900 (木, 28 11月 2013) | 6 lines

List scripts in library and display script source

BUG=
R=iposva@google.com

Review URL: https://codereview.chromium.org//59283007
------------------------------------------------------------------------
r30713 | sgjesse@google.com | 2013-11-27 21:12:08 +0900 (水, 27 11月 2013) | 9 lines

Simplify some argument checking for socket calls

Ensure valid range in the C++ code. Leave any argument checking with
"user-friendly" error messaged to the Dart code.

R=ajohnsen@google.com
BUG=

Review URL: https://codereview.chromium.org//91043003
------------------------------------------------------------------------
r30712 | ajohnsen@google.com | 2013-11-27 21:10:23 +0900 (水, 27 11月 2013) | 9 lines

Add support for Websocket protocols.

This also fixes an issue where idle sockets could keep the program
alive.

BUG=https://code.google.com/p/dart/issues/detail?id=14503
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//91223002
------------------------------------------------------------------------
r30710 | ajohnsen@google.com | 2013-11-27 20:48:14 +0900 (水, 27 11月 2013) | 8 lines

Don't report file-system move events on Mac OS, and use no-defer to avoid past events.

Mac OS does not have a proper way to report 'from' and 'to', thus making it impossible to reason the move direction, as other events may shuffle the order, events are received in.

BUG=https://code.google.com/p/dart/issues/detail?id=14806,https://code.google.com/p/dart/issues/detail?id=14793,https://code.google.com/p/dart/issues/detail?id=14849
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//88063002
------------------------------------------------------------------------
r30709 | sgjesse@google.com | 2013-11-27 20:46:20 +0900 (水, 27 11月 2013) | 8 lines

Propagate errors from DartUtils helper functions

Instead of asserting in debug mode just propagate any errors.

R=ajohnsen@google.com
BUG=

Review URL: https://codereview.chromium.org//91293002
------------------------------------------------------------------------
r30685 | johnmccutchan@google.com | 2013-11-27 08:35:35 +0900 (水, 27 11月 2013) | 6 lines

Remove type annotation from _TypedListBase

BUG=https://code.google.com/p/dart/issues/detail?id=12861
R=hausner@google.com

Review URL: https://codereview.chromium.org//80993003
------------------------------------------------------------------------
r30672 | johnmccutchan@google.com | 2013-11-27 03:13:51 +0900 (水, 27 11月 2013) | 6 lines

Call exit instead of returning from main

BUG=
R=iposva@google.com

Review URL: https://codereview.chromium.org//88853002
------------------------------------------------------------------------
r30658 | ajohnsen@google.com | 2013-11-26 16:41:44 +0900 (火, 26 11月 2013) | 6 lines

Use ino64_t on linux, to match the output of stat64.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//87623002
------------------------------------------------------------------------
r30611 | ajohnsen@google.com | 2013-11-25 17:58:32 +0900 (月, 25 11月 2013) | 6 lines

Use EV_ONESHOT in eventhandler on Mac OS.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//85373002
------------------------------------------------------------------------
r30598 | zra@google.com | 2013-11-23 08:40:25 +0900 (土, 23 11月 2013) | 7 lines

Removes EPOLLONESHOT from Android eventhandler.

It doesn't exist in the NDK.

R=iposva@google.com

Review URL: https://codereview.chromium.org//83963003
------------------------------------------------------------------------
r30596 | turnidge@google.com | 2013-11-23 08:02:11 +0900 (土, 23 11月 2013) | 5 lines

Add field and function view for libraries.  Rough cut.

R=iposva@google.com

Review URL: https://codereview.chromium.org//82793004
------------------------------------------------------------------------
r30576 | ajohnsen@google.com | 2013-11-22 22:56:40 +0900 (金, 22 11月 2013) | 5 lines

Fix re-adding to epoll, when event is unhandled.

BUG=

Review URL: https://codereview.chromium.org//83483003
------------------------------------------------------------------------
r30575 | ajohnsen@google.com | 2013-11-22 22:21:12 +0900 (金, 22 11月 2013) | 6 lines

Correctly revert eventhandler_macos.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//82903003
------------------------------------------------------------------------
r30574 | ajohnsen@google.com | 2013-11-22 21:50:29 +0900 (金, 22 11月 2013) | 6 lines

Read up to 8 InterruptMessages at a time, in unix eventhandlers.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//83173003
------------------------------------------------------------------------
r30573 | ajohnsen@google.com | 2013-11-22 21:10:59 +0900 (金, 22 11月 2013) | 6 lines

Revert using one-shot on mac, as it doesn't work as expected.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//82943004
------------------------------------------------------------------------
r30572 | ajohnsen@google.com | 2013-11-22 20:30:15 +0900 (金, 22 11月 2013) | 6 lines

Remove unneded debug printing from FDUtils.

BUG=https://code.google.com/p/dart/issues/detail?id=15005
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//83053002
------------------------------------------------------------------------
r30566 | ajohnsen@google.com | 2013-11-22 17:24:40 +0900 (金, 22 11月 2013) | 9 lines

Limit the number of syscalls made by the Eventhandler.

We now let epoll use EPOLLONESHOT instead of manual unsubscribing, and
only to handle timeouts when no IO events was received.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//82873002
------------------------------------------------------------------------
r30564 | sgjesse@google.com | 2013-11-22 17:02:20 +0900 (金, 22 11月 2013) | 6 lines

More cleanup in the socket C++ code

R=ajohnsen@google.com
BUG=

Review URL: https://codereview.chromium.org//78393005
------------------------------------------------------------------------
r30533 | iposva@google.com | 2013-11-22 02:26:22 +0900 (金, 22 11月 2013) | 9 lines

- Ensure that classes are finalized before their description is
  being generated for the observatory.
- Reset the state that a class is being currently parsed.
- Move the deployed polymer app to a location where it is not
  being overwritten by the tools.
- Do not rely on Dart SDK binaries being in your path.
- Check for errors when invoking dart2js as part of build.dart.

Review URL: https://codereview.chromium.org//77043010
------------------------------------------------------------------------
r30524 | sgjesse@google.com | 2013-11-22 00:22:35 +0900 (金, 22 11月 2013) | 5 lines

Cleanup the getting and setting of the socket file descriptor

R=ajohnsen@google.com

Review URL: https://codereview.chromium.org//81013002
------------------------------------------------------------------------
r30461 | ajohnsen@google.com | 2013-11-20 21:33:05 +0900 (水, 20 11月 2013) | 6 lines

Simplify 0-timers to not go through the eventhandler.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//78103002
------------------------------------------------------------------------
r30459 | sgjesse@google.com | 2013-11-20 21:03:14 +0900 (水, 20 11月 2013) | 6 lines

Fix dart2js after InternetAddress change

R=ajohnsen@google.com, ngeoffray@google.com
BUG=

Review URL: https://codereview.chromium.org//78223002
------------------------------------------------------------------------
r30453 | ajohnsen@google.com | 2013-11-20 19:26:59 +0900 (水, 20 11月 2013) | 6 lines

Only read from interrupt_fd when data is available.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//77983002
------------------------------------------------------------------------
r30449 | sgjesse@google.com | 2013-11-20 19:01:22 +0900 (水, 20 11月 2013) | 14 lines

Update InternetAddress

Add InternetAddress constructor for numeric addresses. An
InternetAddress can now be constructed without using DNS resolving.

Add hash code calculated from the bytes of the address.

Add equality operator comparing the bytes of the address.

Added check for multicast addresses.

R=ajohnsen@google.com

Review URL: https://codereview.chromium.org//76383002
------------------------------------------------------------------------
r30419 | johnmccutchan@google.com | 2013-11-20 03:26:10 +0900 (水, 20 11月 2013) | 6 lines

Sampling profiler

BUG=4350
R=asiva@google.com

Review URL: https://codereview.chromium.org//25909002
------------------------------------------------------------------------
r30415 | ajohnsen@google.com | 2013-11-20 01:24:10 +0900 (水, 20 11月 2013) | 6 lines

Undo some of the large-file changes on Android, as only some of them are implemented.

BUG=
R=zra@google.com

Review URL: https://codereview.chromium.org//76413003
------------------------------------------------------------------------
r30406 | ajohnsen@google.com | 2013-11-19 21:32:29 +0900 (火, 19 11月 2013) | 6 lines

Fix File truncate on Windows.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//76283002
------------------------------------------------------------------------
r30404 | ajohnsen@google.com | 2013-11-19 21:17:57 +0900 (火, 19 11月 2013) | 6 lines

Fix large-file support for mac os x.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//61633003
------------------------------------------------------------------------
r30403 | sgjesse@google.com | 2013-11-19 21:17:41 +0900 (火, 19 11月 2013) | 13 lines

Don't supply host names for the fixed internet addresses

The hard-coded host names "localhost" and "localhost-ip6" where taken
from the default Ubuntu hosts file. But other machines (e.g the
default on Mac OS) might be configured different. To avoid actual
lookup of "localhost" and "localhost-ip6" returning a different
address than the provided fixed loopback addresses don't add an actual
host name.

R=ajohnsen@google.com
BUG=

Review URL: https://codereview.chromium.org//76243002
------------------------------------------------------------------------
r30399 | ajohnsen@google.com | 2013-11-19 20:38:20 +0900 (火, 19 11月 2013) | 6 lines

Add support for working with large files on unix systems, in dart:io.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//63363010
------------------------------------------------------------------------
r30311 | hausner@google.com | 2013-11-16 04:14:47 +0900 (土, 16 11月 2013) | 7 lines

Fix json message in debugger wire protocol

Removed faulty comma in message. This hopefully solves issue 13792.

R=devoncarew@google.com

Review URL: https://codereview.chromium.org//59883019
------------------------------------------------------------------------
r30289 | hausner@google.com | 2013-11-15 04:42:14 +0900 (金, 15 11月 2013) | 5 lines

Add closure object type to debugger wire protocol

R=devoncarew@google.com

Review URL: https://codereview.chromium.org//61153006
------------------------------------------------------------------------
r30150 | sgjesse@google.com | 2013-11-11 20:22:10 +0900 (月, 11 11月 2013) | 6 lines

Provide better error message when the VM tries to load a script using HTTP

R=whesse@google.com
BUG=http://dartbug.com/14924

Review URL: https://codereview.chromium.org//66623002
------------------------------------------------------------------------
r30045 | whesse@google.com | 2013-11-07 21:25:38 +0900 (木, 07 11月 2013) | 6 lines

Restore missing debug flag supression from NSS update.

BUG=dartbug.com/14896
R=ajohnsen@google.com

Review URL: https://codereview.chromium.org//59773011
------------------------------------------------------------------------
r30044 | whesse@google.com | 2013-11-07 21:01:23 +0900 (木, 07 11月 2013) | 6 lines

Update NSS to Chromium revision 232552

BUG=
R=ajohnsen@google.com

Review URL: https://codereview.chromium.org//64113002
------------------------------------------------------------------------
r29952 | iposva@google.com | 2013-11-06 10:08:22 +0900 (水, 06 11月 2013) | 3 lines

- Do not use size_t.

Review URL: https://codereview.chromium.org//59083012
------------------------------------------------------------------------
r29950 | iposva@google.com | 2013-11-06 09:59:46 +0900 (水, 06 11月 2013) | 11 lines

- Add a per-isolate pseudo random number generator to the
  VM internals. This PRNG is not used to generate random
  numbers in Dart code.
- Use the PRNG to generate JIT cookies for large constants
  if needed during assembly.
- Add the possibility to set an external entropy source
  for the PRNG through the C API.

R=asiva@google.com

Review URL: https://codereview.chromium.org//59773007
------------------------------------------------------------------------
r29929 | srdjan@google.com | 2013-11-06 04:27:46 +0900 (水, 06 11月 2013) | 8 lines

In preparation of inlining remainder and modulo binary Smi operations:
- Add REM token
- Fix checking of function fingerprints.
- Remove unused intrinsic for remainder (the function gets inlined and intrinsic is not generated)

R=hausner@google.com

Review URL: https://codereview.chromium.org//59933004
------------------------------------------------------------------------
r29907 | ajohnsen@google.com | 2013-11-05 22:56:18 +0900 (火, 05 11月 2013) | 5 lines

Fix Socket::remoteAddress on Windows to not include port number.

BUG=

Review URL: https://codereview.chromium.org//59073004
------------------------------------------------------------------------
r29904 | ajohnsen@google.com | 2013-11-05 22:24:49 +0900 (火, 05 11月 2013) | 6 lines

Rename remoteHost to remoteAddress on *Socket.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//59213003
------------------------------------------------------------------------
r29895 | ajohnsen@google.com | 2013-11-05 20:57:52 +0900 (火, 05 11月 2013) | 8 lines

Always mark stdout and stderr as blocking on exit.

This is required by some shell systems, such as Emacs.

BUG=https://code.google.com/p/dart/issues/detail?id=14301
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//59393003
------------------------------------------------------------------------
r29878 | whesse@google.com | 2013-11-05 17:10:55 +0900 (火, 05 11月 2013) | 6 lines

Allow Windows network share paths for the script path and the package root.

BUG=dartbug.com/14577
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//57923004
------------------------------------------------------------------------
r29870 | sigmund@google.com | 2013-11-05 10:51:58 +0900 (火, 05 11月 2013) | 5 lines

Switch to new main semantics (fixes issue 14797)

R=jmesserly@google.com

Review URL: https://codereview.chromium.org//57423005
------------------------------------------------------------------------
r29865 | iposva@google.com | 2013-11-05 09:55:41 +0900 (火, 05 11月 2013) | 6 lines

Fix http://dartbug.com/14763
- Find main in the exported names of the root library.
- Unify how the main function is called from spawnUri
  and the initial isolate.

Review URL: https://codereview.chromium.org//48713013
------------------------------------------------------------------------
r29835 | hausner@google.com | 2013-11-05 03:53:58 +0900 (火, 05 11月 2013) | 8 lines

Compile time error on forward references to functions

Like variables, names of functions must not be referenced
before they are declared.

R=srdjan@google.com

Review URL: https://codereview.chromium.org//49253006
------------------------------------------------------------------------
r29642 | sgjesse@google.com | 2013-10-31 14:46:57 +0900 (木, 31 10月 2013) | 20 lines

Implement fromEnvironment on bool, int and String

This implements const constructor fromEnvironment on bool, int and
String.

The VM have the added -Dname=value option to define the value for the
properties. All values are provided by using the -D - nothing is read
from the environment.

If the resulting value is null or - in the case of int.fromEnvironment
- not a number an ArgumentError is thrown.

This CL does not have any implementation for dart2js.

This is a continuation of the change
https://chromiumcodereview.appspot.com/24975002 by iposva@
BUG=
R=iposva@google.com

Review URL: https://codereview.chromium.org//50983002
------------------------------------------------------------------------
r29622 | johnmccutchan@google.com | 2013-10-31 10:26:15 +0900 (木, 31 10月 2013) | 5 lines

Extend Observatory to display libraries, classes, fields, functions and code.

R=sethladd@google.com

Review URL: https://codereview.chromium.org//50243002
------------------------------------------------------------------------
r29570 | whesse@google.com | 2013-10-31 02:46:30 +0900 (木, 31 10月 2013) | 6 lines

Remove dart:io Options class.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//52903002
------------------------------------------------------------------------
r29550 | ajohnsen@google.com | 2013-10-30 23:50:22 +0900 (水, 30 10月 2013) | 6 lines

Add IOSink:flush().

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//52263005
------------------------------------------------------------------------
r29548 | ajohnsen@google.com | 2013-10-30 23:17:29 +0900 (水, 30 10月 2013) | 6 lines

Make FileSystemWatcher work on MIPS and make watching on android the same as linux.

BUG=https://code.google.com/p/dart/issues/detail?id=13553
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//48493003
------------------------------------------------------------------------
r29536 | ajohnsen@google.com | 2013-10-30 21:24:10 +0900 (水, 30 10月 2013) | 6 lines

Fix move-watched-dir for MacOS.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//46183007
------------------------------------------------------------------------
r29535 | lrn@google.com | 2013-10-30 21:09:15 +0900 (水, 30 10月 2013) | 5 lines

Reapply "Remove @deprecated features."

R=scheglov@google.com, sgjesse@google.com

Review URL: https://codereview.chromium.org//50413005
------------------------------------------------------------------------
r29532 | ajohnsen@google.com | 2013-10-30 20:35:33 +0900 (水, 30 10月 2013) | 6 lines

Fire event and close the stream when the watched directory is moved.

BUG=https://code.google.com/p/dart/issues/detail?id=14598
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//52123002
------------------------------------------------------------------------
r29477 | turnidge@google.com | 2013-10-30 03:53:15 +0900 (水, 30 10月 2013) | 17 lines

Add an option to trace the debug protocol to the dart binary:

  --trace_debug_protocol

------------------------
Sample output:

[>>>] Sending message to debug fd 10:
{ "event": "isolate", "params": { "reason": "created", "id": 7114 }}
[>>>] Sending message to debug fd 10:
{ "event": "paused", "params": { "reason": "breakpoint", "isolateId": 7114,"location": { "url":"file:\/\/\/Users\/turnidge\/dart\/DebuggingExample\/bin\/debuggingexample.dart","libraryId":14,"tokenOffset":193}}}
[<<<] Receiving message from debug fd 10:
{"id":1,"command":"getStackTrace","params":{"isolateId":7114}}
[>>>] Sending message to debug fd 10:
{ "id": 1, "result": {"callFrames" : [ {"functionName":"main","location": { "url":"file:\/\/\/Users\/turnidge\/dart\/DebuggingExample\/bin\/debuggingexample.dart","libraryId":14,"tokenOffset":193},"locals":[]}]}}

Review URL: https://codereview.chromium.org//32643005
------------------------------------------------------------------------
r29456 | whesse@google.com | 2013-10-30 01:36:19 +0900 (水, 30 10月 2013) | 6 lines

Remove uses of dart:io Options in dart2js and dartdoc.

BUG=
R=ahe@google.com, rnystrom@google.com

Review URL: https://codereview.chromium.org//50633004
------------------------------------------------------------------------
r29454 | ajohnsen@google.com | 2013-10-30 00:04:59 +0900 (水, 30 10月 2013) | 10 lines

Fix directory-listing to return a future on cancel.

This also fixes an issue where we would leake FDs/HANDLEs if the listing was interrupted.

Add new pause-resume-cancel test of directory listing.

BUG=https://code.google.com/p/dart/issues/detail?id=10163
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//45833003
------------------------------------------------------------------------
r29435 | whesse@google.com | 2013-10-29 20:33:34 +0900 (火, 29 10月 2013) | 8 lines

Remove dart:platform library.

This reverts commits r29154, r29244, r29251, r29268, and r29272.
The dart:io Platform class will not be moved to a dart:platform library.

R=ajohnsen@google.com

Review URL: https://codereview.chromium.org//50573002
------------------------------------------------------------------------
r29421 | sgjesse@google.com | 2013-10-29 18:20:31 +0900 (火, 29 10月 2013) | 6 lines

Fix un-initialized variable

TBR=ricow@google.com
BUG=

Review URL: https://codereview.chromium.org//50163003
------------------------------------------------------------------------
r29418 | sgjesse@google.com | 2013-10-29 17:45:32 +0900 (火, 29 10月 2013) | 13 lines

Remove the reply port form the native isolate handler

The handler function for a native isolate no longer gets an explicit
reply port. Instead the reply port must be sent as part of the message
if required.

The Dart_CObject structure now exposes the send ports in a message to
a native isolate.

R=asiva@google.com, floitsch@google.com, whesse@google.com
BUG=

Review URL: https://codereview.chromium.org//43483004
------------------------------------------------------------------------
r29415 | johnmccutchan@google.com | 2013-10-29 15:12:18 +0900 (火, 29 10月 2013) | 5 lines

Update VM service to new isolate API

R=floitsch@google.com, iposva@google.com

Review URL: https://codereview.chromium.org//38703009
------------------------------------------------------------------------
r29379 | ajohnsen@google.com | 2013-10-29 02:57:22 +0900 (火, 29 10月 2013) | 7 lines

Fix file-system-entity watching on Windows.

This includes disabling a test, as Windows have no way of detecting when the watched directory is deleted.

BUG=

Review URL: https://codereview.chromium.org//47213007
------------------------------------------------------------------------
r29371 | ajohnsen@google.com | 2013-10-29 02:14:43 +0900 (火, 29 10月 2013) | 6 lines

Add 'isDir' to FileSystemEvent.

BUG=https://code.google.com/p/dart/issues/detail?id=14425
R=whesse@google.com

Review URL: https://codereview.chromium.org//48613002
------------------------------------------------------------------------
r29360 | ajohnsen@google.com | 2013-10-28 22:23:13 +0900 (月, 28 10月 2013) | 6 lines

Only listen to full writes, not incremental file changes, in file system watch.

BUG=https://code.google.com/p/dart/issues/detail?id=14372
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//48183003
------------------------------------------------------------------------
r29356 | ajohnsen@google.com | 2013-10-28 21:08:49 +0900 (月, 28 10月 2013) | 6 lines

Correctly pass errors to the stream, when watching file system entities.

BUG=https://code.google.com/p/dart/issues/detail?id=14470
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//47723003
------------------------------------------------------------------------
r29354 | ajohnsen@google.com | 2013-10-28 21:07:46 +0900 (月, 28 10月 2013) | 6 lines

If a move has matching target/destination, signal the event as create or delete.

BUG=https://code.google.com/p/dart/issues/detail?id=14424
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//48513003
------------------------------------------------------------------------
r29271 | floitsch@google.com | 2013-10-26 04:23:00 +0900 (土, 26 10月 2013) | 5 lines

Very simple version of Isolates.

R=ajohnsen@google.com, iposva@google.com, kasperl@google.com, lrn@google.com

Review URL: https://codereview.chromium.org//27215002
------------------------------------------------------------------------
r29268 | whesse@google.com | 2013-10-26 03:25:56 +0900 (土, 26 10月 2013) | 6 lines

dart:platform | Remove isWindows, isLinux, isAndroid, isMacOS from dart:platform.

BUG=
R=iposva@google.com

Review URL: https://codereview.chromium.org//43773004
------------------------------------------------------------------------
r29244 | whesse@google.com | 2013-10-25 20:48:28 +0900 (金, 25 10月 2013) | 6 lines

Add fields to platform library, implement them on runtime dart.

BUG=
R=ahe@google.com, ajohnsen@google.com, floitsch@google.com, sgjesse@google.com

Review URL: https://codereview.chromium.org//36883005
------------------------------------------------------------------------
r29178 | asiva@google.com | 2013-10-25 01:41:22 +0900 (金, 25 10月 2013) | 10 lines

Fix for issue 14236:
Retain script path of parent isolate when spawnFunction is called so that
it works when using script snapshots.

The test case issue14236_test.dart is a script snapshot whose original source
file path is issue14236_source.dart

R=iposva@google.com, sgjesse@google.com

Review URL: https://codereview.chromium.org//35393003
------------------------------------------------------------------------
r29170 | ajohnsen@google.com | 2013-10-24 21:30:20 +0900 (木, 24 10月 2013) | 6 lines

Make FileSystemEntity.watch return a broadcast stream.

BUG=https://code.google.com/p/dart/issues/detail?id=14378
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//39943002
------------------------------------------------------------------------
r29168 | ajohnsen@google.com | 2013-10-24 21:17:20 +0900 (木, 24 10月 2013) | 6 lines

Remove FileException, DirectoryException and LinkException from dart:io and use FileSystemException instaed.

BUG=https://code.google.com/p/dart/issues/detail?id=12461
R=nweiz@google.com, sgjesse@google.com

Review URL: https://codereview.chromium.org//26968003
------------------------------------------------------------------------
r29164 | ajohnsen@google.com | 2013-10-24 19:26:00 +0900 (木, 24 10月 2013) | 6 lines

Fix issue where we would double unwatch the path.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//39773002
------------------------------------------------------------------------
r29163 | ajohnsen@google.com | 2013-10-24 19:24:08 +0900 (木, 24 10月 2013) | 8 lines

Use while(condition) around monitor wait, in file_system_watcher_macos.

This fixes a potential threading-issue, where the wacther could be used before it was fully initialized, if 'wait' woke up before notify.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//39713002
------------------------------------------------------------------------
r29161 | ajohnsen@google.com | 2013-10-24 17:42:07 +0900 (木, 24 10月 2013) | 6 lines

Stop watching when removing watched path, for Mac OS X as well.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//39683002
------------------------------------------------------------------------
r29159 | ajohnsen@google.com | 2013-10-24 17:12:16 +0900 (木, 24 10月 2013) | 6 lines

Close file watcher when target is deleted.

BUG=http://code.google.com/p/dart/issues/detail?id=14374
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//39613002
------------------------------------------------------------------------
r28933 | whesse@google.com | 2013-10-21 23:57:35 +0900 (月, 21 10月 2013) | 6 lines

dart:io | Fix File.rename on Windows to overwrite an existing target.

BUG=dartbug.com/14164
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//28553006
------------------------------------------------------------------------
r28851 | fschneider@google.com | 2013-10-18 20:13:59 +0900 (金, 18 10月 2013) | 17 lines

Optimize identical-comparisons based on propagated type information.

If the propagated type allows, eliminate the check for numbers at
identical operations in optimized code.

The previous optimizaton was done before full type propagation was run
and was therefore not very effective.

* Made flow-graph printing having no side-effects: calling Type() lazily
initializes the type_ and reaching_type_ fields of Value and Definition.
Access fields directly when printing instead.

Also, fixed two random spelling mistakes.

R=srdjan@google.com

Review URL: https://codereview.chromium.org//27727002
------------------------------------------------------------------------
r28829 | iposva@google.com | 2013-10-18 06:59:46 +0900 (金, 18 10月 2013) | 5 lines

- Add the ability to pass the command line options as an argument to main.

R=asiva@google.com, floitsch@google.com

Review URL: https://codereview.chromium.org//27073005
------------------------------------------------------------------------
r28809 | asiva@google.com | 2013-10-18 02:49:45 +0900 (金, 18 10月 2013) | 5 lines

Fix issue 13942 - Dart_Error function invokes OS::VSNPrint with the "format" string containing data derived from the string

R=iposva@google.com

Review URL: https://codereview.chromium.org//27694005
------------------------------------------------------------------------
r28782 | iposva@google.com | 2013-10-17 14:28:00 +0900 (木, 17 10月 2013) | 3 lines

- Update svn:ignore for vmservice bootstrap_css usage.


------------------------------------------------------------------------
r28740 | johnmccutchan@google.com | 2013-10-17 02:49:33 +0900 (木, 17 10月 2013) | 9 lines

Reorganize VM Service client.

This CL is largely a move/rename of the sources so they are laid out in the standard directory layout (the other layout is no longer necessary with the single html and js file deployed output). Buried inside the rename is the out/ directory which contains the observatory deployed as a single js file + html/img assets.

bootstrap_css DEPS have been updated already.

R=iposva@google.com

Review URL: https://codereview.chromium.org//27530002
------------------------------------------------------------------------
r28677 | hausner@google.com | 2013-10-16 04:58:10 +0900 (水, 16 10月 2013) | 5 lines

Handle recursive list structures in debugger

Issue 14108

Review URL: https://codereview.chromium.org//27397002
------------------------------------------------------------------------
r28650 | floitsch@google.com | 2013-10-16 01:02:07 +0900 (水, 16 10月 2013) | 6 lines

Make print interceptable.

BUG= http://dartbug.com/3486
R=lrn@google.com

Review URL: https://codereview.chromium.org//27112002
------------------------------------------------------------------------
r28613 | pquitslund@google.com | 2013-10-15 06:46:06 +0900 (火, 15 10月 2013) | 7 lines

Formatter library entry-point for the masses (w/ gypi update).

(Note the manual change in resource_sources.gypi.  I verified that this works locally.)

R=jmesserly@google.com, johnmccutchan@google.com

Review URL: https://codereview.chromium.org//27247002
------------------------------------------------------------------------
r28569 | floitsch@google.com | 2013-10-13 00:52:17 +0900 (日, 13 10月 2013) | 5 lines

Rename runAsync to scheduleMicrotask.

R=lrn@google.com

Review URL: https://codereview.chromium.org//26151002
------------------------------------------------------------------------
r28527 | iposva@google.com | 2013-10-12 01:50:54 +0900 (土, 12 10月 2013) | 3 lines

- Ignore bootstrap_css.


------------------------------------------------------------------------
r28511 | floitsch@google.com | 2013-10-11 21:02:20 +0900 (金, 11 10月 2013) | 5 lines

Adapt streams for additional stackTrace argument.

R=lrn@google.com

Review URL: https://codereview.chromium.org//25094002
------------------------------------------------------------------------
r28462 | johnmccutchan@google.com | 2013-10-11 01:36:03 +0900 (金, 11 10月 2013) | 5 lines

Initial GUI for VM service

R=asiva@google.com

Review URL: https://codereview.chromium.org//24844002
------------------------------------------------------------------------
r28426 | johnmccutchan@google.com | 2013-10-10 07:24:21 +0900 (木, 10 10月 2013) | 5 lines

Revert 28422

BUG=

Review URL: https://codereview.chromium.org//26686005
------------------------------------------------------------------------
r28422 | johnmccutchan@google.com | 2013-10-10 06:57:33 +0900 (木, 10 10月 2013) | 5 lines

Initial GUI for VM service

R=asiva@google.com

Review URL: https://codereview.chromium.org//24844002
------------------------------------------------------------------------
r28324 | srdjan@google.com | 2013-10-08 05:19:37 +0900 (火, 08 10月 2013) | 5 lines

Cleanups: int -> intptr_t for "array" lengths, memory sizes.

R=asiva@google.com

Review URL: https://codereview.chromium.org//26294002
------------------------------------------------------------------------
r28248 | asiva@google.com | 2013-10-04 07:17:48 +0900 (金, 04 10月 2013) | 10 lines

Fix for 12312 (Dartium crash when reloading after running tests).

Add framework for Dart_Cleanup which will cleanup stuff on exit.
Ideally the VM isolate should be shutdown in Dart_Terminate but we don't
seem to have a clean thread pool shutdown as a result of which there are
racing isolates.

R=iposva@google.com

Review URL: https://codereview.chromium.org//25674009
------------------------------------------------------------------------
r28230 | rmacnak@google.com | 2013-10-04 02:36:41 +0900 (金, 04 10月 2013) | 6 lines

Better error message when attempting to import dart:html on the stand-alone VM.

BUG=http://dartbug.com/3594
R=asiva@google.com, iposva@google.com

Review URL: https://codereview.chromium.org//25826002
------------------------------------------------------------------------
r28215 | whesse@google.com | 2013-10-03 21:55:30 +0900 (木, 03 10月 2013) | 6 lines

Add Directory.systemTemp getter to replace createSystemTemp().

BUG=dartbug.com/12496
R=rnystrom@google.com, sgjesse@google.com

Review URL: https://codereview.chromium.org//25720002
------------------------------------------------------------------------
r28152 | ajohnsen@google.com | 2013-10-02 20:46:25 +0900 (水, 02 10月 2013) | 5 lines

Call correct FATAL macro in EventHandler.

BUG=

Review URL: https://codereview.chromium.org//25484007
------------------------------------------------------------------------
r28151 | ajohnsen@google.com | 2013-10-02 20:36:08 +0900 (水, 02 10月 2013) | 8 lines

Speed up gen_snapshot by writing all bytes at once.

Before we would write one byte at a time, making it extreamly slow on especially Windows.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//25648005
------------------------------------------------------------------------
r28148 | ajohnsen@google.com | 2013-10-02 20:10:13 +0900 (水, 02 10月 2013) | 8 lines

IssueRead for DirectoryWatcherHandle as soon as the watcher starts.

This makes sure we don't miss any initial events.

BUG=https://code.google.com/p/dart/issues/detail?id=13228
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//25687003
------------------------------------------------------------------------
r28146 | ajohnsen@google.com | 2013-10-02 20:03:34 +0900 (水, 02 10月 2013) | 6 lines

Reuse thread when writing stdout/stderr on Windows.

BUG=https://code.google.com/p/dart/issues/detail?id=13541
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//25631005
------------------------------------------------------------------------
r28100 | whesse@google.com | 2013-10-02 01:07:28 +0900 (水, 02 10月 2013) | 6 lines

Fix breakage from r28097

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//25553002
------------------------------------------------------------------------
r28097 | whesse@google.com | 2013-10-02 00:38:01 +0900 (水, 02 10月 2013) | 6 lines

dart:io | Add Directory.CreateSystemTemp(template) and change Directory.CreateTemp(template).

BUG=dartbug.com/12496
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//25279003
------------------------------------------------------------------------
r28090 | ajohnsen@google.com | 2013-10-01 20:27:46 +0900 (火, 01 10月 2013) | 6 lines

Remove usage of legacy inet_ntop from dart:io.

BUG=https://code.google.com/p/dart/issues/detail?id=13577
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//25411003
------------------------------------------------------------------------
r28082 | ajohnsen@google.com | 2013-10-01 18:17:24 +0900 (火, 01 10月 2013) | 6 lines

Use int for size when printing to stdout.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//25401004
------------------------------------------------------------------------
r28081 | ajohnsen@google.com | 2013-10-01 18:05:54 +0900 (火, 01 10月 2013) | 6 lines

Always mark stdout as blocking when using 'print'.

BUG=http://code.google.com/p/dart/issues/detail?id=13712
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//25465002
------------------------------------------------------------------------
r28056 | whesse@google.com | 2013-10-01 00:23:38 +0900 (火, 01 10月 2013) | 6 lines

dart:io | Remove unused asynchronous file request enums.

BUG=
R=ajohnsen@google.com

Review URL: https://codereview.chromium.org//25173004
------------------------------------------------------------------------
r28053 | ajohnsen@google.com | 2013-09-30 23:56:42 +0900 (月, 30  9月 2013) | 8 lines

Don't emit errors from the socket when we are closing it down.

The socket may be deleted at this point, so getting the error can be 'use-after-free'. Also, the actual error doesn't help, as the user can't do anything about a bad close (note that all data is 'flushed' before close is called).

BUG=https://code.google.com/p/dart/issues/detail?id=12982
R=whesse@google.com

Review URL: https://codereview.chromium.org//25276003
------------------------------------------------------------------------
r28017 | asiva@google.com | 2013-09-28 01:55:20 +0900 (土, 28  9月 2013) | 5 lines

Fix 13594.

R=iposva@google.com

Review URL: https://codereview.chromium.org//24785002
------------------------------------------------------------------------
r28010 | whesse@google.com | 2013-09-27 22:36:03 +0900 (金, 27  9月 2013) | 7 lines

Add .address to [Raw]ServerSocket and HttpServer.

Also use .address in Pub's barback server.

R=sgjesse@google.com

Review URL: https://codereview.chromium.org//25010004
------------------------------------------------------------------------
r27926 | regis@google.com | 2013-09-26 10:10:48 +0900 (木, 26  9月 2013) | 5 lines

Fix VM exit code in some cases.

R=asiva@google.com

Review URL: https://codereview.chromium.org//24508004
------------------------------------------------------------------------
r27890 | ajohnsen@google.com | 2013-09-26 01:31:13 +0900 (木, 26  9月 2013) | 6 lines

Don't compile io_service if io is not supported.

BUG=
R=whesse@google.com

Review URL: https://codereview.chromium.org//24612002
------------------------------------------------------------------------
r27888 | ajohnsen@google.com | 2013-09-26 00:53:54 +0900 (木, 26  9月 2013) | 5 lines

Clean up IOService implementation to be shared between patched and non-patched code.

BUG=

Review URL: https://codereview.chromium.org//24596003
------------------------------------------------------------------------
r27883 | ajohnsen@google.com | 2013-09-26 00:03:24 +0900 (木, 26  9月 2013) | 6 lines

Merge services into a shared IOService in dart:io, and use a native port.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//24395013
------------------------------------------------------------------------
r27877 | sgjesse@google.com | 2013-09-25 22:52:15 +0900 (水, 25  9月 2013) | 8 lines

Add property base to the Uri class

Uri.base returns the natural base URI for the current platform.

R=ahe@google.com, floitsch@google.com, iposva@google.com, rnystrom@google.com
BUG=

Review URL: https://codereview.chromium.org//23686021
------------------------------------------------------------------------
r27875 | whesse@google.com | 2013-09-25 20:20:05 +0900 (水, 25  9月 2013) | 5 lines

dart:io | Enable connection cache for secure networking clients.

BUG=dartbug.com/7230

Review URL: https://codereview.chromium.org//24539002
------------------------------------------------------------------------
r27847 | ajohnsen@google.com | 2013-09-25 05:12:49 +0900 (水, 25  9月 2013) | 6 lines

Throw exception if path can't be watched.

BUG=http://code.google.com/p/dart/issues/detail?id=13552
R=zra@google.com

Review URL: https://codereview.chromium.org//23830014
------------------------------------------------------------------------
r27819 | ajohnsen@google.com | 2013-09-24 22:21:33 +0900 (火, 24  9月 2013) | 6 lines

Make stdin blocking when using Stdin::readByte and readLine.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//24315008
------------------------------------------------------------------------
r27811 | ajohnsen@google.com | 2013-09-24 20:47:53 +0900 (火, 24  9月 2013) | 8 lines

Make stdout and stderr async.

This required some minor changes to the Windows eventhandler, as we now spawn a new thread for writes (just like we do for reads).

BUG=https://code.google.com/p/dart/issues/detail?id=7218
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//23609060
------------------------------------------------------------------------
r27803 | whesse@google.com | 2013-09-24 18:34:10 +0900 (火, 24  9月 2013) | 6 lines

Fix socket_android.cc to agree with socket_linux.cc and compile.

BUG=
R=iposva@google.com

Review URL: https://codereview.chromium.org//24165006
------------------------------------------------------------------------
r27703 | sgjesse@google.com | 2013-09-20 21:46:50 +0900 (金, 20  9月 2013) | 11 lines

Fix bugs in SocketAddress

The formatting of IPv6 strings was wrong on Linux and Mac OS - used
the IPv4 structure.

The fixed socket addresses for any and loopback for IPv6 was mixed up.

R=whesse@google.com
BUG=

Review URL: https://codereview.chromium.org//24269017
------------------------------------------------------------------------
r27700 | sgjesse@google.com | 2013-09-20 21:25:08 +0900 (金, 20  9月 2013) | 9 lines

Replace the memcpy macro with a lint check.

This fixes the build under libc++.  It also allows us to check the
Windows and Android code.  While at it, replace all uncaught instances
of memcpy with memmove.

R=sgjesse@google.com

Review URL: https://codereview.chromium.org//23578046
------------------------------------------------------------------------
r27639 | sgjesse@google.com | 2013-09-19 15:33:28 +0900 (木, 19  9月 2013) | 8 lines

Remove duplicated code on Windows

This also gives a litle more info when FormatMessageW fails.

R=whesse@google.com
BUG=

Review URL: https://codereview.chromium.org//23463044
------------------------------------------------------------------------
r27612 | whesse@google.com | 2013-09-18 21:29:47 +0900 (水, 18  9月 2013) | 7 lines

Recommit add FileSystemEntity.resolveSymbolicLinks

This was reverted in r27481 because of a failure on the debug Windows VM buildbot.

BUG=dartbug.com/1016

Review URL: https://codereview.chromium.org//23480093
------------------------------------------------------------------------
r27486 | iposva@google.com | 2013-09-14 01:40:36 +0900 (土, 14  9月 2013) | 6 lines

Fix http://dartbug.com/13297
- Error out early if the current working directory cannot be determined.

R=asiva@google.com

Review URL: https://codereview.chromium.org//23875023
------------------------------------------------------------------------
r27481 | whesse@google.com | 2013-09-14 00:00:26 +0900 (土, 14  9月 2013) | 7 lines

Revert "dart:io | Change File.fullPath to FileSystemEntity.resolveSymbolicLinks."

This reverts commit r27475.

BUG=dartbug.com/1016

Review URL: https://codereview.chromium.org//23658048
------------------------------------------------------------------------
r27475 | whesse@google.com | 2013-09-13 20:15:12 +0900 (金, 13  9月 2013) | 6 lines

dart:io | Change File.fullPath to FileSystemEntity.resolveSymbolicLinks.

BUG=dartbug.com/1016
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//23444037
------------------------------------------------------------------------
r27440 | jacobr@google.com | 2013-09-13 02:45:42 +0900 (金, 13  9月 2013) | 6 lines

Add "function" as an argument to Dart_ActivationFrameInfo

BUG=
R=hausner@google.com

Review URL: https://codereview.chromium.org//23609032
------------------------------------------------------------------------
r27433 | whesse@google.com | 2013-09-12 23:30:23 +0900 (木, 12  9月 2013) | 6 lines

Fix error handling when current working directory is deleted.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//23702037
------------------------------------------------------------------------
r27395 | mlippautz@google.com | 2013-09-12 01:56:12 +0900 (木, 12  9月 2013) | 12 lines

Checks CObject lengths in native API.

Also converts the API to use intptr_t instead of a mixture of int64_t and int. Internally all variable length objects have lengths and maximum values represented as intptr_t (actually Smi ranges). In order to check for these maximum lengths we need to have a common type for 32 and 64 bit platforms.

Helping constructs like IOBuffer can still use 64bit lengths, but have to check that there values are actually in the domain of intptr_t as soon as internal objects are created.

Addresses issue 4314.

BUG=
R=asiva@google.com, sgjesse@google.com

Review URL: https://codereview.chromium.org//23532048
------------------------------------------------------------------------
r27386 | ajohnsen@google.com | 2013-09-12 00:31:44 +0900 (木, 12  9月 2013) | 6 lines

Polish the EventHandler cleanup in r26517.

BUG=
R=iposva@google.com, sgjesse@google.com

Review URL: https://codereview.chromium.org//22918023
------------------------------------------------------------------------
r27384 | ajohnsen@google.com | 2013-09-11 23:29:23 +0900 (水, 11  9月 2013) | 6 lines

Always wait for child processes when forked, even if the process failed.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//23494048
------------------------------------------------------------------------
r27380 | ajohnsen@google.com | 2013-09-11 22:05:13 +0900 (水, 11  9月 2013) | 12 lines

Simplify process exit-code handling on Posix, take 2.

As in https://codereview.chromium.org/24024007, except the monitor->Wait
is now called in a loop with a guard, to ensure we actually do get notified.

Also, now correctly exiting the thread if we have no more child
processes, using the initialize/terminate mutex as guard.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//23717038
------------------------------------------------------------------------
r27283 | ajohnsen@google.com | 2013-09-09 19:33:53 +0900 (月, 09  9月 2013) | 6 lines

Use correct output encoding in Process.runSync.

BUG=https://code.google.com/p/dart/issues/detail?id=13149
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//23528006
------------------------------------------------------------------------
r27251 | ajohnsen@google.com | 2013-09-07 00:02:31 +0900 (土, 07  9月 2013) | 7 lines

Revert "Simplify process exit-code handling on Posix."

This reverts commit f1b1ba410e964b0f787513f245faf8b457c9331a.

BUG=

Review URL: https://codereview.chromium.org//23536032
------------------------------------------------------------------------
r27247 | ajohnsen@google.com | 2013-09-06 22:08:34 +0900 (金, 06  9月 2013) | 9 lines

Simplify process exit-code handling on Posix.

We now only use waitpid and not signals. When we exit, we perform a
small fork-and-exit to interrupt waitpid, so it can exit the thread.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//24024007
------------------------------------------------------------------------
r27197 | whesse@google.com | 2013-09-06 00:04:59 +0900 (金, 06  9月 2013) | 6 lines

Fix android build of runtime.

BUG=
R=ajohnsen@google.com

Review URL: https://codereview.chromium.org//23978006
------------------------------------------------------------------------
r27196 | ajohnsen@google.com | 2013-09-05 23:54:38 +0900 (木, 05  9月 2013) | 10 lines

Move delete/deleteSync up to FileSystemEntity, with a shared documentation.

This also means that FileSystemEntity.delete(recursive: true) now will
delete any object on disk, much like 'rm -r', without the need of
wrapping it in a Directory object.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//23889008
------------------------------------------------------------------------
r27178 | ajohnsen@google.com | 2013-09-05 17:14:48 +0900 (木, 05  9月 2013) | 6 lines

Be sure to enter monitor before notifying, in file_system_watcher_macos.

BUG=https://code.google.com/p/dart/issues/detail?id=13065
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//23967004
------------------------------------------------------------------------
r27131 | sgjesse@google.com | 2013-09-04 22:52:59 +0900 (水, 04  9月 2013) | 6 lines

Remove ASSERT which was reported as a race by ThreadSanitizer

R=whesse@google.com
BUG=

Review URL: https://codereview.chromium.org//23903007
------------------------------------------------------------------------
r27064 | ajohnsen@google.com | 2013-09-04 00:42:02 +0900 (水, 04  9月 2013) | 6 lines

Make file system watcher compile on Mac OS 106, and add a runtime-call to test if the system supports the feature.

BUG=
R=kustermann@google.com, sgjesse@google.com

Review URL: https://codereview.chromium.org//23483030
------------------------------------------------------------------------
r27051 | ajohnsen@google.com | 2013-09-03 22:13:36 +0900 (火, 03  9月 2013) | 6 lines

Move _FileSystemWatcher to IO patch since it extends NativeFieldWrapperClass1.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//23615005
------------------------------------------------------------------------
r27048 | ajohnsen@google.com | 2013-09-03 21:43:08 +0900 (火, 03  9月 2013) | 6 lines

Add FileSystemWatcher class to dart:io.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//19263003
------------------------------------------------------------------------
r26898 | hausner@google.com | 2013-08-30 08:24:23 +0900 (金, 30  8月 2013) | 8 lines

Evaluation of expression in context of library top-level

Third and final part of expression evaluation in the context
of an (object|class|library).

R=iposva@google.com

Review URL: https://codereview.chromium.org//23514020
------------------------------------------------------------------------
r26789 | floitsch@google.com | 2013-08-28 23:05:11 +0900 (水, 28  8月 2013) | 5 lines

Remove usage of dart:json.

R=jmesserly@google.com, lrn@google.com, nweiz@google.com, rnystrom@google.com

Review URL: https://codereview.chromium.org//23596007
------------------------------------------------------------------------
r26712 | floitsch@google.com | 2013-08-27 22:18:34 +0900 (火, 27  8月 2013) | 5 lines

Some more removals of dart:utf.

R=jmesserly@google.com, lrn@google.com, nweiz@google.com

Review URL: https://codereview.chromium.org//22909059
------------------------------------------------------------------------
r26697 | sgjesse@google.com | 2013-08-27 18:13:21 +0900 (火, 27  8月 2013) | 6 lines

Get rid of some downcasts

R=whesse@google.com
BUG=

Review URL: https://codereview.chromium.org//23540002
------------------------------------------------------------------------
r26668 | hausner@google.com | 2013-08-27 05:59:16 +0900 (火, 27  8月 2013) | 7 lines

JSON string decoding for VM debugger

The VM must properly decode JSON strings it receives.

R=regis@google.com

Review URL: https://codereview.chromium.org//23439002
------------------------------------------------------------------------
r26642 | whesse@google.com | 2013-08-26 21:28:08 +0900 (月, 26  8月 2013) | 9 lines

Fix android compilation by copying process_linux.cc to process_android.cc.

These files, in runtime/bin, are the native functions supporting the dart:io
Process class.  The android version hadn't been updated when the linux version was changed.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//23428002
------------------------------------------------------------------------
r26632 | floitsch@google.com | 2013-08-26 19:37:25 +0900 (月, 26  8月 2013) | 7 lines

Remove Encoding-enum from dart:io and add interface in dart:convert.

BUG= http://dartbug.com/6284
BUG= http://dartbug.com/7966
R=nweiz@google.com, sgjesse@google.com

Review URL: https://codereview.chromium.org//22872012
------------------------------------------------------------------------
r26617 | hausner@google.com | 2013-08-24 07:42:41 +0900 (土, 24  8月 2013) | 8 lines

Evaluate expression in the context of a class

Allows debugger to evaluate an expression in the context of a
static method of a class.

R=srdjan@google.com

Review URL: https://codereview.chromium.org//23102019
------------------------------------------------------------------------
r26577 | ajohnsen@google.com | 2013-08-23 16:12:11 +0900 (金, 23  8月 2013) | 6 lines

Update ZLib/GZip in dart:io to be a Codec/Converter from dart:convert.

BUG=
R=floitsch@google.com, sgjesse@google.com

Review URL: https://codereview.chromium.org//22867033
------------------------------------------------------------------------
r26517 | ajohnsen@google.com | 2013-08-22 21:03:59 +0900 (木, 22  8月 2013) | 6 lines

Always initialize the EventHandler in the standalone.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//22901017
------------------------------------------------------------------------
r26432 | whesse@google.com | 2013-08-22 00:21:55 +0900 (木, 22  8月 2013) | 6 lines

Add Platform.packageRoot and Platform.executableArguments to dart:io.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//22999033
------------------------------------------------------------------------
r26387 | jacobr@google.com | 2013-08-21 05:24:11 +0900 (水, 21  8月 2013) | 5 lines

fix cpp11 compile errors

R=asiva@google.com

Review URL: https://codereview.chromium.org//23072026
------------------------------------------------------------------------
r26328 | hausner@google.com | 2013-08-20 07:17:09 +0900 (火, 20  8月 2013) | 5 lines

Evaluate expression in context of an object

This is the core functionality needed for the debugger.

Review URL: https://codereview.chromium.org//23067006
------------------------------------------------------------------------
r26286 | kevmoo@j832.com | 2013-08-17 03:04:48 +0900 (土, 17  8月 2013) | 5 lines

because Kasper cares

R=kasperl@google.com

Review URL: https://codereview.chromium.org//22904004
------------------------------------------------------------------------
r26201 | johnmccutchan@google.com | 2013-08-16 01:53:25 +0900 (金, 16  8月 2013) | 5 lines

Fix absolute paths on Windows without a drive letter.

BUG=11946

Review URL: https://codereview.chromium.org//23199002
------------------------------------------------------------------------
r26194 | sgjesse@google.com | 2013-08-15 23:55:53 +0900 (木, 15  8月 2013) | 17 lines

Remove the certificate management methods from dart:io

Certificate management functions where added to dart:io in r25610 and
r26002. However these functions where mutating the NSS database for
the whole Dart process, and some functions where also persisting the
changes to the database.

This might cause issues when running multiple isolates as changes in
one isolate will affect other isolates and could lead to unexpected
results.

These functions are removed from dart:io for now.

BUG=http://dartbug.com/8227
TBR=ager@google.com

Review URL: https://codereview.chromium.org//22887014
------------------------------------------------------------------------
r26108 | sgjesse@google.com | 2013-08-14 17:07:29 +0900 (水, 14  8月 2013) | 9 lines

Remove bogus Dart_ExitScope calls

When the Dart_EnterScope/Dart_ExitScope calls where removed some
Dart_ExitScope calls in error returns where not removed.

R=whesse@google.com
BUG=

Review URL: https://codereview.chromium.org//22890003
------------------------------------------------------------------------
r26057 | sgjesse@google.com | 2013-08-14 00:56:47 +0900 (水, 14  8月 2013) | 12 lines

Fix Process.runSync on 64-bit Mac OS

Turned out that for poll on 64-bin Mac OS POLLIN set with 0 available
bytes means closed even though POLLHUP is not set.

Also slighty refactored the loop in the Linux version to make them
look the same.

R=whesse@google.com
BUG=

Review URL: https://codereview.chromium.org//23076002
------------------------------------------------------------------------
r26052 | sgjesse@google.com | 2013-08-13 23:12:31 +0900 (火, 13  8月 2013) | 7 lines

Add Process.runSync for running processes synchronously

BUG=http://dartbug.com/1707

R=whesse@google.com

Review URL: https://codereview.chromium.org//21816002
------------------------------------------------------------------------
r26027 | regis@google.com | 2013-08-13 05:28:52 +0900 (火, 13  8月 2013) | 11 lines

Implement updated method overriding rules in the vm (issue 11495).
Introduce --error-on-bad-override flag and use it when generating snapshots.
Fix signature checking when patching methods.
Fix errors in patch files.
Fix receiver type of constructors.
Fix finalization of mixin application typedefs.
Update tests and status files.

R=asiva@google.com

Review URL: https://codereview.chromium.org//22685007
------------------------------------------------------------------------
r26002 | whesse@google.com | 2013-08-12 22:50:53 +0900 (月, 12  8月 2013) | 8 lines

dart:io | Add SecureSocket.importPrivateCertificates, that reads a PKCS#12 file.

Add private key with certificate to SecureSocket

BUG=
R=sgjesse@google.com, wtc@chromium.org

Review URL: https://codereview.chromium.org//21716004
------------------------------------------------------------------------
r25943 | cbracken@google.com | 2013-08-09 05:24:05 +0900 (金, 09  8月 2013) | 10 lines

Replaced strerror() calls with threadsafe strerror_r().

Mac/Android use the XSI-compliant definition of strerror_r() which stores the message in the passed-in buffer.

Linux uses the GNU-specific definition of strerror_r() which takes a buffer and returns the message in a char* (which may or may not be the passed-in buffer).

BUG=
R=iposva@google.com

Review URL: https://codereview.chromium.org//22634003
------------------------------------------------------------------------
r25927 | johnmccutchan@google.com | 2013-08-09 00:44:21 +0900 (金, 09  8月 2013) | 6 lines

Remove race(s) in vmservice tests.

BUG=https://code.google.com/p/dart/issues/detail?id=12294
R=iposva@google.com

Review URL: https://codereview.chromium.org//22607005
------------------------------------------------------------------------
r25913 | sgjesse@google.com | 2013-08-08 16:19:21 +0900 (木, 08  8月 2013) | 7 lines

Make the values of Platform.executable and Platform.script available to all isolates

BUG=http://dartbug.com/12258

R=iposva@google.com

Review URL: https://codereview.chromium.org//22565003
------------------------------------------------------------------------
r25890 | cbracken@google.com | 2013-08-08 02:28:04 +0900 (木, 08  8月 2013) | 20 lines

Fixes to get Dart VM compiling on Ubuntu 13.04, Debian Wheezy.
* Convince gcc 4.7.x that len is initialized before use in callers of ReadFileFully()
* Cast RawObject* to intptr_t to avoid strict-aliasing error on gcc 4.7.x
* Replace two calls to strerror_r() with strerror() on Linux. When _GNU_SOURCE is
  defined to be non-zero (as it is on Dart Linux builds), strerror_r() is
  defined to return a char*, which is the correct error string to use. When
  _GNU_SOURCE is zero, the XSI-compliant definition is used and the error
  message is returned in the char* param. Surrounding error logging uses
  strerror() which solves the problem.
* Replace int literals with char literals in test string definition.
* co19 math/tan_A01_t01 passes on Ubuntu 13.04.

Original issues:
https://code.google.com/p/dart/issues/detail?id=12085
https://code.google.com/p/dart/issues/detail?id=8807

BUG=
R=asiva@google.com

Review URL: https://codereview.chromium.org//22381002
------------------------------------------------------------------------
r25827 | asiva@google.com | 2013-08-07 04:27:48 +0900 (水, 07  8月 2013) | 10 lines

Auto create ApiLocalScope before calling native functions, this ensures that
native functions do not have to call Dart_EnterScope/Dart_ExitScope
when they callback into the VM.

Remove Dart_EnterScope/Dart_ExitScope calls around native functions in 'bin'
directory.

R=regis@google.com, srdjan@google.com

Review URL: https://codereview.chromium.org//22303002
------------------------------------------------------------------------
r25744 | johnmccutchan@google.com | 2013-08-03 06:40:13 +0900 (土, 03  8月 2013) | 6 lines

Cleanup vm_service library loading.

BUG=11927
R=asiva@google.com

Review URL: https://codereview.chromium.org//21880004
------------------------------------------------------------------------
r25732 | ajohnsen@google.com | 2013-08-02 22:12:24 +0900 (金, 02  8月 2013) | 6 lines

Fix a Socket edge-case where the socket is closed by peer right after accept, where we havn't set a close-handler yet.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//21802002
------------------------------------------------------------------------
r25726 | johnmccutchan@google.com | 2013-08-02 09:24:09 +0900 (金, 02  8月 2013) | 5 lines

Support stacktrace and objecthistogram service commands

R=asiva@google.com

Review URL: https://codereview.chromium.org//19870006
------------------------------------------------------------------------
r25620 | whesse@google.com | 2013-07-31 01:02:54 +0900 (水, 31  7月 2013) | 6 lines

Fix sample_extension_test on 64-bit macos.

BUG=
R=kustermann@google.com

Review URL: https://codereview.chromium.org//21015007
------------------------------------------------------------------------
r25610 | whesse@google.com | 2013-07-30 19:01:07 +0900 (火, 30  7月 2013) | 6 lines

Add SecureSocket.addCertificate.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//18097007
------------------------------------------------------------------------
r25608 | kustermann@google.com | 2013-07-30 16:13:33 +0900 (火, 30  7月 2013) | 5 lines

Fixed memory leaks in runtime/bin/dartutils.cc

R=asiva@google.com

Review URL: https://codereview.chromium.org//21022008
------------------------------------------------------------------------
r25519 | whesse@google.com | 2013-07-26 22:39:18 +0900 (金, 26  7月 2013) | 6 lines

dart:io | Fix handling of exceptions from onBadCertificate callback.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//20316002
------------------------------------------------------------------------
r25413 | ajohnsen@google.com | 2013-07-24 22:51:55 +0900 (水, 24  7月 2013) | 6 lines

Add echo and line modes to Stdin.

BUG=https://code.google.com/p/dart/issues/detail?id=8190,https://code.google.com/p/dart/issues/detail?id=9825,https://code.google.com/p/dart/issues/detail?id=11659
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//19627004
------------------------------------------------------------------------
r25332 | ajohnsen@google.com | 2013-07-23 17:59:23 +0900 (火, 23  7月 2013) | 6 lines

Report correct socket error and use HttpServer:close future in pub.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//19494012
------------------------------------------------------------------------
r25279 | johnmccutchan@google.com | 2013-07-23 00:39:03 +0900 (火, 23  7月 2013) | 5 lines

VM Service isolate listing

R=asiva@google.com

Review URL: https://codereview.chromium.org//19622003
------------------------------------------------------------------------
r25258 | ajohnsen@google.com | 2013-07-22 17:54:54 +0900 (月, 22  7月 2013) | 6 lines

Close 'accepted' sockets when listening socket is closed. Fixes raw_server_socket_cancel_test.

BUG=https://code.google.com/p/dart/issues/detail?id=8675
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//19675009
------------------------------------------------------------------------
r25228 | ajohnsen@google.com | 2013-07-20 02:08:17 +0900 (土, 20  7月 2013) | 6 lines

Also check for pending write for FileHandles in EventHandler.

BUG=
R=kustermann@google.com

Review URL: https://codereview.chromium.org//19724005
------------------------------------------------------------------------
r25226 | ajohnsen@google.com | 2013-07-20 01:52:16 +0900 (土, 20  7月 2013) | 7 lines

Don't call accept the c socket, if we're currently closing.

Fixes a crash on Windows.

BUG=

Review URL: https://codereview.chromium.org//19693007
------------------------------------------------------------------------
r25213 | ajohnsen@google.com | 2013-07-19 22:26:48 +0900 (金, 19  7月 2013) | 15 lines

Keep track of when a socket has been destroyed

This adds the event CLOSED to RawSocket and RawServerSocket. This
event indicate that the underlying socket is now destroyed.

This is used to make Socket.close and ServerSocket.close return a
future which is completed when the unserlying socket is
destroyed. This can be used to start listening on the same port after
closing a server socket.

R=ajohnsen@google.com, kustermann@google.com

BUG=https://code.google.com/p/dart/issues/detail?id=4155

Review URL: https://codereview.chromium.org//14864009
------------------------------------------------------------------------
r25087 | ajohnsen@google.com | 2013-07-17 18:06:03 +0900 (水, 17  7月 2013) | 6 lines

Clear EventHandler on Stop, to avoid future usages.

BUG=
R=fschneider@google.com, kustermann@google.com

Review URL: https://codereview.chromium.org//19546002
------------------------------------------------------------------------
r25082 | ajohnsen@google.com | 2013-07-17 16:26:05 +0900 (水, 17  7月 2013) | 6 lines

One event ahndler for all isolates

BUG=
R=whesse@google.com

Review URL: https://codereview.chromium.org//17851004
------------------------------------------------------------------------
r25076 | johnmccutchan@google.com | 2013-07-17 07:17:52 +0900 (水, 17  7月 2013) | 6 lines

Command line parameter check
VM Service isolate startup and shutdown

R=asiva@google.com

Review URL: https://codereview.chromium.org//19231005
------------------------------------------------------------------------
r25048 | whesse@google.com | 2013-07-17 00:07:45 +0900 (水, 17  7月 2013) | 5 lines

Add dummy implementation of SecureSocket_Renegotiate to Android platform.

BUG=

Review URL: https://codereview.chromium.org//19269011
------------------------------------------------------------------------
r25034 | regis@google.com | 2013-07-16 08:33:24 +0900 (火, 16  7月 2013) | 5 lines

Return a different exit code from the vm after compilation errors (issue 5525).

R=asiva@google.com

Review URL: https://codereview.chromium.org//19284006
------------------------------------------------------------------------
r25011 | johnmccutchan@google.com | 2013-07-16 01:57:48 +0900 (火, 16  7月 2013) | 5 lines

Remove VM Stats

R=iposva@google.com

Review URL: https://codereview.chromium.org//18611003
------------------------------------------------------------------------
r25000 | floitsch@google.com | 2013-07-15 19:32:37 +0900 (月, 15  7月 2013) | 13 lines

Cleanup VM error handling.

Unify the way the runtime throws errors. With this patch the VM goes through one location and always invokes the constructor of the errors.

It also makes it easier to rename fields in the error classes.

R=asiva@google.com

Committed: https://code.google.com/p/dart/source/detail?r=24995

Reverted: https://code.google.com/p/dart/source/detail?r=24997

Review URL: https://codereview.chromium.org//18531003
------------------------------------------------------------------------
r24997 | floitsch@google.com | 2013-07-15 19:18:50 +0900 (月, 15  7月 2013) | 5 lines

Revert "Cleanup VM error handling."

This reverts commit r24995.

Review URL: https://codereview.chromium.org//19172002
------------------------------------------------------------------------
r24995 | floitsch@google.com | 2013-07-15 18:28:28 +0900 (月, 15  7月 2013) | 9 lines

Cleanup VM error handling.

Unify the way the runtime throws errors. With this patch the VM goes through one location and always invokes the constructor of the errors.

It also makes it easier to rename fields in the error classes.

R=asiva@google.com

Review URL: https://codereview.chromium.org//18531003
------------------------------------------------------------------------
r24991 | ajohnsen@google.com | 2013-07-15 17:40:36 +0900 (月, 15  7月 2013) | 6 lines

Move MimeMultipartTransformer and HttpBodyHandler to mime and http_server packages.

BUG=
R=whesse@google.com

Review URL: https://codereview.chromium.org//18438005
------------------------------------------------------------------------
r24941 | ajohnsen@google.com | 2013-07-12 19:39:02 +0900 (金, 12  7月 2013) | 6 lines

Remove _BufferList from dart:io and now use BytesBuilder.

BUG=
R=whesse@google.com

Review URL: https://codereview.chromium.org//18031023
------------------------------------------------------------------------
r24916 | whesse@google.com | 2013-07-11 23:02:49 +0900 (木, 11  7月 2013) | 6 lines

dart:io | Support connection renegotiation (rehandshake) on SecureSocket.

BUG=dartbug.com/11384
R=ajohnsen@google.com

Review URL: https://codereview.chromium.org//18984008
------------------------------------------------------------------------
r24907 | whesse@google.com | 2013-07-11 19:02:11 +0900 (木, 11  7月 2013) | 6 lines

dart:io | Fix SecureSocket client certificate problem with database password.

BUG=
R=ajohnsen@google.com

Review URL: https://codereview.chromium.org//18876003
------------------------------------------------------------------------
r24865 | iposva@google.com | 2013-07-10 06:14:31 +0900 (水, 10  7月 2013) | 6 lines

- Use TCP_NODELAY when using the coverage tool and ddbg.
- Use IPPROTO_TCP instead of SOL_TCP for increased portability.

R=asiva@google.com, hausner@google.com

Review URL: https://codereview.chromium.org//18829003
------------------------------------------------------------------------
r24858 | regis@google.com | 2013-07-10 03:42:49 +0900 (水, 10  7月 2013) | 4 lines

Take into account virtual devices (e.g. OpenVPN tun0) when iterating network
interfaces. Their network address is NULL.

Review URL: https://codereview.chromium.org//18268003
------------------------------------------------------------------------
r24784 | ajohnsen@google.com | 2013-07-05 21:36:10 +0900 (金, 05  7月 2013) | 6 lines

Add 'address' and 'port' to SocketException, and include them in toString().

BUG=
R=whesse@google.com

Review URL: https://codereview.chromium.org//18154005
------------------------------------------------------------------------
r24765 | whesse@google.com | 2013-07-04 18:21:01 +0900 (木, 04  7月 2013) | 6 lines

dart:io | Pass errors from multithreaded encryption back to Dart.

BUG=dartbug.com/11383
R=ajohnsen@google.com

Review URL: https://codereview.chromium.org//18500006
------------------------------------------------------------------------
r24722 | ajohnsen@google.com | 2013-07-03 20:43:02 +0900 (水, 03  7月 2013) | 6 lines

Remove old code for dealing with non-typed buffers in Socket.write.

BUG=
R=whesse@google.com

Review URL: https://codereview.chromium.org//18608005
------------------------------------------------------------------------
r24685 | ajohnsen@google.com | 2013-07-02 22:29:34 +0900 (火, 02  7月 2013) | 5 lines

Fix Stdio->Stdin typo and missing external.

BUG=

Review URL: https://codereview.chromium.org//18532002
------------------------------------------------------------------------
r24684 | ajohnsen@google.com | 2013-07-02 22:18:00 +0900 (火, 02  7月 2013) | 6 lines

Add Stdio.readByteSync and Stdio.readLineSync.

BUG=https://code.google.com/p/dart/issues/detail?id=7136
R=whesse@google.com

Review URL: https://codereview.chromium.org//18516002
------------------------------------------------------------------------
r24623 | ajohnsen@google.com | 2013-07-01 20:23:17 +0900 (月, 01  7月 2013) | 6 lines

Extract the correct os-error on Socket.write, and report correctly in IOSink.

BUG=
R=whesse@google.com

Review URL: https://codereview.chromium.org//18324006
------------------------------------------------------------------------
r24620 | asiva@google.com | 2013-06-30 03:19:33 +0900 (日, 30  6月 2013) | 11 lines

Make writes consistent across socket and file synchronous/asynchronus writes in terms of truncation semantics (reports an argument error if the list element contains a non byte value).

Remove Common_IsBuiltinList as it is not used anymore

Change synchronous file writes to use Dart_TypedDataAcquireData and
Dart_TypedDataReleaseData since the buffer object is always a Uint8List
instead of the more expensive Dart_ListGetAsBytes.

R=ajohnsen@google.com, iposva@google.com

Review URL: https://codereview.chromium.org//18115002
------------------------------------------------------------------------
r24578 | ajohnsen@google.com | 2013-06-28 19:29:21 +0900 (金, 28  6月 2013) | 6 lines

Implement redirect-stdout-on-close on Winows, to the 'NUL' device.

BUG=https://code.google.com/p/dart/issues/detail?id=11593
R=kustermann@google.com, whesse@google.com

Review URL: https://codereview.chromium.org//18194003
------------------------------------------------------------------------
r24576 | ajohnsen@google.com | 2013-06-28 17:44:15 +0900 (金, 28  6月 2013) | 6 lines

Remove static mutexes/monitors from dart:io.

BUG=
R=whesse@google.com

Review URL: https://codereview.chromium.org//18080010
------------------------------------------------------------------------
r24526 | ajohnsen@google.com | 2013-06-28 01:45:40 +0900 (金, 28  6月 2013) | 6 lines

Fix comment from earlier commit.

BUG=
R=iposva@google.com

Review URL: https://codereview.chromium.org//18087003
------------------------------------------------------------------------
r24525 | ajohnsen@google.com | 2013-06-28 01:44:39 +0900 (金, 28  6月 2013) | 9 lines

Stop printing when stdout is closed.

This makes sure we don't print(...) data to a file opened after stdout
was closed.

BUG=https://code.google.com/p/dart/issues/detail?id=9615
R=kustermann@google.com, whesse@google.com

Review URL: https://codereview.chromium.org//18031003
------------------------------------------------------------------------
r24510 | whesse@google.com | 2013-06-27 17:31:17 +0900 (木, 27  6月 2013) | 6 lines

Fix runtime build for Android

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//17860002
------------------------------------------------------------------------
r24505 | iposva@google.com | 2013-06-27 10:14:12 +0900 (木, 27  6月 2013) | 3 lines

- Use VOID_TEMP_FAILURE_RETRY where needed

Review URL: https://codereview.chromium.org//17840009
------------------------------------------------------------------------
r24471 | ajohnsen@google.com | 2013-06-27 00:12:56 +0900 (木, 27  6月 2013) | 8 lines

Avoid picking port 65535 for ServerSockets, when any is requested.

Some browsers block requests to 65535.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//17842003
------------------------------------------------------------------------
r24468 | sgjesse@google.com | 2013-06-26 23:09:29 +0900 (水, 26  6月 2013) | 6 lines

dart:io | Add rename to Link

R=whesse@google.com
BUG=

Review URL: https://codereview.chromium.org//17848003
------------------------------------------------------------------------
r24467 | sgjesse@google.com | 2013-06-26 22:45:58 +0900 (水, 26  6月 2013) | 8 lines

Change the timeout handling in the standalone VM to use 64-bit integers - take 2

Missed two places in previous commit.

TBR=floitsch@google.com
BUG=

Review URL: https://codereview.chromium.org//17888002
------------------------------------------------------------------------
r24466 | sgjesse@google.com | 2013-06-26 22:33:10 +0900 (水, 26  6月 2013) | 6 lines

Change the timeout handling in the standalone VM to use 64-bit integers

R=floitsch@google.com
BUG=

Review URL: https://codereview.chromium.org//17878002
------------------------------------------------------------------------
r24405 | whesse@google.com | 2013-06-25 22:54:42 +0900 (火, 25  6月 2013) | 6 lines

dart:io | Change names for SecureSocket exceptions.

BUG=
R=ajohnsen@google.com, sgjesse@google.com

Review URL: https://codereview.chromium.org//17589007
------------------------------------------------------------------------
r24401 | sgjesse@google.com | 2013-06-25 21:56:23 +0900 (火, 25  6月 2013) | 10 lines

Move getters from Options to Platform

The getters for executable, script and version are now statics on
Platform. I kept them on Options for now, but updated most tests to
use Platform.

R=ajohnsen@google.com, floitsch@google.com, iposva@google.com
BUG=

Review URL: https://codereview.chromium.org//17406010
------------------------------------------------------------------------
r24399 | sgjesse@google.com | 2013-06-25 21:11:45 +0900 (火, 25  6月 2013) | 6 lines

Fix checked mode error in previous commit

TBR=ajohnsen@google.com
BUG=

Review URL: https://codereview.chromium.org//17589021
------------------------------------------------------------------------
r24397 | sgjesse@google.com | 2013-06-25 20:47:55 +0900 (火, 25  6月 2013) | 8 lines

Detect EOF when reading stdio from terminal on Mac OS

R=ajohnsen@google.com
BUG=http://dartbug.com/453

patch from issue 17381012

Review URL: https://codereview.chromium.org//17463003
------------------------------------------------------------------------
r24396 | ajohnsen@google.com | 2013-06-25 20:40:10 +0900 (火, 25  6月 2013) | 5 lines

Fix InternetAddress.resolve impl and test for Windows.

BUG=

Review URL: https://codereview.chromium.org//17601011
------------------------------------------------------------------------
r24394 | sgjesse@google.com | 2013-06-25 20:32:39 +0900 (火, 25  6月 2013) | 11 lines

Remove dead code and re-enable short socket read

The native function Socket_ReadList have not been used for some time now.

Unfortunately the replacement function Socket_Read did not apply
short socket reads for testing. This is now in place again.

R=ajohnsen@google.com
BUG=

Review URL: https://codereview.chromium.org//17611010
------------------------------------------------------------------------
r24393 | ajohnsen@google.com | 2013-06-25 20:27:48 +0900 (火, 25  6月 2013) | 6 lines

Add reverse dns lookup as a method on InternetAddress.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//17640008
------------------------------------------------------------------------
r24270 | ajohnsen@google.com | 2013-06-21 17:22:29 +0900 (金, 21  6月 2013) | 5 lines

Add missing include of ifaddrs in mac.

BUG=

Review URL: https://codereview.chromium.org//17198015
------------------------------------------------------------------------
r24269 | ajohnsen@google.com | 2013-06-21 17:13:42 +0900 (金, 21  6月 2013) | 5 lines

Update mac and android Socket::LookupAddress.

BUG=

Review URL: https://codereview.chromium.org//17341008
------------------------------------------------------------------------
r24267 | ajohnsen@google.com | 2013-06-21 16:58:48 +0900 (金, 21  6月 2013) | 9 lines

Add NetworkAdaptor to dart:io.

NetworkAdaptor contains a static method, list, that will query the
underlaying system for active network adaptors.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//16514010
------------------------------------------------------------------------
r24262 | ajohnsen@google.com | 2013-06-21 15:44:55 +0900 (金, 21  6月 2013) | 6 lines

Include parent environment by default, add option to not, for Process.

BUG=https://code.google.com/p/dart/issues/detail?id=9294,https://code.google.com/p/dart/issues/detail?id=9295
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//17261026
------------------------------------------------------------------------
r24244 | asiva@google.com | 2013-06-21 03:11:47 +0900 (金, 21  6月 2013) | 5 lines

Replace uses of Dart_GetClass with Dart_GetType and Dart_InstanceGetClass with Dart_InstanceGetType (The idea is to deprecate Dart_GetClass and Dart_InstanceGetClass from the API)

R=sgjesse@google.com

Review URL: https://codereview.chromium.org//17261011
------------------------------------------------------------------------
r24233 | whesse@google.com | 2013-06-21 00:06:43 +0900 (金, 21  6月 2013) | 6 lines

dart:io | Enable multithreaded secure networking encryption.

BUG=
R=ajohnsen@google.com, sgjesse@google.com

Review URL: https://codereview.chromium.org//16858011
------------------------------------------------------------------------
r24232 | ajohnsen@google.com | 2013-06-20 23:50:33 +0900 (木, 20  6月 2013) | 6 lines

Always escape " in Process on Windows.

BUG=https://code.google.com/p/dart/issues/detail?id=10895
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//17447015
------------------------------------------------------------------------
r24206 | zra@google.com | 2013-06-20 07:33:57 +0900 (木, 20  6月 2013) | 7 lines

Removes references to LIB_DIR from gyp files.

This eliminates the cirular dependency warnings from make.

R=iposva@google.com

Review URL: https://codereview.chromium.org//17288009
------------------------------------------------------------------------
r24174 | sgjesse@google.com | 2013-06-19 18:07:43 +0900 (水, 19  6月 2013) | 15 lines

Ensure that there is no "hidden" DNS lookup in secure socket code

The required setting of the internet adddress of the peer for NSS is
now using the internet address which have already been looked up in
Dart code for normal secure socket connect.

In the cases where SecureSocket.secure and RawSecureSocket.secure is
used with a host name, the internet address of the already connected
socket will be used. If that is not sufficient an IntetnetAddress from
DNS lookup in Dart can be passed instead of just a host name.

R=ajohnsen@google.com, whesse@google.com
BUG=http://dartbug.com/11103

Review URL: https://codereview.chromium.org//17381012
------------------------------------------------------------------------
r24165 | johnmccutchan@google.com | 2013-06-19 09:02:38 +0900 (水, 19  6月 2013) | 5 lines

HTTP loading cleanups

BUG=

Review URL: https://codereview.chromium.org//17183008
------------------------------------------------------------------------
r24150 | iposva@google.com | 2013-06-19 01:24:20 +0900 (水, 19  6月 2013) | 3 lines

- Fix PATH_MAX vs MAX_PATH confusion.

Review URL: https://codereview.chromium.org//17190005
------------------------------------------------------------------------
r24145 | iposva@google.com | 2013-06-19 00:44:21 +0900 (水, 19  6月 2013) | 5 lines

- Do NOT mix malloc/free and new/delete!

R=sgjesse@google.com, sigmund@google.com

Review URL: https://codereview.chromium.org//16929007
------------------------------------------------------------------------
r24100 | johnmccutchan@google.com | 2013-06-18 01:38:17 +0900 (火, 18  6月 2013) | 3 lines

Revert 24099

Review URL: https://codereview.chromium.org//17284004
------------------------------------------------------------------------
r24099 | johnmccutchan@google.com | 2013-06-18 00:59:13 +0900 (火, 18  6月 2013) | 13 lines

Make implicit things explicit when loading scripts.

Explicitly:
Set current working directory
Set windows flag

Previously these were side effects of calling other functions.

Also use ' strings consistently.

R=iposva@google.com

Review URL: https://codereview.chromium.org//16368002
------------------------------------------------------------------------
r24076 | ajohnsen@google.com | 2013-06-17 17:16:42 +0900 (月, 17  6月 2013) | 9 lines

Report async errors when they happend, in directory listing.

This ensure that we capture the correct OS error.

Also fix compiler issue for mac and dart2js.

BUG=

Review URL: https://codereview.chromium.org//17158003
------------------------------------------------------------------------
r24075 | ajohnsen@google.com | 2013-06-17 16:31:46 +0900 (月, 17  6月 2013) | 5 lines

Use correct keyword for forward-declaration in directory.h.

BUG=

Review URL: https://codereview.chromium.org//17120004
------------------------------------------------------------------------
r24074 | ajohnsen@google.com | 2013-06-17 16:27:19 +0900 (月, 17  6月 2013) | 6 lines

Make Directory.list pull-based, making it possible to pause, resume and cancel directory listing.

BUG=https://code.google.com/p/dart/issues/detail?id=10163,
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//16813006
------------------------------------------------------------------------
r24062 | asiva@google.com | 2013-06-15 08:47:40 +0900 (土, 15  6月 2013) | 10 lines

Split dart_api.h into multiple parts:

dart_api.h - Has the core API functions
dart_mirrors_api.h - Has API functions to support Mirrors or reflection
dart_native_api.h - Has parts which support the native message handling,
                    profilling and other internal tools

R=sgjesse@google.com, vsm@google.com

Review URL: https://codereview.chromium.org//16973003
------------------------------------------------------------------------
r24030 | sgjesse@google.com | 2013-06-14 22:34:54 +0900 (金, 14  6月 2013) | 8 lines

dart:io | Add File.rename

R=ajohnsen@google.com
BUG=

Committed: https://code.google.com/p/dart/source/detail?r=24029

Review URL: https://codereview.chromium.org//17033003
------------------------------------------------------------------------
r24029 | sgjesse@google.com | 2013-06-14 21:58:21 +0900 (金, 14  6月 2013) | 6 lines

dart:io | Add File.rename

R=ajohnsen@google.com
BUG=

Review URL: https://codereview.chromium.org//17033003
------------------------------------------------------------------------
r23977 | sgjesse@google.com | 2013-06-13 22:06:11 +0900 (木, 13  6月 2013) | 8 lines

Remove Encoding.BINARY

THe Encoding.BINARY was a bad idea. It is now removed and null is used to indicate binary result from Process.run.

R=ajohnsen@google.com
BUG=

Review URL: https://codereview.chromium.org//16959004
------------------------------------------------------------------------
r23962 | sgjesse@google.com | 2013-06-13 19:27:54 +0900 (木, 13  6月 2013) | 6 lines

Add support for binary stdout/stderr data when using Process.run

R=ajohnsen@google.com
BUG=http://dartbug.com/9167

Review URL: https://codereview.chromium.org//16309014
------------------------------------------------------------------------
r23896 | sgjesse@google.com | 2013-06-12 17:33:16 +0900 (水, 12  6月 2013) | 6 lines

Ensure that only byte values are sent by sockets and web sockets

R=ajohnsen@google.com
BUG=http://dartbug.com/11007

Review URL: https://codereview.chromium.org//16363005
------------------------------------------------------------------------
r23848 | ajohnsen@google.com | 2013-06-11 22:15:46 +0900 (火, 11  6月 2013) | 13 lines

Clean up dart:io exceptions.

- Introduce IOException.
- Remove HttpParserException.
- Merge RedirectLimitExceededException and RedirectLoopException into
RedirectException.
- Remove 'IO' from FileIOException, DirectoryIOException, LinkIOException
and SocketIOException.

BUG=https://code.google.com/p/dart/issues/detail?id=9955
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//16123036
------------------------------------------------------------------------
r23845 | ajohnsen@google.com | 2013-06-11 20:55:43 +0900 (火, 11  6月 2013) | 8 lines

Require exact match of vm arguments.

This will make sure e.g. '--verbose-gc' won't trigger '--verbose'.

BUG=
R=iposva@google.com, sgjesse@google.com

Review URL: https://codereview.chromium.org//15724022
------------------------------------------------------------------------
r23844 | ajohnsen@google.com | 2013-06-11 20:54:15 +0900 (火, 11  6月 2013) | 8 lines

Add 'Server' and 'User-Agent' default header fields.

They include the major and minor version of Dart.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//16758008
------------------------------------------------------------------------
r23831 | asiva@google.com | 2013-06-11 06:57:49 +0900 (火, 11  6月 2013) | 5 lines

Fix for issue 11112 align flags to formats used by other tools.

R=hausner@google.com

Review URL: https://codereview.chromium.org//16673006
------------------------------------------------------------------------
r23593 | johnmccutchan@google.com | 2013-06-04 22:52:47 +0900 (火, 04  6月 2013) | 5 lines

HTTP loading tests and package root support

R=asiva@google.com, iposva@google.com, sgjesse@google.com

Review URL: https://codereview.chromium.org//16092007
------------------------------------------------------------------------
r23586 | whesse@google.com | 2013-06-04 20:06:00 +0900 (火, 04  6月 2013) | 6 lines

dart:io | Improve NSS and SSL error messages for secure networking.

BUG=dartbug.com/9688
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//16305005
------------------------------------------------------------------------
r23584 | lrn@google.com | 2013-06-04 19:33:11 +0900 (火, 04  6月 2013) | 18 lines

Rename RuntimeError to CyclicIntializationError, as per spec.

The RuntimeError has been used to report cyclic initialization errors in
dart2js.
It has also been used for other, unrelated, uses, where it makes
little to no sense.

The RuntimeError type has been removed, but added in js_helper.dart,
where dart2js uses it.

Uses of new RuntimeError("some message") have been converted to
other errors (Argument/State/Unsupported). In some cases, just
throwing a String might have been just as good.

BUG=http://dartbug.com/11040
R=johnniwinther@google.com

Review URL: https://codereview.chromium.org//16154017
------------------------------------------------------------------------
r23565 | johnmccutchan@google.com | 2013-06-04 05:32:12 +0900 (火, 04  6月 2013) | 5 lines

Fix HTTP response handling

R=sgjesse@google.com

Review URL: https://codereview.chromium.org//16305011
------------------------------------------------------------------------
r23543 | whesse@google.com | 2013-06-04 00:01:02 +0900 (火, 04  6月 2013) | 6 lines

dart:io | Make FileStat.stat throw an exception when the file does not exist, or cannot be accessed.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//16140008
------------------------------------------------------------------------
r23534 | kustermann@google.com | 2013-06-03 18:41:36 +0900 (月, 03  6月 2013) | 15 lines

Fix for leaking file descriptor issue

When calling a non-existent executable, a pair of file descriptors will be
created with pipe(). One end goes to the exitcode handler thread, the other end
goes to the epoll() thread.

If an error occurs during process creation, the pipe is still created and the
exit handler thread writes the exitcode to the pipe, but the other file
descriptor is not added to the epoll() set and is therefore leaked. (i.e.
Process_Start ignores the other end of the pipe if exec() failed in
Proces::Start()).

R=sgjesse@google.com

Review URL: https://codereview.chromium.org//15980006
------------------------------------------------------------------------
r23531 | whesse@google.com | 2013-06-03 18:19:31 +0900 (月, 03  6月 2013) | 6 lines

Clean up the gyp build of standalone dart executable on Android.

BUG=
R=iposva@google.com, sgjesse@google.com

Review URL: https://codereview.chromium.org//16254005
------------------------------------------------------------------------
r23504 | asiva@google.com | 2013-06-01 08:01:35 +0900 (土, 01  6月 2013) | 3 lines

Fix windows build.

Review URL: https://codereview.chromium.org//15881009
------------------------------------------------------------------------
r23500 | iposva@google.com | 2013-06-01 07:43:17 +0900 (土, 01  6月 2013) | 3 lines

- Another speculative fix for Windows.


------------------------------------------------------------------------
r23499 | iposva@google.com | 2013-06-01 07:33:34 +0900 (土, 01  6月 2013) | 3 lines

- Fix Windows.

Review URL: https://codereview.chromium.org//16105019
------------------------------------------------------------------------
r23496 | johnmccutchan@google.com | 2013-06-01 07:04:59 +0900 (土, 01  6月 2013) | 5 lines

Remove hack http client and use the one in dart:io

R=asiva@google.com

Review URL: https://codereview.chromium.org//15736023
------------------------------------------------------------------------
r23480 | iposva@google.com | 2013-06-01 02:32:12 +0900 (土, 01  6月 2013) | 3 lines

- Attempt not to pass C++ flags to C builds.

Review URL: https://codereview.chromium.org//15736026
------------------------------------------------------------------------
r23476 | iposva@google.com | 2013-06-01 01:36:27 +0900 (土, 01  6月 2013) | 7 lines

- Modify dart_api.h to be a proper C API.
- Verify that dart_api.h can be used from C
  by changing the test_extension to be a pure C file.

R=asiva@google.com

Review URL: https://codereview.chromium.org//15689013
------------------------------------------------------------------------
r23453 | lrn@google.com | 2013-05-31 15:07:39 +0900 (金, 31  5月 2013) | 8 lines

Make new StreamController be async by default.

Change all instances, except some tests, to be sync still.
Rename Multiplex to Broadcast everywhere.

R=floitsch@google.com

Review URL: https://codereview.chromium.org//16125005
------------------------------------------------------------------------
r23421 | iposva@google.com | 2013-05-31 00:55:59 +0900 (金, 31  5月 2013) | 7 lines

- Add different types for persistent and weak persistent handles
  in the Dart C API.
- Adapt code in the runtime.

R=asiva@google.com

Review URL: https://codereview.chromium.org//15772005
------------------------------------------------------------------------
r23352 | johnmccutchan@google.com | 2013-05-29 23:45:27 +0900 (水, 29  5月 2013) | 3 lines

Fix windows build

Review URL: https://codereview.chromium.org//15904013
------------------------------------------------------------------------
r23351 | johnmccutchan@google.com | 2013-05-29 23:34:15 +0900 (水, 29  5月 2013) | 5 lines

Add support for loading scripts from http

R=iposva@google.com

Review URL: https://codereview.chromium.org//15966002
------------------------------------------------------------------------
r23349 | sgjesse@google.com | 2013-05-29 21:38:27 +0900 (水, 29  5月 2013) | 10 lines

Change File.directory to not do any IO

Removed the File.directory and File.directorySync methods and added a
File.directory getter. The File.directory getter does not do any IO,
but just calculates the directory of the file from the path.

R=whesse@google.com
BUG=http://dartbug.com/9926

Review URL: https://codereview.chromium.org//15832003
------------------------------------------------------------------------
r23336 | whesse@google.com | 2013-05-29 18:55:18 +0900 (水, 29  5月 2013) | 5 lines

dart:io | Add missing files.

BUG=

Review URL: https://codereview.chromium.org//16122004
------------------------------------------------------------------------
r23335 | whesse@google.com | 2013-05-29 18:43:10 +0900 (水, 29  5月 2013) | 6 lines

A working version of dart_no_snapshot on Android.

BUG=
R=gram@google.com, sgjesse@google.com

Review URL: https://codereview.chromium.org//15706008
------------------------------------------------------------------------
r23318 | lrn@google.com | 2013-05-29 14:39:23 +0900 (水, 29  5月 2013) | 8 lines

Make new StreamController().isPaused be true until the first listener arrives.

This is compatible with what we had before, and makes good sense if you read
"isPaused" as "must buffer incoming events".

R=floitsch@google.com, sgjesse@google.com

Review URL: https://codereview.chromium.org//15981003
------------------------------------------------------------------------
r23299 | zra@google.com | 2013-05-29 02:56:07 +0900 (水, 29  5月 2013) | 8 lines

When cross-compiling, also build and link run_vm_tests for the host architecture.

E.g. for ARM, run_vm_tests for the host architecture will end up in
out/DebugARM/run_vm_tests.host.

R=iposva@google.com

Review URL: https://codereview.chromium.org//16060004
------------------------------------------------------------------------
r23266 | sgjesse@google.com | 2013-05-28 22:35:01 +0900 (火, 28  5月 2013) | 20 lines

Merge the dart:uri library into dart:core and update the Uri class

This merges the dart:uri library into dart:core removing the dart:uri library. Besides moving the library the Url class has been changed.

* Removed existing Uri constructor as it was equivalent with Uri.parse
* Remamed constructor Uri.fromComponents to Uri
* Moved toplevel function encodeUriComponent to static method Uri.encodeComponent
* Moved toplevel function decodeUriComponent to static method Uri.decodeComponent
* Moved toplevel function encodeUri to static method Uri.encodeFull
* Moved toplevel function decodeUri to static method Uri.decodeFull
* Rename domain to host
* Added static methods Uri.encodeQueryComponent and Uri.decodeQueryComponent
* Added support for path generation and splitting
* Added support for query generation and splitting
* Added some level of normalization

R=floitsch@google.com, lrn@google.com, nweiz@google.com, scheglov@google.com
BUG=

Review URL: https://codereview.chromium.org//16019002
------------------------------------------------------------------------
r23260 | whesse@google.com | 2013-05-28 21:58:30 +0900 (火, 28  5月 2013) | 6 lines

dart:io | Fix a few bugs in the Android port of dart:io.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//15894004
------------------------------------------------------------------------
r23237 | lrn@google.com | 2013-05-28 16:28:36 +0900 (火, 28  5月 2013) | 26 lines

Reapply "Active stream subscriptions".

Makes subscriptions the active part of a stream, with the stream
itself being just an inert creator of subscriptions.

This changes the behavior of a "single subscription" stream to match
the documentation: After the subscription is canceled, you can't
resubscribe to the stream. Previously, you could do that, but it was
never documented or intended.
This also makes the stream of a StreamController not be paused while
before it's subscribed - it is always the subscription that is paused
or not, and while there is no subscription, the stream cannot be
paused. Previously the stream was set to paused until the first
subscription in order to prevent events from being lost. That is
handled independently of pauses now.

Adds StreamController.multiplex constructor. This name is tentative,
and likely to change. Its behavior may change as well. It currently
provides a new single-subscription stream each time its "stream"
getter is read, and you can subscribe to these.

Adds StreamIterator class that allows iterating over a stream's data
events using (async) "moveNext()" and "current", like a direct style
Iterator (sorry, it won't work in a for-in loop).

Review URL: https://codereview.chromium.org//16131003
------------------------------------------------------------------------
r23221 | lrn@google.com | 2013-05-27 22:03:03 +0900 (月, 27  5月 2013) | 13 lines

Revert until Windows crash is debugged.

Reverts r23218, r23217, r23208, r23207, r23206, r23205, r23204.

r23218 | Path observer is listened more than once, so make it multiplex.
r23217 | Add StreamController.multiplex constructor.
r23208 | Fix bug in streamimpl
r23207 | Fix bug in stream iterator.
r23206 | Change expectations for http_parser_test.
r23205 | Fix bug in stream-impl.
r23204 | Make StreamSubscription be the active part of a string.

Review URL: https://codereview.chromium.org//15989006
------------------------------------------------------------------------
r23204 | lrn@google.com | 2013-05-27 17:34:20 +0900 (月, 27  5月 2013) | 7 lines

Make StreamSubscription be the active part of a string.

It is the one keeping the buffer of events, not the stream.

R=ajohnsen@google.com, floitsch@google.com, jmesserly@google.com

Review URL: https://codereview.chromium.org//14753009
------------------------------------------------------------------------
r23178 | hausner@google.com | 2013-05-25 05:35:03 +0900 (土, 25  5月 2013) | 11 lines

Don't use statically declared Mutex in debugger

Hopefully eliminates the "resource busy" errors we occasionally
see on MacOS (issue 10488).

I ran the debugger test 10000 times in a loop on my machine and
never ran into the assert. Let's hope the build bot is happy too.

R=asiva@google.com

Review URL: https://codereview.chromium.org//15861016
------------------------------------------------------------------------
r23150 | ajohnsen@google.com | 2013-05-24 23:14:45 +0900 (金, 24  5月 2013) | 7 lines

Temporary, only escape quotes if run in shell.

This gets pub to pass. This patch should be reverted at some point.

BUG=

Review URL: https://codereview.chromium.org//15861004
------------------------------------------------------------------------
r23148 | ajohnsen@google.com | 2013-05-24 22:34:27 +0900 (金, 24  5月 2013) | 5 lines

Use correct path escape on Windows, for Process.

BUG=

Review URL: https://codereview.chromium.org//15782003
------------------------------------------------------------------------
r23138 | whesse@google.com | 2013-05-24 21:34:01 +0900 (金, 24  5月 2013) | 6 lines

Fix some errors in the Android compilation of standalone Dart.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//16000003
------------------------------------------------------------------------
r23131 | ajohnsen@google.com | 2013-05-24 20:03:40 +0900 (金, 24  5月 2013) | 8 lines

Remove ProcessOptions and make the options named arguments.

This also removed Process.runShell and adds a new flag: runInShell.

BUG=
R=kustermann@google.com, nweiz@google.com, sgjesse@google.com

Review URL: https://codereview.chromium.org//15883003
------------------------------------------------------------------------
r23087 | asiva@google.com | 2013-05-24 02:54:32 +0900 (金, 24  5月 2013) | 5 lines

Change SecureSocket to use a single patch class instead of multiple patch classes the way it is being done now.

R=ager@google.com

Review URL: https://codereview.chromium.org//15899003
------------------------------------------------------------------------
r23086 | hausner@google.com | 2013-05-24 02:41:50 +0900 (金, 24  5月 2013) | 9 lines

Let debug target pick the debugger port

Invoking the dart executable with --debug:0 lets the debuggee pick a free port number. It prints the port number to stdout if --verbose_debug is specified on the command line.

Adapt debugger tests to use this scheme for selecting an available port number.

R=iposva@google.com

Review URL: https://codereview.chromium.org//15507004
------------------------------------------------------------------------
r23024 | podivilov@google.com | 2013-05-23 01:09:07 +0900 (木, 23  5月 2013) | 5 lines

Provide a POSIX-compliant implementation of Directory::Current.

R=sgjesse@google.com, whesse@google.com

Review URL: https://codereview.chromium.org//15719002
------------------------------------------------------------------------
r23023 | asiva@google.com | 2013-05-23 01:07:25 +0900 (木, 23  5月 2013) | 8 lines

Fix runnning of vm benchmarks on golem.

Use snapshots for creating isolates used in the benchmarks, that way
they are not dependent on corelib source paths.

R=ajohnsen@google.com, srdjan@google.com

Review URL: https://codereview.chromium.org//15640002
------------------------------------------------------------------------
r23019 | whesse@google.com | 2013-05-22 23:41:05 +0900 (水, 22  5月 2013) | 5 lines

dart:io | Roll third_party/nss from Chromium to revision 199075.

R=sgjesse@google.com

Review URL: https://codereview.chromium.org//15371008
------------------------------------------------------------------------
r22996 | podivilov@google.com | 2013-05-22 17:55:31 +0900 (水, 22  5月 2013) | 5 lines

Adapt gen_snapshot to the recent changes in bootstrap sources loading scheme.

R=asiva@google.com

Review URL: https://codereview.chromium.org//15250009
------------------------------------------------------------------------
r22984 | ajohnsen@google.com | 2013-05-22 16:23:18 +0900 (水, 22  5月 2013) | 9 lines

Remove explicit delayed futures in dart:io.

After the change of Completers always being delayed to the next tick,
      this is no longer needed.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//15680002
------------------------------------------------------------------------
r22830 | ajohnsen@google.com | 2013-05-17 15:28:30 +0900 (金, 17  5月 2013) | 6 lines

Actually end a ZLib stream with a Z_FINISH marker.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//14962006
------------------------------------------------------------------------
r22685 | whesse@google.com | 2013-05-15 01:26:13 +0900 (水, 15  5月 2013) | 6 lines

dart:io | Add FileSystemEntity.stat() and FileStat class.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//15018011
------------------------------------------------------------------------
r22531 | asiva@google.com | 2013-05-09 06:27:54 +0900 (木, 09  5月 2013) | 5 lines

Fix for issue 10488 standalone/basic_debugger_test flaky

R=hausner@google.com

Review URL: https://codereview.chromium.org//15051002
------------------------------------------------------------------------
r22516 | asiva@google.com | 2013-05-09 02:06:09 +0900 (木, 09  5月 2013) | 3 lines

Fix windows build break.

Review URL: https://codereview.chromium.org//15010004
------------------------------------------------------------------------
r22515 | asiva@google.com | 2013-05-09 01:58:32 +0900 (木, 09  5月 2013) | 3 lines

Fix windows build.

Review URL: https://codereview.chromium.org//14680010
------------------------------------------------------------------------
r22514 | asiva@google.com | 2013-05-09 01:42:46 +0900 (木, 09  5月 2013) | 13 lines

Final step towards loading core library scripts directly from the sources

- Modify bin.gypi to ensure that the io library and patch files are read
  directly from the sources. Remove the source buffer generation step in
  the gypi files for all the io library and patch files.

- Restructure the code a bit to eliminate some code duplication.

- Delete runtime/tools/concat_library.py

R=ager@google.com, sgjesse@google.com

Review URL: https://codereview.chromium.org//14752008
------------------------------------------------------------------------
r22505 | podivilov@google.com | 2013-05-08 22:00:09 +0900 (水, 08  5月 2013) | 5 lines

Fix Clank+Dart compilation.

R=iposva@google.com

Review URL: https://codereview.chromium.org//15023007
------------------------------------------------------------------------
r22411 | sgjesse@google.com | 2013-05-06 21:28:45 +0900 (月, 06  5月 2013) | 10 lines

Change async read buffer sizes on Windows

When reading from the console using ReadFile on Windows the buffer size must
be a bit smaller than 32k. Use a 16k buffer in that case and raise the buffer
size to 64k otherwise.

R=ajohnsen@google.com
BUG=https://code.google.com/p/dart/issues/detail?id=9429

Review URL: https://codereview.chromium.org//14589014
------------------------------------------------------------------------
r22396 | asiva@google.com | 2013-05-04 07:50:26 +0900 (土, 04  5月 2013) | 5 lines

Resubmit 22380 after fixing the windows build.

R=hausner@google.com

Review URL: https://codereview.chromium.org//14645025
------------------------------------------------------------------------
r22382 | asiva@google.com | 2013-05-04 03:26:34 +0900 (土, 04  5月 2013) | 3 lines

Revert 22380 to investigate windows build break.

Review URL: https://codereview.chromium.org//14927003
------------------------------------------------------------------------
r22380 | asiva@google.com | 2013-05-04 03:12:24 +0900 (土, 04  5月 2013) | 22 lines

Second step towards loading core library scripts directly from the sources
- Modify the library source generator to generate a source mapping array
  The generated array is of the following format:
  const char* dart::Bootstrap::corelib_source_paths_[] = {
    "dart:core", "/workspace1/dart-all/dart/sdk/lib/core/core.dart", 

    "bool.dart", "/workspace1/dart-all/dart/sdk/lib/core/bool.dart", 
    ...
    ...
  };

- Read the source file using the source mapping array instead of relying on
  a generated buffer containing the sources

- Modify the gyp files to ensure that all libraries are read directly
  from the sources. This CL does not change the patch part yet.
  Remove the source concatentation step in the gypi files for all the core
  libraries.

R=hausner@google.com, iposva@google.com

Review URL: https://codereview.chromium.org//14786012
------------------------------------------------------------------------
r22364 | whesse@google.com | 2013-05-03 21:02:10 +0900 (金, 03  5月 2013) | 6 lines

dart:io | Implement truly asynchronous version of FileSystemEntity.type().

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//14907002
------------------------------------------------------------------------
r22354 | whesse@google.com | 2013-05-03 17:39:16 +0900 (金, 03  5月 2013) | 6 lines

dart:io | Add asynchronous versions of the methods of FileSystemEntity and Link.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//14642012
------------------------------------------------------------------------
r22313 | iposva@google.com | 2013-05-02 20:40:23 +0900 (木, 02  5月 2013) | 6 lines

- Fixed some old-style casts.
- Remove TODO as it is not feasible to ever enable.

R=kustermann@google.com

Review URL: https://codereview.chromium.org//14628009
------------------------------------------------------------------------
r22309 | ajohnsen@google.com | 2013-05-02 20:23:40 +0900 (木, 02  5月 2013) | 6 lines

Add v6Only named argument to ServerSocket and etc.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//14766003
------------------------------------------------------------------------
r22240 | ajohnsen@google.com | 2013-05-01 21:18:53 +0900 (水, 01  5月 2013) | 6 lines

Enable IPv6 by default in dart:io.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//14766004
------------------------------------------------------------------------
r22227 | sgjesse@google.com | 2013-05-01 18:14:04 +0900 (水, 01  5月 2013) | 15 lines

Change the signature for all network bind calls.

All the bind calls on RawServerSocket, ServerSocket,
RawSecureServerSocket, SecureServerSocket and HttpServer (and
bindSecure on HttpServer) now have mandatory address and port
parameters. All the rest of the parameters are named optional
(including backlog).

The address parameter can be an InternetAddress or a String for all
these calls.

R=ajohnsen@google.com, whesse@google.com
BUG=

Review URL: https://codereview.chromium.org//14640008
------------------------------------------------------------------------
r22175 | sgjesse@google.com | 2013-04-30 20:48:48 +0900 (火, 30  4月 2013) | 6 lines

Put HashMap class in dart namespace.

R=sgjesse@google.com
Signed-off-by: Thiago Farina <tfarina@chromium.org>

Review URL: https://codereview.chromium.org//14572004
------------------------------------------------------------------------
r22174 | sgjesse@google.com | 2013-04-30 20:30:05 +0900 (火, 30  4月 2013) | 6 lines

Add static getters for common internet addresses

R=whesse@google.com
BUG=

Review URL: https://codereview.chromium.org//14619008
------------------------------------------------------------------------
r22173 | kustermann@google.com | 2013-04-30 19:37:35 +0900 (火, 30  4月 2013) | 8 lines

Make ninja build on mac work

If we use ninja as gyp backend on mac, all configurations must have the same
xcode_settings.

R=whesse@google.com

Review URL: https://codereview.chromium.org//14499010
------------------------------------------------------------------------
r22117 | sgjesse@google.com | 2013-04-29 22:06:56 +0900 (月, 29  4月 2013) | 6 lines

Fix checked mode errors in previous commit

TBR=whesse@google.com
BUG=

Review URL: https://codereview.chromium.org//13950018
------------------------------------------------------------------------
r22116 | sgjesse@google.com | 2013-04-29 21:43:53 +0900 (月, 29  4月 2013) | 12 lines

Add the ability to change the working directory

Directory.current have been changed from a factory constructor to a
getter and setter. The getter returns a Direcotry object holding the
current working directory. The setter changes the current working
directory of the Dart process.

R=whesse@google.com

BUG=https://code.google.com/p/dart/issues/detail?id=6316, https://code.google.com/p/dart/issues/detail?id=8893

Review URL: https://codereview.chromium.org//13896034
------------------------------------------------------------------------
r22032 | smok@google.com | 2013-04-25 23:22:30 +0900 (木, 25  4月 2013) | 3 lines

Put everything in runtime/bin into '::dart::bin' namespace.

Review URL: https://codereview.chromium.org//14341015
------------------------------------------------------------------------
r21942 | iposva@google.com | 2013-04-24 21:28:27 +0900 (水, 24  4月 2013) | 3 lines

- Avoid warnings when building with clang.

Review URL: https://codereview.chromium.org//13940017
------------------------------------------------------------------------
r21940 | sgjesse@google.com | 2013-04-24 20:51:56 +0900 (水, 24  4月 2013) | 8 lines

Fix broken Mac OS socket code

The order of the fields in the sockaddr structures on Mac OS was different and we where relying on the Linux/Windows order of fields. This should now be platform independent.

TBR=ajohnsen@google.com
BUG=

Review URL: https://codereview.chromium.org//14139032
------------------------------------------------------------------------
r21936 | ajohnsen@google.com | 2013-04-24 19:25:25 +0900 (水, 24  4月 2013) | 7 lines

Disable IPv6 lookup by default.

Will revert once IPv6 have stablized.

BUG=

Review URL: https://codereview.chromium.org//13918013
------------------------------------------------------------------------
r21934 | ajohnsen@google.com | 2013-04-24 18:26:58 +0900 (水, 24  4月 2013) | 8 lines

Add new InternetAddress class with a static lookup function (including     IPv6
    results).

Reapply of https://codereview.chromium.org/13880029/ with fixes.

BUG=

Review URL: https://codereview.chromium.org//14469002
------------------------------------------------------------------------
r21928 | ajohnsen@google.com | 2013-04-24 17:10:00 +0900 (水, 24  4月 2013) | 7 lines

Revert "Add new InternetAddress class with a static lookup function (including     IPv6 results)."
Revert "Attempt to fix strict align issue."
Revert "Trying another fix."

BUG=

Review URL: https://codereview.chromium.org//14036017
------------------------------------------------------------------------
r21927 | ajohnsen@google.com | 2013-04-24 17:02:13 +0900 (水, 24  4月 2013) | 5 lines

Trying another fix.

BUG=

Review URL: https://codereview.chromium.org//14389008
------------------------------------------------------------------------
r21925 | ajohnsen@google.com | 2013-04-24 16:32:27 +0900 (水, 24  4月 2013) | 5 lines

Attempt to fix strict align issue.

BUG=

Review URL: https://codereview.chromium.org//14217013
------------------------------------------------------------------------
r21923 | ajohnsen@google.com | 2013-04-24 16:12:05 +0900 (水, 24  4月 2013) | 7 lines

Add new InternetAddress class with a static lookup function (including     IPv6 results).

Reapply of https://codereview.chromium.org/14083007/ with fixes.

BUG=

Review URL: https://codereview.chromium.org//13880029
------------------------------------------------------------------------
r21892 | podivilov@google.com | 2013-04-24 01:26:33 +0900 (水, 24  4月 2013) | 6 lines

Add fallback to load the original version of dart:io library
if url mapping is not provided.

R=asiva@google.com

Review URL: https://codereview.chromium.org//14366024
------------------------------------------------------------------------
r21871 | ager@google.com | 2013-04-23 20:54:54 +0900 (火, 23  4月 2013) | 6 lines

Rename dart:typeddata to dart:typed_data.

R=asiva@google.com, floitsch@google.com, srdjan@google.com
BUG=

Review URL: https://codereview.chromium.org//14426006
------------------------------------------------------------------------
r21865 | sgjesse@google.com | 2013-04-23 19:07:03 +0900 (火, 23  4月 2013) | 5 lines

Revert "Add new InternetAddress class with a static lookup function (including IPv6 results)"

TBR=ajohnsen@google.com

Review URL: https://codereview.chromium.org//14081024
------------------------------------------------------------------------
r21864 | sgjesse@google.com | 2013-04-23 19:02:01 +0900 (火, 23  4月 2013) | 6 lines

Anoher try to avoid GCC strict-aliasing error

TBR=ajohnsen@google.com
BUG=

Review URL: https://codereview.chromium.org//14426004
------------------------------------------------------------------------
r21863 | sgjesse@google.com | 2013-04-23 18:51:32 +0900 (火, 23  4月 2013) | 6 lines

Try to avoid GCC strict-aliasing error

TBR=ajohnsen@google.com
BUG=

Review URL: https://codereview.chromium.org//13856013
------------------------------------------------------------------------
r21862 | ajohnsen@google.com | 2013-04-23 18:36:18 +0900 (火, 23  4月 2013) | 7 lines

Add new InternetAddress class with a static lookup function (including IPv6 results).

Socket.connect/ServerSocket.bind now accepts IPv6 host names. If a new ServerSocket is connected to an IPv6 interface, it will (if possible) support incoming IPv4 connections as well.

BUG=

Review URL: https://codereview.chromium.org//14083007
------------------------------------------------------------------------
r21859 | sgjesse@google.com | 2013-04-23 15:50:59 +0900 (火, 23  4月 2013) | 8 lines

Support upgrading sockets to secure sockets

This build on the support for upgrading raw sockets to raw secure sockets.

R=ajohnsen@google.com
BUG=https://code.google.com/p/dart/issues/detail?id=8789

Review URL: https://codereview.chromium.org//14034012
------------------------------------------------------------------------
r21831 | hausner@google.com | 2013-04-23 03:43:03 +0900 (火, 23  4月 2013) | 5 lines

Implement list isolates command

New Debugger wire protocol command to list all isolates in a vm.

Review URL: https://codereview.chromium.org//14381005
------------------------------------------------------------------------
r21813 | iposva@google.com | 2013-04-22 22:12:57 +0900 (月, 22  4月 2013) | 3 lines

- Check for error when creating the source string.

Review URL: https://codereview.chromium.org//13842019
------------------------------------------------------------------------
r21786 | iposva@google.com | 2013-04-22 14:31:03 +0900 (月, 22  4月 2013) | 4 lines

- Reduce warnings about project settings in Xcode 4.
- Address compilation warnings found by clang.

Review URL: https://codereview.chromium.org//14084006
------------------------------------------------------------------------
r21759 | zra@google.com | 2013-04-20 03:31:47 +0900 (土, 20  4月 2013) | 3 lines

Implements features to run "Hello, world!" on simulated MIPS.

Review URL: https://codereview.chromium.org//14246039
------------------------------------------------------------------------
r21757 | zra@google.com | 2013-04-20 03:05:44 +0900 (土, 20  4月 2013) | 13 lines

Enables cross-compilation of the VM for ARM.

Uses the "toolset" feature of gyp to build the dart VM
for ARM, but restricts building of snapshot generation
to the host machine.

For generated source files, it also changes to using
LIB_DIR instead of SHARED_INTERMEDIATE_DIR to avoid
generation of duplicate Makefile rules (gyp doesn't
know that generated source files from toolchains it
thinks are different will be the same.)

Review URL: https://codereview.chromium.org//12726011
------------------------------------------------------------------------
r21745 | hausner@google.com | 2013-04-20 00:20:43 +0900 (土, 20  4月 2013) | 8 lines

Debugger wire protocol changes

- Add 'number' value type for transmitting values of type num
- Eliminate 'integer' value types (subsumed in number values)
- Eliminate url and line number fields in breakpointResolved
  events

Review URL: https://codereview.chromium.org//14201004
------------------------------------------------------------------------
r21735 | ajohnsen@google.com | 2013-04-19 20:40:04 +0900 (金, 19  4月 2013) | 5 lines

Fix Zlib filters to correctly emit the last chunks of data.

BUG=https://code.google.com/p/dart/issues/detail?id=10026

Review URL: https://codereview.chromium.org//14241021
------------------------------------------------------------------------
r21719 | sgjesse@google.com | 2013-04-19 16:37:37 +0900 (金, 19  4月 2013) | 15 lines

Add the ability to secure an already established raw socket connection

The static methods secure and secureServer can be used to start
TLS handshake as eihter client or server.

This CL only implement the securing of RawSocket.

This also changes the semantics of cancelling a subscription on a
RawSocket from closing the socket to just pausing.

R=ager@google.com

BUG=https://code.google.com/p/dart/issues/detail?id=8789

Review URL: https://codereview.chromium.org//13502004
------------------------------------------------------------------------
r21711 | srdjan@google.com | 2013-04-19 08:18:13 +0900 (金, 19  4月 2013) | 3 lines

Add flag --check-function-fingerprints, it checks all function fingerprints of the intrinsifier and method recognizer. Added flag to a test so that the fingerprints will be tested during a regular test.

Review URL: https://codereview.chromium.org//14247005
------------------------------------------------------------------------
r21634 | tball@google.com | 2013-04-18 01:35:33 +0900 (木, 18  4月 2013) | 1 line

Added generated JavaScript vmstats app to build.
------------------------------------------------------------------------
r21631 | tball@google.com | 2013-04-18 01:30:26 +0900 (木, 18  4月 2013) | 3 lines

Added dart2js-generated vmstats.dart, to support non-Dartium browsers.

Review URL: https://codereview.chromium.org//14191002
------------------------------------------------------------------------
r21615 | sgjesse@google.com | 2013-04-17 20:10:21 +0900 (水, 17  4月 2013) | 6 lines

Fix patch file return types

TBR=ajohnsen@google.com
BUG=

Review URL: https://codereview.chromium.org//13933021
------------------------------------------------------------------------
r21611 | sgjesse@google.com | 2013-04-17 19:15:29 +0900 (水, 17  4月 2013) | 7 lines

Add access to process id for both current process and processes started

BUG=https://code.google.com/p/dart/issues/detail?id=9129

R=ajohnsen@google.com

Review URL: https://codereview.chromium.org//14322011
------------------------------------------------------------------------
r21600 | tball@google.com | 2013-04-17 14:30:24 +0900 (水, 17  4月 2013) | 3 lines

Fixed Windows syntax error.

Review URL: https://codereview.chromium.org//13977010
------------------------------------------------------------------------
r21599 | tball@google.com | 2013-04-17 14:24:07 +0900 (水, 17  4月 2013) | 3 lines

Added ctrl-\ support in dart binary to dump isolate stacks.

Review URL: https://codereview.chromium.org//14313002
------------------------------------------------------------------------
r21592 | hausner@google.com | 2013-04-17 08:24:21 +0900 (水, 17  4月 2013) | 3 lines

Add library id, location info to breakpointResolved event

Review URL: https://codereview.chromium.org//13940008
------------------------------------------------------------------------
r21590 | tball@google.com | 2013-04-17 08:15:19 +0900 (水, 17  4月 2013) | 1 line

Rolled back due to missing Windows signal definition.
------------------------------------------------------------------------
r21589 | tball@google.com | 2013-04-17 08:11:36 +0900 (水, 17  4月 2013) | 3 lines

Added ctrl-\ command that dumps isolate stacks to dart binary.

Review URL: https://codereview.chromium.org//13603002
------------------------------------------------------------------------
r21582 | regis@google.com | 2013-04-17 06:53:09 +0900 (水, 17  4月 2013) | 3 lines

Implement missing features to run Hello world! on simulated ARM.

Review URL: https://codereview.chromium.org//14153004
------------------------------------------------------------------------
r21579 | tball@google.com | 2013-04-17 06:05:37 +0900 (水, 17  4月 2013) | 3 lines

Resubmission of 21573, with corrected strndup call.

Review URL: https://codereview.chromium.org//14308006
------------------------------------------------------------------------
r21575 | tball@google.com | 2013-04-17 05:47:32 +0900 (水, 17  4月 2013) | 1 line

Rolled back due to missing Windows strndup.
------------------------------------------------------------------------
r21573 | tball@google.com | 2013-04-17 05:40:56 +0900 (水, 17  4月 2013) | 5 lines

Fixed stack trace for isolates without any Dart frames. Updated
stats display to display empty stack dumps, and reduced screen
update time.

Review URL: https://codereview.chromium.org//13939003
------------------------------------------------------------------------
r21569 | hausner@google.com | 2013-04-17 04:42:39 +0900 (水, 17  4月 2013) | 10 lines

Deprecate old debugger breakpoint handler

- Add new breakpoint handler callback that does not take a
  stack trace
- Remove deprecated handler from debugger core
- Adjust tests
- Old breakpoint handler support remain in code until Dartium
  switches to new handler.

Review URL: https://codereview.chromium.org//14298002
------------------------------------------------------------------------
r21559 | asiva@google.com | 2013-04-17 02:19:34 +0900 (水, 17  4月 2013) | 5 lines

Fix the help message printed by standalone dart
- remove use-script-snapshot (not supported anymore)
- changed --print-source to --print-script

Review URL: https://codereview.chromium.org//14281003
------------------------------------------------------------------------
r21517 | floitsch@google.com | 2013-04-16 06:24:27 +0900 (火, 16  4月 2013) | 5 lines

Refactor Future constructors.

BUG=

Review URL: https://codereview.chromium.org//14070010
------------------------------------------------------------------------
r21498 | floitsch@google.com | 2013-04-16 03:58:32 +0900 (火, 16  4月 2013) | 3 lines

Remove AsyncError with Expando.

Review URL: https://codereview.chromium.org//14251006
------------------------------------------------------------------------
r21472 | floitsch@google.com | 2013-04-16 01:34:26 +0900 (火, 16  4月 2013) | 3 lines

Change StreamController constructor.

Review URL: https://codereview.chromium.org//14196003
------------------------------------------------------------------------
r21469 | floitsch@google.com | 2013-04-16 01:07:36 +0900 (火, 16  4月 2013) | 3 lines

Rename unsubscribeOnError to cancelOnError.

Review URL: https://codereview.chromium.org//14251013
------------------------------------------------------------------------
r21466 | ajohnsen@google.com | 2013-04-16 00:44:41 +0900 (火, 16  4月 2013) | 5 lines

Rename RandomAccessFile.readList and RandomAccessFile.writeList to RandomAccessFile.readInto and RandomAccessFile.writeFrom.

BUG=

Review URL: https://codereview.chromium.org//14018007
------------------------------------------------------------------------
r21455 | sgjesse@google.com | 2013-04-15 23:19:46 +0900 (月, 15  4月 2013) | 9 lines

Add support for even more typed data on native ports

The only types missing now are: Float32x4, Float32x4List and
Uint32x4 (currently no Uint32x4List).

R=ager@google.com
BUG=

Review URL: https://codereview.chromium.org//13998008
------------------------------------------------------------------------
r21452 | floitsch@google.com | 2013-04-15 22:52:29 +0900 (月, 15  4月 2013) | 3 lines

Refactor List.setRange function.

Review URL: https://codereview.chromium.org//13863012
------------------------------------------------------------------------
r21427 | sgjesse@google.com | 2013-04-15 18:56:41 +0900 (月, 15  4月 2013) | 10 lines

Fix wrong ASSERT

TBR=ager@google.com

Fix building of extension sample

TBR=ager@google.com
BUG=

Review URL: https://codereview.chromium.org//14046011
------------------------------------------------------------------------
r21423 | sgjesse@google.com | 2013-04-15 18:01:56 +0900 (月, 15  4月 2013) | 11 lines

Add support for more typed data types on native ports

Renamed the kUint8Array type for a Dart_CObject structure to
kByteArray to support all typed data types. The specific type is
stored in a separate type field. No matter what the specific type is,
the length of the byte array is always in bytes.

R=ager@google.com
BUG=

Review URL: https://codereview.chromium.org//14142008
------------------------------------------------------------------------
r21416 | ajohnsen@google.com | 2013-04-15 16:35:45 +0900 (月, 15  4月 2013) | 5 lines

Remove .writeStream, .consume and rewrite IOSink to correctly implement a (sane) well-defined behaviour of the .done future.

BUG=

Review URL: https://codereview.chromium.org//14028017
------------------------------------------------------------------------
r21395 | hausner@google.com | 2013-04-13 07:04:26 +0900 (土, 13  4月 2013) | 2 lines

Fix wire json breakage
Review URL: https://codereview.chromium.org//14217006
------------------------------------------------------------------------
r21392 | hausner@google.com | 2013-04-13 06:49:24 +0900 (土, 13  4月 2013) | 2 lines

More cleanups in debugger API and wire protocol
Review URL: https://codereview.chromium.org//13975018
------------------------------------------------------------------------
r21363 | whesse@google.com | 2013-04-13 00:22:45 +0900 (土, 13  4月 2013) | 5 lines

dart:io | Change the way SecureSocket initializes the NSS library with an empty database.

BUG=dartbug.com/7104

Review URL: https://codereview.chromium.org//13985012
------------------------------------------------------------------------
r21337 | floitsch@google.com | 2013-04-12 18:30:05 +0900 (金, 12  4月 2013) | 3 lines

Change hasSubscribers to hasListener.

Review URL: https://codereview.chromium.org//14103010
------------------------------------------------------------------------
r21305 | hausner@google.com | 2013-04-12 04:26:25 +0900 (金, 12  4月 2013) | 2 lines

Remove legacy debugger API stuff. The removed functions do not appear to be used in Dartium.
Review URL: https://codereview.chromium.org//14029016
------------------------------------------------------------------------
r21303 | floitsch@google.com | 2013-04-12 03:11:40 +0900 (金, 12  4月 2013) | 3 lines

Remove second generic argument of StreamConsumer.

Review URL: https://codereview.chromium.org//14172013
------------------------------------------------------------------------
r21275 | ajohnsen@google.com | 2013-04-11 21:54:19 +0900 (木, 11  4月 2013) | 7 lines

Remove StreamSink(replaced by EventSink) and make IOSink extend EventSink.

With this change 'writeBytes' was renamed to 'add'.

BUG=

Review URL: https://codereview.chromium.org//14150002
------------------------------------------------------------------------
r21241 | hausner@google.com | 2013-04-11 08:37:21 +0900 (木, 11  4月 2013) | 6 lines

Debugger wire protocol cleanups

- Rename id->isolateId in paused events
- Eliminate stack trace object in paused events
- Adapt ddbg.dart tool
Review URL: https://codereview.chromium.org//14105003
------------------------------------------------------------------------
r21205 | whesse@google.com | 2013-04-10 23:41:17 +0900 (水, 10  4月 2013) | 5 lines

dart:io | Remove some unneeded global error save/restore pairs on Windows.

BUG=

Review URL: https://codereview.chromium.org//13828005
------------------------------------------------------------------------
r21202 | ajohnsen@google.com | 2013-04-10 22:50:44 +0900 (水, 10  4月 2013) | 5 lines

Introduce new HttpBodyHandler to easily extract full body of HttpRequest and HttpClientResponse.

BUG=https://code.google.com/p/dart/issues/detail?id=8834

Review URL: https://codereview.chromium.org//14019002
------------------------------------------------------------------------
r21201 | whesse@google.com | 2013-04-10 22:47:22 +0900 (水, 10  4月 2013) | 5 lines

dart:io | Directory.list: Add some missing lines to macos and android versions of implementation.

BUG=

Review URL: https://codereview.chromium.org//14066002
------------------------------------------------------------------------
r21199 | whesse@google.com | 2013-04-10 22:07:08 +0900 (水, 10  4月 2013) | 5 lines

dart:io | Ensure that Directory.list terminates even when symbolic links create loops in the file system.

BUG=

Review URL: https://codereview.chromium.org//13818010
------------------------------------------------------------------------
r21160 | iposva@google.com | 2013-04-10 02:51:24 +0900 (水, 10  4月 2013) | 2 lines

Changelist to land https://codereview.chromium.org/13452007/ for Siva.
Review URL: https://codereview.chromium.org//13813018
------------------------------------------------------------------------
r21132 | ajohnsen@google.com | 2013-04-09 15:21:17 +0900 (火, 09  4月 2013) | 5 lines

Also wrap stdin/stdout/stderr on Process.

BUG=https://code.google.com/p/dart/issues/detail?id=9439

Review URL: https://codereview.chromium.org//13929002
------------------------------------------------------------------------
r21123 | iposva@google.com | 2013-04-09 08:33:50 +0900 (火, 09  4月 2013) | 2 lines

- Make the test_extension (a shared library) build in PIC.
Review URL: https://codereview.chromium.org//13811007
------------------------------------------------------------------------
r21109 | hausner@google.com | 2013-04-09 05:00:54 +0900 (火, 09  4月 2013) | 5 lines

More debugger fixing in json objects

Need a better test. The current basic_debugger_test hangs due to
the bug. Will look at that in a separate cl.
Review URL: https://codereview.chromium.org//13800014
------------------------------------------------------------------------
r21100 | hausner@google.com | 2013-04-09 03:49:28 +0900 (火, 09  4月 2013) | 4 lines

Fix editor build

Fix json syntax from previous change.
Review URL: https://codereview.chromium.org//13801017
------------------------------------------------------------------------
r21098 | hausner@google.com | 2013-04-09 03:31:56 +0900 (火, 09  4月 2013) | 5 lines

Add library id to code location object

Add libraryId field to the JSON Location object in the debugger
wire protocol.
Review URL: https://codereview.chromium.org//13771013
------------------------------------------------------------------------
r21077 | whesse@google.com | 2013-04-09 00:12:47 +0900 (火, 09  4月 2013) | 5 lines

dart:io | Add asynchronous Link.create implementation.

BUG=

Review URL: https://codereview.chromium.org//13800002
------------------------------------------------------------------------
r21075 | ajohnsen@google.com | 2013-04-08 23:35:44 +0900 (月, 08  4月 2013) | 5 lines

WebSocket: Correctly expect masked frames from clients, and send masked frames from the client.

BUG=https://code.google.com/p/dart/issues/detail?id=9723

Review URL: https://codereview.chromium.org//13686005
------------------------------------------------------------------------
r21063 | ajohnsen@google.com | 2013-04-08 21:13:03 +0900 (月, 08  4月 2013) | 5 lines

Wrap stdout/stderr/stdin to only expose the relevant methods.

BUG=https://code.google.com/p/dart/issues/detail?id=9439,https://code.google.com/p/dart/issues/detail?id=9593

Review URL: https://codereview.chromium.org//13787003
------------------------------------------------------------------------
r21060 | ajohnsen@google.com | 2013-04-08 20:30:33 +0900 (月, 08  4月 2013) | 5 lines

Fix recursive directory-deletion of top-level files/links.

BUG=

Review URL: https://codereview.chromium.org//13771010
------------------------------------------------------------------------
r21047 | ajohnsen@google.com | 2013-04-08 16:58:46 +0900 (月, 08  4月 2013) | 5 lines

Report same error-code on windows for all not-found cases.

BUG=

Review URL: https://codereview.chromium.org//13638028
------------------------------------------------------------------------
r21045 | ajohnsen@google.com | 2013-04-08 16:44:18 +0900 (月, 08  4月 2013) | 12 lines

Change how File/Directory/Link .delete works.

Now:
- File.delete works iff path is File or Link.
- Directory.delete works iff path is Directory or Link.
- Link.delete works iff path Link.

This now matches .exists.

BUG=

Review URL: https://codereview.chromium.org//13654002
------------------------------------------------------------------------
r21009 | hausner@google.com | 2013-04-06 08:45:14 +0900 (土, 06  4月 2013) | 5 lines

Add line table command to debugger

New command returns token information of a script. This will enable
the editor/debugger to translate token offsets to line numbers.
Review URL: https://codereview.chromium.org//13533016
------------------------------------------------------------------------
r21006 | efortuna@google.com | 2013-04-06 08:16:48 +0900 (土, 06  4月 2013) | 5 lines

Rename context2d to context2D.

BUG=

Review URL: https://codereview.chromium.org//13726010
------------------------------------------------------------------------
r20997 | tball@google.com | 2013-04-06 05:55:10 +0900 (土, 06  4月 2013) | 2 lines

Synced basic_debugger_test start on new "debugger initialized" message.
Review URL: https://codereview.chromium.org//13597004
------------------------------------------------------------------------
r20979 | floitsch@google.com | 2013-04-06 01:22:11 +0900 (土, 06  4月 2013) | 5 lines

StreamConsumer has an addStream and a close functions.

The 'consume' function will be removed.

Review URL: https://codereview.chromium.org//13680002
------------------------------------------------------------------------
r20978 | floitsch@google.com | 2013-04-06 01:12:40 +0900 (土, 06  4月 2013) | 8 lines

Add Iterable.fold (and Stream.fold) which replace `reduce`.

For now this is just a copy. In a next step we will change the behavior of
`reduce`.

BUG= http://dartbug.com/9536

Review URL: https://codereview.chromium.org//13548002
------------------------------------------------------------------------
r20964 | sgjesse@google.com | 2013-04-05 22:04:26 +0900 (金, 05  4月 2013) | 8 lines

Reapply "Add a sleep function to dart:io"

This reapplies r20952, r20953, r20954 together with hiding sleep from
dart:io in a number of tests.

R=ager@google.com

Review URL: https://codereview.chromium.org//13704003
------------------------------------------------------------------------
r20960 | sgjesse@google.com | 2013-04-05 20:13:24 +0900 (金, 05  4月 2013) | 14 lines

Fix a number of issues with determining the type of stdio

 * Fix checked mode exception when _getSocketType returns an OSError
 * Treat any character device as terminal (this includes /dev/null)
 * Fix detecting of file redirection af file
 * Don't turn an unkonwn device type into an OSError (wth value for an unknown was -1)

Expanded an existing test to catch some of this.

R=ager@google.com

BUG=https://code.google.com/p/dart/issues/detail?id=9637

Review URL: https://codereview.chromium.org//13636003
------------------------------------------------------------------------
r20955 | sgjesse@google.com | 2013-04-05 19:06:56 +0900 (金, 05  4月 2013) | 9 lines

Revert r20952, r20953, r20954

Too many failures due to conflicting top level sleep methods.

TBR=ager@google.com

BUG=

Review URL: https://codereview.chromium.org//13565005
------------------------------------------------------------------------
r20954 | sgjesse@google.com | 2013-04-05 18:52:30 +0900 (金, 05  4月 2013) | 5 lines

Fix analyze api test failure

TBR=ager@google.com

Review URL: https://codereview.chromium.org//13568004
------------------------------------------------------------------------
r20952 | sgjesse@google.com | 2013-04-05 18:35:37 +0900 (金, 05  4月 2013) | 9 lines

Add a sleep function to dart:io

The sleep function is a top-level function.

R=ager@google.com

BUG=https://code.google.com/p/dart/issues/detail?id=9254

Review URL: https://codereview.chromium.org//13641005
------------------------------------------------------------------------
r20929 | ajohnsen@google.com | 2013-04-05 02:30:17 +0900 (金, 05  4月 2013) | 5 lines

Fix directory-listing, directory-deletion and file deletion, when links are involved.

BUG=https://code.google.com/p/dart/issues/detail?id=4928,https://code.google.com/p/dart/issues/detail?id=9278,https://code.google.com/p/dart/issues/detail?id=9504

Review URL: https://codereview.chromium.org//13578003
------------------------------------------------------------------------
r20899 | tball@google.com | 2013-04-04 07:03:20 +0900 (木, 04  4月 2013) | 2 lines

Client-side support for stacktrace VM status.
Review URL: https://codereview.chromium.org//13008025
------------------------------------------------------------------------
r20816 | hausner@google.com | 2013-04-03 05:41:29 +0900 (水, 03  4月 2013) | 10 lines

Add text location in debugger event

- Adding token number in text location data. Line number will be
  removed when the editor knows how to convert a token number to its
  line number.
- "location" field in stack frames is now optional. If it is not present, there
  is no corresponding textual location for the code location.
- Add location info of "paused" and "interrupted" events.
  Stack trace will go away in these events.
Review URL: https://codereview.chromium.org//13144018
------------------------------------------------------------------------
r20566 | tball@google.com | 2013-03-28 02:30:14 +0900 (木, 28  3月 2013) | 2 lines

Added string appending to TextBuffer, removed STL use in vm_stats_impl.
Review URL: https://codereview.chromium.org//13006007
------------------------------------------------------------------------
r20466 | hausner@google.com | 2013-03-26 03:11:08 +0900 (火, 26  3月 2013) | 7 lines

Remove legacy syntax support for library import

Remove legacy syntax for #import, #library and #source
Update test programs
Recalc fingerprints of inlined functions that were apparently
affected by the change of library name from "dart:io" to dart.io.
Review URL: https://codereview.chromium.org//12880023
------------------------------------------------------------------------
r20370 | whesse@google.com | 2013-03-22 18:56:14 +0900 (金, 22  3月 2013) | 5 lines

dart:io | Add "followLinks" optional parameter to Directory.list, let it return Link objects when false.

BUG=dartbug.com/7720

Review URL: https://codereview.chromium.org//12638039
------------------------------------------------------------------------
r20342 | asiva@google.com | 2013-03-22 04:49:50 +0900 (金, 22  3月 2013) | 2 lines

Fix build break in dart2js. The snapshot length was not accounting for the magic number.
Review URL: https://codereview.chromium.org//12419009
------------------------------------------------------------------------
r20339 | asiva@google.com | 2013-03-22 03:47:49 +0900 (金, 22  3月 2013) | 2 lines

Write the magic number 0xf5f5dcdc into a script snapshot file and use this to distinguish whether a script snapshot or a regular script file is being passed on the command line (removed the --use-script-snapshot option).
Review URL: https://codereview.chromium.org//12438033
------------------------------------------------------------------------
r20307 | whesse@google.com | 2013-03-21 18:44:56 +0900 (木, 21  3月 2013) | 5 lines

Add FileSystemEntity.identical, to test if two file system objects are the same.

BUG=

Review URL: https://codereview.chromium.org//12850010
------------------------------------------------------------------------
r20277 | asiva@google.com | 2013-03-21 00:41:29 +0900 (木, 21  3月 2013) | 2 lines

Remove redundant Dart_LoadEmbeddedScript as it doesn't seem to be used in the VM and hopefully dartium can start using Dart_Script always.
Review URL: https://codereview.chromium.org//12919020
------------------------------------------------------------------------
r20210 | sgjesse@google.com | 2013-03-20 00:26:47 +0900 (水, 20  3月 2013) | 18 lines

Change the IO buffer size on Windows to 32k

This makes a program like this

import "dart:io";

main() {
  stdin.pipe(stdout);
}

with stdin redirected from a file run 20 - 50 times faster depending
in the file size piped through.

R=ager@google.com

BUG=

Review URL: https://codereview.chromium.org//12935002
------------------------------------------------------------------------
r20195 | whesse@google.com | 2013-03-19 20:19:03 +0900 (火, 19  3月 2013) | 5 lines

dart:io | Add Link.targetSync on all platforms.

BUG=

Review URL: https://codereview.chromium.org//12812010
------------------------------------------------------------------------
r20075 | whesse@google.com | 2013-03-15 21:57:15 +0900 (金, 15  3月 2013) | 5 lines

dart:io | Make broken links report NOT_FOUND from FileSystemEntity.typeSync on Windows.

BUG=dartbug.com/8935

Review URL: https://codereview.chromium.org//12437017
------------------------------------------------------------------------
r20074 | floitsch@google.com | 2013-03-15 21:45:40 +0900 (金, 15  3月 2013) | 5 lines

Make argument to StringSink.writeln optional.

BUG= http://dartbug.com/9102

Review URL: https://codereview.chromium.org//12870003
------------------------------------------------------------------------
r20068 | ager@google.com | 2013-03-15 19:19:56 +0900 (金, 15  3月 2013) | 6 lines

Avoid massive stack frames by allocating 64k buffers in the heap.

R=sgjesse@google.com,ajohnsen@google.com
BUG=

Review URL: https://codereview.chromium.org//12812006
------------------------------------------------------------------------
r20025 | asiva@google.com | 2013-03-14 23:12:36 +0900 (木, 14  3月 2013) | 2 lines

Fix source generation for strings that have \$ in them.
Review URL: https://codereview.chromium.org//12605009
------------------------------------------------------------------------
r20014 | ajohnsen@google.com | 2013-03-14 21:46:54 +0900 (木, 14  3月 2013) | 7 lines

Add setOption method on Socket/RawSocket.

This will allow the user to enable TCP_NODELAY on the native sockets.

BUG=

Review URL: https://codereview.chromium.org//12614014
------------------------------------------------------------------------
r19996 | asiva@google.com | 2013-03-14 18:47:46 +0900 (木, 14  3月 2013) | 4 lines

Add a command line option to generate source code for a script
(apparently this would be useful for pretty printing the output of
dart2dart)
Review URL: https://codereview.chromium.org//12517005
------------------------------------------------------------------------
r19995 | whesse@google.com | 2013-03-14 18:37:44 +0900 (木, 14  3月 2013) | 8 lines

dart:io | Add Link class, as sibling to File and Directory.

BUG=

Committed: https://code.google.com/p/dart/source/detail?r=19772
Reverted: https://code.google.com/p/dart/source/detail?r=19777

Review URL: https://codereview.chromium.org//12691002
------------------------------------------------------------------------
r19927 | floitsch@google.com | 2013-03-13 22:12:00 +0900 (水, 13  3月 2013) | 3 lines

Move Options to dart:io.

Review URL: https://codereview.chromium.org//12794002
------------------------------------------------------------------------
r19925 | floitsch@google.com | 2013-03-13 22:02:13 +0900 (水, 13  3月 2013) | 3 lines

Rename Timer.repeating to Timer.periodic.

Review URL: https://codereview.chromium.org//12793003
------------------------------------------------------------------------
r19921 | ager@google.com | 2013-03-13 20:11:38 +0900 (水, 13  3月 2013) | 8 lines

Fix file descriptor leak in event handler implementation. When shutting down an isolate, we did not destruct the eventhandler so we leaked the file descriptors for it.

Also fix leak of monitor wait data objects on Windows.

R=sgjesse@google.com
BUG=dartbug.com/9021

Review URL: https://codereview.chromium.org//12646007
------------------------------------------------------------------------
r19848 | asiva@google.com | 2013-03-12 19:57:48 +0900 (火, 12  3月 2013) | 3 lines

- Use dart:typedata types in the Dart API calls.
- Change the dart/io code to not use dart:scalarlist
Review URL: https://codereview.chromium.org//12730013
------------------------------------------------------------------------
r19803 | sgjesse@google.com | 2013-03-12 01:15:56 +0900 (火, 12  3月 2013) | 10 lines

Fix checked mode error on socket IOSink

The set encoding method on a Sockets IOSink implementation failed in
checked mode. Added a test calling all IOSink methods on a socket.

BUG=https://code.google.com/p/dart/issues/detail?id=9020

R=ajohnsen@google.com

Review URL: https://codereview.chromium.org//12408004
------------------------------------------------------------------------
r19796 | ajohnsen@google.com | 2013-03-12 00:16:08 +0900 (火, 12  3月 2013) | 7 lines

Handle /dev/null on linux, as an closed device.

This will make all devices unsupported by epoll act as an empty source.

BUG=

Review URL: https://codereview.chromium.org//12476021
------------------------------------------------------------------------
r19790 | kustermann@google.com | 2013-03-11 22:35:38 +0900 (月, 11  3月 2013) | 5 lines

Fix of file descriptor inheritance problem in process_{linux,android,mac}

BUG=http://dartbug.com/9030

Review URL: https://codereview.chromium.org//12576007
------------------------------------------------------------------------
r19777 | whesse@google.com | 2013-03-11 20:59:57 +0900 (月, 11  3月 2013) | 5 lines

dart:io | Revert addition of Link class, because it conflicts with a Link class in dart2js.

BUG=

Review URL: https://codereview.chromium.org//12555005
------------------------------------------------------------------------
r19772 | whesse@google.com | 2013-03-11 19:34:52 +0900 (月, 11  3月 2013) | 5 lines

dart:io | Add Link class, as sibling to File and Directory.

BUG=

Review URL: https://codereview.chromium.org//12691002
------------------------------------------------------------------------
r19690 | floitsch@google.com | 2013-03-08 22:07:18 +0900 (金, 08  3月 2013) | 3 lines

Remove deprecated StringBuffer.add, addAll and addCharCode.

Review URL: https://codereview.chromium.org//12473003
------------------------------------------------------------------------
r19683 | lrn@google.com | 2013-03-08 20:31:19 +0900 (金, 08  3月 2013) | 3 lines

Renamed StreamSink to EventSink. Renamed signalError to addError.

Review URL: https://codereview.chromium.org//12610006
------------------------------------------------------------------------
r19681 | whesse@google.com | 2013-03-08 19:36:08 +0900 (金, 08  3月 2013) | 5 lines

dart:io | Implement FileSystemEntity.typeSync on Windows, to identify symbolic links and junctions.

BUG=dartbug.com/8935

Review URL: https://codereview.chromium.org//12617002
------------------------------------------------------------------------
r19676 | sgjesse@google.com | 2013-03-08 19:06:28 +0900 (金, 08  3月 2013) | 16 lines

Make IOSink implement StringSink

Besides adding the StringSink methods I also added writeBytes and
deprecated both add and addString.

To handle the encoding of strings the IOSike has an encoding
property. This property is mutable in situation when it makes sense to
change encoding of what is written. The exception here is for HTTP
where the encoding is determined from the header and the encoding
cannot be changed.

R=ajohnsen@google.com, ager@google.com, nweiz@google.com

BUG=

Review URL: https://codereview.chromium.org//12504006
------------------------------------------------------------------------
r19611 | whesse@google.com | 2013-03-07 20:32:05 +0900 (木, 07  3月 2013) | 6 lines

dart:io | Fix stray code committed to Windows platform

TBR=sgjesse@google.com
BUG=

Review URL: https://codereview.chromium.org//12464013
------------------------------------------------------------------------
r19608 | whesse@google.com | 2013-03-07 20:18:38 +0900 (木, 07  3月 2013) | 5 lines

dart:io | Add FileSystemEntity.typeSync to test for symbolic links.

BUG=dartbug.com/8935

Review URL: https://codereview.chromium.org//12533008
------------------------------------------------------------------------
r19569 | tball@google.com | 2013-03-07 02:48:53 +0900 (木, 07  3月 2013) | 6 lines

Added support for "bin-ified" resources, used to link the vmstats 
web app files into the VM binary. create_resources.py takes a list
of resources and writes each as a byte array, then builds a resource
table. resources.h defines a simple lookup for these arrays, which
vmstats uses.
Review URL: https://codereview.chromium.org//12377099
------------------------------------------------------------------------
r19553 | ajohnsen@google.com | 2013-03-06 20:53:27 +0900 (水, 06  3月 2013) | 5 lines

And another... :(

BUG=

Review URL: https://codereview.chromium.org//12481016
------------------------------------------------------------------------
r19551 | ajohnsen@google.com | 2013-03-06 20:38:41 +0900 (水, 06  3月 2013) | 5 lines

Introduce ZLibInflater and ZLibDeflater to dart:io.

BUG=

Review URL: https://codereview.chromium.org//12451004
------------------------------------------------------------------------
r19396 | whesse@google.com | 2013-03-05 01:16:18 +0900 (火, 05  3月 2013) | 5 lines

dart:io | Fix a crash when read was called on a closed socket on Windows.

BUG=dartbug.com/8798

Review URL: https://codereview.chromium.org//12395017
------------------------------------------------------------------------
r19345 | tball@google.com | 2013-03-02 08:38:45 +0900 (土, 02  3月 2013) | 2 lines

Set vmstats socket as blocking.
Review URL: https://codereview.chromium.org//12390041
------------------------------------------------------------------------
r19334 | tball@google.com | 2013-03-02 03:33:17 +0900 (土, 02  3月 2013) | 2 lines

Added Socket::SetBlocking() and Socket::SetNonBlocking().
Review URL: https://codereview.chromium.org//12380032
------------------------------------------------------------------------
r19316 | ajohnsen@google.com | 2013-03-01 23:20:38 +0900 (金, 01  3月 2013) | 5 lines

Fix socket so we stop the consumer before we close the socket - this makes sure we socket-close future don't result in a socket write.

BUG=https://code.google.com/p/dart/issues/detail?id=8874

Review URL: https://codereview.chromium.org//12393010
------------------------------------------------------------------------
r19276 | sgjesse@google.com | 2013-03-01 16:53:11 +0900 (金, 01  3月 2013) | 9 lines

Remove wrong type annotation

nativeCreateConnect returns either a bool (only true) or an OSError.

TBR=ajohnsen@google.com

BUG=

Review URL: https://codereview.chromium.org//12383043
------------------------------------------------------------------------
r19229 | ajohnsen@google.com | 2013-02-28 23:16:05 +0900 (木, 28  2月 2013) | 5 lines

Correctly close done future with an error, before a normal complete can happen.

BUG=

Review URL: https://codereview.chromium.org//12387014
------------------------------------------------------------------------
r19220 | floitsch@google.com | 2013-02-28 22:24:12 +0900 (木, 28  2月 2013) | 3 lines

Remove deprecated ms arguments for Timer and Future.

Review URL: https://codereview.chromium.org//12342014
------------------------------------------------------------------------
r19150 | whesse@google.com | 2013-02-28 01:15:18 +0900 (木, 28  2月 2013) | 5 lines

dart:io | Change a remaining use of File.name to File.path, in samples.

BUG=

Review URL: https://codereview.chromium.org//12319148
------------------------------------------------------------------------
r19145 | sgjesse@google.com | 2013-02-28 00:33:08 +0900 (木, 28  2月 2013) | 7 lines

Make File.readSync return only the bytes read

R=ager@google.com
BUG=https://code.google.com/p/dart/issues/detail?id=8831
TEST=tests/standalone/io/file_test.dart

Review URL: https://codereview.chromium.org//12315129
------------------------------------------------------------------------
r19144 | whesse@google.com | 2013-02-28 00:26:11 +0900 (木, 28  2月 2013) | 5 lines

dart:io | Rename File.name to File.path.

BUG=dartbug.com/8790

Review URL: https://codereview.chromium.org//12314153
------------------------------------------------------------------------
r19117 | ajohnsen@google.com | 2013-02-27 18:27:01 +0900 (水, 27  2月 2013) | 7 lines

Make sure the socket unsubscribes on error, so we don't get race conditions between an error and an immidiately following close event.

This makes sure we always see the expected errors.

BUG=

Review URL: https://codereview.chromium.org//12314148
------------------------------------------------------------------------
r19112 | lrn@google.com | 2013-02-27 17:45:04 +0900 (水, 27  2月 2013) | 7 lines

Change new List(n) to return fixed length list.
Deprecate List.fixedLength, add List.filled.

Make Iterable.toList and List.from take "growable" argument,
defaulting to false.

Review URL: https://codereview.chromium.org//12328104
------------------------------------------------------------------------
r19111 | ajohnsen@google.com | 2013-02-27 17:27:12 +0900 (水, 27  2月 2013) | 17 lines

Rewrite the Future-pipeline from the Socket to the HttpClientRequest/HttpResponse.

Before we had two future, HttpClientRequest/HttpResponse.done and
Socket.addStream's return valud(stored as _writeDoneFuture in
    http_impl). Many issues in our code was based on the futures not
being the same, that the user will get a done event, while the socket is
still writing data on the socket.

Immidiate calls to HttpServer/HttpClient.close, after e.g. pipe, would
then destroy the socket while still having data in dart buffers.

The new approach makes sure that there is a direct future link between
the socket and the user.

BUG=

Review URL: https://codereview.chromium.org//12328114
------------------------------------------------------------------------
r19106 | asiva@google.com | 2013-02-27 11:25:32 +0900 (水, 27  2月 2013) | 3 lines

Quick fix for racy shutdown issues in VmStats.
(We need a VmStats::InitOnce to set things up).
Review URL: https://codereview.chromium.org//12316148
------------------------------------------------------------------------
r19105 | tball@google.com | 2013-02-27 10:09:36 +0900 (水, 27  2月 2013) | 2 lines

Don't execute VmStats::Stop() unless port is specified.
Review URL: https://codereview.chromium.org//12310158
------------------------------------------------------------------------
r19100 | tball@google.com | 2013-02-27 09:25:08 +0900 (水, 27  2月 2013) | 2 lines

Removed remaining reference to FDUtils.
Review URL: https://codereview.chromium.org//12328124
------------------------------------------------------------------------
r19098 | tball@google.com | 2013-02-27 08:40:26 +0900 (水, 27  2月 2013) | 3 lines

Used Socket::Read instead of FdUtils::ReadFromBlocking, since FdUtils
isn't implemented on Windows.
Review URL: https://codereview.chromium.org//12328122
------------------------------------------------------------------------
r19095 | tball@google.com | 2013-02-27 08:22:53 +0900 (水, 27  2月 2013) | 2 lines

Replaced read() call with FDUtils functions to fix Windows build.
Review URL: https://codereview.chromium.org//12340090
------------------------------------------------------------------------
r19093 | iposva@google.com | 2013-02-27 08:02:40 +0900 (水, 27  2月 2013) | 2 lines

- Fix string formatting.
Review URL: https://codereview.chromium.org//12340088
------------------------------------------------------------------------
r19091 | tball@google.com | 2013-02-27 07:34:08 +0900 (水, 27  2月 2013) | 2 lines

Initial prototype of vmstats support, based on Dart VM Stats draft design doc.
Review URL: https://codereview.chromium.org//12221022
------------------------------------------------------------------------
r19017 | iposva@google.com | 2013-02-26 08:25:29 +0900 (火, 26  2月 2013) | 3 lines

- Properly load the core libraries as libraries and not as scripts.
  This will honor their imports and library names.
Review URL: https://codereview.chromium.org//12321082
------------------------------------------------------------------------
r18969 | whesse@google.com | 2013-02-25 23:52:39 +0900 (月, 25  2月 2013) | 6 lines

dart:io | Fix writing to a Socket while and after calling destroy() on it.

BUG=dartbug.com/8681
TEST=standalone/io/http_client_request_test

Review URL: https://codereview.chromium.org//12330109
------------------------------------------------------------------------
r18960 | lrn@google.com | 2013-02-25 19:48:09 +0900 (月, 25  2月 2013) | 5 lines

Remove deprecated string features.

Make String.codeUnits return a List.

Review URL: https://codereview.chromium.org//12282038
------------------------------------------------------------------------
r18880 | ajohnsen@google.com | 2013-02-22 20:51:24 +0900 (金, 22  2月 2013) | 5 lines

Add asserts to kqueue filter/events on mac.

BUG=

Review URL: https://codereview.chromium.org//12334036
------------------------------------------------------------------------
r18878 | ajohnsen@google.com | 2013-02-22 20:42:32 +0900 (金, 22  2月 2013) | 5 lines

Handle single EPOLLHUP epoll events on Linux.

BUG=

Review URL: https://codereview.chromium.org//12328052
------------------------------------------------------------------------
r18877 | ajohnsen@google.com | 2013-02-22 20:24:35 +0900 (金, 22  2月 2013) | 5 lines

Don't send null data events on a Socket stream.

BUG=

Review URL: https://codereview.chromium.org//12334035
------------------------------------------------------------------------
r18873 | ajohnsen@google.com | 2013-02-22 18:51:08 +0900 (金, 22  2月 2013) | 10 lines

Handle legacy epoll event on Linux.

This should fix flaky tests on older versions of Linux (including those
    running buildbot).

Also re-enable test on linux.

BUG=

Review URL: https://codereview.chromium.org//12319067
------------------------------------------------------------------------
r18865 | asiva@google.com | 2013-02-22 10:24:57 +0900 (金, 22  2月 2013) | 3 lines

Move json, uri, utf and crypto libraries into the VM.
This should ensure that we would not need a patch per embedder for these libraries in case somebody decides to patch these.
Review URL: https://codereview.chromium.org//12318031
------------------------------------------------------------------------
r18846 | asiva@google.com | 2013-02-22 03:43:44 +0900 (金, 22  2月 2013) | 2 lines

Add typed data interface to Dart API, this only changes the C++ API as dicussed in a previous email. The dart code in the library has not been changed yet.
Review URL: https://codereview.chromium.org//12255018
------------------------------------------------------------------------
r18821 | sgjesse@google.com | 2013-02-21 21:08:34 +0900 (木, 21  2月 2013) | 7 lines

Add missing files from previous commit

TBR=ager@google.com

BUG=

Review URL: https://codereview.chromium.org//12328037
------------------------------------------------------------------------
r18820 | sgjesse@google.com | 2013-02-21 20:58:11 +0900 (木, 21  2月 2013) | 7 lines

Merge IO v2 branch to bleeding edge

R=ager@google.com, ajohnsen@google.com, whesse@google.com

BUG=

Review URL: https://codereview.chromium.org//12316036
------------------------------------------------------------------------
r18798 | iposva@google.com | 2013-02-21 08:47:29 +0900 (木, 21  2月 2013) | 3 lines

Fix Windows build:
- Missed a OS dependent file.
Review URL: https://codereview.chromium.org//12315020
------------------------------------------------------------------------
r18788 | iposva@google.com | 2013-02-21 06:27:07 +0900 (木, 21  2月 2013) | 2 lines

- Attempt to fix build breakage on Windows.
Review URL: https://codereview.chromium.org//12319030
------------------------------------------------------------------------
r18786 | iposva@google.com | 2013-02-21 06:17:38 +0900 (木, 21  2月 2013) | 4 lines

Prepare for removal of source_filter.gypi:
- Guard OS-dependent source files with #if TARGET_OS_* in a similar
  fashion to the architecture dependent sources.
Review URL: https://codereview.chromium.org//12282051
------------------------------------------------------------------------
r18754 | whesse@google.com | 2013-02-20 22:34:50 +0900 (水, 20  2月 2013) | 5 lines

dart:io Directory.list: Fix use of snprintf return value to work with both C99, Windows, and pre-C99 versions of snprintf.

BUG=

Review URL: https://codereview.chromium.org//12326007
------------------------------------------------------------------------
r18740 | whesse@google.com | 2013-02-20 18:42:28 +0900 (水, 20  2月 2013) | 3 lines

IO v2: Use a single PathBuffer in Directory.list on Windows, and stop rewriting paths during listing.

Review URL: https://codereview.chromium.org//12212194
------------------------------------------------------------------------
r18739 | whesse@google.com | 2013-02-20 18:27:08 +0900 (水, 20  2月 2013) | 8 lines

Change Directory.list to use the input path, and not resolve it to a full path.
All paths reported by Directory.list are now extensions of the input path.

The Windows platform equivalent change will be committed in a separate CL.

BUG=

Review URL: https://codereview.chromium.org//12217086
------------------------------------------------------------------------
r18732 | iposva@google.com | 2013-02-20 07:43:22 +0900 (水, 20  2月 2013) | 2 lines

- Avoid warnings when the result of TEMP_FAILURE_RETRY is unused.
Review URL: https://codereview.chromium.org//12178025
------------------------------------------------------------------------
r18702 | whesse@google.com | 2013-02-20 02:00:35 +0900 (水, 20  2月 2013) | 6 lines

Fix error handling in SecureSocket.initialize

BUG=dartbug.com/8228
TEST=standalone/io/secure_socket_arguments_test

Review URL: https://codereview.chromium.org//12298035
------------------------------------------------------------------------
r18599 | tball@google.com | 2013-02-16 06:06:54 +0900 (土, 16  2月 2013) | 1 line

Last windows fix (hopefully!).
------------------------------------------------------------------------
r18598 | tball@google.com | 2013-02-16 06:02:31 +0900 (土, 16  2月 2013) | 1 line

Fixed Windows compile error.
------------------------------------------------------------------------
r18597 | tball@google.com | 2013-02-16 05:51:49 +0900 (土, 16  2月 2013) | 2 lines

Moved GetCurrentTime functions from bin/eventhandler to bin/utils.
Review URL: https://codereview.chromium.org//12280004
------------------------------------------------------------------------
r18448 | whesse@google.com | 2013-02-14 00:00:55 +0900 (木, 14  2月 2013) | 5 lines

dart:io: Use PathBuffer class for Directory.list on Windows platform.

BUG=https://code.google.com/p/dart/issues/detail?id=7505

Review URL: https://codereview.chromium.org//12252006
------------------------------------------------------------------------
r18367 | asiva@google.com | 2013-02-12 11:39:00 +0900 (火, 12  2月 2013) | 2 lines

Add snapshot size to the VM benchmarks suite.
Review URL: https://codereview.chromium.org//12226068
------------------------------------------------------------------------
r18307 | whesse@google.com | 2013-02-11 22:44:00 +0900 (月, 11  2月 2013) | 5 lines

Remove erroneous assert from Windows implementation of dart:io File.fullPath.

BUG=

Review URL: https://codereview.chromium.org//12208109
------------------------------------------------------------------------
r18260 | whesse@google.com | 2013-02-09 01:47:33 +0900 (土, 09  2月 2013) | 7 lines

Revert changes to directory listing on Windows, to diagnose pub problems.

TBR=nweiz@google.com

BUG=

Review URL: https://codereview.chromium.org//12210086
------------------------------------------------------------------------
r18251 | whesse@google.com | 2013-02-08 21:55:32 +0900 (金, 08  2月 2013) | 5 lines

Remove use of strnlen on Mac OS, because pre-Lion versions don't have it.

BUG=

Review URL: https://codereview.chromium.org//12212090
------------------------------------------------------------------------
r18248 | whesse@google.com | 2013-02-08 21:21:56 +0900 (金, 08  2月 2013) | 5 lines

Add string.h header file to directory listing implementations.

BUG=

Review URL: https://codereview.chromium.org//12221086
------------------------------------------------------------------------
r18247 | whesse@google.com | 2013-02-08 20:58:12 +0900 (金, 08  2月 2013) | 8 lines

Use a PathBuffer class in dart:io directory lister.

This simplifies the code, and avoids buffer overflow errors
by encapsulating snprintf.

BUG=

Review URL: https://codereview.chromium.org//12220034
------------------------------------------------------------------------
r18199 | tball@google.com | 2013-02-07 09:44:55 +0900 (木, 07  2月 2013) | 2 lines

Added Socket::Close() function.
Review URL: https://codereview.chromium.org//12209047
------------------------------------------------------------------------
r18174 | sgjesse@google.com | 2013-02-07 00:24:12 +0900 (木, 07  2月 2013) | 5 lines

Remove Windows line breaks accidentially committed in r18172

TBR=ager@google.com

Review URL: https://codereview.chromium.org//12217038
------------------------------------------------------------------------
r18171 | sgjesse@google.com | 2013-02-06 23:39:29 +0900 (水, 06  2月 2013) | 9 lines

Fix socket error reporting on Windows

An error which happened during writing could be reported as error code 0 (which indicate success). This has been fixed so that the original error is reported.

R=ager@google.com

BUG=

Review URL: https://codereview.chromium.org//12218035
------------------------------------------------------------------------
r18117 | sra@google.com | 2013-02-05 16:11:12 +0900 (火, 05  2月 2013) | 3 lines

Revert "Fresh try at "Use browsers JSON.parse for parsing JSON.""

Review URL: https://codereview.chromium.org//12220009
------------------------------------------------------------------------
r18116 | sra@google.com | 2013-02-05 16:00:47 +0900 (火, 05  2月 2013) | 3 lines

Fresh try at "Use browsers JSON.parse for parsing JSON."

Review URL: https://codereview.chromium.org//12221009
------------------------------------------------------------------------
r18024 | sra@google.com | 2013-02-02 13:01:28 +0900 (土, 02  2月 2013) | 3 lines

Revert "Revert "Revert "Use browsers JSON.parse for parsing JSON."""

Review URL: https://codereview.chromium.org//12192003
------------------------------------------------------------------------
r18023 | sra@google.com | 2013-02-02 12:36:10 +0900 (土, 02  2月 2013) | 5 lines

Revert "Revert "Use browsers JSON.parse for parsing JSON.""

with missing gyp file.

Review URL: https://codereview.chromium.org//12179004
------------------------------------------------------------------------
r18022 | sra@google.com | 2013-02-02 12:25:53 +0900 (土, 02  2月 2013) | 3 lines

Revert "Use browsers JSON.parse for parsing JSON."

Review URL: https://codereview.chromium.org//12190002
------------------------------------------------------------------------
r18021 | sra@google.com | 2013-02-02 12:17:41 +0900 (土, 02  2月 2013) | 6 lines

Use browsers JSON.parse for parsing JSON.

This shrinks swarm by 27k (3.6%)
We can't make the error messages be the same since the native error contains only a message.

Review URL: https://codereview.chromium.org//12114021
------------------------------------------------------------------------
r17937 | asiva@google.com | 2013-02-01 03:53:21 +0900 (金, 01  2月 2013) | 3 lines

- Change the layout of external typed array objects to avoid the extra indirection when accessing elements in the array.
- Change the Dart API which create these external arrays to account for this change
Review URL: https://codereview.chromium.org//12093071
------------------------------------------------------------------------
r17852 | ager@google.com | 2013-01-31 01:16:54 +0900 (木, 31  1月 2013) | 6 lines

Fix Socket_WriteList to use the offset for external byte arrays.

R=sgjesse@google.com
BUG=

Review URL: https://codereview.chromium.org//12087088
------------------------------------------------------------------------
r17737 | asiva@google.com | 2013-01-29 08:36:00 +0900 (火, 29  1月 2013) | 2 lines

Remove the script snapshot option from gen_snapshot as the dart executable can be used for generating script snapshots.
Review URL: https://codereview.chromium.org//12084011
------------------------------------------------------------------------
r17686 | asiva@google.com | 2013-01-26 14:47:56 +0900 (土, 26  1月 2013) | 3 lines

1. Change option --use_script_snapshot to --use-script-snapshot (easier to type).
2. Use dart binary with the --generate-script-snapshot option to generate dart2js snapshot
Review URL: https://codereview.chromium.org//12084010
------------------------------------------------------------------------
r17680 | asiva@google.com | 2013-01-26 09:43:09 +0900 (土, 26  1月 2013) | 2 lines

Add --generate-script-snapshot option to dart so that this binary can be used for generating script snapshots.
Review URL: https://codereview.chromium.org//11953115
------------------------------------------------------------------------
r17617 | hausner@google.com | 2013-01-25 08:35:34 +0900 (金, 25  1月 2013) | 4 lines

Verify integrity of JSOM messages sent to debugger client

Make sure JSOM messages are grammatically correct and string values are properly encoded.
Review URL: https://codereview.chromium.org//12035086
------------------------------------------------------------------------
r17604 | iposva@google.com | 2013-01-25 06:56:10 +0900 (金, 25  1月 2013) | 3 lines

Fix issue 8094:
- Do not assert that dart-scheme URIs point to libraries exclusively.
Review URL: https://codereview.chromium.org//12036089
------------------------------------------------------------------------
r17562 | floitsch@google.com | 2013-01-24 22:26:18 +0900 (木, 24  1月 2013) | 3 lines

Rename new Uri.fromString to Uri.parse.

Review URL: https://codereview.chromium.org//12052038
------------------------------------------------------------------------
r17549 | floitsch@google.com | 2013-01-24 21:16:37 +0900 (木, 24  1月 2013) | 5 lines

Rename Date to DateTime.

BUG=http://dartbug.com/1424

Review URL: https://codereview.chromium.org//11770004
------------------------------------------------------------------------
r17517 | hausner@google.com | 2013-01-24 09:53:42 +0900 (木, 24  1月 2013) | 5 lines

More length restrictions in debugger protocol

Restrict the length of the textual representation of variable values that are sent over the debugger wire protocol. The full value can still be retrieved explicitly by the debugger client.
 
Review URL: https://codereview.chromium.org//12040053
------------------------------------------------------------------------
r17486 | hausner@google.com | 2013-01-24 03:41:00 +0900 (木, 24  1月 2013) | 6 lines

Limit textual representation of arrays in debugger

The debugger wire protocol choked when large arrays were present, because it tried to send the entire array as textual value. This change limits the size of the textual representation to about 256 characters. If elements are dropped, they are printed as …

 
Review URL: https://codereview.chromium.org//12033039
------------------------------------------------------------------------
r17352 | floitsch@google.com | 2013-01-21 22:34:02 +0900 (月, 21  1月 2013) | 3 lines

Move some core classes to collection library.

Review URL: https://codereview.chromium.org//11867024
------------------------------------------------------------------------
r17332 | hausner@google.com | 2013-01-19 09:03:30 +0900 (土, 19  1月 2013) | 6 lines

Add function for one-time stop at function entry

Adds function Dart_OneTimeBreakAtEntry()

Used by debugger clients to stop at the beginning of the program without setting a user-visible breakpoint.
Review URL: https://codereview.chromium.org//11926026
------------------------------------------------------------------------
r17246 | regis@google.com | 2013-01-18 09:34:20 +0900 (金, 18  1月 2013) | 2 lines

Fix vm code base so that it can be built for --arch=simarm (no snapshot yet).
Review URL: https://codereview.chromium.org//11956004
------------------------------------------------------------------------
r16934 | hausner@google.com | 2013-01-11 06:47:09 +0900 (金, 11  1月 2013) | 9 lines

Support for embedded Dart scripts

Add a line and column offset to scripts so that errors and exceptions
in embedded Dart scripts are reported at the proper location.
New API call Dart_LoadEmbeddedScript() that allows to specify
line and column offsets.

Stumbled on and fixed a bug. Script::kind field was not externalized to snapshot.
Review URL: https://codereview.chromium.org//11824067
------------------------------------------------------------------------
r16921 | whesse@google.com | 2013-01-10 23:24:57 +0900 (木, 10  1月 2013) | 5 lines

Speed up secure sockets by increasing encrypted buffer size.

BUG=

Review URL: https://codereview.chromium.org//11819062
------------------------------------------------------------------------
r16903 | ager@google.com | 2013-01-10 17:43:56 +0900 (木, 10  1月 2013) | 6 lines

Remove accidental addition of new stream API in dart:io.

R=ajohnsen@google.com
BUG=

Review URL: https://codereview.chromium.org//11823050
------------------------------------------------------------------------
r16842 | whesse@google.com | 2013-01-09 18:59:14 +0900 (水, 09  1月 2013) | 5 lines

Fix race condition in Directory.create.

BUG=https://code.google.com/p/dart/issues/detail?id=7679

Review URL: https://codereview.chromium.org//11794048
------------------------------------------------------------------------
r16839 | sgjesse@google.com | 2013-01-09 18:17:07 +0900 (水, 09  1月 2013) | 11 lines

Add function for finding what a InputStream or OutputStream is attached to

For the dart:io types InputStream and OutputStream the top level
function stdioType will return whether the stream is attached to a
terminal, pipe, file or something else.

BUG=dart:2789

R=ager@google.com

Review URL: https://codereview.chromium.org//11773041
------------------------------------------------------------------------
r16687 | floitsch@google.com | 2013-01-07 20:23:16 +0900 (月, 07  1月 2013) | 3 lines

Big merge from experimental to bleeding edge.

Review URL: https://codereview.chromium.org//11783009
------------------------------------------------------------------------
r16636 | whesse@google.com | 2013-01-04 22:51:15 +0900 (金, 04  1月 2013) | 5 lines

Add synchronous directory listing to dart:io Directory.

BUG=dart:4730

Review URL: https://codereview.chromium.org//11748017
------------------------------------------------------------------------
r16601 | ager@google.com | 2013-01-03 22:16:19 +0900 (木, 03  1月 2013) | 9 lines

Properly initialize eventhandler mask for all handles on Windows.

The change to make writes to stdout/stderr async exposed this
issue.

R=sgjesse@google.com
BUG=

Review URL: https://codereview.chromium.org//11741015
------------------------------------------------------------------------
r16462 | meh@google.com | 2012-12-22 09:23:25 +0900 (土, 22 12月 2012) | 12 lines

Clean up CodeObservers

Move CodeObserver registration to the OS abstraction.
Move Pprof logic to the OS abstraction.
Remove pprof from VM tests because now pprof logic is in the VM itself.
Add DISALLOW and AllStatic to Code Observers where appropriate.

Previous review: https://codereview.chromium.org/11572032/

BUG=7321

Review URL: https://codereview.chromium.org//11660011
------------------------------------------------------------------------
r16446 | meh@google.com | 2012-12-22 02:45:36 +0900 (土, 22 12月 2012) | 7 lines

Revert "Clean up CodeObservers"

This reverts commit 43e5ada2fba69c7d5c009b5bf70a234f12941617.

BUG=

Review URL: https://codereview.chromium.org//11644074
------------------------------------------------------------------------
r16445 | meh@google.com | 2012-12-22 02:37:59 +0900 (土, 22 12月 2012) | 11 lines

Clean up CodeObservers

Move CodeObserver registration to the OS abstraction
Move Pprof logic to the OS abstraction
Add DISALLOW and AllStatic to Code Observers where appropriate

BUG=7321

Committed: https://code.google.com/p/dart/source/detail?r=16273

Review URL: https://codereview.chromium.org//11572032
------------------------------------------------------------------------
r16444 | devoncarew@google.com | 2012-12-22 02:27:23 +0900 (土, 22 12月 2012) | 2 lines

Fix an issue with newlines and exception text in the debugger wire protocol.
Review URL: https://codereview.chromium.org//11645046
------------------------------------------------------------------------
r16435 | ager@google.com | 2012-12-21 19:36:52 +0900 (金, 21 12月 2012) | 10 lines

Add exitCode setter to set the exit code returned by the Dart VM
standalone binary on normal termination.

This is needed to be able to set the exit code without cutting
off pending asynchronous operations.

R=sgjesse@google.com,rnystrom@google.com
BUG=

Review URL: https://codereview.chromium.org//11665004
------------------------------------------------------------------------
r16384 | whesse@google.com | 2012-12-21 03:17:07 +0900 (金, 21 12月 2012) | 5 lines

Add automatic initialization of SecureSocket library.

BUG=dart:7541

Review URL: https://codereview.chromium.org//11583026
------------------------------------------------------------------------
r16336 | ager@google.com | 2012-12-20 03:42:19 +0900 (木, 20 12月 2012) | 16 lines

Implement debugger connection on Windows.

This is a slightly cleaned up version of the code that Devon
created.

All of eventhandler and socket in bin is designed for async
communication only. Therefore, it does not make much sense
to use it for something as simple as this. I have put the
sync send and receive operations into DebuggerConnectionImpl
instead of attempting to use the async Socket::Read and
Socket::Write.

R=devoncarew@google.com,sgjesse@google.com,hausner@google.com
BUG=

Review URL: https://codereview.chromium.org//11642019
------------------------------------------------------------------------
r16322 | ager@google.com | 2012-12-19 23:37:14 +0900 (水, 19 12月 2012) | 10 lines

Be explicit about use of W version on Windows.

The trunk builder is unhappy. I don't understand why since we are
defining UNICODE and _UNICODE in our header files. However, let's
just be explicit.

R=sgjesse@google.com,ricow@google.com
BUG=

Review URL: https://codereview.chromium.org//11639017
------------------------------------------------------------------------
r16316 | kustermann@google.com | 2012-12-19 21:43:38 +0900 (水, 19 12月 2012) | 3 lines

Set close-on-exec flag on pipe() and kqueue() file descriptors on MacOS

Review URL: https://codereview.chromium.org//11571056
------------------------------------------------------------------------
r16309 | ager@google.com | 2012-12-19 19:10:01 +0900 (水, 19 12月 2012) | 11 lines

Fix Windows XP process handling.

ProcThreadAttributeLists are not supported on Windows XP so we need
to dynamically load the functions and check that they exist. This
of course means that file descriptors are inherited on XP, but we
knew that already.

R=sgjesse@google.com
BUG=dartbug.com/7492

Review URL: https://codereview.chromium.org//11637014
------------------------------------------------------------------------
r16308 | kustermann@google.com | 2012-12-19 18:36:47 +0900 (水, 19 12月 2012) | 3 lines

Set close-on-exec flag on pipe() and epoll() file descriptors

Review URL: https://codereview.chromium.org//11644017
------------------------------------------------------------------------
r16306 | sgjesse@google.com | 2012-12-19 17:11:51 +0900 (水, 19 12月 2012) | 9 lines

Reapply "Fixes to eventhandler and HTTP""

This reapplies r16252 with a number of fixes.

R=ager@google.com

BUG=

Review URL: https://codereview.chromium.org//11606020
------------------------------------------------------------------------
r16256 | sgjesse@google.com | 2012-12-18 22:21:12 +0900 (火, 18 12月 2012) | 9 lines

Revert "Fixes to eventhandler and HTTP"

This reverts commit 21994e29d17b686d71432dfac3bc59e5f2238aa1.

TBR=ager@google.com

BUG=

Review URL: https://codereview.chromium.org//11614028
------------------------------------------------------------------------
r16252 | sgjesse@google.com | 2012-12-18 21:32:35 +0900 (火, 18 12月 2012) | 42 lines

Fixes to eventhandler and HTTP

1. Improve error handling in Windows event handler

Whenever an error happens on an IO operation this
generates an error event and the handle is marked as having has
an error.

The test http_shutdown_test have been fixed to check for error as well
as succesful request when the server is closing the connection due to
closing the output stream before the input have been read. The test
have also been extended to have the client send more request data to
get more errors.

2. Disable event handler events until re-enabled from Dart

When an eventhandle event is posted to Dart this event is now
disabled in the eventhandler until re-enabled from Dart.

On Linux and Mac OS this was already the case as the file
descriptor for which the event(s) was posted was removed from
epoll/kqueue when events was posted.

On Windows this is now changed so that after an event is posted
it needs to be re-enabled from Dart code like on Linux and Mac
OS.

Changed the Dart event handler code to avoid posting disabling of
the out handler as the C++ code is already doing this on all
platforms.

3. Cancel HTTP parser when a connection is closing

When a HTTP connection is closing and moved to the close queue
there should be no more envents from the HTTP parser for whatever
data is still buffered.

R=ager@google.com

BUG=7294

Review URL: https://codereview.chromium.org//11623004
------------------------------------------------------------------------
r16244 | ager@google.com | 2012-12-18 15:18:54 +0900 (火, 18 12月 2012) | 6 lines

Fix closing of process stdin on Process.run.

R=sgjesse@google.com
BUG=dartbug/7473

Review URL: https://codereview.chromium.org//11614024
------------------------------------------------------------------------
r16122 | ager@google.com | 2012-12-14 00:51:48 +0900 (金, 14 12月 2012) | 11 lines

Complete the transition to unicode APIs on Windows.

Define _UNICODE and UNICODE so that we do not add accidental
dependencies on non-unicode APIs.

Reapply the change without the completely broken code in
socket_win.cc. Instead use 'A' versions explicitly.

R=sgjesse@google.com,antonm@google.com

Review URL: https://codereview.chromium.org//11564017
------------------------------------------------------------------------
r16105 | ager@google.com | 2012-12-13 21:56:02 +0900 (木, 13 12月 2012) | 6 lines

Revert last unicode change. Causes Pub issues.

R=sgjesse@google.com
BUG=

Review URL: https://codereview.chromium.org//11570006
------------------------------------------------------------------------
r16104 | ager@google.com | 2012-12-13 21:43:01 +0900 (木, 13 12月 2012) | 11 lines

Complete the transition to unicode APIs on Windows.

Define _UNICODE and UNICODE so that we do not add accidental
dependencies on non-unicode APIs.

Anton, this could have an influence on Dartium builds as well?

R=sgjesse@google.com,antonm@google.com
BUG=

Review URL: https://codereview.chromium.org//11567010
------------------------------------------------------------------------
r16097 | whesse@google.com | 2012-12-13 19:10:17 +0900 (木, 13 12月 2012) | 5 lines

Add client certificates to HttpsServer and HttpClient.

BUG=

Review URL: https://codereview.chromium.org//11553027
------------------------------------------------------------------------
r16096 | ager@google.com | 2012-12-13 19:09:52 +0900 (木, 13 12月 2012) | 9 lines

Fix extraction of error messages on Windows from getaddrinfo.

Use WSAGetLastError which is thread safe. This also means
lets us use the unicode support for normal error messages.

R=sgjesse@google.com
BUG=

Review URL: https://codereview.chromium.org//11566007
------------------------------------------------------------------------
r16093 | ager@google.com | 2012-12-13 18:24:05 +0900 (木, 13 12月 2012) | 7 lines

Use unicode versions of process APIs on Windows. Additionally,
retrieve the arguments to dart as unicode strings.

R=sgjesse@google.com
BUG=

Review URL: https://codereview.chromium.org//11565008
------------------------------------------------------------------------
r16084 | meh@google.com | 2012-12-13 09:42:19 +0900 (木, 13 12月 2012) | 12 lines

Move generate_perf_events_symbols flag to VM (new issue with @google address)

Changes reviewed and approved here:
https://chromiumcodereview.appspot.com/11490026

Created a new issue using meh@google.com instead of meh@chromium.org so I can commit to trunk.

BUG=

Committed: https://code.google.com/p/dart/source/detail?r=16016

Review URL: https://codereview.chromium.org//11549011
------------------------------------------------------------------------
r16045 | ager@google.com | 2012-12-13 00:38:51 +0900 (木, 13 12月 2012) | 6 lines

Update Windows file implementation to use the unicode APIs.

R=sgjesse@google.com
BUG=

Review URL: https://codereview.chromium.org//11554021
------------------------------------------------------------------------
r16043 | ager@google.com | 2012-12-13 00:01:48 +0900 (木, 13 12月 2012) | 6 lines

Use unicode versions of all directory system calls on Windows.

R=sgjesse@google.com
BUG=

Review URL: https://codereview.chromium.org//11550014
------------------------------------------------------------------------
r16041 | ager@google.com | 2012-12-12 23:39:21 +0900 (水, 12 12月 2012) | 6 lines

Use FormatMessageW for Windows error messages to handle internationalized messages correctly.

R=sgjesse@google.com
BUG=dartbug.com/6986

Review URL: https://codereview.chromium.org//11558012
------------------------------------------------------------------------
r16026 | ager@google.com | 2012-12-12 18:23:57 +0900 (水, 12 12月 2012) | 6 lines

Fix unresolved classes issues in dart:io.

R=sgjesse@google.com
BUG=dartbug.com/7299

Review URL: https://codereview.chromium.org//11553020
------------------------------------------------------------------------
r16017 | meh@google.com | 2012-12-12 12:41:30 +0900 (水, 12 12月 2012) | 7 lines

Revert "Move generate_perf_events_symbols flag to VM (new issue with @google address)"

This reverts commit d4d38edbb889d186930c9346c867a0252f425e99.

BUG=

Review URL: https://codereview.chromium.org//11519025
------------------------------------------------------------------------
r16016 | meh@google.com | 2012-12-12 11:55:21 +0900 (水, 12 12月 2012) | 10 lines

Move generate_perf_events_symbols flag to VM (new issue with @google address)

Changes reviewed and approved here:
https://chromiumcodereview.appspot.com/11490026

Created a new issue using meh@google.com instead of meh@chromium.org so I can commit to trunk.

BUG=

Review URL: https://codereview.chromium.org//11549011
------------------------------------------------------------------------
r15977 | ager@google.com | 2012-12-11 23:42:09 +0900 (火, 11 12月 2012) | 16 lines

Fix extraction of environment variables on Windows.

Environment variables were extracted using GetEnvironmentStringsA
and that does not play nice with for instance Danish letters
in environment variables.

This causes problems for pub if the current user has an
internationalized name.

This is the first patch in a series that will switch to the
unicode APIs on Windows.

R=sgjesse@google.com
BUG=

Review URL: https://codereview.chromium.org//11529008
------------------------------------------------------------------------
r15957 | whesse@google.com | 2012-12-11 18:26:23 +0900 (火, 11 12月 2012) | 5 lines

Enable client certificates in SecureSocket and SecureServerSocket

BUG=

Review URL: https://codereview.chromium.org//11467004
------------------------------------------------------------------------
r15904 | whesse@google.com | 2012-12-10 22:14:58 +0900 (月, 10 12月 2012) | 6 lines

Disable SSL session cache to fix issue with SecureSocket connections.

BUG=dart:7208
TEST=standalone/io/secure_session_resume_test.dart

Review URL: https://codereview.chromium.org//11478049
------------------------------------------------------------------------
r15898 | ager@google.com | 2012-12-10 21:15:51 +0900 (月, 10 12月 2012) | 7 lines

Fix Windows process implementation to only inherit the three handles needed for stdin, stdout and stderr.

This time without attempting to update test binaries.

R=kustermann@google.com

Review URL: https://codereview.chromium.org//11497007
------------------------------------------------------------------------
r15897 | ager@google.com | 2012-12-10 20:55:15 +0900 (月, 10 12月 2012) | 6 lines

Revert update of stable test binary.

R=kustermann@google.com
BUG=

Review URL: https://codereview.chromium.org//11474053
------------------------------------------------------------------------
r15896 | ager@google.com | 2012-12-10 20:51:37 +0900 (月, 10 12月 2012) | 7 lines

Fix Windows process implementation to only inherit the three
handles needed for stdin, stdout and stderr.

R=sgjesse@google.com,ahe@google.com,kustermann@google.com
BUG=dartbug.com/7191

Review URL: https://codereview.chromium.org//11474026
------------------------------------------------------------------------
r15860 | ager@google.com | 2012-12-08 05:14:37 +0900 (土, 08 12月 2012) | 8 lines

Reapply change to use system code page on Windows to fix Pub.
This time with correct null termination of the char* that
we convert.

R=sgjesse@google.com
BUG=dartbug.com/7180

Review URL: https://codereview.chromium.org//11472032
------------------------------------------------------------------------
r15854 | rnystrom@google.com | 2012-12-08 03:49:52 +0900 (土, 08 12月 2012) | 9 lines

Revert "By default use current code page on Windows for decoding string"

This reverts commit c247cd299958d0ee713dcfef8aaf44d230a3a7e0.

Revert "Fix memory leaks in system string patch"

This reverts commit 5e533a0c383518fc1851fbdc01a796f7d6b077f8.

Review URL: https://codereview.chromium.org//11446067
------------------------------------------------------------------------
r15846 | ager@google.com | 2012-12-07 22:30:17 +0900 (金, 07 12月 2012) | 6 lines

Fix memory leaks in system string patch

R=sgjesse@google.com
BUG=

Review URL: https://codereview.chromium.org//11470017
------------------------------------------------------------------------
r15844 | ager@google.com | 2012-12-07 21:51:49 +0900 (金, 07 12月 2012) | 7 lines

By default use current code page on Windows for decoding string
data from processes.

R=sgjesse@google.com
BUG=dartbug.com/7180

Review URL: https://codereview.chromium.org//11475026
------------------------------------------------------------------------
r15807 | cshapiro@google.com | 2012-12-07 06:56:31 +0900 (金, 07 12月 2012) | 3 lines

Unify specification of file open, close, and write callbacks.

Review URL: https://codereview.chromium.org//11442024
------------------------------------------------------------------------
r15785 | sgjesse@google.com | 2012-12-06 22:44:24 +0900 (木, 06 12月 2012) | 10 lines

Make all allocation of external arrays used for IO use the IOBuffer class

This will not make a difference right now, but when we start to do
something with io buffers they should originate from the same place.

R=ager@google.com

BUG=

Review URL: https://codereview.chromium.org//11438045
------------------------------------------------------------------------
r15784 | whesse@google.com | 2012-12-06 22:34:16 +0900 (木, 06 12月 2012) | 5 lines

Stop leaking NSS library objects in SecureSocket.

This reduces memory leakage per secure connection from 600 kb to less than 3 kb, perhaps even to zero.

Review URL: https://codereview.chromium.org//11450033
------------------------------------------------------------------------
r15757 | asiva@google.com | 2012-12-06 07:34:07 +0900 (木, 06 12月 2012) | 9 lines

Fix for issue 6768

Original CL done by Max Heinritz(meh@chromium.org)
Correct PrintUsage in gen_snapshot. 

Update PrintUsage in gen_snapshot to accurately describe proper usage of the command. 

BUG=6768
Review URL: https://codereview.chromium.org//11446018
------------------------------------------------------------------------
r15734 | whesse@google.com | 2012-12-05 23:31:51 +0900 (水, 05 12月 2012) | 5 lines

Add a callback to SecureSocket for certificates that fail to be authenticated.

BUG=

Review URL: https://codereview.chromium.org//11415290
------------------------------------------------------------------------
r15728 | iposva@google.com | 2012-12-05 22:02:44 +0900 (水, 05 12月 2012) | 2 lines

- Add an extension test which throws from native code.
Review URL: https://codereview.chromium.org//11447010
------------------------------------------------------------------------
r15702 | podivilov@google.com | 2012-12-05 05:27:00 +0900 (水, 05 12月 2012) | 5 lines

Support symbolic links and package imports in gen_snapshot.

R=asiva@google.com,iposva@google.com

Review URL: https://codereview.chromium.org//11421215
------------------------------------------------------------------------
r15635 | ager@google.com | 2012-12-03 23:39:05 +0900 (月, 03 12月 2012) | 6 lines

Fix a number of int type issues in dart:io File implementation to avoid implicit conversions that can change the value.

R=sgjesse@google.com
BUG=dartbug.com/5301

Review URL: https://codereview.chromium.org//11414293
------------------------------------------------------------------------
r15634 | whesse@google.com | 2012-12-03 22:15:51 +0900 (月, 03 12月 2012) | 6 lines

Add built-in root certificates to dart:io SecureSocket.
Add flag that allows them to disabled at runtime.

BUG=

Review URL: https://codereview.chromium.org//11308271
------------------------------------------------------------------------
r15627 | iposva@google.com | 2012-12-03 19:38:24 +0900 (月, 03 12月 2012) | 3 lines

- Consolidate libdart and libdart_export by always exporting
  the Dart C API symbols.
Review URL: https://codereview.chromium.org//11415254
------------------------------------------------------------------------
r15571 | ager@google.com | 2012-11-30 18:29:40 +0900 (金, 30 11月 2012) | 8 lines

Add RandomAccessFile.read method and use it for file input stream.

I will deprecate the readList method completely as my next change.

R=sgjesse@google.com
BUG=

Review URL: https://codereview.chromium.org//11308226
------------------------------------------------------------------------
r15392 | whesse@google.com | 2012-11-27 23:07:53 +0900 (火, 27 11月 2012) | 2 lines

Clean up svn:ignore property and .gitignore in dart, dart/pkg, dart/runtime, and dart/samples.
Review URL: https://codereview.chromium.org//11421093
------------------------------------------------------------------------
r15378 | whesse@google.com | 2012-11-27 19:09:35 +0900 (火, 27 11月 2012) | 5 lines

Add onError to dart:io SecureSocket.  Allow onConnect and outputStream to coexist on Socket and SecureSocket.

BUG=

Review URL: https://codereview.chromium.org//11280162
------------------------------------------------------------------------
r15368 | iposva@google.com | 2012-11-27 14:41:14 +0900 (火, 27 11月 2012) | 2 lines

- Remove unneeded library tags when concatenating libraries.
Review URL: https://codereview.chromium.org//11411176
------------------------------------------------------------------------
r15352 | tball@google.com | 2012-11-27 08:31:47 +0900 (火, 27 11月 2012) | 5 lines

Added support for isolate unhandled exceptions.

BUG=

Review URL: https://codereview.chromium.org//11413101
------------------------------------------------------------------------
r15278 | sgjesse@google.com | 2012-11-23 19:12:07 +0900 (金, 23 11月 2012) | 8 lines

Roll NSS to 169195.

This updates NSS to version 3.14.

It also contains a fix for compiling with -O3 on GCC 4.6.3.

R=whesse@google.com
Review URL: https://codereview.chromium.org//11413141
------------------------------------------------------------------------
r15274 | whesse@google.com | 2012-11-23 18:21:48 +0900 (金, 23 11月 2012) | 5 lines

Rename TlsSocket to SecureSocket, and all other Tls... items to Secure....

BUG=

Review URL: https://codereview.chromium.org//11419138
------------------------------------------------------------------------
r15272 | ager@google.com | 2012-11-23 16:03:15 +0900 (金, 23 11月 2012) | 12 lines

Deal with extension loading from packages.

The issue is bad interplay with package and dart-ext URIs.
dart-ext URIs overwrite the package URI which makes us lose
the package URI path components. This change resolves
all the way to a file path for dart-ext URIs if the base
URI is a package URI.

R=whesse@google.com
BUG=dartbug.com/6264

Review URL: https://codereview.chromium.org//11308170
------------------------------------------------------------------------
r15267 | whesse@google.com | 2012-11-23 01:37:10 +0900 (金, 23 11月 2012) | 5 lines

Implement input and output streams for secure network sockets.

BUG=dart:6701

Review URL: https://codereview.chromium.org//11416108
------------------------------------------------------------------------
r15258 | ager@google.com | 2012-11-22 23:41:34 +0900 (木, 22 11月 2012) | 11 lines

Remove output directory from library path on Linux.

Move the setting of -rdynamic to the two executables that need
it (dart, dart_no_snapshot). It is needed to allow dynamically
loaded libraries to lookup the API symbols in the binary. We
use that for native extensions.

R=whesse@google.com,iposva@google.com
BUG=

Review URL: https://codereview.chromium.org//11316144
------------------------------------------------------------------------
r15242 | iposva@google.com | 2012-11-22 16:54:21 +0900 (木, 22 11月 2012) | 4 lines

Fix bug 6467:
- Do not attempt to Dart_ExitScope if no scope exists.
- Print more informative message if Dart_Initialization fails.
Review URL: https://codereview.chromium.org//11308166
------------------------------------------------------------------------
r15210 | hausner@google.com | 2012-11-22 02:23:35 +0900 (木, 22 11月 2012) | 5 lines

Remove abstract from class members in dart libraries

Add VM flag to produce compile error for explicitly
defined abstract class members.
Review URL: https://codereview.chromium.org//11299121
------------------------------------------------------------------------
r15163 | whesse@google.com | 2012-11-21 02:45:18 +0900 (水, 21 11月 2012) | 9 lines

Working tls server sockets.

Add is_server parameter to _TlsSocket, pass it through to _TlsFilterImpl.connect.

Add TlsServerSocket class.

BUG=

Review URL: https://codereview.chromium.org//11414009
------------------------------------------------------------------------
r15096 | gram@google.com | 2012-11-20 02:38:15 +0900 (火, 20 11月 2012) | 2 lines

Revised CL for customisable logging (replacing printfs).
Review URL: https://codereview.chromium.org//11312242
------------------------------------------------------------------------
r15010 | ager@google.com | 2012-11-16 22:03:29 +0900 (金, 16 11月 2012) | 6 lines

Include command in ProcessException.

R=sgjesse@google.com
BUG=dartbug.com/4060

Review URL: https://codereview.chromium.org//11417028
------------------------------------------------------------------------
r14964 | kustermann@google.com | 2012-11-15 23:13:28 +0900 (木, 15 11月 2012) | 5 lines

Fixed missing O_CLOEXEC in Mac OS

TBR=ager@google.com

Review URL: https://codereview.chromium.org//11416009
------------------------------------------------------------------------
r14963 | kustermann@google.com | 2012-11-15 22:46:15 +0900 (木, 15 11月 2012) | 6 lines

Added O_CLOEXEC to the flags parameter of open() calls

To prevent sub-processes from inheriting open file descriptors of
the current process, the O_CLOEXEC flag is necessary.

Review URL: https://codereview.chromium.org//11419008
------------------------------------------------------------------------
r14955 | ager@google.com | 2012-11-15 21:05:18 +0900 (木, 15 11月 2012) | 6 lines

Remove overhead of socket testing flags by storing the value in a static.

R=sgjesse@google.com
BUG=

Review URL: https://codereview.chromium.org//11348062
------------------------------------------------------------------------
r14952 | kustermann@google.com | 2012-11-15 20:27:33 +0900 (木, 15 11月 2012) | 7 lines

Added FD_CLOEXEC flag to client/server socket file descriptors

Without the FD_CLOEXEC, all subprocesses will inherit the open socket
file descriptors of the current process due to the default behavior
of fork()+exec().

Review URL: https://codereview.chromium.org//11416006
------------------------------------------------------------------------
r14920 | srdjan@google.com | 2012-11-15 06:21:27 +0900 (木, 15 11月 2012) | 2 lines

Remove unused files.
Review URL: https://codereview.chromium.org//11365262
------------------------------------------------------------------------
r14907 | whesse@google.com | 2012-11-15 02:39:40 +0900 (木, 15 11月 2012) | 1 line

Add new gyp-generated files to svn:ignore properties for new targets.  Review = http://codereview.chromium.org/11359211/
------------------------------------------------------------------------
r14900 | whesse@google.com | 2012-11-15 01:42:29 +0900 (木, 15 11月 2012) | 5 lines

Add some makefiles generated by gyp for newly added targets to .gitignore.

BUG=

Review URL: https://codereview.chromium.org//11361262
------------------------------------------------------------------------
r14893 | whesse@google.com | 2012-11-14 22:38:32 +0900 (水, 14 11月 2012) | 5 lines

Add a TlsSocket class to dart:io, that implements secure client sockets using TLS (SSL).

This uses the NSS (Network Security Services) libraries from Mozilla, which is a cross-platform library for SSL and TLS sockets.  We use the patched version from the Chromium repository, which is checked into third_party by the DEPS file.

Review URL: https://codereview.chromium.org//10916081
------------------------------------------------------------------------
r14851 | ager@google.com | 2012-11-14 00:03:23 +0900 (水, 14 11月 2012) | 11 lines

Update dart:io to convert strings between UTF8 and current code page
when interacting with the system.

What we get from and need to hand to the VM is utf8. What we
get from and need to hand to the system is in the current
code page.

R=sgjesse@google.com
BUG=

Review URL: https://codereview.chromium.org//11275281
------------------------------------------------------------------------
r14842 | whesse@google.com | 2012-11-13 20:47:31 +0900 (火, 13 11月 2012) | 5 lines

Change gyp flag from in_dartium to dart_io_support.

BUG=

Review URL: https://codereview.chromium.org//11377098
------------------------------------------------------------------------
r14838 | ajohnsen@google.com | 2012-11-13 19:41:37 +0900 (火, 13 11月 2012) | 8 lines

Move JSSyntaxRegExp to core as a private member. This removes the last refrences to dart:coreimpl.

After this cleanup, RegExp no longer have a const constructor. Use 'new
RegExp(...)' from now on.

BUG=

Review URL: https://codereview.chromium.org//11365196
------------------------------------------------------------------------
r14794 | floitsch@google.com | 2012-11-13 02:19:58 +0900 (火, 13 11月 2012) | 7 lines

a === b -> identical(a, b)

Replace === null with == null.

BUG=http://dartbug.com/6380

Review URL: https://codereview.chromium.org//11361190
------------------------------------------------------------------------
r14740 | whesse@google.com | 2012-11-09 22:56:08 +0900 (金, 09 11月 2012) | 5 lines

Disable NSS build targets in a Dartium build.

BUG=

Review URL: https://codereview.chromium.org//11369152
------------------------------------------------------------------------
r14731 | whesse@google.com | 2012-11-09 19:57:42 +0900 (金, 09 11月 2012) | 5 lines

Change names of all NSS gyp targets, so they don't conflict with the Chromium target names.

BUG=

Review URL: https://codereview.chromium.org//11365165
------------------------------------------------------------------------
r14730 | whesse@google.com | 2012-11-09 19:37:45 +0900 (金, 09 11月 2012) | 15 lines

Add gyp files to build NSS in Dart

The change builds static versions of the cross-platform secure networking libraries NSS and NSPR from Mozilla, on Linux, MacOS, and Windows.  These libraries are linked with the standalone Dart executable in a future changelist to support HTTPS and SSL networking in dart:io.

The built libraries will be tested by that future changelist.

Patchlist 19 was committed: https://code.google.com/p/dart/source/detail?r=14524

Reverted in r=14529

Pachlist 21 was committed: https://code.google.com/p/dart/source/detail?r=14684

Reverted in r=14688

Review URL: https://codereview.chromium.org//10909189
------------------------------------------------------------------------
r14701 | gram@google.com | 2012-11-09 03:41:58 +0900 (金, 09 11月 2012) | 2 lines

Fix library syntax
Review URL: https://codereview.chromium.org//11368124
------------------------------------------------------------------------
r14688 | whesse@google.com | 2012-11-09 01:00:02 +0900 (金, 09 11月 2012) | 5 lines

"Reverting 14684" - Building NSS libraries.  It is causing local compilation failures.

BUG=

Review URL: https://codereview.chromium.org//11364150
------------------------------------------------------------------------
r14684 | whesse@google.com | 2012-11-09 00:07:27 +0900 (金, 09 11月 2012) | 11 lines

Add gyp files to build NSS in Dart

The change builds static versions of the cross-platform secure networking libraries NSS and NSPR from Mozilla, on Linux, MacOS, and Windows.  These libraries are linked with the standalone Dart executable in a future changelist to support HTTPS and SSL networking in dart:io.

The built libraries will be tested by that future changelist.

Patchlist 19 was committed: https://code.google.com/p/dart/source/detail?r=14524

Reverted in r=14529

Review URL: https://codereview.chromium.org//10909189
------------------------------------------------------------------------
r14680 | whesse@google.com | 2012-11-08 22:57:44 +0900 (木, 08 11月 2012) | 5 lines

Move Platform class to dartlib_io target.

BUG=

Review URL: https://codereview.chromium.org//11365149
------------------------------------------------------------------------
r14679 | whesse@google.com | 2012-11-08 22:19:26 +0900 (木, 08 11月 2012) | 5 lines

When building standalone Dart executable, put implementation of dart:io natives in a separate library.

BUG=

Review URL: https://codereview.chromium.org//11360121
------------------------------------------------------------------------
r14619 | whesse@google.com | 2012-11-07 21:03:10 +0900 (水, 07 11月 2012) | 5 lines

Change dart_no_snapshot to run native extensions.

BUG=standalone/test_extension_test

Review URL: https://codereview.chromium.org//11362132
------------------------------------------------------------------------
r14609 | iposva@google.com | 2012-11-07 10:05:09 +0900 (水, 07 11月 2012) | 3 lines

Fix bug 4534:
- Only drop the leading "/" on Windows if a leading slash is in the path.
Review URL: https://codereview.chromium.org//11368114
------------------------------------------------------------------------
r14588 | asiva@google.com | 2012-11-07 04:07:43 +0900 (水, 07 11月 2012) | 2 lines

Fix length computation in Dart_StringToUTF8.
Review URL: https://codereview.chromium.org//11275107
------------------------------------------------------------------------
r14527 | whesse@google.com | 2012-11-05 22:53:42 +0900 (月, 05 11月 2012) | 7 lines

Revert commit 14524, which builds NSS and NSPR libraries, for secure networking.

There are builders which build Windows 64-bit versions of the SDK, and the Dartium build builds the Dart runtime executable, both of which were not supported by the CL.

BUG=

Review URL: https://codereview.chromium.org//11275150
------------------------------------------------------------------------
r14524 | whesse@google.com | 2012-11-05 22:22:31 +0900 (月, 05 11月 2012) | 7 lines

This change depends on changelist 11341038, which checks out third_party/nss and related libraries from the Chromium repository into third_party in the Dart repository, and on changelist 11343039, which adds platform-specific files for linux to the Chromium repository.

The change builds static versions of the cross-platform secure networking libraries NSS and NSPR from Mozilla, on Linux, MacOS, and Windows.  These libraries are linked with the standalone Dart executable in a future changelist to support HTTPS and SSL networking in dart:io.

The built libraries will be tested by that future changelist.

Review URL: https://codereview.chromium.org//10909189
------------------------------------------------------------------------
r14475 | dgrove@google.com | 2012-11-03 00:18:11 +0900 (土, 03 11月 2012) | 2 lines

Changes outside pkg/ and lib/ for directory refactoring
Review URL: https://codereview.chromium.org//11358024
------------------------------------------------------------------------
r14405 | lrn@google.com | 2012-11-01 22:46:30 +0900 (木, 01 11月 2012) | 5 lines

Renaming IndexOutOfRangeException to RangeError.

It now extends ArgumentError.

Review URL: https://codereview.chromium.org//11275042
------------------------------------------------------------------------
r14399 | whesse@google.com | 2012-11-01 21:20:07 +0900 (木, 01 11月 2012) | 5 lines

Fix error in debug printing from the Dart executable, introduced in r14357.

BUG=

Review URL: https://codereview.chromium.org//11361032
------------------------------------------------------------------------
r14384 | sgjesse@google.com | 2012-11-01 17:48:07 +0900 (木, 01 11月 2012) | 7 lines

Send data in an external byte array directly from the backing store

R=ager@google.com, ajohnsen@google.com

BUG=

Review URL: https://codereview.chromium.org//11275074
------------------------------------------------------------------------
r14357 | asiva@google.com | 2012-11-01 02:56:46 +0900 (木, 01 11月 2012) | 23 lines

- Represent strings internally in UTF-16 format, this makes it
  compatible with webkit and will allow for easy externalization of
  strings. One byte strings are retained for pure ASCII strings.
  (The language specification was changed recently to reflect this as
   follows "A string is a sequence of UTF-16 code units").
- Remove four byte string class and all references to it.
- Rename some of the string functions in Dart API to make them
  consistent and better describe the underlying functionality
  Dart_NewString => Dart_NewStringFromCString
  Dart_NewString8 => Dart_NewStringFromUTF8
  Dart_NewString16 => Dart_NewStringFromUTF16
  Dart_NewString32 => Dart_NewStringFromUTF32
  Dart_NewExternalString8 => Dart_NewExternalUTF8String
  Dart_NewExternalString16 => Dart_NewExternalUTF16String
  Dart_NewExternalString32 => Dart_NewExternalUTF32String
  Dart_StringGet8 => Dart_StringToUTF8
  Dart_StringGet16 => Dart_StringToUTF16
  Dart_StringToCString => Dart_StringToCString
  Dart_IsString8 => Removed
  Dart_IsString16 -> Removed
  Dart_StringToBytes -> Removed
  Dart_StringGet32 -> Removed
Review URL: https://codereview.chromium.org//11318018
------------------------------------------------------------------------
r14337 | ager@google.com | 2012-10-31 22:14:21 +0900 (水, 31 10月 2012) | 7 lines

Remember to close the exitHandler when processes have received
their exit code.

R=sgjesse@google.com
BUG=

Review URL: https://codereview.chromium.org//11361008
------------------------------------------------------------------------
r14321 | sgjesse@google.com | 2012-10-31 18:56:50 +0900 (水, 31 10月 2012) | 16 lines

Start reading data from sockets directly into external byte arrays

This adds a new read function to Dart sockets which delivers data in a
system allocated buffer. For now just use that for socket input
streams.

The IOBuffer class does not do much at the moment, but the idea of
adding it is to be able to centralize the management of the IO
buffers. One thing I am considering here is to keep a cache of free
buffers which can be reused without freeing and re-allocating.

R=ager@google.com, ajhonsen@google.com

BUG=

Review URL: https://codereview.chromium.org//11338037
------------------------------------------------------------------------
r14300 | rnystrom@google.com | 2012-10-31 03:17:51 +0900 (水, 31 10月 2012) | 5 lines

Look up executable on PATH when given environment variables.

Fixes http://code.google.com/p/dart/issues/detail?id=4402

Review URL: https://codereview.chromium.org//11260048
------------------------------------------------------------------------
r14274 | ajohnsen@google.com | 2012-10-30 22:25:04 +0900 (火, 30 10月 2012) | 5 lines

Move ListImplementation from coreimpl to core, as a private member.

BUG=

Review URL: https://codereview.chromium.org//11189141
------------------------------------------------------------------------
r14268 | ager@google.com | 2012-10-30 20:59:29 +0900 (火, 30 10月 2012) | 6 lines

Use the encoding parameter for writeString on RandomAccessFile objects.

R=sgjesse@google.com
BUG=dartbug.com/6392

Review URL: https://codereview.chromium.org//11345025
------------------------------------------------------------------------
r14259 | ager@google.com | 2012-10-30 19:32:30 +0900 (火, 30 10月 2012) | 17 lines

Use patching for dart:io.

This allows the tools such as dartdoc to operate on dart:io
in the same way as it does with other code and allows the
implemenation of parts of dart:io for dart2js if we ever
want to do that.

The current patching is very VM specific. I have only moved
stuff to patch files when they actually need to be. For
Process and Socket everything has to be moved because they
use native fields. For the rest, only the individual native
calls have been put in patch files.

R=sgjesse@google.com,ajohnsen@google.com
BUG=

Review URL: https://codereview.chromium.org//11337019
------------------------------------------------------------------------
r14246 | sgjesse@google.com | 2012-10-30 17:30:05 +0900 (火, 30 10月 2012) | 12 lines

Add flush to HTTP output streams

The flush method was missing on the HTTP output streams and was
wrongly on the HTTP input streams. The call to flush is forwarded to
the socket output stream (on which is is actually a noop).

R=ager@google.com

BUG=dart:6384
TEST=tests/standalone/io/http_advanced_test.dart

Review URL: https://codereview.chromium.org//11301034
------------------------------------------------------------------------
r14244 | jmesserly@google.com | 2012-10-30 15:12:55 +0900 (火, 30 10月 2012) | 5 lines

"Reverting 14243"

BUG=

Review URL: https://codereview.chromium.org//11340034
------------------------------------------------------------------------
r14243 | jmesserly@google.com | 2012-10-30 14:54:12 +0900 (火, 30 10月 2012) | 11 lines

Fix type annotation in _FileBase._exceptionFromResponse

ArgumentError is not a subtype of Exception, which leads to confusing errors in checked mode:

  Expected future to complete successfully, but it failed with type 'ArgumentError' is not a subtype of type 'Exception' of 'function result'.
  Stack trace:
    #0      _FileBase._exceptionFromResponse (dart:io:1032:48)
    #1      _RandomAccessFile.writeString.<anonymous closure> (dart:io:1491:37)
    #2      _FutureImpl.transform.<anonymous closure> (bootstrap:855:37)

Review URL: https://codereview.chromium.org//11343033
------------------------------------------------------------------------
r14204 | sgjesse@google.com | 2012-10-30 00:04:54 +0900 (火, 30 10月 2012) | 10 lines

Remove public SocketInputStream and SocketOutputStream clases

The socket streams only implement the streams interfaces so no
explicit classes are needed for these.

R=ager@google.com

BUG=

Review URL: https://codereview.chromium.org//11336012
------------------------------------------------------------------------
r14197 | sgjesse@google.com | 2012-10-29 22:20:22 +0900 (月, 29 10月 2012) | 7 lines

Remove unused member

R=ager@google.com

BUG=

Review URL: https://codereview.chromium.org//11273079
------------------------------------------------------------------------
r14190 | sgjesse@google.com | 2012-10-29 21:23:38 +0900 (月, 29 10月 2012) | 7 lines

Fix spelling mistake in r14188

TBR=ager@google.com

BUG=

Review URL: https://codereview.chromium.org//11339012
------------------------------------------------------------------------
r14189 | sgjesse@google.com | 2012-10-29 21:13:07 +0900 (月, 29 10月 2012) | 15 lines

Add support for authorization of HTTP client requests

This implements the infrastructure for authorization of HTTP client
requests. Currently only basic authentication is fully implemented,
but the infrastructure to support digest is there.

Please focus on the developer facing API with the authenticate callback and
addCredentials method.

R=ager@google.com,ajohnsen@google.com

BUG=dart:2788
TEST=tests/standalone/io/http_auth_test.dart

Review URL: https://codereview.chromium.org//11118021
------------------------------------------------------------------------
r14188 | ager@google.com | 2012-10-29 21:02:35 +0900 (月, 29 10月 2012) | 10 lines

Remove file name from File C++ structure. It is not used.

Currently, the field is being assigned a string that we
immediately deallocate leaving the field invalid. Since
it is not used we should get rid of it.

R=aprelev@gmail.com,sgjesse@google.com
BUG=

Review URL: https://codereview.chromium.org//11348006
------------------------------------------------------------------------
r14187 | ager@google.com | 2012-10-29 20:59:09 +0900 (月, 29 10月 2012) | 11 lines

Get rid of 'close' on process. It is very easy to use incorrectly and cut off data from your streams.

When using an interactive process started with Process.start you have
to drain the stdout and stderr streams to make sure that all resources
are freed. If you do that the dart:io library will make sure to free
all system resources for you.

R=sgjesse@google.com
BUG=

Review URL: https://codereview.chromium.org//11343009
------------------------------------------------------------------------
r14184 | sgjesse@google.com | 2012-10-29 20:30:17 +0900 (月, 29 10月 2012) | 25 lines

Change the handling og the HTTP content length

This change should make the indicated HTTP message content length be
as described in RFC 2616.

For requests the content length is 0 if neither Content-Length nor
Transfer-Encoding headers are set. If the content length of a request
is set to 0 the Content-Length header is not sent with a value of
0. For GET and HEAD the content length is set to 0 by default.

For responses content length needs to be set to 0 to indicate an empty
response (unless it is a HEAD response where the content length
indicate the size of the body expected). Otherwise a body is assumed
and if no content length is set chunked transfer encoding is used.

For HTTP 1.0 chunked transfer encoding is not supported. So for HTTP
1.0 requests needs content length if they have a body and responses
without a content length will indicate end of body by closing the
connection.

R=ager@google.com

BUG=dart:6309

Review URL: https://codereview.chromium.org//11348005
------------------------------------------------------------------------
r14082 | floitsch@google.com | 2012-10-26 00:19:31 +0900 (金, 26 10月 2012) | 3 lines

Make first and last getters.

Review URL: https://codereview.chromium.org//11273041
------------------------------------------------------------------------
r14078 | floitsch@google.com | 2012-10-25 23:25:43 +0900 (木, 25 10月 2012) | 3 lines

Make String.charCodes a getter.

Review URL: https://codereview.chromium.org//11263040
------------------------------------------------------------------------
r14055 | asiva@google.com | 2012-10-25 09:43:17 +0900 (木, 25 10月 2012) | 2 lines

Fix error exit path so that it frees the buffer before exiting the program.
Review URL: https://codereview.chromium.org//11192065
------------------------------------------------------------------------
r14045 | vsm@google.com | 2012-10-25 07:20:34 +0900 (木, 25 10月 2012) | 5 lines

Add crypto_android.cc

This fixes the android build of the command line embedder.

Review URL: https://codereview.chromium.org//11273018
------------------------------------------------------------------------
r14022 | floitsch@google.com | 2012-10-25 00:04:32 +0900 (木, 25 10月 2012) | 3 lines

Make isEmpty a getter.

Review URL: https://codereview.chromium.org//11238035
------------------------------------------------------------------------
r14012 | lrn@google.com | 2012-10-24 21:36:10 +0900 (水, 24 10月 2012) | 5 lines

Removed IllegalAccessException and UnsupportedOperationException.

Both were converted to StateError.

Review URL: https://codereview.chromium.org//11235054
------------------------------------------------------------------------
r14010 | sgjesse@google.com | 2012-10-24 20:38:02 +0900 (水, 24 10月 2012) | 10 lines

Use the thread safe gethostbyname function on Linux

On Mac OS and Windows gethostbyname is already thread safe (according
to the documentation).

R=ager@google.com

BUG=

Review URL: https://codereview.chromium.org//11262006
------------------------------------------------------------------------
r14004 | ajohnsen@google.com | 2012-10-24 19:34:42 +0900 (水, 24 10月 2012) | 5 lines

Moved RuntimeOptions from coreimpl to core, renamed to _OptionsImpl.

BUG=

Review URL: https://codereview.chromium.org//11260010
------------------------------------------------------------------------
r13960 | ager@google.com | 2012-10-23 22:04:02 +0900 (火, 23 10月 2012) | 12 lines

Do *not* make file handles inheritable on Windows.

This is the cause of the pub failures to unpack a file that has
just been created. The problem is that another 7-zip process has
inherited the file handle for a file that we are still writing.
When we are done writing the file, we cannot use it because the
other process still keeps the handle.

R=sgjesse@google.com,rnystrom@google.com
BUG=dartbug.com/5910

Review URL: https://codereview.chromium.org//11230051
------------------------------------------------------------------------
r13956 | ager@google.com | 2012-10-23 21:40:53 +0900 (火, 23 10月 2012) | 15 lines

Change Process.kill to return a boolean instead of throwing an exception when kill fails.

If the program wants to kill the process after a given time, it is
possible that the process is already dead but has not yet been
reaped. Therefore, there is no way for the programmer to test if the
process is already dead before killing it. Throwing an exception from
kill is not helpful as you will most often have to catch it and do
nothing because you cannot prevent the exception occasionally and
there is nothing you can do as a result of the exception since it
usually means that the process is already dead.

R=ahe@google.com,sgjesse@google.com
BUG=

Review URL: https://codereview.chromium.org//11238057
------------------------------------------------------------------------
r13940 | sgjesse@google.com | 2012-10-23 18:43:49 +0900 (火, 23 10月 2012) | 9 lines

Fix bug in r13232

Discovered after commit by floitsch@.

R=floitsch@google.com

BUG=

Review URL: https://codereview.chromium.org//11235056
------------------------------------------------------------------------
r13939 | sgjesse@google.com | 2012-10-23 18:39:17 +0900 (火, 23 10月 2012) | 21 lines

Fix bug in HTTP client request generation

If an HTTP request with an empty path was done using the HttpClient
(either for normal HTTP or for upgrading to web sockets) the generated
HTTP request line was invalid. The empty path was used in the request
line e.g.

GET  HTTP/1.1

instead of

GET / HTTP/1.1

This is now fixed by using / if no path is specified. This is
specified in RFC 2616 section 3.2.2.

BUG=6185

R=ager@google.com

Review URL: https://codereview.chromium.org//11231070
------------------------------------------------------------------------
r13933 | ager@google.com | 2012-10-23 18:15:01 +0900 (火, 23 10月 2012) | 10 lines

Change Directory.create to not fail on existing directory with that name.

The new semantics is to ensure that a directory with that name
exists. There is no way to reliably guard a create call against
existing directories in an async program.

R=sgjesse@google.com
BUG=

Review URL: https://codereview.chromium.org//11175054
------------------------------------------------------------------------
r13923 | ager@google.com | 2012-10-23 16:01:29 +0900 (火, 23 10月 2012) | 9 lines

Fix path to only use public interface in the implementation of methods.

This allows other people to implement the Path interface and have the
dart:io implementation interact with those Path objects.

R=sgjesse@google.com
BUG=dartbug.com/5913

Review URL: https://codereview.chromium.org//11189125
------------------------------------------------------------------------
r13870 | ajohnsen@google.com | 2012-10-22 22:08:42 +0900 (月, 22 10月 2012) | 13 lines

Add sessions to HttpServer.

A session is started when HttpRequest.getSession() is called. The
session will then be added to the session manager. The session manager
then controls timeouts.

The session id is create by using the a crypto-random sequence of 16
bytes. These are extracted by using /dev/urandom on posix and
CryptGenRandom on windows.

BUG=

Review URL: https://codereview.chromium.org//11175030
------------------------------------------------------------------------
r13866 | floitsch@google.com | 2012-10-22 21:41:04 +0900 (月, 22 10月 2012) | 3 lines

Make hashCode a getter and not a method.

Review URL: https://codereview.chromium.org//11191078
------------------------------------------------------------------------
r13759 | regis@google.com | 2012-10-18 05:58:19 +0900 (木, 18 10月 2012) | 2 lines

Second round of cleanups for new optional parameter semantics.
Review URL: https://codereview.chromium.org//11194025
------------------------------------------------------------------------
r13752 | justinfagnani@google.com | 2012-10-18 03:14:38 +0900 (木, 18 10月 2012) | 5 lines

Allow package: imports inside isolates

BUG=http://dartbug/5915

Review URL: https://codereview.chromium.org//11195017
------------------------------------------------------------------------
r13749 | asiva@google.com | 2012-10-18 02:47:04 +0900 (木, 18 10月 2012) | 2 lines

The snapshot buffer was being released too early resulting in weird crashes.
Review URL: https://codereview.chromium.org//11193024
------------------------------------------------------------------------
r13729 | ager@google.com | 2012-10-17 19:57:45 +0900 (水, 17 10月 2012) | 14 lines

Change Process.start to return a future that completes with a
Process object only when the process has been successfully started.

This is less error prone since you can use all the methods on a
Process object as soon as you can get your hands on it. Unfortunately,
this change leads to quite a few changes in test.dart. Some of those
changes will fix bugs as well. We used to have a problem with a
timeout that could fire just in between two steps in a chain of
commands that constitute one test run. This change should address
that issue as well.

BUG=dartbug.com/5305

Review URL: https://codereview.chromium.org//11091070
------------------------------------------------------------------------
r13691 | asiva@google.com | 2012-10-17 03:22:54 +0900 (水, 17 10月 2012) | 6 lines

1. Add isolate id parameter to all the debugger commands in the debugger wire protocol so that the commands are directed to the appropriate isolate.

2. Changed ddbg to pass the isolate ID in the debugger wire message.

The Dart debugger protocol document has been changed to reflect this.
Review URL: https://codereview.chromium.org//11094017
------------------------------------------------------------------------
r13684 | regis@google.com | 2012-10-17 01:03:47 +0900 (水, 17 10月 2012) | 2 lines

Change core lib, dart2js, and more for new optional parameters syntax and semantics (new semantics is not enforced yet).
Review URL: https://codereview.chromium.org//11090016
------------------------------------------------------------------------
r13681 | vsm@google.com | 2012-10-17 00:36:12 +0900 (水, 17 10月 2012) | 5 lines

Build fix for android

Fixes a build error following: https://code.google.com/p/dart/wiki/Android

Review URL: https://codereview.chromium.org//11099071
------------------------------------------------------------------------
r13669 | asiva@google.com | 2012-10-16 06:28:36 +0900 (火, 16 10月 2012) | 3 lines

Fix race condition when posting debugger messages to the message queue
(An isolate could be shutting down while a message arrives for the isolate).
Review URL: https://codereview.chromium.org//11144027
------------------------------------------------------------------------
r13661 | iposva@google.com | 2012-10-16 02:53:43 +0900 (火, 16 10月 2012) | 4 lines

Fix bug 5883:
- Fix condition when removing isolates being debugged.
- Reenable debugging for Linux and Windows.
Review URL: https://codereview.chromium.org//11145023
------------------------------------------------------------------------
r13599 | sgjesse@google.com | 2012-10-12 17:18:19 +0900 (金, 12 10月 2012) | 13 lines

Add support for multiple HTTP proxies

If the configuration returned from the findProxy in HttpClient
contails a list of proxies the the entries in the list will be tried
one by one until a working one is found. Before only the first was
ever tried.

R=ajohnsen@google.com

BUG=dart:5468
TEST=tests/standalone/io/http_proxy_test.dart

Review URL: https://codereview.chromium.org//11092044
------------------------------------------------------------------------
r13536 | fschneider@google.com | 2012-10-11 21:25:55 +0900 (木, 11 10月 2012) | 2 lines

Remove support for generating visualizer format file for the flowgraph.
Review URL: https://codereview.chromium.org//11099061
------------------------------------------------------------------------
r13514 | iposva@google.com | 2012-10-11 16:17:09 +0900 (木, 11 10月 2012) | 4 lines

- Generate a version string based on the VERSION file.
- Add a Dart_VersionString to the API.
- Print version string when passing --version to the standalone binary.
Review URL: https://codereview.chromium.org//11086065
------------------------------------------------------------------------
r13437 | asiva@google.com | 2012-10-10 05:12:32 +0900 (水, 10 10月 2012) | 2 lines

Add more options to the help message in verbose mode.
Review URL: https://codereview.chromium.org//11094027
------------------------------------------------------------------------
r13435 | blois@google.com | 2012-10-10 04:58:10 +0900 (水, 10 10月 2012) | 9 lines

Improving path.relativeTo to add support for a broader set of absolute paths.

I had made a last minute change in my previous CL (changing from a string operation to using hasTrailingSeparator), but forgot to test it.

First change is the original, second has the fix.

BUG=

Review URL: https://codereview.chromium.org//11087034
------------------------------------------------------------------------
r13423 | blois@google.com | 2012-10-10 02:02:51 +0900 (水, 10 10月 2012) | 7 lines

Revert "Improving relative path support."

This reverts commit 13422 which broke VM win & mac.

BUG=

Review URL: https://codereview.chromium.org//11096026
------------------------------------------------------------------------
r13422 | blois@google.com | 2012-10-10 01:48:48 +0900 (水, 10 10月 2012) | 7 lines

Improving relative path support.

I'm looking to modify our HTML tests to use relative paths and it was mentioned that I should be using Path.relativeTo- this change fixes relativeTo to handle the cases that I need.

BUG=

Review URL: https://codereview.chromium.org//10986078
------------------------------------------------------------------------
r13415 | sgjesse@google.com | 2012-10-09 23:07:42 +0900 (火, 09 10月 2012) | 9 lines

Addressed drive by comments

DBC from ager@ on http://codereview.chromium.org/11066041/.

R=ager@google.com

BUG=

Review URL: https://codereview.chromium.org//11098018
------------------------------------------------------------------------
r13351 | sgjesse@google.com | 2012-10-08 21:58:56 +0900 (月, 08 10月 2012) | 9 lines

Fix another issue with r13348

Add missing const.

TBR=ajohnsen@google.com

BUG=

Review URL: https://codereview.chromium.org//11089003
------------------------------------------------------------------------
r13350 | sgjesse@google.com | 2012-10-08 21:46:13 +0900 (月, 08 10月 2012) | 10 lines

Fix error in in r13348

The name of a constructor cannot be the same as the name of a member
declared in the immediately enclosing class.

TBR=ajohnsen@google.com

BUG=

Review URL: https://codereview.chromium.org//11086003
------------------------------------------------------------------------
r13348 | sgjesse@google.com | 2012-10-08 21:19:14 +0900 (月, 08 10月 2012) | 21 lines

Add support for HTTP proxy in the HTTP client

An HttpClient instance now has the property findProxy. This
property can be set to a function which can return the proxy
configuration encoded in a string in the same format as is used
by browser PAC (proxy auto-config) scripts.

Currently only the first proxy in the list will be used. I will
address trying multiple proxies in a separate CL.

Also fixed a HTTP input stream bug revealed by the tests. If an
input stream from either a HttpRequest or HttpClientResponse
object is retreived after all data in the body has been received
the HTTP input stream would call the onClosed callback.

R=ajohnsen@google.com

BUG=dart:5468
TEST=tests/standalone/io/http_proxy_test.dart

Review URL: https://codereview.chromium.org//11066041
------------------------------------------------------------------------
r13333 | asiva@google.com | 2012-10-06 08:10:28 +0900 (土, 06 10月 2012) | 17 lines

- Add support to interrupt a running isolate with the following command:
<===  InterruptCmd = "{" RequestId "," command ":" interrupt "," params ":" "{" isolateId ":" Integer "}" "}"
===>  InterruptCmdResp = "{" RequestId "}"

- Send isolate events over to the debugger client in the following format:
===>  "{" event ":" isolate "," params ":" "{" reason ":" created "," id ":" Integer "}" "}"
===>  "{" event ":" isolate "," params ":" "{" reason ":" shutdown "," id ":" Integer "}" "}"
===>  "{" event ":" paused "," params ":" "{" reason ":" interrupted "," callFrames ":" StackTrace "}" "}"

- Added id ";" Integer, to params in all paused events messages

- create per isolate debugger message queues, instead of the global static one

- Add 'i' command in ddbg to exercise the interrupt feature

- Add support for handling isolave event messages in ddbg
Review URL: https://codereview.chromium.org//11028040
------------------------------------------------------------------------
r13232 | sgjesse@google.com | 2012-10-04 23:11:38 +0900 (木, 04 10月 2012) | 9 lines

Refactor HttpClient internals to use Uri class for passing connection information

This is in preparation for adding proxy server support.

R=ajohnsen@google.com

BUG=

Review URL: https://codereview.chromium.org//11035030
------------------------------------------------------------------------
r13207 | asiva@google.com | 2012-10-04 09:13:37 +0900 (木, 04 10月 2012) | 11 lines

1. Create a port when a debugger object is created for an isolate, use this
   port as the unique ID to represent an isolate in the debugger message
   format.

2. Switch the Event handler API to use an isolate id instead of the isolate
   object itself.

3. Add a unit test case for isolate debugger event handling with an
   interrupt of isolate to ensure that interrupting the isolate runs
   the interrupt event handler.
Review URL: https://codereview.chromium.org//11052006
------------------------------------------------------------------------
r13186 | asiva@google.com | 2012-10-04 02:13:43 +0900 (木, 04 10月 2012) | 8 lines

First step towards support for being able to interrupt a running Dart Isolate
using the debugger API
- restructure the debug connection handler code to allow a native thread
  to accept debug connections and read debug commands
- added a new message queue data structure for being able to dispatch
  debug commands on a per isolate basis
- add framework for generic commands and isolate specific commands.
Review URL: https://codereview.chromium.org//10990089
------------------------------------------------------------------------
r13130 | asiva@google.com | 2012-10-03 03:09:55 +0900 (水, 03 10月 2012) | 3 lines

Add isolate event handler setup in order to be able to propagate isolate
events (create/shutdown/interrupted)
Review URL: https://codereview.chromium.org//11026011
------------------------------------------------------------------------
r13067 | ager@google.com | 2012-10-01 23:04:26 +0900 (月, 01 10月 2012) | 23 lines

Change run_vm_tests to take the VM arguments before the test name so
it acts more like the standalone VM. That way the test scripts can
uniformly pass extra arguments to the cctest runner and to the VM
itself.

The use case for this is that it is nice to be able to add extra
vm flags to all tests using the --special-commands flag for the
test runner:

./tools/test.py --special-commands='time @ --vm-flag'

This will turn cc tests into:

time run_vm_tests --vm-flag Selector

and VM tests into:

time dart --vm-flag my_test.dart

R=ricow@google.com,asiva@google.com
BUG=

Review URL: https://codereview.chromium.org//11018014
------------------------------------------------------------------------
r13054 | ager@google.com | 2012-10-01 18:21:18 +0900 (月, 01 10月 2012) | 10 lines

Clean up file implementation.

The _FileUtils class is not needed it is used to hold methods used
from multiple places. After we started using native ports for the
async API most of these are used from only one place.

BUG=
R=sgjesse@google.com

Review URL: https://codereview.chromium.org//11023003
------------------------------------------------------------------------
r13006 | ager@google.com | 2012-09-28 20:42:14 +0900 (金, 28  9月 2012) | 6 lines

Fix errors caused by missing argument checking

R=sgjesse@google.com
BUG=

Review URL: https://codereview.chromium.org//10996058
------------------------------------------------------------------------
r13005 | ahe@google.com | 2012-09-28 20:41:08 +0900 (金, 28  9月 2012) | 3 lines

Minor improvement to File diagnostics

Review URL: https://codereview.chromium.org//10983066
------------------------------------------------------------------------
r13003 | ager@google.com | 2012-09-28 20:08:38 +0900 (金, 28  9月 2012) | 8 lines

Reapply change to hide VM-only List implementation classes.

The performance issue was that I had not updated the method
recognizer.

BUG=

Review URL: https://codereview.chromium.org//10990083
------------------------------------------------------------------------
r12963 | ager@google.com | 2012-09-27 23:07:56 +0900 (木, 27  9月 2012) | 8 lines

Revert hiding of VM-only coreimpl list implementation types. While I
investigate performance regression (even after fixing constructors
in the intrinsifier).

R=iposva@google.com,srdjan@google.com,fschneider@google.com
BUG=

Review URL: https://codereview.chromium.org//11000025
------------------------------------------------------------------------
r12955 | lrn@google.com | 2012-09-27 22:07:54 +0900 (木, 27  9月 2012) | 8 lines

Stop using the Hashable interface.

All objects have a hashCode method, so there is no need for a Hashable
interface.
The interface itself is retained for at least two weeks, to give time for
code to remove uses of it.

Review URL: https://codereview.chromium.org//10993059
------------------------------------------------------------------------
r12952 | ager@google.com | 2012-09-27 21:37:30 +0900 (木, 27  9月 2012) | 4 lines

Hide VM-only coreimpl List implementation types. These should not be
exposed as visible parts of coreimpl.

Review URL: https://codereview.chromium.org//10990055
------------------------------------------------------------------------
r12897 | fschneider@google.com | 2012-09-26 18:08:21 +0900 (水, 26  9月 2012) | 7 lines

Add code for CPU feature detection and use it to detect SSE3 and SSE 4.1.

The Dart VM now requires at least SSE3 to build and run.

There is a new flag --use-sse41 (default:true) to disable the use of 
SSE 4.1 features manually. 
Review URL: https://codereview.chromium.org//10990028
------------------------------------------------------------------------
r12893 | ager@google.com | 2012-09-26 15:01:23 +0900 (水, 26  9月 2012) | 6 lines

Update all occurrences of raw strings.

R=hausner@google.com,kasperl@google.com
BUG=

Review URL: https://codereview.chromium.org//10977027
------------------------------------------------------------------------
r12841 | lrn@google.com | 2012-09-25 21:27:52 +0900 (火, 25  9月 2012) | 3 lines

Change IllegalArgumentException to ArgumentError.

Review URL: https://codereview.chromium.org//10989013
------------------------------------------------------------------------
r12814 | iposva@google.com | 2012-09-25 07:26:37 +0900 (火, 25  9月 2012) | 2 lines

- Add support for --help and --verbose to print usage message of the standalone binary.
Review URL: https://codereview.chromium.org//10979006
------------------------------------------------------------------------
r12693 | ager@google.com | 2012-09-21 20:40:40 +0900 (金, 21  9月 2012) | 6 lines

Avoid needless int64_t to intptr_t conversion in eventhandler.

R=sgjesse@google.com
BUG=

Review URL: https://codereview.chromium.org//10962026
------------------------------------------------------------------------
r12691 | ager@google.com | 2012-09-21 20:07:36 +0900 (金, 21  9月 2012) | 11 lines

Use native fields for process pid and fix bug that allowed killing
a process before it was started.

We should make the change to make Process.start return a future that
does not complete unless the process is actually started. That would
have avoided this issue as well.

R=sgjesse@google.com
BUG=dartbug.com/5301

Review URL: https://codereview.chromium.org//10963024
------------------------------------------------------------------------
r12685 | sgjesse@google.com | 2012-09-21 18:06:50 +0900 (金, 21  9月 2012) | 7 lines

Update documentation for HTTP response status code

R=ager@google.com

BUG=

Review URL: https://codereview.chromium.org//10964039
------------------------------------------------------------------------
r12684 | ager@google.com | 2012-09-21 17:19:01 +0900 (金, 21  9月 2012) | 9 lines

Use native wrapper fields to store socket ids.

This relies on landing the change to fix implicit super constructors
for subclasses of something that has native fields.

R=sgjesse@google.com
BUG=dartbug.com/5301

Review URL: https://codereview.chromium.org//10962012
------------------------------------------------------------------------
r12616 | ager@google.com | 2012-09-20 16:08:10 +0900 (木, 20  9月 2012) | 13 lines

Introduce a VM-only dart:scalarlist library for byte arrays.

Include it in the SDK so users can use it. Create a dummy
implementation and patch file for the library for dart2js so it can be
documented. Johnni, can you think of a nicer way of making
documentation generation work for a VM only library? Also, it seems that
patching kills the documentation comments and they do not show up in
the generated docs.

R=iposva@google.com,johnniwinther@google.com
BUG=

Review URL: https://codereview.chromium.org//10919267
------------------------------------------------------------------------
r12504 | jackpal@google.com | 2012-09-19 01:44:41 +0900 (水, 19  9月 2012) | 9 lines

Improve dlsym() error-detection.

Avoid false-positive error detection by calling dlerror() once (and
ignoring the result) before calling dlsym().

See "man dlsym" on a Linux machine for more discussion of how to detect
errors when calling dlsym().

Review URL: https://codereview.chromium.org//10943002
------------------------------------------------------------------------
r12484 | ager@google.com | 2012-09-18 19:54:37 +0900 (火, 18  9月 2012) | 9 lines

Switch from interfaces to abstract classes in dart:io.

Add a bunch of default argument values to the abstract classes
so they are picked up by dartdoc.

R=sgjesse@google.com
BUG=

Review URL: https://codereview.chromium.org//10938010
------------------------------------------------------------------------
r12482 | sgjesse@google.com | 2012-09-18 19:27:47 +0900 (火, 18  9月 2012) | 19 lines

Never send reserved status codes in a close frame

When receiving a close frame with no status code the reported status
code is 1005. If the close is echoed as part of the close handshake
the echoed close frame must also have no status code and NOT status
code 1005.

The description of status code 1005 from the spec:

1005 is a reserved value and MUST NOT be set as a status code in a
Close control frame by an endpoint.  It is designated for use in
applications expecting a status code to indicate that no status
code was actually present.

R=ajohnsen@google.com

BUG=dart:5209

Review URL: https://codereview.chromium.org//10946007
------------------------------------------------------------------------
r12474 | sgjesse@google.com | 2012-09-18 17:25:26 +0900 (火, 18  9月 2012) | 8 lines

Make it possible to read a specific number of characters from a string input stream

R=ager@google.com

BUG=dart:4954
TEST=tests/standalone/io/string_stream_test.dart

Review URL: https://codereview.chromium.org//10945004
------------------------------------------------------------------------
r12447 | jackpal@google.com | 2012-09-18 03:48:33 +0900 (火, 18  9月 2012) | 8 lines

Don't use TEMP_FAILURE_RETRY macro with inet_addr

inet_addr is not a syscall, therefore it should not be used with the
TEMP_FAILURE_RETRY macro.

This fixes a warning in the Android build.

Review URL: https://codereview.chromium.org//10907248
------------------------------------------------------------------------
r12395 | jackpal@google.com | 2012-09-15 03:20:24 +0900 (土, 15  9月 2012) | 15 lines

Use casts to work around bug in Android TEMP_FAILURE_RETRY macro

See http://code.google.com/p/android/issues/detail?id=37426
"unistd.h TEMP_FAILURE_RETRY generates warning when used with syscall
 that returns unsigned int".

The Android version of this macro will generate a signed/unsigned
comparison when used with a syscall function that returns an unsigned
value such as inet_addr(), which returns in_addr_t, which is defined as
an unsigned int. By casting the result to an int before the macro
processes it, and then casting it back to an in_addr_t after the macro
returns it we are able to avoid the signed/unsigned comparison, and so
avoid the signed/unsigned comparison warning.

Review URL: https://codereview.chromium.org//10907228
------------------------------------------------------------------------
r12382 | scheglov@google.com | 2012-09-14 22:04:19 +0900 (金, 14  9月 2012) | 7 lines

Issue 3476. Final variables don't have to have constant initializers
http://code.google.com/p/dart/issues/detail?id=3476

R=jwren@google.com
BUG=

Review URL: https://codereview.chromium.org//10919290
------------------------------------------------------------------------
r12371 | ager@google.com | 2012-09-14 18:53:24 +0900 (金, 14  9月 2012) | 6 lines

Use const instead of final for constants.

R=sgjesse@google.com
BUG=

Review URL: https://codereview.chromium.org//10909227
------------------------------------------------------------------------
r12316 | ager@google.com | 2012-09-13 20:50:19 +0900 (木, 13  9月 2012) | 6 lines

Patch print directly in corelib instead of going through coreimpl.

R=ajohnsen@google.com
BUG=

Review URL: https://chromiumcodereview.appspot.com//10928145
------------------------------------------------------------------------
r12307 | sgjesse@google.com | 2012-09-13 17:48:19 +0900 (木, 13  9月 2012) | 9 lines

Add web socket error codes constants

Also update the onClosed comment.

R=ajohnsen@google.com

BUG=dart:5125

Review URL: https://codereview.chromium.org//10907211
------------------------------------------------------------------------
r12275 | devoncarew@google.com | 2012-09-13 03:01:50 +0900 (木, 13  9月 2012) | 4 lines

Fix for http://code.google.com/p/dart/issues/detail?id=5085 - break-on-exceptions in the debugger can recurse.

This CL turns off the break-on-exceptions behavior when evaluating Dart code in the debugger (in particular, the toString() method).
Review URL: https://chromiumcodereview.appspot.com//10928149
------------------------------------------------------------------------
r12256 | ager@google.com | 2012-09-12 20:21:45 +0900 (水, 12  9月 2012) | 10 lines

Fix http input stream double close problem.

Make sure to record the fact that we are calling close in
_closeReceived so the client close handler cannot trigger another
close.

R=sgjesse@google.com
BUG=dartbug.com/4974

Review URL: https://chromiumcodereview.appspot.com//10914224
------------------------------------------------------------------------
r12240 | ager@google.com | 2012-09-12 16:35:34 +0900 (水, 12  9月 2012) | 11 lines

Move VM specific library files to the runtime/lib directory so they do
not become part of the SDK.

We should get rid of these files and use the real library file that
sources the rest of the implementation. That work is tracked in
dartbug.com/5099.

R=iposva@google.com
BUG=dartbug.com/5069

Review URL: https://chromiumcodereview.appspot.com//10913214
------------------------------------------------------------------------
r12199 | ager@google.com | 2012-09-11 23:44:41 +0900 (火, 11  9月 2012) | 10 lines

Fix closing of server sockets.

Waiting for the onClosed event on the socket output stream is the
right thing to do. However, only if we actually make sure that it
will always close. :-)

R=sgjesse@google.com,ajohnsen@google.com
BUG=

Review URL: https://chromiumcodereview.appspot.com//10914200
------------------------------------------------------------------------
r12198 | ajohnsen@google.com | 2012-09-11 23:43:12 +0900 (火, 11  9月 2012) | 9 lines

Fix two issues in the websocket.

- Correctly report protocol error as error 1002.
- If the socket is teared down while writing, correctly report the
error.

BUG=

Review URL: https://chromiumcodereview.appspot.com//10905214
------------------------------------------------------------------------
r12106 | ager@google.com | 2012-09-10 19:38:46 +0900 (月, 10  9月 2012) | 12 lines

Fix for Directory.exists on Windows using GetFileAttributes
based on patch from Alexander Aprelev.

Discriminate different reasons for not being able to get
the file attributes. Currently this makes no difference since
both DOES_NOT_EXIST and UNKNOWN turn into a false return value
from Directory.existsSync().

R=sgjesse@google.com
BUG=3914

Review URL: https://chromiumcodereview.appspot.com//10916206
------------------------------------------------------------------------
r12085 | asiva@google.com | 2012-09-08 10:00:28 +0900 (土, 08  9月 2012) | 2 lines

Simplify functions in Builtin class and get rid of unused code.
Review URL: https://chromiumcodereview.appspot.com//10911135
------------------------------------------------------------------------
r12023 | lrn@google.com | 2012-09-07 21:30:55 +0900 (金, 07  9月 2012) | 6 lines

Move dart:web to pkg:htmlescape.

Remove the dart:web library from the VM.
Remove reference to web library from libraries.dart.

Review URL: https://chromiumcodereview.appspot.com//10919147
------------------------------------------------------------------------
r12020 | ager@google.com | 2012-09-07 21:19:13 +0900 (金, 07  9月 2012) | 6 lines

Fix an analyser error in the http_impl. The code works fine on the VM.

R=sgjesse@google.com
BUG=

Review URL: https://chromiumcodereview.appspot.com//10918118
------------------------------------------------------------------------
r11972 | hausner@google.com | 2012-09-07 03:02:41 +0900 (金, 07  9月 2012) | 14 lines

Add named constructor name checking

Named constructors may not clash with any other class members.
Add a check but enable it only when --construcotr_name_check
runtime flag is passed to the VM.

Eliminate one named constructor in Process class in core library,
as well as a couple of cases in dart2js.

The dart2js team may want to rename the constructors I changed.

Issue 3990  (http://code.google.com/p/dart/issues/detail?id=3990)
 
Review URL: https://chromiumcodereview.appspot.com//10905109
------------------------------------------------------------------------
r11951 | ager@google.com | 2012-09-06 23:08:43 +0900 (木, 06  9月 2012) | 9 lines

Do not close sockets for http connection fully before we are
done writing data to them.

This fixes the remaining skipped/failing http tests on Windows.

R=sgjesse@google.com
BUG=dartbug.com/2959

Review URL: https://chromiumcodereview.appspot.com//10908121
------------------------------------------------------------------------
r11945 | kasperl@google.com | 2012-09-06 22:17:01 +0900 (木, 06  9月 2012) | 8 lines

Revert "Move dart:web to pkg:htmlescape."

This reverts r11943.

R=lrn@google.com
BUG=

Review URL: https://chromiumcodereview.appspot.com//10912123
------------------------------------------------------------------------
r11943 | lrn@google.com | 2012-09-06 21:54:59 +0900 (木, 06  9月 2012) | 3 lines

Move dart:web to pkg:htmlescape.

Review URL: https://chromiumcodereview.appspot.com//10905125
------------------------------------------------------------------------
r11921 | sgjesse@google.com | 2012-09-06 16:31:46 +0900 (木, 06  9月 2012) | 9 lines

Cleanup and fixes to some dart:io files

Fixed wrong names for constants and some warnings. This includes the changes in https://chromiumcodereview.appspot.com/10913096/.

R=ager@google.com

BUG=dart:4711

Review URL: https://chromiumcodereview.appspot.com//10911120
------------------------------------------------------------------------
r11913 | cshapiro@google.com | 2012-09-06 10:14:09 +0900 (木, 06  9月 2012) | 7 lines

Fix build break on Win32 and MacOS related to printf format string checks.

Implement remaining inttypes.h format specifiers on Win32

Resolve some conversion specifier discrepancies on MacOS.

Review URL: https://chromiumcodereview.appspot.com//10928013
------------------------------------------------------------------------
r11912 | cshapiro@google.com | 2012-09-06 09:58:25 +0900 (木, 06  9月 2012) | 6 lines

Add attributions so printf like functions can have their arguments checked.

This change also corrects some misuses of format strings and format
arguments that discovered by the compiler checks.

Review URL: https://chromiumcodereview.appspot.com//10869063
------------------------------------------------------------------------
r11894 | asiva@google.com | 2012-09-06 03:49:07 +0900 (木, 06  9月 2012) | 4 lines

Rename Builtin::LoadLibrary to Builtin::LoadAndCheckLibrary as the name
LoadLibrary seems to conflict with some windows predefined macros causing
build failures on windows build of dartium.
Review URL: https://chromiumcodereview.appspot.com//10905102
------------------------------------------------------------------------
r11865 | ager@google.com | 2012-09-05 19:40:09 +0900 (水, 05  9月 2012) | 12 lines

Change backlog on http server listen from 5 to 128.

5 simultaneously connecting clients seems like very little. This
also fixes an http client test on Mac. If the backlog is too
small a connection can be dropped again before it is accepted
and the client will get a "broken pipe" or "connection reset"
error.

R=sgjesse@google.com
BUG=

Review URL: https://chromiumcodereview.appspot.com//10916111
------------------------------------------------------------------------
r11863 | ajohnsen@google.com | 2012-09-05 18:09:57 +0900 (水, 05  9月 2012) | 7 lines

Cleanup in http_utils.dart.

Followup fixes to ager's DBC.

BUG=

Review URL: https://chromiumcodereview.appspot.com//10914093
------------------------------------------------------------------------
r11840 | asiva@google.com | 2012-09-05 05:46:30 +0900 (水, 05  9月 2012) | 17 lines

Added option --script-snapshot in gen_snapshot to generate the snapshot of a scipt into the file.

Added option --use-script-snapshot to dart to be able to read a script from a snapshot.

Using this for dart2js produces the following result:

time dart --use-script-snapshot=dart2-js out/ReleaseIA32/dart-sdk/lib/dart2js/lib/compiler/implementation/dart2js.dart tests/language/string_test.dart -oout.js
real    0m1.733s
user    0m1.690s
sys     0m0.030s

without the snapshot the runtimes are:
time out/ReleaseIA32/dart out/ReleaseIA32/dart-sdk/lib/dart2js/lib/compiler/implementation/dart2js.dart tests/language/string_test.dart -oout.js.orig
real    0m2.406s
user    0m2.350s
sys     0m0.040s
Review URL: https://chromiumcodereview.appspot.com//10871092
------------------------------------------------------------------------
r11785 | ajohnsen@google.com | 2012-09-04 16:26:19 +0900 (火, 04  9月 2012) | 9 lines

Use onClosed instead of onError in the WebSocket classes.

There is a remaining onerror in 'class WebSocket', but as it's
documented (though unused in the spec), we've left it in for
completeness.

BUG=

Review URL: https://chromiumcodereview.appspot.com//10907047
------------------------------------------------------------------------
r11783 | ajohnsen@google.com | 2012-09-04 16:03:29 +0900 (火, 04  9月 2012) | 5 lines

Use correct cookie date parsing for cookie 'expires' field.

BUG=

Review URL: https://chromiumcodereview.appspot.com//10909057
------------------------------------------------------------------------
r11771 | ajohnsen@google.com | 2012-09-03 23:57:50 +0900 (月, 03  9月 2012) | 5 lines

Don't use TEMP_FAILURE_RETRY on windows.

BUG=

Review URL: https://chromiumcodereview.appspot.com//10905063
------------------------------------------------------------------------
r11770 | ajohnsen@google.com | 2012-09-03 23:49:06 +0900 (月, 03  9月 2012) | 5 lines

Fix type for container of inet_addr result on Win.

BUG=

Review URL: https://chromiumcodereview.appspot.com//10919062
------------------------------------------------------------------------
r11769 | ajohnsen@google.com | 2012-09-03 23:39:47 +0900 (月, 03  9月 2012) | 5 lines

Throw an error if the ServerSocket host argument is invalid.

BUG=

Review URL: https://chromiumcodereview.appspot.com//10917064
------------------------------------------------------------------------
r11728 | iposva@google.com | 2012-09-01 07:07:51 +0900 (土, 01  9月 2012) | 3 lines

Fix dartbug.com/3424:
- Remove bogus return type.
Review URL: https://chromiumcodereview.appspot.com//10920049
------------------------------------------------------------------------
r11698 | asiva@google.com | 2012-09-01 01:55:03 +0900 (土, 01  9月 2012) | 2 lines

Get rid of support for string interpolation in #import strings.
Review URL: https://chromiumcodereview.appspot.com//10911025
------------------------------------------------------------------------
r11614 | whesse@google.com | 2012-08-30 23:12:47 +0900 (木, 30  8月 2012) | 5 lines

Use new getters syntax in dart:io.  A few were missed in the first round of cleanup.

BUG=

Review URL: https://chromiumcodereview.appspot.com//10915007
------------------------------------------------------------------------
r11605 | sgjesse@google.com | 2012-08-30 20:36:11 +0900 (木, 30  8月 2012) | 8 lines

Better handling of reading empty files

R=whesse@google.com

BUG=dart:4834
TEST=tests/standalone/io/file_test.dart

Review URL: https://chromiumcodereview.appspot.com//10913005
------------------------------------------------------------------------
r11603 | ager@google.com | 2012-08-30 20:31:30 +0900 (木, 30  8月 2012) | 13 lines

Move print to corelib.

Allow embedder customization in the VM through a static field that can
be set by the embedder.

Mark failing test that is unrelated to this change. The VM does not
like when you import dart:core explicitly and tells you there both
'dart:core' and 'dart:core' define 'print'.

R=ajohnsen@google.com,iposva@google.com
BUG=

Review URL: https://chromiumcodereview.appspot.com//10887024
------------------------------------------------------------------------
r11514 | kasperl@google.com | 2012-08-29 20:58:58 +0900 (水, 29  8月 2012) | 6 lines

Use new try-catch syntax in runtime/, tools/, and utils/.

R=ngeoffray@google.com
BUG=

Review URL: https://chromiumcodereview.appspot.com//10887023
------------------------------------------------------------------------
r11494 | ager@google.com | 2012-08-29 17:35:43 +0900 (水, 29  8月 2012) | 16 lines

Beginning support for library prefixes in the dart API.

This is a request for comments. Do we want to expose library
prefixes like this? Is there a way to import with a prefix already
and lookup members?

The reason why I would like to do this is so that I can import the
user-supplied builtins library under a prefix. This will be a useful
first step to move the print function to corelib while preserving
the ability to patch in a print implementation via the builtins
library.

R=iposva@google.com,turnidge@google.com
BUG=

Review URL: https://chromiumcodereview.appspot.com//10867032
------------------------------------------------------------------------
r11488 | aprelev@gmail.com | 2012-08-29 11:55:34 +0900 (水, 29  8月 2012) | 6 lines

Fix lowercasing output filenames for dart:3320 as well as fix for co19 test

BUG=dart:3320
TEST=

Review URL: https://chromiumcodereview.appspot.com//10825434
------------------------------------------------------------------------
r11425 | iposva@google.com | 2012-08-28 08:51:37 +0900 (火, 28  8月 2012) | 3 lines

- Change "static final" to "static const" in the runtime/ directory.
- Fixed parsing of top-level static const.
Review URL: https://chromiumcodereview.appspot.com//10883071
------------------------------------------------------------------------
r11328 | hausner@google.com | 2012-08-25 02:57:57 +0900 (土, 25  8月 2012) | 8 lines

Suppress "Waiting for debugger..." message on cosole

Less noise in the debugger console window.

Also put the verbose debugger output under command line flag
instead of compile time flag.

Review URL: https://chromiumcodereview.appspot.com//10874065
------------------------------------------------------------------------
r11300 | whesse@google.com | 2012-08-24 19:11:05 +0900 (金, 24  8月 2012) | 5 lines

Change getters syntax in dart:io library.

BUG=

Review URL: https://chromiumcodereview.appspot.com//10872033
------------------------------------------------------------------------
r11217 | ager@google.com | 2012-08-23 17:50:22 +0900 (木, 23  8月 2012) | 6 lines

Move exit from the builtin library to dart:io.

R=sgjesse@google.com
BUG=

Review URL: https://chromiumcodereview.appspot.com//10879033
------------------------------------------------------------------------
r11175 | rnystrom@google.com | 2012-08-23 01:46:21 +0900 (木, 23  8月 2012) | 3 lines

When a directory contains read-only files, try to make them writable when recursively deleting on Windows.

Review URL: https://chromiumcodereview.appspot.com//10867003
------------------------------------------------------------------------
r11155 | ager@google.com | 2012-08-22 23:33:01 +0900 (水, 22  8月 2012) | 3 lines

Deprecate Math object in corelib in favor of dart:math library.

Review URL: https://chromiumcodereview.appspot.com//10829459
------------------------------------------------------------------------
r11050 | whesse@google.com | 2012-08-21 23:24:22 +0900 (火, 21  8月 2012) | 5 lines

Fix dart:io Process class on the Windows plaform, which had some race conditions.

BUG=dart:4414

Review URL: https://chromiumcodereview.appspot.com//10825473
------------------------------------------------------------------------
r11034 | whesse@google.com | 2012-08-21 20:45:48 +0900 (火, 21  8月 2012) | 6 lines

Fix for bug dart 3639: Process.run gets stuck on Mac

BUG=
TEST=Run fresh build no macosx10.7. Observe finishing to completion without being stuck on dartdoc step

Review URL: https://chromiumcodereview.appspot.com//10834423
------------------------------------------------------------------------
r11005 | rnystrom@google.com | 2012-08-21 08:25:13 +0900 (火, 21  8月 2012) | 3 lines

Don't traverse through junctions when recursively deleting on Windows.

Review URL: https://chromiumcodereview.appspot.com//10825413
------------------------------------------------------------------------
r10946 | whesse@google.com | 2012-08-20 21:32:19 +0900 (月, 20  8月 2012) | 5 lines

Fix dart:io Process callback on Windows platfrom calling convention from cdecl to stdcall.

BUG=dart:4414

Review URL: https://chromiumcodereview.appspot.com//10836337
------------------------------------------------------------------------
r10793 | ajohnsen@google.com | 2012-08-16 15:50:54 +0900 (木, 16  8月 2012) | 5 lines

Fix HttpHeaders.date and add HttpHeaders.ifModifiedSince.

BUG=

Review URL: https://chromiumcodereview.appspot.com//10855197
------------------------------------------------------------------------
r10700 | ager@google.com | 2012-08-15 14:50:35 +0900 (水, 15  8月 2012) | 8 lines

Revert "Start adding TLS (SSL) sockets to dart:io."

Revert "Add stub for TlsSocket to dart2js library."

R=whesse@google.com
BUG=

Review URL: https://chromiumcodereview.appspot.com//10828320
------------------------------------------------------------------------
r10676 | jackpal@google.com | 2012-08-15 05:04:54 +0900 (水, 15  8月 2012) | 15 lines

Support generating the dart vm snapshot binary on Android

This change splits the generate_snapshot_file build target into two targets:

generate_snapshot_bin - executes gen_snapshot to create snapshot_bin_file
generate_snapshot_file - creates snapshot_cc_file

It's not strictly necessary to split the generation into two steps, but
it is convenient to do so, because only the first step needs to know about
Android. The second step can be shared between all builds.

For Android we copy the gen_snapshot executable and all its input files
to Android, run it there, and copy the output files back to the host.

Review URL: https://chromiumcodereview.appspot.com//10827250
------------------------------------------------------------------------
r10650 | whesse@google.com | 2012-08-14 23:34:02 +0900 (火, 14  8月 2012) | 11 lines

Start adding TLS (SSL) sockets to dart:io.

Add Linux implementation for SSL client sockets.

BUG=dart:3950
TEST=standalone/io/tls_socket_test

Committed: https://code.google.com/p/dart/source/detail?r=10565
Reverted: r=10567

Review URL: https://chromiumcodereview.appspot.com//10704159
------------------------------------------------------------------------
r10613 | jackpal@google.com | 2012-08-14 08:06:52 +0900 (火, 14  8月 2012) | 17 lines

Add _android files for building DartVM on Android

Split directory_posix -> directory_(android|linux|macos)
  This allows us to cleanly make Android-specific changes to
  directory_android.cc

Copy all _linux files to _android files and edit as needed to account
for the differences between Linux and Android:

 + getcwd(0, NULL) doesn't work on Android, have to emulate
 + Android doesn't have a '/tmp' directory, have to emulate
 + Android doesn't provide mkdtemp(), have to emulate.
 + Small differences in the available system include files.
 + Use pthread_cond_timedwait_monotonic instead of
   pthread_condattr_setclock

Review URL: https://chromiumcodereview.appspot.com//10826233
------------------------------------------------------------------------
r10567 | whesse@google.com | 2012-08-13 21:31:36 +0900 (月, 13  8月 2012) | 7 lines

Revert "Start adding TLS (SSL) sockets to dart:io."

This reverts commit 10565.

BUG=

Review URL: https://chromiumcodereview.appspot.com//10832269
------------------------------------------------------------------------
r10565 | whesse@google.com | 2012-08-13 21:22:03 +0900 (月, 13  8月 2012) | 8 lines

Start adding TLS (SSL) sockets to dart:io.

Add Linux implementation for SSL client sockets.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10704159
------------------------------------------------------------------------
r10455 | nweiz@google.com | 2012-08-10 05:09:19 +0900 (金, 10  8月 2012) | 5 lines

Add an OutputStream.closed getter.

BUG=3603

Review URL: https://chromiumcodereview.appspot.com//10832188
------------------------------------------------------------------------
r10373 | whesse@google.com | 2012-08-08 18:09:13 +0900 (水, 08  8月 2012) | 7 lines

Revert "Revert "Fix dartdoc block code comments in Dart API that are broken and use [: :] delimiters.""

This reverts the reversion of 10368.

BUG=

Review URL: https://chromiumcodereview.appspot.com//10837163
------------------------------------------------------------------------
r10370 | whesse@google.com | 2012-08-08 17:48:29 +0900 (水, 08  8月 2012) | 7 lines

Revert "Fix dartdoc block code comments in Dart API that are broken and use [: :] delimiters."

This reverts commit 10368.

BUG=

Review URL: https://chromiumcodereview.appspot.com//10825242
------------------------------------------------------------------------
r10368 | whesse@google.com | 2012-08-08 17:16:39 +0900 (水, 08  8月 2012) | 5 lines

Fix dartdoc block code comments in Dart API that are broken and use [: :] delimiters.

BUG=dart:2570

Review URL: https://chromiumcodereview.appspot.com//10854025
------------------------------------------------------------------------
r10354 | rnystrom@google.com | 2012-08-08 05:56:59 +0900 (水, 08  8月 2012) | 3 lines

Rename BadNumberFormatException -> FormatException.

Review URL: https://chromiumcodereview.appspot.com//10850034
------------------------------------------------------------------------
r10316 | jackpal@google.com | 2012-08-07 07:39:36 +0900 (火, 07  8月 2012) | 34 lines

Revert "Make Directory::Current() work with unenhanced POSIX getcwd"

(Was committed by mistake.)

This reverts commit 75e15184afcd00e293a44ccba7dc1ead5387c382.

Merge remote-tracking branch 'refs/remotes/git-svn'

Revert "Make Directory::Current() work with unenhanced POSIX getcwd"

This reverts commit cab70428509870ae6ebf8de09d42991cc0318a07.

(Which was accidentally checked in before being reviewed.)

Make Directory::Current() work with unenhanced POSIX getcwd

POSIX says getcwd needs to be passed a pre-allocated
buffer, but many platforms provide an extended version
of getcwd that will allocate a buffer when called with
arguments (NULL, 0).

Display::Current() was depending upon this extended
behavior, which happens to work on Linux and Mac
platforms, but which doesn't work on other POSIX
platforms (such as Android.)

Fixed by using the preprocessor to choose between two
implementations of Display::Current, one of which depends
upon the extended semantics of getcwd, the other of which
only depends upon the standard semantics of getcwd.

BUG=

Review URL: https://chromiumcodereview.appspot.com//10828180
------------------------------------------------------------------------
r10309 | jackpal@google.com | 2012-08-07 06:51:20 +0900 (火, 07  8月 2012) | 20 lines

Make Directory::Current() work with unenhanced POSIX getcwd

POSIX says getcwd needs to be passed a pre-allocated
buffer, but many platforms provide an extended version
of getcwd that will allocate a buffer when called with
arguments (NULL, 0).

Display::Current() was depending upon this extended
behavior, which happens to work on Linux and Mac
platforms, but which doesn't work on other POSIX
platforms (such as Android.)

Fixed by using the preprocessor to choose between two
implementations of Display::Current, one of which depends
upon the extended semantics of getcwd, the other of which
only depends upon the standard semantics of getcwd.

BUG=

Review URL: https://chromiumcodereview.appspot.com//10824159
------------------------------------------------------------------------
r10298 | nweiz@google.com | 2012-08-07 03:25:14 +0900 (火, 07  8月 2012) | 5 lines

Add a ListOutputStream.onData callback.

BUG=4335

Review URL: https://chromiumcodereview.appspot.com//10832145
------------------------------------------------------------------------
r10261 | asiva@google.com | 2012-08-04 07:11:30 +0900 (土, 04  8月 2012) | 2 lines

Move hashmap.h and hashmap.cc from the 'bin' directory to 'platform' directory so that it can be used from VM code too.
Review URL: https://chromiumcodereview.appspot.com//10853009
------------------------------------------------------------------------
r10168 | ahe@google.com | 2012-08-02 22:48:30 +0900 (木, 02  8月 2012) | 8 lines

Changed default Uri constructor to Uri.fromComponents(), new default constructor is Uri.fromString(). This is to avoid new Uri('http://www.google.com') resulting in Uri with scheme='http://www.google.com'.

Committing on behalf of: Alexander Aprelev <aprelev@gmail.com>

BUG=dart-3348
TEST=new Uri('http://www.google.com') is the same as new Uri.fromString('http://www.google.com') same as new Uri.fromComponents(scheme:'http', domain:'www.google.com')

Review URL: https://chromiumcodereview.appspot.com//10850015
------------------------------------------------------------------------
r10135 | nweiz@google.com | 2012-08-02 03:47:33 +0900 (木, 02  8月 2012) | 7 lines

Fix the definition of kIllegalPort in dart_api.h.

Declaring a variable directly in a header will cause C to be unable to link
multiple object files that both include that header, even if that variable is
const.

Review URL: https://chromiumcodereview.appspot.com//10834017
------------------------------------------------------------------------
r9922 | cshapiro@google.com | 2012-07-26 09:21:25 +0900 (木, 26  7月 2012) | 3 lines

Emit symbol maps for compiled code for use by the Linux perf tool.

Review URL: https://chromiumcodereview.appspot.com//10831005
------------------------------------------------------------------------
r9782 | regis@google.com | 2012-07-21 01:08:43 +0900 (土, 21  7月 2012) | 4 lines

Add missing type finalization for function literals not assigned to a function
variable.
Various cleanup.
Review URL: https://chromiumcodereview.appspot.com//10797031
------------------------------------------------------------------------
r9772 | hausner@google.com | 2012-07-20 07:51:09 +0900 (金, 20  7月 2012) | 2 lines

Debugger API to enable/disable debugging of libraries
Review URL: https://chromiumcodereview.appspot.com//10797033
------------------------------------------------------------------------
r9761 | ajohnsen@google.com | 2012-07-20 00:18:50 +0900 (金, 20  7月 2012) | 6 lines

Add the ability to get info of a Http connection, e.g. host and port.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10803033
------------------------------------------------------------------------
r9751 | hausner@google.com | 2012-07-19 08:27:59 +0900 (木, 19  7月 2012) | 7 lines

Add multibyte string support to debugger

Issue 4110.

Had to extend the JSON protocol to support code points > 0xffff. The debugger client (editor) needs to support this new escape sequence'
format as well.
Review URL: https://chromiumcodereview.appspot.com//10801002
------------------------------------------------------------------------
r9681 | regis@google.com | 2012-07-17 06:34:07 +0900 (火, 17  7月 2012) | 7 lines

Fix type checking of void type.
Fix library and tests accordingly.
Add new test.
Disable new test for dart2js.
Disable some now failing co19 tests (new issue 158 filed).
Hide internal VM String types from user (not complete).
Review URL: https://chromiumcodereview.appspot.com//10787021
------------------------------------------------------------------------
r9673 | regis@google.com | 2012-07-17 04:05:38 +0900 (火, 17  7月 2012) | 2 lines

Revert fix for type checking of void type, because some top level tests fail.
Review URL: https://chromiumcodereview.appspot.com//10784020
------------------------------------------------------------------------
r9672 | regis@google.com | 2012-07-17 03:05:55 +0900 (火, 17  7月 2012) | 7 lines

Fix type checking of void type.
Fix library and tests accordingly.
Add new test.
Disable new test for dart2js.
Disable some now failing co19 tests (new issue 158 filed).
Hide internal VM String types from user (not complete).
Review URL: https://chromiumcodereview.appspot.com//10704216
------------------------------------------------------------------------
r9583 | ager@google.com | 2012-07-12 17:35:10 +0900 (木, 12  7月 2012) | 11 lines

Guard against integer overflow in process constructor.

I have set an arbitrary limit of around one million arguments. I
see no reasonable use of the Process API where that would be a
problem.

R=whesse@google.com,turnidge@google.com
BUG=dartbug.com/1751
TEST=None, can't happen right now but might in the future.

Review URL: https://chromiumcodereview.appspot.com//10690160
------------------------------------------------------------------------
r9428 | whesse@google.com | 2012-07-06 17:41:37 +0900 (金, 06  7月 2012) | 6 lines

[IO] Improve documentation for dart:io Socket.onWrite.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10703096
------------------------------------------------------------------------
r9404 | sgjesse@google.com | 2012-07-04 21:27:35 +0900 (水, 04  7月 2012) | 11 lines

Fix HTTP client eviction timer bug

The HTTP client eviction timer should only be cancled and nulled out
when there are no client connections at all.

R=whesse@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10693091
------------------------------------------------------------------------
r9336 | whesse@google.com | 2012-07-03 19:16:25 +0900 (火, 03  7月 2012) | 6 lines

IO: Fix error in Process exit handling.

BUG=3639
TEST=

Review URL: https://chromiumcodereview.appspot.com//10697066
------------------------------------------------------------------------
r9284 | ager@google.com | 2012-07-02 19:58:24 +0900 (月, 02  7月 2012) | 10 lines

Deal with special cmd.exe environment variables that have keys that start with an equals sign.

I have attempted to deal with them correctly instead of ignoring
them so that they can be passed on unchanged to subprocesses.

R=johnniwinther@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10689065
------------------------------------------------------------------------
r9281 | ager@google.com | 2012-07-02 16:22:32 +0900 (月, 02  7月 2012) | 11 lines

Support posting of external data into dart as external uint8 arrays through the Dart API.

The native ports use the snapshot reader to create the dart objects. Added support for reading external arrays from snapshots but no support for writing them. The only way an external array is written to a snapshot is through the api message writer.

This allows dart:io to avoid one copy of data read from files and sockets. This change only contains one use of the new API.

R=asiva@google.com,iposva@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10698011
------------------------------------------------------------------------
r9251 | ager@google.com | 2012-06-29 23:40:17 +0900 (金, 29  6月 2012) | 7 lines

Terminate event handler thread on isolate shutdown.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10693039
------------------------------------------------------------------------
r9235 | hausner@google.com | 2012-06-29 09:52:51 +0900 (金, 29  6月 2012) | 2 lines

Support for lists in debugger wire protocol
Review URL: https://chromiumcodereview.appspot.com//10698039
------------------------------------------------------------------------
r9211 | turnidge@google.com | 2012-06-29 03:15:17 +0900 (金, 29  6月 2012) | 2 lines

Add a callback to inform embedders when an isolate is being shut down.
Review URL: https://chromiumcodereview.appspot.com//10450016
------------------------------------------------------------------------
r9121 | hausner@google.com | 2012-06-27 02:32:34 +0900 (水, 27  6月 2012) | 8 lines

Debugger support to display global variables

- Add library id to ActivationFrame
- Add debugger function to get all global variables visible in
  a library (including imported variables).
- Add LibraryPrefixIterator
- Fix Dart_GetLibraryImports
Review URL: https://chromiumcodereview.appspot.com//10657048
------------------------------------------------------------------------
r9110 | whesse@google.com | 2012-06-26 23:24:48 +0900 (火, 26  6月 2012) | 6 lines

Make Path implement (extend) Hashable, and make Path.append to an empty path work right.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10668041
------------------------------------------------------------------------
r9092 | iposva@google.com | 2012-06-26 08:20:31 +0900 (火, 26  6月 2012) | 2 lines

- Fix sorting.
Review URL: https://chromiumcodereview.appspot.com//10661046
------------------------------------------------------------------------
r9091 | iposva@google.com | 2012-06-26 08:05:42 +0900 (火, 26  6月 2012) | 2 lines

- Sort sources in gyp files.
Review URL: https://chromiumcodereview.appspot.com//10663029
------------------------------------------------------------------------
r9060 | ager@google.com | 2012-06-25 21:10:02 +0900 (月, 25  6月 2012) | 7 lines

Remove reference to non-existing classes from encodings class comment.

R=whesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10662015
------------------------------------------------------------------------
r9028 | whesse@google.com | 2012-06-22 20:02:49 +0900 (金, 22  6月 2012) | 10 lines

Add methods to dart:io Path.

Add .append, which adds a segment to the end of a Path, and
.pathWithoutExtension, which removes the extension (part after .),
from the filename at the end of a path, and returns the new path.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10638002
------------------------------------------------------------------------
r9024 | whesse@google.com | 2012-06-22 19:36:20 +0900 (金, 22  6月 2012) | 6 lines

Add .fromPath constructors to File and Directory.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10639004
------------------------------------------------------------------------
r9017 | ajohnsen@google.com | 2012-06-22 18:13:18 +0900 (金, 22  6月 2012) | 6 lines

Document the HttpClient uses KeepAlive, keeping sockets open for up to 60 seconds after a connection is complete.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10640017
------------------------------------------------------------------------
r9011 | asiva@google.com | 2012-06-22 08:33:31 +0900 (金, 22  6月 2012) | 2 lines

Add pprof symbol generation option to run_vm_tests so that we can use pprof in the vm benchmark framework as well.
Review URL: https://chromiumcodereview.appspot.com//10643003
------------------------------------------------------------------------
r8993 | efortuna@google.com | 2012-06-22 02:11:02 +0900 (金, 22  6月 2012) | 2 lines

Add dart:web to VM.
Review URL: https://chromiumcodereview.appspot.com//10574037
------------------------------------------------------------------------
r8987 | iposva@google.com | 2012-06-22 01:17:21 +0900 (金, 22  6月 2012) | 6 lines

- Move the Timer interface to the dart:isolate library so that it
  is accessible from both client and standalone program.
- Enable a way for the embedder to provide the implementation of
  the Timer interface.
- Update tests.
Review URL: https://chromiumcodereview.appspot.com//10532123
------------------------------------------------------------------------
r8913 | hausner@google.com | 2012-06-21 01:09:39 +0900 (木, 21  6月 2012) | 5 lines

Implement the linux debugger wire protocol.

Platform-dependent code of the Linux version of the debugger wire
protocol.
Review URL: https://chromiumcodereview.appspot.com//10572028
------------------------------------------------------------------------
r8909 | whesse@google.com | 2012-06-21 00:21:01 +0900 (木, 21  6月 2012) | 8 lines

Add Path class to dart:io, add tests for it to standalone/io.

Just a preliminary implementation - make suggestions for changes.

BUG=
TEST=standalone/io/path_test

Review URL: https://chromiumcodereview.appspot.com//10417053
------------------------------------------------------------------------
r8899 | floitsch@google.com | 2012-06-20 20:43:46 +0900 (水, 20  6月 2012) | 14 lines

Make isUtc a getter, change some method names in Date. Weekday is now 1 based.

isUtc is now a getter.
Date.hours -> Date.hour
Date.minutes -> Date.minute
Date.seconds -> Date.second
Date.milliseconds -> Date.millisecond
Date.fromEpoch -> Date.fromMillisecondsSinceEpoch
Date.value -> Date.millisecondsSinceEpoch
Date.MON == 1 (up to Date.SUN == 7).

Fixes issue 3444, 1985.

Review URL: https://chromiumcodereview.appspot.com//10538105
------------------------------------------------------------------------
r8797 | whesse@google.com | 2012-06-18 23:16:00 +0900 (月, 18  6月 2012) | 8 lines

Revert "Test infrastructure: Change the intentionally crashing process_test.cc, to try and avoid timeout of this process."

This reverts commit 51bfb317ef687e8457ce6bccb21f022d4b21ea74.

BUG=
TEST=standalone/io/process_segfault_test

Review URL: https://chromiumcodereview.appspot.com//10544207
------------------------------------------------------------------------
r8795 | whesse@google.com | 2012-06-18 22:56:21 +0900 (月, 18  6月 2012) | 6 lines

Test infrastructure: Change the intentionally crashing process_test.cc, to try and avoid timeout of this process.

BUG=1947
TEST=standalone/io/test_runner_test

Review URL: https://chromiumcodereview.appspot.com//10532190
------------------------------------------------------------------------
r8666 | sethladd@google.com | 2012-06-15 01:08:51 +0900 (金, 15  6月 2012) | 6 lines

specify which version of web sockets

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10535168
------------------------------------------------------------------------
r8649 | whesse@google.com | 2012-06-14 20:48:02 +0900 (木, 14  6月 2012) | 6 lines

Close a _FileInputStream only immediately before onClosed is called, so .closed returns false before that.

BUG=
TEST=standalone/io/file_test

Review URL: https://chromiumcodereview.appspot.com//10536168
------------------------------------------------------------------------
r8643 | whesse@google.com | 2012-06-14 17:36:29 +0900 (木, 14  6月 2012) | 6 lines

Add test for buffered file input stream on dart:io File class.

BUG=
TEST=standalone/io/file_test

Review URL: https://chromiumcodereview.appspot.com//10544134
------------------------------------------------------------------------
r8622 | asiva@google.com | 2012-06-14 02:48:47 +0900 (木, 14  6月 2012) | 2 lines

Fix for issue-2837 (allow --print-flags without a script name).
Review URL: https://chromiumcodereview.appspot.com//10548017
------------------------------------------------------------------------
r8579 | hausner@google.com | 2012-06-13 06:56:50 +0900 (水, 13  6月 2012) | 7 lines

Add API to configure debugger pause on exception

Still to be done: proper determination whether an exception is
handled or unhandled. We still assume that TypeError and AssertionError
exceptions are unhanded.

Review URL: https://chromiumcodereview.appspot.com//10540121
------------------------------------------------------------------------
r8553 | whesse@google.com | 2012-06-13 01:06:12 +0900 (水, 13  6月 2012) | 8 lines

Make sure that _FileInputStream._fillBuffer is not entered again before it finishes.

Also fix a bug where _fillBuffer did not reset _position correctly.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10533110
------------------------------------------------------------------------
r8548 | whesse@google.com | 2012-06-12 23:00:06 +0900 (火, 12  6月 2012) | 6 lines

Fix file buffering code that uses RemoveRange on a fixed-length Uint8 array.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10544110
------------------------------------------------------------------------
r8541 | ajohnsen@google.com | 2012-06-12 21:00:50 +0900 (火, 12  6月 2012) | 6 lines

Give Process.kill an optional argument to specify which signal to send.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10545134
------------------------------------------------------------------------
r8537 | whesse@google.com | 2012-06-12 19:55:51 +0900 (火, 12  6月 2012) | 9 lines

Add buffering to _FileInputStream implementation.

Revert "Revert dart:io file InputStream buffering to fix bugs in it."
Recommits r8435, r8401, r8396, r8395, with additional fixes.

BUG=3434
TEST=

Review URL: https://chromiumcodereview.appspot.com//10542102
------------------------------------------------------------------------
r8525 | ager@google.com | 2012-06-12 16:28:29 +0900 (火, 12  6月 2012) | 7 lines

Add missing closed check to random access file.

R=iposva@google.com
BUG=
TEST=standalone/io/file_error_test

Review URL: https://chromiumcodereview.appspot.com//10536112
------------------------------------------------------------------------
r8491 | whesse@google.com | 2012-06-12 00:09:54 +0900 (火, 12  6月 2012) | 9 lines

Enable standalone/io/http_test, splitting it into three separate tests.

This allows better reporting and diagnosis of flakiness.
Also fixed some type and interface issues that created type warnings in http tests.

BUG=2987
TEST=standalone/io/http_test, http_advanced_test, http_read_test, http_basic_test

Review URL: https://chromiumcodereview.appspot.com//10533078
------------------------------------------------------------------------
r8457 | hausner@google.com | 2012-06-09 02:51:50 +0900 (土, 09  6月 2012) | 11 lines

Debugger break on TypeError, AssertionError

Add debugger functionality to pause the VM whenever a TypeError
or AssertionError exception happens.

This is a first step towards breaking on handled and unhanded
exceptions in general. We first need to generate more debug info
for catch handlers so we can determine whether an exception will
be handled or not before we unwind the stack to run the catch
clauses.
Review URL: https://chromiumcodereview.appspot.com//10537065
------------------------------------------------------------------------
r8441 | whesse@google.com | 2012-06-08 23:39:02 +0900 (金, 08  6月 2012) | 6 lines

Revert dart:io file InputStream buffering to fix bugs in it.  Reverts r8435, r8401, r8396, r8395.

BUG=dart:3450, dart:3434
TEST=

Review URL: https://chromiumcodereview.appspot.com//10537077
------------------------------------------------------------------------
r8435 | whesse@google.com | 2012-06-08 21:05:53 +0900 (金, 08  6月 2012) | 6 lines

Fix dart:io File.openInputStream input stream to cancel outstanding onData events when EOF reached.

BUG=
TEST=standalone/io/file_test

Review URL: https://chromiumcodereview.appspot.com//10543078
------------------------------------------------------------------------
r8422 | sgjesse@google.com | 2012-06-08 16:56:15 +0900 (金, 08  6月 2012) | 8 lines

Add method flush to output stream

R=ager@google.com

BUG=dart:1407
TEST=tests/standalone/src/io/FileOutputStreamTest.dart

Review URL: https://chromiumcodereview.appspot.com//9969202
------------------------------------------------------------------------
r8401 | whesse@google.com | 2012-06-08 01:43:41 +0900 (金, 08  6月 2012) | 8 lines

Change FileInputStream to only call onClosed callback when underlying file has been closed.  Change standalone/io/file_test to check this.

TBR=ricow@google.com

BUG=
TEST=standalone/io/file_test

Review URL: https://chromiumcodereview.appspot.com//10546051
------------------------------------------------------------------------
r8396 | whesse@google.com | 2012-06-07 23:23:16 +0900 (木, 07  6月 2012) | 6 lines

Remove erroneous assert from dart:io's File class.

BUG=
TEST=standalone/io/file_test.dart

Review URL: https://chromiumcodereview.appspot.com//10537053
------------------------------------------------------------------------
r8395 | whesse@google.com | 2012-06-07 22:44:31 +0900 (木, 07  6月 2012) | 6 lines

Add buffering to File.openInputStream, so that the entire file is not read in at once.

BUG=dart:3334
TEST=

Review URL: https://chromiumcodereview.appspot.com//10536029
------------------------------------------------------------------------
r8322 | fschneider@google.com | 2012-06-06 20:09:02 +0900 (水, 06  6月 2012) | 9 lines

Add flow graph printing into a .cfg file with flag --print-flow-graph-file.

This CL adds a flag --print-flow-graph-file which produces one
.cfg-file per isolate when enabled. Currently it prints the final
flow graph before code generation.

I also added SuccessorAt and SuccessorCount to allow easy iteration
over the successors of a basic block.
Review URL: https://chromiumcodereview.appspot.com//10446116
------------------------------------------------------------------------
r8321 | ajohnsen@google.com | 2012-06-06 19:46:30 +0900 (水, 06  6月 2012) | 8 lines

Close stdin in Process.run.

This fixes an open pipe issue.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10532024
------------------------------------------------------------------------
r8269 | hausner@google.com | 2012-06-05 07:27:50 +0900 (火, 05  6月 2012) | 6 lines

Fix handling of long JSON messages

Fix Debugger wire protocol for long messages.
Add a stress mode in the protocol handler to break messages
into small pieces.
Review URL: https://chromiumcodereview.appspot.com//10515015
------------------------------------------------------------------------
r8220 | hausner@google.com | 2012-06-02 09:07:12 +0900 (土, 02  6月 2012) | 4 lines

Add string encoding to wire protocol

Also, add command to retrieve the source text of a given script.
Review URL: https://chromiumcodereview.appspot.com//10496006
------------------------------------------------------------------------
r8175 | asiva@google.com | 2012-06-01 06:09:17 +0900 (金, 01  6月 2012) | 2 lines

1. Restructure some of the builtin library processing code.
Review URL: https://chromiumcodereview.appspot.com//10388242
------------------------------------------------------------------------
r8088 | ager@google.com | 2012-05-30 17:17:25 +0900 (水, 30  5月 2012) | 15 lines

Add test that passes invalid arguments to socket methods and fix
issues encountered.

The fuzzing is not as systematic as for some of the other
APIs. However, a lot of checking is going on in the Dart code so
forcing issues required a bit of work making objects act like lists
and integers.

Additionally, fix a memory leak in process implementation.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10441078
------------------------------------------------------------------------
r8075 | hausner@google.com | 2012-05-30 04:51:51 +0900 (水, 30  5月 2012) | 6 lines

Introduce library ids and info in the wire protocol

- Library hierarchy (imports, prefixes)
- Global (top-level) variables
- Removing breakpoints
Review URL: https://chromiumcodereview.appspot.com//10447045
------------------------------------------------------------------------
r8044 | sgjesse@google.com | 2012-05-29 18:31:32 +0900 (火, 29  5月 2012) | 12 lines

Small HTTP server fixes

Make empty responses use content length instead of chunked.
Make the default error handler indicate no content for HTTP 1.1 as well as HTTP 1.0.
Remove unneeded null check.

R=ager@google.com

BUG=none
TEST=HTTP tests

Review URL: https://chromiumcodereview.appspot.com//10454051
------------------------------------------------------------------------
r8033 | ajohnsen@google.com | 2012-05-29 16:26:03 +0900 (火, 29  5月 2012) | 6 lines

Mark the vm_tests as a RunTime score.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10446056
------------------------------------------------------------------------
r7995 | ager@google.com | 2012-05-25 22:10:03 +0900 (金, 25  5月 2012) | 12 lines

Process exit code handling reworked for Windows.

Simplify the code by relying on the builtin Windows thread pool
to wait for all process handles. The additional benefit is that
we can have an arbitrary number of processes and are not restricted
by the max number of handles for WaitForMultipleObjects.

R=sgjesse@google.com
BUG=dartbug:1450
TEST=standalone/io/process_many_test.dart

Review URL: https://chromiumcodereview.appspot.com//10440044
------------------------------------------------------------------------
r7994 | ager@google.com | 2012-05-25 22:02:47 +0900 (金, 25  5月 2012) | 8 lines

Use Dart_New to construct OSError objects instead of the static
method workaround.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10443029
------------------------------------------------------------------------
r7990 | sgjesse@google.com | 2012-05-25 20:57:02 +0900 (金, 25  5月 2012) | 13 lines

Implement a MIME multipart parser

Added a MIME multipart parser with tests.

The parser is currently not used but will be used to handle form
posts with content type multipart/form-data.

R=ager@google.com, ajohnsen@google.com

BUG=dart:2488
TEST=tests/standalone/io/mime_multipart_parser_test.dart

Review URL: https://chromiumcodereview.appspot.com//10441021
------------------------------------------------------------------------
r7986 | sgjesse@google.com | 2012-05-25 19:13:05 +0900 (金, 25  5月 2012) | 18 lines

Support using the HEAD request in the HTTP library

There was a number of issues in relation to using the HTTP method HEAD

* The HTTP parser did not parse HEAD correctly
* HEAD respoonse could not have a content length and empty body
* The client could not receive a HEAD response with content length an empty body

I the server we support writing to the output stream when replying to a head request.

They should now be fixed and a test for HEAD have been added

R=ager@google.com

BUG=dart:3205
TEST=tests/standalone/io/http_head_test.dart, tests/standalone/io/http_parser_test.dart

Review URL: https://chromiumcodereview.appspot.com//10449020
------------------------------------------------------------------------
r7945 | ager@google.com | 2012-05-24 22:10:02 +0900 (木, 24  5月 2012) | 7 lines

Implement File.lastModified.

R=sgjesse@google.com,ajohnsen@google.com
BUG=dartbug/2988
TEST=standalone/io/file*

Review URL: https://chromiumcodereview.appspot.com//10443008
------------------------------------------------------------------------
r7943 | sgjesse@google.com | 2012-05-24 22:03:31 +0900 (木, 24  5月 2012) | 25 lines

Support for cookies in the HTTP library

This change adds the list field cookies to all requests and
responses.

For HttpRequest the cookie list will have all the cookies set by
the client in its HttpClientRequest cookie list. These cookies
are passed through the "Cookie" HTTP header.

For HttpClientResponse the cookie list will have all the cookies
set by the server in the HttpResponse cookie list. These cookies
are passed through the "Set-Cookie" HTTP header.

The parsing of the "Cookie" and "Set-Cookie" headers try to
follow RFC 6265.

This change does not add a cookie jar in the http client with
cookie policy for automatic cookie handling.

R=ager@google.com, ajohnsen@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10414076
------------------------------------------------------------------------
r7917 | turnidge@google.com | 2012-05-24 03:32:51 +0900 (木, 24  5月 2012) | 4 lines

spawnUri.  Take two.  This time I'll wait for Anton before committing :-).

See original change 7756 for description.
Review URL: https://chromiumcodereview.appspot.com//10407042
------------------------------------------------------------------------
r7911 | floitsch@google.com | 2012-05-24 01:07:35 +0900 (木, 24  5月 2012) | 3 lines

Deprecate use of timezones.

Review URL: https://chromiumcodereview.appspot.com//10411057
------------------------------------------------------------------------
r7894 | ager@google.com | 2012-05-23 17:22:09 +0900 (水, 23  5月 2012) | 10 lines

Fuzzing of dart:io Directory API.

Uncovered one issue where an usupported value was posted back
through a native port on a failed directory listing operation.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10408060
------------------------------------------------------------------------
r7864 | hausner@google.com | 2012-05-23 03:06:34 +0900 (水, 23  5月 2012) | 2 lines

Introduce remote objects in Debugger protocol
Review URL: https://chromiumcodereview.appspot.com//10407071
------------------------------------------------------------------------
r7851 | sgjesse@google.com | 2012-05-22 21:53:35 +0900 (火, 22  5月 2012) | 20 lines

Add special handling of the content type HTTP header

This adds parsing of HTTP headers of the form:

  Name=value; parameter1=value1; parameter2=value2

Specialize the implemented header value class into a content type
class.

One could argue whether the "synchronization" between the string
representation and the content type object representation is the best
way, but if the exposed parameters map should just be the standard map
implementation there is no way of detection changes,

R=ager@google.com, ajohnsen@google.com

BUG=dart:2045
TEST=tests/standalone/io/http_test.dart, tests/standalone/io/http_headers_test.dart

Review URL: https://chromiumcodereview.appspot.com//10407002
------------------------------------------------------------------------
r7848 | ager@google.com | 2012-05-22 21:46:25 +0900 (火, 22  5月 2012) | 7 lines

Add support for directory renaming to dart:io.

R=sgjesse@google.com
BUG=dartbug:3104
TEST=standalone/io/directory*

Review URL: https://chromiumcodereview.appspot.com//10414046
------------------------------------------------------------------------
r7847 | sgjesse@google.com | 2012-05-22 20:56:38 +0900 (火, 22  5月 2012) | 10 lines

Make the Dart standalone VM run on Windows XP

Removed another use of inet_ntop.

R=ager@google.com

BUG=dart:3164
TEST=Most socket tests in tests/standalone/io

Review URL: https://chromiumcodereview.appspot.com//10411069
------------------------------------------------------------------------
r7844 | sgjesse@google.com | 2012-05-22 19:34:47 +0900 (火, 22  5月 2012) | 16 lines

Add support for websocket PING and PONG frames

The handling of control frames have been refactored to uniformly
hanlde CLOSE, PING and PONG frames.

Currently this is not tested as I have bot found a good way to test it
yet. It has been somewhat tested with a browser client forcing ping
messages from the server and processing the pong responses from the
browser.

R=ager@google.com, ajohnsen@google.com

BUG=none
TEST=none

Review URL: https://chromiumcodereview.appspot.com//10392195
------------------------------------------------------------------------
r7843 | ager@google.com | 2012-05-22 18:52:36 +0900 (火, 22  5月 2012) | 10 lines

Finish file 'fuzzer' and fix issues.

- One integer extraction issue.
- Changed to using nativeport.call().transform to make sure that exceptions during the processing of the reply are propagated to the future.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10411053
------------------------------------------------------------------------
r7797 | sgjesse@google.com | 2012-05-21 22:31:01 +0900 (月, 21  5月 2012) | 11 lines

Make standalone Dart VM run on Windows XP

Use the function WSAAddressToString for converting an IP address to a string
instead of inet_ntop. WSAAddressToString is available on Windows XP.

R=ager@google.com

BUG=dart:2559
TEST=tests\standalone\io\socket_info_test.dart

Review URL: https://chromiumcodereview.appspot.com//10409051
------------------------------------------------------------------------
r7792 | ager@google.com | 2012-05-21 20:00:05 +0900 (月, 21  5月 2012) | 9 lines

Remove reference to onError from file API docs.

onError was removed when transitioning to futures.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10387212
------------------------------------------------------------------------
r7790 | ager@google.com | 2012-05-21 19:52:01 +0900 (月, 21  5月 2012) | 16 lines

Reland: Add more API fuzzing and fix the issues encountered.

Only change from original code review is the closing of files
opened in the test.

- Fixed integer checks in a couple of places.
- Added closed checks to async operations.

More changes like this coming but I'm splitting the work up to not
make the review too large.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10414021
------------------------------------------------------------------------
r7758 | gram@google.com | 2012-05-19 03:39:18 +0900 (土, 19  5月 2012) | 4 lines

URI encoder/decoder - copied from other repo. This is the same code already reviewed but the other repo is not allowing me to commit so trying again.

See  Issue 10310080: Added uriEncode/uriEncodeComponent/uriDecode/uriDecodeComponent functions.
Review URL: https://chromiumcodereview.appspot.com//10399077
------------------------------------------------------------------------
r7757 | turnidge@google.com | 2012-05-19 03:35:04 +0900 (土, 19  5月 2012) | 2 lines

Revert my last change.
Review URL: https://chromiumcodereview.appspot.com//10332257
------------------------------------------------------------------------
r7756 | turnidge@google.com | 2012-05-19 03:22:10 +0900 (土, 19  5月 2012) | 43 lines

Implement spawnUri from dart:isolate.  This function allows us to
launch an isolate running a different script.  Finally.

Reviewers: This isn't as hard to review as it looks.  Dive right in!

Siggi: Take a look at my test status file changes and make sure I'm
excluding the right stuff.

Much of the churn in the CL comes from moving ownership of the
import_map.  It used to be set per-library and is now set per-isolate.
This caused a lot of superficial diffs.

DART EMBEDDING API CHANGES:

- Dart_IsolateCreateCallback now takes a script_uri and main argument
  instead of a name_prefix argument.  The script_uri argument allows
  the callback to launch different scripts.  The main argument is used
  in creating the isolate debug name.

- Dart_CreateIsolate now takes script_uri and main arguments.  These
  are used to build the isolate's debug name.

- Dart_LibraryTagHandler, Dart_LoadScript, and Dart_LoadLibrary no
  longer take an import_map.

- Added Dart_SetImportMap.

- Added Dart_RootLibrary to provide access to the root library for the
  current isolate.

OTHER STUFF

Add a couple of tests for spawnUri -- the existing tests assume that
scripts end in a .js suffix which isn't going to work out for us.

Changed how the debug name for isolates get built a bit.

Refactored bin/main.cc a bit.  Fixed some problems with error handling
while creating isolates.

Minor refactoring in builtin.dart to always pass is_windows rather
than relying on it being squirreled away.
Review URL: https://chromiumcodereview.appspot.com//10386107
------------------------------------------------------------------------
r7745 | hausner@google.com | 2012-05-19 00:33:05 +0900 (土, 19  5月 2012) | 6 lines

Fix tests in language suite: eliminate String +

The language suite runs clean without String + after this change.

string_concat_test.dart is obsolete, removed.
Review URL: https://chromiumcodereview.appspot.com//10383238
------------------------------------------------------------------------
r7684 | ager@google.com | 2012-05-16 22:02:48 +0900 (水, 16  5月 2012) | 11 lines

Revert "Add more API fuzzing and fix the issues encountered."

I know what is wrong but don't have the time to fix it right now.
I open a lot of files that are not closed and therefore the directory
cannot be deleted on Windows. Will fix ASAP.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10398053
------------------------------------------------------------------------
r7683 | ager@google.com | 2012-05-16 21:52:10 +0900 (水, 16  5月 2012) | 13 lines

Add more API fuzzing and fix the issues encountered.

- Fixed integer checks in a couple of places.
- Added closed checks to async operations.

More changes like this coming but I'm splitting the work up to not
make the review too large.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10382194
------------------------------------------------------------------------
r7678 | ajohnsen@google.com | 2012-05-16 17:43:08 +0900 (水, 16  5月 2012) | 6 lines

Correctly handle the case of a 126 bytes long message, in WebSocket frame encoding.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10388159
------------------------------------------------------------------------
r7655 | ager@google.com | 2012-05-15 23:33:17 +0900 (火, 15  5月 2012) | 11 lines

Fix directory listing to actually have the semantics intended.

The directory listing will continue on error (such as broken links)
and the boolean indication when listing is complete will signal
if all operations succeeded.

R=sgjesse@google.com
BUG=dartbug.com/3031
TEST=standalone/io/file_system_links_test.dart

Review URL: https://chromiumcodereview.appspot.com//10381150
------------------------------------------------------------------------
r7650 | ricow@google.com | 2012-05-15 20:48:10 +0900 (火, 15  5月 2012) | 2 lines

Update documentation on Process.close to explain issues with closing before reading out all content of stdout and stderr
Review URL: https://chromiumcodereview.appspot.com//10386140
------------------------------------------------------------------------
r7644 | sgjesse@google.com | 2012-05-15 17:57:21 +0900 (火, 15  5月 2012) | 13 lines

Re-apply "Fix URL decoding in HTTP library"

Now URL decoding works for non-ASCII URLs and will be UTF-8 decoded.

Added an additional import to lib/compiler/implementation/lib/io.dart
for the tests to compile with dart2js.

TBR=ager@google.com

BUG=dart:2902
TEST=tests/standalone/io/url_encoding_test.dart

Review URL: https://chromiumcodereview.appspot.com//10391135
------------------------------------------------------------------------
r7640 | sgjesse@google.com | 2012-05-15 16:55:44 +0900 (火, 15  5月 2012) | 8 lines

Remove the SHA1 implementation used by web sockets and use the dart:crypto library one instead.

R=ager@google.com

BUG=none
TEST=tests/standalone/io/web_socket_test.dart

Review URL: https://chromiumcodereview.appspot.com//10398010
------------------------------------------------------------------------
r7628 | hausner@google.com | 2012-05-15 06:10:25 +0900 (火, 15  5月 2012) | 11 lines

Debugger wire protocol: setting breakpoints

- Adding commands to set breakpoints and showing current stack trace.
- Adding a callback hook to signal when a breakpoint gets resolved to
  and actual line number. 
- Adding ids for breakpoints and new breakpoint API functions, deprecating
  the existing ones. 
- Adding one helper function to the JSON class

Anton may want to take a look at the JSON addition.
Review URL: https://chromiumcodereview.appspot.com//10383164
------------------------------------------------------------------------
r7613 | sgjesse@google.com | 2012-05-15 00:53:28 +0900 (火, 15  5月 2012) | 12 lines

Add a hash code to client and server web socket connections

The client web socket connection uses part of the nonce generated for
the challenge. The server web socket connection uses the hash code
from the socket.

R=ager@google.com

BUG=dart:3017
TEST=tests/standalone/io/web_socket_test.dart

Review URL: https://chromiumcodereview.appspot.com//10377124
------------------------------------------------------------------------
r7604 | ager@google.com | 2012-05-14 20:20:56 +0900 (月, 14  5月 2012) | 11 lines

Make the crypto library an official dart:crypto library.

The library now works on dart2js and on the VM.

Add the library to the API docs and to the sdk.

R=iposva@google.com,dgrove@google.com,kasperl@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10332109
------------------------------------------------------------------------
r7600 | sgjesse@google.com | 2012-05-14 19:26:12 +0900 (月, 14  5月 2012) | 10 lines

Revert "Fix URL decoding in HTTP library"

Issues with dart2js tests.

TBR=ager@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10382148
------------------------------------------------------------------------
r7599 | sgjesse@google.com | 2012-05-14 18:58:27 +0900 (月, 14  5月 2012) | 10 lines

Fix URL decoding in HTTP library

Now URL decoding works for non-ASCII URLs and will be UTF-8 decoded.

R=ager@google.com

BUG=dart:2902
TEST=tests/standalone/io/url_encoding_test.dart

Review URL: https://chromiumcodereview.appspot.com//10387082
------------------------------------------------------------------------
r7543 | ahe@google.com | 2012-05-11 22:40:03 +0900 (金, 11  5月 2012) | 3 lines

Split the URI library across multiple files.

Review URL: https://chromiumcodereview.appspot.com//10383103
------------------------------------------------------------------------
r7529 | ager@google.com | 2012-05-11 15:09:42 +0900 (金, 11  5月 2012) | 24 lines

Change dart:io to use Future for one-shot operations.

This appears to be what a lot of our users are doing and it is the
style used in our other libraries.

Noteworthy changes:

- File and Directory objects are now immutable.

- Directory.list returns an active lister object.

- Write operations on files return futures and the
  onNoPendingWrites handler is gone. The same
  functionality is there by using 'then' on the
  future returned from the last write operation.

- Process starting is now done with static methods:
  -- Process.start yields an InteractiveProcess.
  -- Process.run yields a Future<ProcessResult>

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10392023
------------------------------------------------------------------------
r7525 | hausner@google.com | 2012-05-11 08:28:14 +0900 (金, 11  5月 2012) | 4 lines

Eliminate need for va_copy in json.cc

The hacked version of va_copy did not work on Linux.
Review URL: https://chromiumcodereview.appspot.com//10383122
------------------------------------------------------------------------
r7518 | hausner@google.com | 2012-05-11 07:04:50 +0900 (金, 11  5月 2012) | 6 lines

Support more debugger commands in the wire protocol

Also add a very simple debugger shell which at this point
is meant to be a debugging help for the debugger code rather
than a user-friendly tool.
Review URL: https://chromiumcodereview.appspot.com//10392017
------------------------------------------------------------------------
r7511 | asiva@google.com | 2012-05-11 04:17:37 +0900 (金, 11  5月 2012) | 2 lines

Resubmit change 7506.
Review URL: https://chromiumcodereview.appspot.com//10387061
------------------------------------------------------------------------
r7508 | asiva@google.com | 2012-05-11 03:36:06 +0900 (金, 11  5月 2012) | 2 lines

Revert change 7506 to check on build failure.
Review URL: https://chromiumcodereview.appspot.com//10386073
------------------------------------------------------------------------
r7506 | asiva@google.com | 2012-05-11 03:25:47 +0900 (金, 11  5月 2012) | 8 lines

Fix issue 2888.

Allow for the library tag handler to be setup for the isolate, instead of
while loading a script. This ensures that we can use #import on the boot strap libraries like builtin, uri etc.

This change results in a dart API change and corresponding modifications are
necessary in dartium and App Engine.
Review URL: https://chromiumcodereview.appspot.com//10302020
------------------------------------------------------------------------
r7505 | iposva@google.com | 2012-05-11 03:16:46 +0900 (金, 11  5月 2012) | 2 lines

- Fix the no_snapshot build.
Review URL: https://chromiumcodereview.appspot.com//10389072
------------------------------------------------------------------------
r7448 | ajohnsen@google.com | 2012-05-09 19:55:42 +0900 (水, 09  5月 2012) | 8 lines

Correctly entirely close client connections, when closing http server.

Also remove duplicate call to _connectionEstablished.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10356069
------------------------------------------------------------------------
r7444 | sgjesse@google.com | 2012-05-09 19:18:24 +0900 (水, 09  5月 2012) | 8 lines

Add Exception to the class name for recently added exception classes

R=ager@google.com

BUG=none
TEST=none

Review URL: https://chromiumcodereview.appspot.com//10389017
------------------------------------------------------------------------
r7442 | sgjesse@google.com | 2012-05-09 18:06:28 +0900 (水, 09  5月 2012) | 8 lines

Avoid using chunked transfer encoding when the HTTP verision is 1.0.

R=ager@google.com

BUG=dart:2938
TEST=tests/standalone/io/http_content_length_test.dart

Review URL: https://chromiumcodereview.appspot.com//10386040
------------------------------------------------------------------------
r7441 | sgjesse@google.com | 2012-05-09 17:53:41 +0900 (水, 09  5月 2012) | 12 lines

Make the HTTP server close non-persistent connections

When closing the connection due to non-presistent connection make sure
that all data are sent to the receiver. For socket close due to errors
or idle timeout destroy the socket.

R=ager@google.com

BUG=dart:2918
TEST=tests/standalone/io/http_connection_close_test.dart

Review URL: https://chromiumcodereview.appspot.com//10356055
------------------------------------------------------------------------
r7440 | sgjesse@google.com | 2012-05-09 17:47:07 +0900 (水, 09  5月 2012) | 10 lines

Implemented W3C complient web socket client interface

Fixed a bug where onMessage events could happen before the onOpen event.

R=ager@google.com, ajohnsen@google.com, vsm@google.com, jacobr@google.com

BUG=dart:2001
TEST=tests/standalone/io/web_socket_test.dart

Review URL: https://chromiumcodereview.appspot.com//10383039
------------------------------------------------------------------------
r7415 | sgjesse@google.com | 2012-05-08 22:32:45 +0900 (火, 08  5月 2012) | 18 lines

Add redirect support to the HTTP client

Redirection is implemented by re-using the same HttpClientConnection
object for several request/response pairs. There is s redirect method
on the HttpClientConnection object for manual redirection. The
HttpClientConnection object also has properties followRedirects and
maxRedirects to configure automatic redirect handling.

When redirection happen the HttpClientConnection will collect the
redirection history for client einspection and for redirect loop
detection.

R=ajohnsen@google.com, ager@google.com

BUG=none
TEST=tests/standalone/io/http_redirect_test.dart

Review URL: https://chromiumcodereview.appspot.com//10386024
------------------------------------------------------------------------
r7408 | sgjesse@google.com | 2012-05-08 18:52:46 +0900 (火, 08  5月 2012) | 8 lines

Fix wrong type in HTTP library

R=ager@google.com

BUG=none
TEST=none

Review URL: https://chromiumcodereview.appspot.com//10375051
------------------------------------------------------------------------
r7402 | sgjesse@google.com | 2012-05-08 16:04:06 +0900 (火, 08  5月 2012) | 8 lines

Update HTTP server documentation

R=ajohnsen@google.com

BUG=dart:2934
TEST=none

Review URL: https://chromiumcodereview.appspot.com//10378046
------------------------------------------------------------------------
r7401 | ager@google.com | 2012-05-08 15:41:00 +0900 (火, 08  5月 2012) | 7 lines

Address review comments on Options.executable change.

R=iposva@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10388024
------------------------------------------------------------------------
r7386 | sgjesse@google.com | 2012-05-07 23:53:48 +0900 (月, 07  5月 2012) | 8 lines

Correct comment wording

TBR=ajohnsen@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10383042
------------------------------------------------------------------------
r7382 | ager@google.com | 2012-05-07 23:27:05 +0900 (月, 07  5月 2012) | 9 lines

Add executable to Options interface to get the name of the executable used to execute the script.

This is useful when you want to spawn separate dart processes. We do this from tests and we keep getting bitten by a broken search for the executable. Let's make it available instead.

R=sgjesse@google.com,iposva@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10380026
------------------------------------------------------------------------
r7377 | sgjesse@google.com | 2012-05-07 22:52:14 +0900 (月, 07  5月 2012) | 8 lines

Add enumeration of the HTTP headers

R=ajohnsen@google.com

BUG=dart:2045
TEST=tests/standalone/io/http_headers_test.dart

Review URL: https://chromiumcodereview.appspot.com//10386010
------------------------------------------------------------------------
r7371 | sgjesse@google.com | 2012-05-07 20:53:16 +0900 (月, 07  5月 2012) | 8 lines

Better checking and error reporting for HTTP client

R=ager@google.com

BUG=dart:2034
TEST=none

Review URL: https://chromiumcodereview.appspot.com//10315010
------------------------------------------------------------------------
r7365 | sgjesse@google.com | 2012-05-07 16:44:33 +0900 (月, 07  5月 2012) | 10 lines

Fix error reporting for socket write failure

It now includes the OS error in the thrown exception

R=ager@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10383037
------------------------------------------------------------------------
r7352 | cshapiro@google.com | 2012-05-05 08:16:09 +0900 (土, 05  5月 2012) | 5 lines

Revert "Revert "Implement {Int,Uint}{8,16,32,64} and Float{32,64} typed arrays.""

This reverts commit 63480a81fccbde001494dd535cd06a8fa02ed261.

Review URL: https://chromiumcodereview.appspot.com//10379018
------------------------------------------------------------------------
r7348 | hausner@google.com | 2012-05-05 06:24:16 +0900 (土, 05  5月 2012) | 2 lines

Eliminate busy waiting for debugger connection
Review URL: https://chromiumcodereview.appspot.com//10384016
------------------------------------------------------------------------
r7336 | hausner@google.com | 2012-05-05 01:09:56 +0900 (土, 05  5月 2012) | 2 lines

Now it's Linux fix time.
Review URL: https://chromiumcodereview.appspot.com//10380009
------------------------------------------------------------------------
r7335 | hausner@google.com | 2012-05-05 01:01:55 +0900 (土, 05  5月 2012) | 2 lines

Stop laughing!
Review URL: https://chromiumcodereview.appspot.com//10383008
------------------------------------------------------------------------
r7334 | hausner@google.com | 2012-05-05 00:56:01 +0900 (土, 05  5月 2012) | 4 lines

More windows fixes.

I wish we had a sandbox for test builds before we submit...
Review URL: https://chromiumcodereview.appspot.com//10332015
------------------------------------------------------------------------
r7333 | hausner@google.com | 2012-05-05 00:48:28 +0900 (土, 05  5月 2012) | 2 lines

And hopefully the last fix...
Review URL: https://chromiumcodereview.appspot.com//10381009
------------------------------------------------------------------------
r7332 | hausner@google.com | 2012-05-05 00:45:27 +0900 (土, 05  5月 2012) | 2 lines

More windows fixes.
Review URL: https://chromiumcodereview.appspot.com//10365015
------------------------------------------------------------------------
r7331 | hausner@google.com | 2012-05-05 00:37:11 +0900 (土, 05  5月 2012) | 2 lines

Try to fix windows build.
Review URL: https://chromiumcodereview.appspot.com//10332014
------------------------------------------------------------------------
r7330 | hausner@google.com | 2012-05-05 00:25:49 +0900 (土, 05  5月 2012) | 14 lines

Beginnings of a debugger wire protocol

The debugger wire handler is implemented similarly to the io event handler.
A dedicated thread monitors the debugger port for incoming connection
requests. When a debugger is connected, the VM sends events messages
over the wire and handles debugger requests.

To start the VM with a debugger connection, use the option
--debug:<portnumber>. The VM pauses at the beginning of main()
and waits for a debugger to connect.

Subsequent changes will implement debugger commands one by one.
With this change, the VM only understands "resume" commands. 
Review URL: https://chromiumcodereview.appspot.com//10357003
------------------------------------------------------------------------
r7282 | ager@google.com | 2012-05-03 22:16:33 +0900 (木, 03  5月 2012) | 7 lines

Change Platform members to getters instead of methods.

R=sgjesse@google.com
BUG=dartbug.com/1668
TEST=

Review URL: https://chromiumcodereview.appspot.com//10351011
------------------------------------------------------------------------
r7280 | sgjesse@google.com | 2012-05-03 22:02:59 +0900 (木, 03  5月 2012) | 13 lines

Fix bug in web socket close handling

Don't just close the socket when using the output stream for buffering
data - some data might not be sent.

This was causing the flakiness on Windows.

R=ager@google.com

BUG=dart:2867
TEST=tests/standalone/io/web_socket_test.dart

Review URL: https://chromiumcodereview.appspot.com//10316018
------------------------------------------------------------------------
r7273 | ager@google.com | 2012-05-03 20:48:19 +0900 (木, 03  5月 2012) | 7 lines

Fix inconsistent file error messages.

R=iposva@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10361003
------------------------------------------------------------------------
r7272 | sgjesse@google.com | 2012-05-03 19:58:06 +0900 (木, 03  5月 2012) | 15 lines

Implement onClosed on a socket output stream

onClosed on a socket output stream was never implemented.

Use this to correct the close handling of the web socket. Before it
was incorectly relying on no pending writes callback when closing the
connection which does not happen, so closing always happened throught
the timer.

R=ager@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10351009
------------------------------------------------------------------------
r7267 | sgjesse@google.com | 2012-05-03 16:08:32 +0900 (木, 03  5月 2012) | 11 lines

Improve the handling of the connection header

* The connection header can now have multiple values
* The persistent connection state can be controlled

R=ajohnsen@google.com

BUG=dart:1995
TEST=tests/standalone/io/http_connection_header_test.dart

Review URL: https://chromiumcodereview.appspot.com//10315002
------------------------------------------------------------------------
r7265 | asiva@google.com | 2012-05-03 10:01:47 +0900 (木, 03  5月 2012) | 2 lines

Canonicalize the reference_dir also when canonicalizing a path
Review URL: https://chromiumcodereview.appspot.com//10344010
------------------------------------------------------------------------
r7261 | cshapiro@google.com | 2012-05-03 07:48:02 +0900 (木, 03  5月 2012) | 5 lines

Fix two semantic errors from my previous check-in.

TBR=asiva

Review URL: https://chromiumcodereview.appspot.com//10343010
------------------------------------------------------------------------
r7260 | cshapiro@google.com | 2012-05-03 07:40:48 +0900 (木, 03  5月 2012) | 14 lines

Do not externalize Dart strings as C strings for "print()".

Dart strings with embedded '\0' characters cannot be faithfully
represented as a C string.

This change adds Dart_StringToBytes to the Dart API.  This function
converts a Dart string to array of UTF-8 code units and returns a
length.  Builtin::PrintString now calls Dart_StringToBytes instead of
Dart_StringToCString and, for I/O, fwrite is called instead of fprintf
with the string format specifier.

BUG=1098

Review URL: https://chromiumcodereview.appspot.com//10306002
------------------------------------------------------------------------
r7240 | sgjesse@google.com | 2012-05-02 23:59:17 +0900 (水, 02  5月 2012) | 10 lines

Revert socket output stream changes

Also mark web_socket_test as flaky on Windows

R=ager@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10317007
------------------------------------------------------------------------
r7228 | ager@google.com | 2012-05-02 20:39:21 +0900 (水, 02  5月 2012) | 7 lines

Deal with symbolic links for file and directories on Mac and Linux.

R=sgjesse@google.com
BUG=dartbug.com/2516
TEST=

Review URL: https://chromiumcodereview.appspot.com//10309004
------------------------------------------------------------------------
r7224 | sgjesse@google.com | 2012-05-02 19:30:38 +0900 (水, 02  5月 2012) | 25 lines

Add a web socket client

The web socket client is a implemented as a class which is
created from from a HTTP client connection. This way it is
independent from the HTTP client and is just using the HTTP
client.

The protocol handling is mainly re-using the code from the web
socket server.

Change the handling of setting an onNoPendingWrites handler on a
socket output stream. Now setting a new onNoPendingWrites handler
will trigger a callback when there is no pending data to be
written.

Add socket detaching to the HTTP client as well. Add the ability
to get any unparsed data read from the socket for processing
after the protocol upgrade.

R=ager@google.com, ajohnsen@google.com, vsm@google.com, jacobr@google.com

BUG=dart:2001
TEST=tests/standalone/io/web_socket_test.dart

Review URL: https://chromiumcodereview.appspot.com//10262031
------------------------------------------------------------------------
r7208 | asiva@google.com | 2012-05-02 07:15:26 +0900 (水, 02  5月 2012) | 2 lines

Set up a variable so that the compiler script can be imported using an import map.
Review URL: https://chromiumcodereview.appspot.com//10280003
------------------------------------------------------------------------
r7179 | ager@google.com | 2012-05-01 15:32:17 +0900 (火, 01  5月 2012) | 6 lines

Fix type assertion error in dart:io File library.

R=sgjesse@google.com
BUG=dartbug.com/2776

Review URL: https://chromiumcodereview.appspot.com//10265023
------------------------------------------------------------------------
r7175 | asiva@google.com | 2012-05-01 10:00:04 +0900 (火, 01  5月 2012) | 3 lines

Added lib/compiler compile all VM benchmark.
Added frame lookup VM benchmark.
Review URL: https://chromiumcodereview.appspot.com//10178030
------------------------------------------------------------------------
r7155 | ager@google.com | 2012-04-30 22:40:10 +0900 (月, 30  4月 2012) | 7 lines

Add the name of the file to exceptions on failed file operations.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10270012
------------------------------------------------------------------------
r7092 | mattsh@google.com | 2012-04-28 02:23:00 +0900 (土, 28  4月 2012) | 6 lines

added package_root flag to vm

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10134015
------------------------------------------------------------------------
r7075 | ager@google.com | 2012-04-27 21:01:17 +0900 (金, 27  4月 2012) | 8 lines

Make sure that errors are thrown when there is no error handler
on a FileInputStream.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10206023
------------------------------------------------------------------------
r7066 | ager@google.com | 2012-04-27 20:07:01 +0900 (金, 27  4月 2012) | 8 lines

Fix invalid pointer arithmetic in Linux and MacOS event handler
implementations.

R=sgjesse@google.com
BUG=dartbug.com/2759
TEST=

Review URL: https://chromiumcodereview.appspot.com//10243003
------------------------------------------------------------------------
r7063 | ager@google.com | 2012-04-27 18:30:49 +0900 (金, 27  4月 2012) | 13 lines

Add websocket files to dummy io.dart implementation for dart2js.

Apparently this file is also used for generating API documentation
now. We need to move away from that and generate the API documentation
from the io_runtime.dart file in the SDK. The dummy implementation
file is not automatically updated and therefore this will keep
breaking.

R=ahe@google.com,rnystrom@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10254001
------------------------------------------------------------------------
r7062 | ajohnsen@google.com | 2012-04-27 18:22:22 +0900 (金, 27  4月 2012) | 10 lines

Fix WebSocket header construction for large frames.

The spec uses 8 bytes for length if it's larger then 65535. This was
only done when appending data to the header, not when setting the header
size.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10255002
------------------------------------------------------------------------
r7010 | sgjesse@google.com | 2012-04-26 20:43:32 +0900 (木, 26  4月 2012) | 20 lines

Check the state of the HTTP request and response when handling headers

The HTTP headers object in request and response objects is now marked
as non-mutable when it cannot be changed. An exception will be thrown
if trying to mutate headers when they are not mutable.

Postponed the sending of the headers until either the first byte of
body data is sent or the empty body is indicated. This is to allow
getting the output stream object and still be able to set headers
until the actual body is touched.

Added checking of the number of bytes of body data transmitted when an
explicit content length is specified.

R=ajohnsen@google.com

BUG=none
TEST=tests/standalone/src/io/HttpHeadersState.dart,tests/standalone/src/io/HttpContentLengthTest.dart

Review URL: https://chromiumcodereview.appspot.com//10232006
------------------------------------------------------------------------
r7008 | sgjesse@google.com | 2012-04-26 20:12:07 +0900 (木, 26  4月 2012) | 13 lines

Add web socket protocol processor test

Unit test of the web socket protocol processor. This test includes
testing splitting a message into several frames.

Fixed the bugs found by adding a test.

R=ager@google.com, ajohnsen@google.com

BUG=dart:2001
TEST=tests/standalone/src/io/WebSocketProtocolProcessorTest.dart

Review URL: https://chromiumcodereview.appspot.com//10173021
------------------------------------------------------------------------
r6998 | sgjesse@google.com | 2012-04-26 19:15:30 +0900 (木, 26  4月 2012) | 44 lines

Initial web socket server implementation

This implements the web socket protocol as a request handler for
the HTTP server. The HTTP server have been updated with the
ability of getting the socket when a HTTP upgrade request is
processed. This way the web socket implementation is not builtin
to the HTTP server.

The API on the server is:

interface WebSocketConnection {
  void set onMessage(void callback(Object message));
  void set onClosed(void callback(int status, String reason));
  void set onError(void callback(e));

  send(Object message);
  close([int status, String reason]);
}

This API currently does not have any streaming but collects the
entire message before invoking the onMessage callback. The
current browser web socket API
(http://dev.w3.org/html5/websockets/) works the same way. The
underlying web socket protocol can have unbounded messages so
long term this probably have to change. But for now the only
likely client for a web socket server is a browser.

Currently this is missing tests. The implementation has been
tested by running the WebSocketTest.dart script and connecting
using a browser. This testing have been done using Chrome 19 and
Firefox 11.

I will be adding tests in separate change lists.

The SHA-1 and base 64 code (initially written by
ajohnsen@google.com) can be removed when these algorithms is
available in the dart:crypto.

R=ager@google.com, ajohnsen@google.com, vsm@google.com, jacobr@google.com

BUG=dart:2001
TEST=none

Review URL: https://chromiumcodereview.appspot.com//10205012
------------------------------------------------------------------------
r6995 | ager@google.com | 2012-04-26 17:56:27 +0900 (木, 26  4月 2012) | 10 lines

Fix exception throwing in connection with process starting.

For the run constructor, verify the arguments before starting the
underlying process.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10202014
------------------------------------------------------------------------
r6994 | sgjesse@google.com | 2012-04-26 17:12:17 +0900 (木, 26  4月 2012) | 22 lines

Change the error handling in dart:io

1. Change the argument on all onError handlers from Exception to
Dynamic

2. Throw an exception if an error ocours and there is no error handler
present for handling it.

For sockets there is the complication that an error on a socket is
reported to the socket error handler, and each of the stream error
handlers. The solution to this is to throw an exception if there was
no error handler on either the socket or one of the streams.

Fixed a number of bugs in tests revealed by errors no longer being
silently ignored.

R=ager@google.com

BUG=none
TEST=tests/standalone/src/io/*

Review URL: https://chromiumcodereview.appspot.com//10173024
------------------------------------------------------------------------
r6939 | sgjesse@google.com | 2012-04-25 22:27:14 +0900 (水, 25  4月 2012) | 15 lines

Remove the RequestHandler interface from the HTTP library

Having the RequestHandler interface did no add anything, so it has
been removed. The HTTP server function addRequestHandler and setter
defaultRequestHandler now just takes function.

To use an instance of a class with a request handler member function
the Dart auto closurerization works fine.

R=ajohnsen@google.com, ager@google.com

BUG=none
TEST=tests/standalone/src/io/HttpServerHandlerTest.dart

Review URL: https://chromiumcodereview.appspot.com//10226002
------------------------------------------------------------------------
r6930 | sgjesse@google.com | 2012-04-25 18:16:37 +0900 (水, 25  4月 2012) | 8 lines

Add handling of the HTTP Date header

R=ajohnsen@google.com

BUG=none
TEST=none

Review URL: https://chromiumcodereview.appspot.com//10191013
------------------------------------------------------------------------
r6869 | ajohnsen@google.com | 2012-04-24 15:35:08 +0900 (火, 24  4月 2012) | 6 lines

Unregister callbacks from socket, when we return the socket for reuse.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10164001
------------------------------------------------------------------------
r6827 | ager@google.com | 2012-04-23 16:54:10 +0900 (月, 23  4月 2012) | 11 lines

Support passing an environment variable map to child processes.

Fix minor type warning in test.

Reapplication after MacOS bug fix.

R=sgjesse@google.com
BUG=dartbug.com/2193
TEST=

Review URL: https://chromiumcodereview.appspot.com//10166029
------------------------------------------------------------------------
r6820 | asiva@google.com | 2012-04-21 10:36:23 +0900 (土, 21  4月 2012) | 6 lines

Add infrastructure to create and run benchmarks specific to some VM functionality. This is used to measure performance of specific VM functionality (similar to VM unit tests testing specific VM functionality)

run_vm_tests --benchmarks to run all benchmarks
 or
run_vm_tests CorelibCompileAll
Review URL: https://chromiumcodereview.appspot.com//10069039
------------------------------------------------------------------------
r6795 | ager@google.com | 2012-04-20 21:53:19 +0900 (金, 20  4月 2012) | 9 lines

Revert "Support passing an environment variable map to child processes."

Apparently the code or the test is broken on Mac.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10163004
------------------------------------------------------------------------
r6794 | ager@google.com | 2012-04-20 21:38:57 +0900 (金, 20  4月 2012) | 9 lines

Support passing an environment variable map to child processes.

Fix minor type warning in test.

R=sgjesse@google.com
BUG=dartbug.com/2193
TEST=

Review URL: https://chromiumcodereview.appspot.com//10127008
------------------------------------------------------------------------
r6769 | turnidge@google.com | 2012-04-20 06:04:15 +0900 (金, 20  4月 2012) | 9 lines

Remove the deprecated method invocation and field access apis from the
dart embbedding api.  Use the new apis instead.

Fixed a bug where field/function lookup was failing for imported libs.
Added tests.  Had to add a couple of lookup functions to Library.

Fixed a bug in Dart_Invoke -- it wasn't handling a null receiver
correctly.
Review URL: https://chromiumcodereview.appspot.com//10021072
------------------------------------------------------------------------
r6754 | regis@google.com | 2012-04-20 02:01:28 +0900 (金, 20  4月 2012) | 6 lines

Throw a type error in production mode when the type of the type test is not
declared (issue 2571).
Add test.
Delete bad negative test now covered by new test.
Update status files of different compilers.
Review URL: https://chromiumcodereview.appspot.com//10035058
------------------------------------------------------------------------
r6731 | sgjesse@google.com | 2012-04-19 18:17:14 +0900 (木, 19  4月 2012) | 8 lines

Fix a number of editor errors and warnings in io tests

R=ager@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10035056
------------------------------------------------------------------------
r6698 | hausner@google.com | 2012-04-19 01:09:22 +0900 (木, 19  4月 2012) | 23 lines

Static members are not visible in subclasses

Fix for issue 1598.

Lexical scope comes before inherited names. Also, Static members
are not inherited and are not visible in subclasses.
Code in the subclass (or any other code for that matter) has to
qualify the names of these members with the class name.

We had a few tests that were wrong and only passed in the VM because
this was not implemented correctly.

Also had to fix code in frog and dartdoc.

I hope I ran enough tests. I built an all.deps tree using tools/build.py from the root directory, which brought up the frog and dartdoc issues.

Tested:
tools/test.py --compiler=dart2js --runtime=drt
tools/test.py -c none -r drt
tools/test.py -c frog -r drt
tools/test.py -r vm

Review URL: https://chromiumcodereview.appspot.com//10115005
------------------------------------------------------------------------
r6683 | sgjesse@google.com | 2012-04-18 22:03:43 +0900 (水, 18  4月 2012) | 23 lines

Add HTTP handler registration to the HTTP server

NOTE: This is a breaking change.

The onRequest callback on the HTTP server have been removed in favor
of the ability to register handlers. A handler can be either a
function or an instance of a class which implements a specific
interface. Each handler registration has a regular expression which is
matched against the request path.

There is also a default handler which can be set to handle all
requests which is not matched by any of the registered patterns. If
there is no default handler explicitly set there is a builtin one
which will just return 404 status.

Currently the method is not considered in the matching.

R=ager@google.com, ajohnsen@google.com

BUG=none
TEST=tests/standalone/src/io/HttpServerHandlerTest.dart

Review URL: https://chromiumcodereview.appspot.com//10119005
------------------------------------------------------------------------
r6682 | ager@google.com | 2012-04-18 20:39:16 +0900 (水, 18  4月 2012) | 10 lines

Remove need to instantiate Platform and make methods static.

This will require an update of the stable test binary. I will upload
a new build when done with the review process.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10021048
------------------------------------------------------------------------
r6680 | iposva@google.com | 2012-04-18 20:00:33 +0900 (水, 18  4月 2012) | 2 lines

- Update the style of switch statement.
Review URL: https://chromiumcodereview.appspot.com//10083042
------------------------------------------------------------------------
r6674 | whesse@google.com | 2012-04-18 18:58:01 +0900 (水, 18  4月 2012) | 6 lines

Refactor URI processing of native extensions directive #import("dart-ext:foo").

BUG=
TEST=standalone/io/TestExtensionsTest

Review URL: https://chromiumcodereview.appspot.com//10103031
------------------------------------------------------------------------
r6669 | sgjesse@google.com | 2012-04-18 15:44:58 +0900 (水, 18  4月 2012) | 10 lines

Add test of the HTTP headers object

Fixed a number of bugs revealed by actually testing.

R=ajohnsen@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9956175
------------------------------------------------------------------------
r6646 | ager@google.com | 2012-04-18 01:20:28 +0900 (水, 18  4月 2012) | 19 lines

Add read-only environment variable access.

Map<String, String> env = new Platform().environment();

Unfortunately, this is a bit hard to test at this point. I
will move on to implement support for providing an environment
to processes that are started. At that point we can test it
properly.

Another follow-up change will be to remove the instantiation
for Platform. I would like this to be just

Map<String, String> env = Platform.environment();

R=sgjesse@google.com
BUG=dartbug.com/752
TEST=

Review URL: https://chromiumcodereview.appspot.com//10112002
------------------------------------------------------------------------
r6626 | ahe@google.com | 2012-04-17 20:53:56 +0900 (火, 17  4月 2012) | 3 lines

Move cygwin_dir to shared gypi file.

Review URL: https://chromiumcodereview.appspot.com//9877003
------------------------------------------------------------------------
r6615 | sgjesse@google.com | 2012-04-17 16:37:47 +0900 (火, 17  4月 2012) | 8 lines

Add missing properties on HttpHeader

R=ajohnsen@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10109002
------------------------------------------------------------------------
r6567 | sgjesse@google.com | 2012-04-16 21:18:45 +0900 (月, 16  4月 2012) | 13 lines

Start refactoring of the HTTP header handling

This change moves the headers into a separate object.

There will be follow-up changes for handling whether the headers are
read-only or mutable. Also additional tests will be added later.

R=ajohnsen@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10082003
------------------------------------------------------------------------
r6564 | ager@google.com | 2012-04-16 20:32:03 +0900 (月, 16  4月 2012) | 12 lines

Make it an error to call close twice on a file using the async API.

This is to make it consistent with the sync API.

Additionally, fix situations where a non-exception was passed to
error handlers on File objects.

R=sgjesse@google.com
BUG=dartbug.com/2451
TEST=standalone/io/File*

Review URL: https://chromiumcodereview.appspot.com//10095009
------------------------------------------------------------------------
r6509 | sgjesse@google.com | 2012-04-13 19:58:58 +0900 (金, 13  4月 2012) | 24 lines

Add HTTP/1.0 support and simplify persistent connections handling

The HTTP parser now recognized both HTTP/1.1 and HTTP/1.0 in
request and response headers. The only difference between the
handling of HTTP 1.1 and HTTP 1.0 is in the decection of
persistent connections. For HTTP 1.1 persistent connections are
the default and for HTTP 1.0 persistent connections are speficified
throught the "Connection: Keep-Alive" header.

Removed the getters and setters for keepAlive from all the
interfaces. They are not of much use and persistent connection
handling should be transparent. The HTTP client currently always
sends requests using HTTP 1.1 and in the reare cases where one wants the
connection to be closed after the request adding the
header "Connection: close" should work.

With this change using wget to get resources from the chat server.

R=ajohnsen@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10008083
------------------------------------------------------------------------
r6502 | ager@google.com | 2012-04-13 18:21:54 +0900 (金, 13  4月 2012) | 9 lines

Fix Process test, fix Process factory, diable tests on dart2js.

Florian and I will investigate the dart2js failures.

R=sgjesse@google.com,floitsch@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10069053
------------------------------------------------------------------------
r6499 | ager@google.com | 2012-04-13 17:53:35 +0900 (金, 13  4月 2012) | 16 lines

This is a request for comments.

First attempt at implementing a higher-level API for processes.
Add a startNonInteractive constructor that takes a callback which
is called with the exit code and the complete stdout and stderr
when the process terminates.

Let me know what you think. This obviously needs at least tests.
Not entirely sure what I think about the interface in the first
place.

R=sgjesse@google.com
BUG=1689
TEST=

Review URL: https://chromiumcodereview.appspot.com//9863015
------------------------------------------------------------------------
r6464 | sgjesse@google.com | 2012-04-12 23:31:47 +0900 (木, 12  4月 2012) | 10 lines

Add basic handling to connection upgrade to the HTTP parser

See description in runtime/bin/http_parser.dart on how the upgrade works.

R=ajohnsen@google.com

BUG=dart:2002
TEST=tests/standalone/src/io/HttpParserTest.dart

Review URL: https://chromiumcodereview.appspot.com//10068013
------------------------------------------------------------------------
r6459 | ager@google.com | 2012-04-12 20:47:32 +0900 (木, 12  4月 2012) | 10 lines

Support length operation without opening file.

Use fstat instead of multiple seek calls to get length of
opened files.

R=sgjesse@google.com
BUG=dartbug.com/1592
TEST=standalone/io/File*Test

Review URL: https://chromiumcodereview.appspot.com//10065013
------------------------------------------------------------------------
r6455 | ajohnsen@google.com | 2012-04-12 18:30:49 +0900 (木, 12  4月 2012) | 6 lines

Close socket, and not non-existing outputStream. Fixes crash in HttpServer.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10008075
------------------------------------------------------------------------
r6454 | ajohnsen@google.com | 2012-04-12 15:41:58 +0900 (木, 12  4月 2012) | 8 lines

Mark as closing, when we close the connection manually.

Succeeding calls to write* would have failed without this.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10008072
------------------------------------------------------------------------
r6435 | rnystrom@google.com | 2012-04-12 05:27:57 +0900 (木, 12  4月 2012) | 3 lines

Fix merge bug.

Review URL: https://chromiumcodereview.appspot.com//10020049
------------------------------------------------------------------------
r6431 | rnystrom@google.com | 2012-04-12 05:14:08 +0900 (木, 12  4月 2012) | 3 lines

Fix "package:" stuff on Windows and skip tests on dart2js since it doesn't support it yet.

Review URL: https://chromiumcodereview.appspot.com//10052021
------------------------------------------------------------------------
r6428 | rnystrom@google.com | 2012-04-12 04:40:51 +0900 (木, 12  4月 2012) | 3 lines

Add support for importing using "package:" to the standalone VM.

Review URL: https://chromiumcodereview.appspot.com//10034001
------------------------------------------------------------------------
r6409 | ajohnsen@google.com | 2012-04-11 21:27:55 +0900 (水, 11  4月 2012) | 6 lines

Add member localHostname() to the Dart IO Platform class.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10050011
------------------------------------------------------------------------
r6400 | ager@google.com | 2012-04-11 18:27:53 +0900 (水, 11  4月 2012) | 9 lines

Remove check whether async has been used from File objects.

It makes it hard to use libraries and doesn't really help.

R=sgjesse@google.com
BUG=dartbug.com/2426
TEST=

Review URL: https://chromiumcodereview.appspot.com//10054005
------------------------------------------------------------------------
r6399 | ajohnsen@google.com | 2012-04-11 17:43:34 +0900 (水, 11  4月 2012) | 6 lines

Socket.available should never return a negative value.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10052007
------------------------------------------------------------------------
r6398 | sgjesse@google.com | 2012-04-11 16:10:49 +0900 (水, 11  4月 2012) | 8 lines

Address additional comments from http://codereview.chromium.org/9956062/

R=ajohnsen@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10050007
------------------------------------------------------------------------
r6397 | sgjesse@google.com | 2012-04-11 16:09:45 +0900 (水, 11  4月 2012) | 8 lines

Fix bug in HTTP header parsing

R=ajohnsen@google.com

BUG=dart:2370
TEST=tests/standalone/src/io/HttpParserTest.dart

Review URL: https://chromiumcodereview.appspot.com//10033023
------------------------------------------------------------------------
r6390 | asiva@google.com | 2012-04-11 08:29:02 +0900 (水, 11  4月 2012) | 3 lines

Fix win32 Socket test errors
SocketInfoTest and SocketPortTest are failing on windows.
Review URL: https://chromiumcodereview.appspot.com//10014037
------------------------------------------------------------------------
r6363 | ricow@google.com | 2012-04-11 00:47:59 +0900 (水, 11  4月 2012) | 2 lines

Speculative fix for the windows compilation failure.
Review URL: https://chromiumcodereview.appspot.com//10032030
------------------------------------------------------------------------
r6355 | sgjesse@google.com | 2012-04-10 21:54:54 +0900 (火, 10  4月 2012) | 14 lines

Refactor the close and error handling of HTTP connections

* Unify the handling of connection close and connection error.
* The HttpConnection and HttpClientConnection now have separate
  close/error handling
* The HTTP parser gets the connection close indication as it might
  signal end of body for responses with no other length indication

R=ajohnsen@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9956062
------------------------------------------------------------------------
r6354 | ajohnsen@google.com | 2012-04-10 21:24:04 +0900 (火, 10  4月 2012) | 6 lines

Fix signature of GetRemotePeer declaration.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9999022
------------------------------------------------------------------------
r6353 | ajohnsen@google.com | 2012-04-10 21:18:12 +0900 (火, 10  4月 2012) | 9 lines

Add remoteHost to Socket.

This is merging the native calls into one, GetRemotePeer, thus
eliminating a potentiel extra call to getpeername.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10032027
------------------------------------------------------------------------
r6352 | ajohnsen@google.com | 2012-04-10 21:09:47 +0900 (火, 10  4月 2012) | 6 lines

Actually close socket, on eviction timeout.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//10037003
------------------------------------------------------------------------
r6090 | ajohnsen@google.com | 2012-04-02 22:54:03 +0900 (月, 02  4月 2012) | 2 lines

Add remotePort getter to Socket.
Review URL: https://chromiumcodereview.appspot.com//9963053
------------------------------------------------------------------------
r6089 | sgjesse@google.com | 2012-04-02 22:51:36 +0900 (月, 02  4月 2012) | 19 lines

Discard HTTP data written after a socket error

If any type of HTTP connection encounters an error writing additional
data is an error. However in many cases getting exceptions from writes
in this situation is inconvenient.

With this change any data written will be silently discarded after an
error have occoured. The onError will always be called and the user of
the library have the ability to stop generating output data as soon as
possible.

Currently this is default behaviour with no option for changing it.

R=ajohnsen@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9958059
------------------------------------------------------------------------
r6082 | ajohnsen@google.com | 2012-04-02 17:24:37 +0900 (月, 02  4月 2012) | 2 lines

Add a new attachTo method to HttpServer, for using an existing ServerSocket.
Review URL: https://chromiumcodereview.appspot.com//9965053
------------------------------------------------------------------------
r5954 | ager@google.com | 2012-03-29 06:57:58 +0900 (木, 29  3月 2012) | 9 lines

Remove unused thread pool from standalone VM binary.

We are using the thread pool in the VM via native ports.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9875006
------------------------------------------------------------------------
r5923 | asiva@google.com | 2012-03-28 11:32:22 +0900 (水, 28  3月 2012) | 6 lines

Fix build break when compiling with gcc 4.6:

../runtime/bin/file.cc: In function 'void Builtin_File_Flush(Dart_NativeArguments)':
../runtime/bin/file.cc:356:12: error: variable 'return_value' set but not used [-Werror=unused-but-set-variable]
cc1plus: all warnings being treated as errors
Review URL: https://chromiumcodereview.appspot.com//9837102
------------------------------------------------------------------------
r5921 | iposva@google.com | 2012-03-28 10:21:04 +0900 (水, 28  3月 2012) | 2 lines

- Make the URI resolution methods used by the tag handler private.
Review URL: https://chromiumcodereview.appspot.com//9845040
------------------------------------------------------------------------
r5904 | ager@google.com | 2012-03-28 05:28:19 +0900 (水, 28  3月 2012) | 9 lines

Fix typo that has crept into string input stream.

Add regression test.

R=sgjesse@google.com
BUG=dartbug.com/2322
TEST=standalone/io/StringStreamTest.dart

Review URL: https://chromiumcodereview.appspot.com//9864051
------------------------------------------------------------------------
r5881 | ager@google.com | 2012-03-28 00:31:00 +0900 (水, 28  3月 2012) | 13 lines

Make the temporary OSError allocation method private.

GetField, SetField, Invoke can now be called with a library target
and with private names. Using that we can make this temporary
utility function private as it should be.

Work is under way to support instance creation through the API.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9773037
------------------------------------------------------------------------
r5871 | sgjesse@google.com | 2012-03-27 20:51:28 +0900 (火, 27  3月 2012) | 8 lines

Avoid double reporting of errors to HTTPServer onError callback

R=ajohnsen@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9863035
------------------------------------------------------------------------
r5869 | ajohnsen@google.com | 2012-03-27 19:56:43 +0900 (火, 27  3月 2012) | 2 lines

Don't propagate http client error, when no response object is available.
Review URL: https://chromiumcodereview.appspot.com//9863031
------------------------------------------------------------------------
r5866 | sgjesse@google.com | 2012-03-27 17:50:35 +0900 (火, 27  3月 2012) | 18 lines

Add error handling to directory

The directory object now has error handling like the rest of the
dart:io. The added tests to some extend overlaps with some of the
tests in DirectpryTest.dart, but I found it better to have error tests
in a single place.

I removed a few type checks sitting in the C++ code for the native
functions as for file we currently don't have them. I have opened
issue 2305 regarding where to do type checks for dart:io native
functions.

R=ager@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9773018
------------------------------------------------------------------------
r5812 | sgjesse@google.com | 2012-03-26 14:54:49 +0900 (月, 26  3月 2012) | 21 lines

Add error handling to random access file

Now all both sync and async methods on File and RandomAccessFile
should have correct error handling.

Changed readByte and readByteSync to return -1 instead of
reporting an error when end of file is reached. It seems to make
the most sense.

The amount of boiler-plate code in both the native functions and
native port functions in file.cc is growing. Maybe we should
consider some refactoring, e.g. with a table of the expected
argument types for each native port functions together with known
position of the FILE* argument.

R=ager@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9839053
------------------------------------------------------------------------
r5797 | ager@google.com | 2012-03-24 07:39:27 +0900 (土, 24  3月 2012) | 13 lines

Treat EAGAIN/EWOULDBLOCK as requests for retry on socket accept.

On Linux there are a number of protocol errors that can be
returned from accept. According to the linux man pages they
should be treated as EAGAIN.

This should hopefully fix the flakiness of EchoServerStreamTest.

R=iposva@google.com,sgjesse@google.com
BUG=2262
TEST=

Review URL: https://chromiumcodereview.appspot.com//9837060
------------------------------------------------------------------------
r5770 | sgjesse@google.com | 2012-03-23 18:16:58 +0900 (金, 23  3月 2012) | 11 lines

Fix another syntax error in the HTTP library discovered by dart2js

Clearly I did not test errors on streams from HttpRequest and
HttpResponse - only from HttpClinetRequest and HttpClientResponse.

TBR=ager@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9839044
------------------------------------------------------------------------
r5769 | sgjesse@google.com | 2012-03-23 17:33:09 +0900 (金, 23  3月 2012) | 8 lines

Fix HTTP library issues reported by dart2js

TBR=ager@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9834043
------------------------------------------------------------------------
r5768 | sgjesse@google.com | 2012-03-23 17:00:27 +0900 (金, 23  3月 2012) | 24 lines

Add error handling to the HTTP library

The socket errors and HTTP parser errors are now handled by the
HTTP library and propagated to the related onError callback.

For HttpClient there is no onError on the HttpClient object
itself. Errors on active connections (including connection
errors) are reported on the HttpClientConnection. Errors on
connections sitting in the keep alive pool are handled by just
closing the connection and removing it from the pool. Errors on
the HttpClientConnection are also reported through the onError
callbacks on any active streams.

I am not particulair happy of the way errors are propagated to
the active streams but that can be refactored later.

Added more checks and tests to the HTTP parser.

R=ager@google.com, ajohnsen@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9834008
------------------------------------------------------------------------
r5722 | sgjesse@google.com | 2012-03-22 00:41:39 +0900 (木, 22  3月 2012) | 17 lines

Change the message body handling in the HTTP parser

The message content detection and handling should now be more
correct and according to the specification (RFC 2616 section 4.3).

* Requests with no Content-Length and no Transfer-Encoding have no message body
* Responses with status code 1xx, 204 and 304 have no message body
* Responses which are responses to HEAD requests have no message body

Also added support for detecting chunk-extensions and ignoring these.

R=ajohnsen@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9812005
------------------------------------------------------------------------
r5717 | sgjesse@google.com | 2012-03-21 23:40:15 +0900 (水, 21  3月 2012) | 19 lines

Add error handling to socket streams

Change the streams onError callbacks to get an Exception argument on
all streams.

Added actual error handling to the socket streams.

As it is difficult to determine where an error should be reported I
decided to call all the registered onError callbacks, that is on the
socket itself and on both input and output stream.

Did some additional cleanup of the naming of OnError argument in some tests.

R=ager@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9812007
------------------------------------------------------------------------
r5711 | sgjesse@google.com | 2012-03-21 19:37:50 +0900 (水, 21  3月 2012) | 10 lines

Fix checked mode errors

Remove return types from functions which can now return objects of different types.

TBR=ngeoffray@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9816005
------------------------------------------------------------------------
r5709 | sgjesse@google.com | 2012-03-21 18:39:47 +0900 (水, 21  3月 2012) | 21 lines

Extend dart:io error handling to all socket functions

There are currently no tests of the error handling, as it is hard to
create consistent tests. I have done some manual tests locally:

* Lowering the number of file descriptors available (ulimit -n) and hitting that limit
* Running two dart programs communicating and terminating one (using Ctrl-C)
* Running two dart programs communicating on two machines and pulling out the network cable.

If there is an error we always call the onError callback and never the onClosed callback.

On Windows there is the issue that both closing the connection correctly and terminating one end gives the same error (ERROR_NETNAME_DELETED) so both are reported as connection close. Pulling out the network cable gives a different (real) error on Windows though.

On Mac OS it turned out the for kqueue EV_EOF is also used to indicate errors with the error code set in the fflags field. EV_ERROR is only reported if there is an internal error in  kevent processing (see http://developer.apple.com/library/mac/#documentation/Darwin/Reference/ManPages/man2/kqueue.2.html).

R=ager@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9720045
------------------------------------------------------------------------
r5686 | ager@google.com | 2012-03-21 00:24:14 +0900 (水, 21  3月 2012) | 8 lines

Add additional error printing to kqueue failures on Mac.

This is an attempt to get more information on dartbug.com/1876

R=ricow@google.com
BUG=1876

Review URL: https://chromiumcodereview.appspot.com//9705096
------------------------------------------------------------------------
r5641 | sgjesse@google.com | 2012-03-19 20:36:32 +0900 (月, 19  3月 2012) | 13 lines

Support parsing HTTP responses where the body length is not known

The HTTP parser ends the body when the connection is closed.

This only implements this in the HTTP parser - it is not yet used in
the dart:io HTTP library.

R=ajohnsen@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9704009
------------------------------------------------------------------------
r5640 | sgjesse@google.com | 2012-03-19 20:26:41 +0900 (月, 19  3月 2012) | 19 lines

Start better error reporting for sockets

Changed the onError callback for sockets to take an exception argument.

First area to report errors for is name resolution.

Changed the IP address resolution from being synchronous with the
creation of the socket to being asynchronous thsough a lookup
service running on a native port. Currently this lookup service
is static on the socket class as we need to call it from a
factory method. We should probably add a separate name lookup
service at some point.

R=ager@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9699017
------------------------------------------------------------------------
r5597 | iposva@google.com | 2012-03-17 07:19:23 +0900 (土, 17  3月 2012) | 6 lines

Reapply part of r5325.

- Fix use of String operator + in IO libraries.

Previously reviewed as part of https://chromiumcodereview.appspot.com/9690003
Review URL: https://chromiumcodereview.appspot.com//9725001
------------------------------------------------------------------------
r5524 | whesse@google.com | 2012-03-16 00:49:57 +0900 (金, 16  3月 2012) | 6 lines

Change lookup path for Dart native extensions shared libraries.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9694045
------------------------------------------------------------------------
r5522 | ager@google.com | 2012-03-16 00:33:06 +0900 (金, 16  3月 2012) | 8 lines

Change quoting in Process implementation on Windows.

Only quote command and arguments if they contain a space or a tab.
This seems consistent with the way it is handled in other systems.

R=antonm@google.com,sgjesse@google.com

Review URL: https://chromiumcodereview.appspot.com//9701061
------------------------------------------------------------------------
r5514 | whesse@google.com | 2012-03-15 18:34:51 +0900 (木, 15  3月 2012) | 6 lines

Fix some minor static type issues in dart:io implementation.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9703023
------------------------------------------------------------------------
r5472 | ager@google.com | 2012-03-15 01:50:16 +0900 (木, 15  3月 2012) | 14 lines

Wrap all arguments passed to processes in "" on Windows.

I'm not 100% sure that this is what we want. I'll dig into
what other systems are doing tomorrow.

This could make the test scripts work on Windows for Dartium.

Updated windows test binary as well.

R=antonm@google.com,sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9699032
------------------------------------------------------------------------
r5452 | ajohnsen@google.com | 2012-03-14 20:24:50 +0900 (水, 14  3月 2012) | 2 lines

Close connections on server.close(), and call onError on early connection close.
Review URL: https://chromiumcodereview.appspot.com//9700012
------------------------------------------------------------------------
r5400 | sgjesse@google.com | 2012-03-13 22:24:17 +0900 (火, 13  3月 2012) | 10 lines

Fix missing member initialization on Mac OS

TBR=ager@google.com

Fix Mac OS build\n\nTBR=ager@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9694037
------------------------------------------------------------------------
r5397 | sgjesse@google.com | 2012-03-13 22:09:24 +0900 (火, 13  3月 2012) | 8 lines

Fix Mac OS build

TBR=ager@google.com

BUG=none
TEST=none

Review URL: https://chromiumcodereview.appspot.com//9692045
------------------------------------------------------------------------
r5396 | sgjesse@google.com | 2012-03-13 22:00:47 +0900 (火, 13  3月 2012) | 12 lines

Error reporting on File in dart:io

This implements consistent error reporting on all methods on File in dart:io. The async onError method is called with an exception argument which is the same exception as would have been thrown from the corresponding sync method.

The one method on Directory which already did this has been updated as well.

R=ager@google.com

BUG=none
TEST=tests/standalone/src/io/FileTest.dart, tests/standalone/src/io/FileInvalidArgumentsTest.dart

Review URL: https://chromiumcodereview.appspot.com//9630012
------------------------------------------------------------------------
r5368 | sigmund@google.com | 2012-03-13 07:52:36 +0900 (火, 13  3月 2012) | 6 lines

SendPort + ReceivePort changes:
- document what are valid messages in SendPort.send
- change SendPort.call to return a future of the reply
- remove ReceivePort.singleShot

Review URL: https://chromiumcodereview.appspot.com//9652001
------------------------------------------------------------------------
r5333 | iposva@google.com | 2012-03-13 01:31:12 +0900 (火, 13  3月 2012) | 3 lines

- Fix build by rolling back r5324, r5325.


------------------------------------------------------------------------
r5325 | iposva@google.com | 2012-03-13 00:26:55 +0900 (火, 13  3月 2012) | 2 lines

- Fix use of String operator + in corelib and standalone libraries.
Review URL: https://chromiumcodereview.appspot.com//9690003
------------------------------------------------------------------------
r5266 | iposva@google.com | 2012-03-10 08:12:03 +0900 (土, 10  3月 2012) | 2 lines

- Fix trailing white space.
Review URL: https://chromiumcodereview.appspot.com//9668033
------------------------------------------------------------------------
r5243 | regis@google.com | 2012-03-10 03:14:02 +0900 (土, 10  3月 2012) | 5 lines

Fix type checks that wrongly ignored malformed types.
Fix corresponding test.
Fix comment in gypi file.
Fix undeclared type in stream_util.dart.
Review URL: https://chromiumcodereview.appspot.com//9649010
------------------------------------------------------------------------
r5238 | iposva@google.com | 2012-03-10 01:45:57 +0900 (土, 10  3月 2012) | 4 lines

- The dart:io library uses Uri from dart:uri.
- Fix the library tag handler to proper import libraries
  when generating snapshots.
Review URL: https://chromiumcodereview.appspot.com//9655015
------------------------------------------------------------------------
r5235 | whesse@google.com | 2012-03-09 23:34:57 +0900 (金, 09  3月 2012) | 6 lines

Add native extensions for the Dart shell to the Windows platform and the Mac OS X platform.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9465004
------------------------------------------------------------------------
r5234 | sgjesse@google.com | 2012-03-09 23:02:58 +0900 (金, 09  3月 2012) | 8 lines

Prevent creation of additional FileMode and Encoding objects

R=ager@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9662002
------------------------------------------------------------------------
r5231 | sgjesse@google.com | 2012-03-09 22:49:20 +0900 (金, 09  3月 2012) | 21 lines

Add writeString method to OutputStream

All output streams now supports writeString which takes the encoding
to be used when transforming the string into a sequence of bytes.

This change also introduces an Encoding interface and Encodings class
as a repository for the supported encodings. Currently this is only
UTF-8, ISO-8859-1 and ASCII. All methods in dart:io which previously
used a String to represent the encoding now uses objects implementing
Encoding.

In this change dart:io is still using the internal UTF-8 encoder used
by the HTTP implementation. I will look into using the one in dart:utf
in a separate change.

R=ager@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9653026
------------------------------------------------------------------------
r5198 | turnidge@google.com | 2012-03-09 08:10:24 +0900 (金, 09  3月 2012) | 2 lines

Spot fix for linux-only source file.  Cross fingers.
Review URL: https://chromiumcodereview.appspot.com//9651010
------------------------------------------------------------------------
r5197 | turnidge@google.com | 2012-03-09 08:06:44 +0900 (金, 09  3月 2012) | 2 lines

Start using Dart_PropagateError in the runtime/bin directory.
Review URL: https://chromiumcodereview.appspot.com//9657001
------------------------------------------------------------------------
r5195 | iposva@google.com | 2012-03-09 07:25:29 +0900 (金, 09  3月 2012) | 2 lines

- Fix the dart_no_snapshot binary.
Review URL: https://chromiumcodereview.appspot.com//9639018
------------------------------------------------------------------------
r5185 | turnidge@google.com | 2012-03-09 03:36:56 +0900 (金, 09  3月 2012) | 2 lines

Start using Dart_SetField and Dart_GetField in the vm.
Review URL: https://chromiumcodereview.appspot.com//9642003
------------------------------------------------------------------------
r5169 | dgrove@google.com | 2012-03-08 22:28:40 +0900 (木, 08  3月 2012) | 4 lines

Unify most of our utf8 implementations. This takes the implementation
from utils/string_encoding and moves it to utils/utf . utils/utf8
goes away.
Review URL: https://chromiumcodereview.appspot.com//9462001
------------------------------------------------------------------------
r5153 | sgjesse@google.com | 2012-03-08 17:44:59 +0900 (木, 08  3月 2012) | 11 lines

Add support for using an URL for establishing HTTP connections

As the URI library is now part of the standalone VM it makes sense to
have the option of using a URL for opening a HTTP connection

R=ager@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9625008
------------------------------------------------------------------------
r5145 | iposva@google.com | 2012-03-08 09:53:56 +0900 (木, 08  3月 2012) | 2 lines

- Pass Dart_Null() instead of an empty array for unused import maps.
Review URL: https://chromiumcodereview.appspot.com//9630004
------------------------------------------------------------------------
r5143 | iposva@google.com | 2012-03-08 09:19:39 +0900 (木, 08  3月 2012) | 1 line

- Win: Disable logging output during script URI resolution.
------------------------------------------------------------------------
r5141 | iposva@google.com | 2012-03-08 09:08:21 +0900 (木, 08  3月 2012) | 1 line

- Win: Remove leading / from file path.
------------------------------------------------------------------------
r5140 | iposva@google.com | 2012-03-08 09:02:17 +0900 (木, 08  3月 2012) | 2 lines

- D:\rive\letters
Review URL: https://chromiumcodereview.appspot.com//9608028
------------------------------------------------------------------------
r5138 | iposva@google.com | 2012-03-08 08:18:16 +0900 (木, 08  3月 2012) | 1 line

- Fix build: unused vars.
------------------------------------------------------------------------
r5135 | iposva@google.com | 2012-03-08 07:57:57 +0900 (木, 08  3月 2012) | 2 lines

- Proper URI resolution when loading scripts from the standalone binary.
Review URL: https://chromiumcodereview.appspot.com//9614006
------------------------------------------------------------------------
r5097 | sgjesse@google.com | 2012-03-08 00:18:50 +0900 (木, 08  3月 2012) | 14 lines

Fix hostname lookup on Windows

The previous implementation was broken and did not use the result retreived from
gethostbyname. Changed the implementation to use getaddrinfo as gethostbyname has
been deprecated in the Winsock2 library.

Added a test to test that something can be read from www.google.com.

R=ager@google.com

BUG=none
TEST=tests/standalone/src/io/HttpClientTest.dart

Review URL: https://chromiumcodereview.appspot.com//9624005
------------------------------------------------------------------------
r5087 | sgjesse@google.com | 2012-03-07 22:23:08 +0900 (水, 07  3月 2012) | 12 lines

Add the ability to get the current directory

Added constructor current to directory. Use like this:

var cwd = Directory.current()

R=ager@google.com

BUG=dart:1793
TEST=tests/standalone/src/io/DirectoryTest.dart

Review URL: https://chromiumcodereview.appspot.com//9622001
------------------------------------------------------------------------
r5056 | rice@google.com | 2012-03-07 06:36:07 +0900 (水, 07  3月 2012) | 3 lines

Allow std{in,out,err} to be a socket

Review URL: http://chromiumcodereview.appspot.com/9617012
------------------------------------------------------------------------
r5044 | antonm@google.com | 2012-03-07 04:00:08 +0900 (水, 07  3月 2012) | 3 lines

Force non-Unicode build in all configurations.

Review URL: https://chromiumcodereview.appspot.com//9618018
------------------------------------------------------------------------
r5021 | sgjesse@google.com | 2012-03-06 21:42:30 +0900 (火, 06  3月 2012) | 12 lines

Add method available to StringInputStream

The StringInputStream did not have any way for checking the number of
available characters. Added method available like on a binary
InputStream.

R=ager@google.com

BUG=dart:1945
TEST=tests/standalone/src/io/StringStreamTest.dart

Review URL: https://chromiumcodereview.appspot.com//9546003
------------------------------------------------------------------------
r5016 | sgjesse@google.com | 2012-03-06 20:24:11 +0900 (火, 06  3月 2012) | 14 lines

Add handling of HTTP header "Expires"

The value of the "Expires" header is now available as a property on
the HttpResponse and the HttpClientResponse.

Added formatting of dates as HTTP dates in RFC 1123 format and parsing
of HTTP dates in all three formats mentioned in RFC 2616.

R=ajohnsen@google.com

BUG=none
TEST=tests/standalone/src/io/HttpDateTest.dart

Review URL: https://chromiumcodereview.appspot.com//9602011
------------------------------------------------------------------------
r5015 | sgjesse@google.com | 2012-03-06 19:59:28 +0900 (火, 06  3月 2012) | 8 lines

Add handling of the HTTP header "Host"

R=ajohnsen@google.com

BUG=none
TEST=tests/standalone/src/io/HttpTest.dart

Review URL: https://chromiumcodereview.appspot.com//9616004
------------------------------------------------------------------------
r4955 | antonm@google.com | 2012-03-06 00:11:51 +0900 (火, 06  3月 2012) | 5 lines

Force not-Unicode version of libdart_builtin.

Current implementation of file/process/etc. assumes it anyway.

Review URL: https://chromiumcodereview.appspot.com//9600017
------------------------------------------------------------------------
r4945 | ager@google.com | 2012-03-05 21:43:41 +0900 (月, 05  3月 2012) | 19 lines

Update Timer API to take the callback as the last parameter.

This makes the code easier to read when the callback actually does
work:

  new Timer(1000, (t) {
    // do
    // lots
    // of
    // stuff
  });

Also, it is more consistent with the rest of the APIs.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9597015
------------------------------------------------------------------------
r4934 | sgjesse@google.com | 2012-03-05 17:04:04 +0900 (月, 05  3月 2012) | 10 lines

Make the HttpParser and HttpUtil classes private

Move to separate files for sourcing these in the tests.

R=ager@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9581011
------------------------------------------------------------------------
r4932 | sgjesse@google.com | 2012-03-05 16:06:37 +0900 (月, 05  3月 2012) | 17 lines

Handle closing of HTTP client and server

For the server keep track of the state of the connection and close the
socket when it is closed by the client. The client might close the
connection both when processing a request and while the connection is
an idle keep alive connection.

For the client keep track of the active connections as well as the
idle keep alive connections. When the client is closed make sure to
close all connections.

R=ajohnsen@google.com

BUG=none
TEST=tests/standalone/src/io/HttpShutdownTest.dart

Review URL: https://chromiumcodereview.appspot.com//9589001
------------------------------------------------------------------------
r4854 | sgjesse@google.com | 2012-03-02 16:29:20 +0900 (金, 02  3月 2012) | 10 lines

Use a pool of native ports for file operations

See description on https://chromiumcodereview.appspot.com/9568010/

R=ager@google.com

BUG=none
TEST=tests/standalone/src/ManyFileOperationsTest.dart

Review URL: https://chromiumcodereview.appspot.com//9569010
------------------------------------------------------------------------
r4795 | sgjesse@google.com | 2012-03-01 23:29:12 +0900 (木, 01  3月 2012) | 23 lines

Use a pool of native ports for directory operations

Each directory object creates a new service port which will start a
new thread. As these service ports are currently never closed this is
a huge problem causing the standalone VM to fail when running out of
threads.

This change uses a pool of native ports for directory operations. This
still ensures that the operations for each directory object are
serialized and limits the number of native ports allocated and thus
threads started.

Even when closing of native ports is possible we might want to keep
some kind of pool like this. The reason for this is that to actually
determine when the native port is not needed any more we need a
finalizer callback on the directory object.

R=ager@google.com

BUG=none
TEST=tests/standalone/src/ManyDirectoryOperationsTest.dart

Review URL: https://chromiumcodereview.appspot.com//9568010
------------------------------------------------------------------------
r4793 | sgjesse@google.com | 2012-03-01 21:32:52 +0900 (木, 01  3月 2012) | 10 lines

Missing handling of default arguments in socket stream readInto

Also made it a bit easier to write a socket connection test.

R=ager@google.com

BUG=dart:1925
TEST=tests/standalone/src/Regress-1925.dart

Review URL: https://chromiumcodereview.appspot.com//9568006
------------------------------------------------------------------------
r4790 | ager@google.com | 2012-03-01 19:07:35 +0900 (木, 01  3月 2012) | 7 lines

Reapply dart:io API changes.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9568004
------------------------------------------------------------------------
r4785 | ager@google.com | 2012-03-01 18:43:15 +0900 (木, 01  3月 2012) | 10 lines

Revert "Rename blahHandler to onBlah throughout dart:io."

D'oh! I need to update the test binaries as well. Reverting, building
and putting back in again.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9570004
------------------------------------------------------------------------
r4784 | ager@google.com | 2012-03-01 18:36:04 +0900 (木, 01  3月 2012) | 12 lines

Rename blahHandler to onBlah throughout dart:io.

Additionally, change all single-shot methods to take their callback as an argument instead of registering it on the object.

I have attempted to find all uses in the repo but there might
be some firefighting to do when this lands.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9500002
------------------------------------------------------------------------
r4754 | ager@google.com | 2012-03-01 00:42:19 +0900 (木, 01  3月 2012) | 10 lines

Fix close callback on FileInputStreams.

Not waiting for the underlying file to actually close before
setting streamMarkedClosed can lead to too early close callbacks.

R=sgjesse@google.com
BUG=dart:1922
TEST=standalone/FileTest.dart

Review URL: https://chromiumcodereview.appspot.com//9540009
------------------------------------------------------------------------
r4750 | sgjesse@google.com | 2012-02-29 21:59:44 +0900 (水, 29  2月 2012) | 10 lines

Add statusCode and reasonPhrase getters and setters to the HttpResponse interface

These where missing in the interface.

R=ager@google.com

BUG=dart:1919
TEST=tests/standalone/src/HttpTest.dart

Review URL: https://chromiumcodereview.appspot.com//9500014
------------------------------------------------------------------------
r4717 | asiva@google.com | 2012-02-29 03:36:39 +0900 (水, 29  2月 2012) | 3 lines

Changes to get rid of dependency on openssl in the dart VM.
(This will enable dartium to be built on the windows platform).
Review URL: https://chromiumcodereview.appspot.com//9481019
------------------------------------------------------------------------
r4692 | sgjesse@google.com | 2012-02-29 00:11:34 +0900 (水, 29  2月 2012) | 12 lines

Include HTTP library in the standalone VM

HTTP support is part of library dart:io.

The current interface is defined in runtime/bin/http.dart

R=ager@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9488008
------------------------------------------------------------------------
r4679 | sgjesse@google.com | 2012-02-28 22:04:04 +0900 (火, 28  2月 2012) | 38 lines

Prepare the HTTP library for inclusion in the standalone VM (step 2)

Change the handling of the received data on HTTPRequest and
HTTPClientResponse to use the InputStream interface instead of
dataReceived and dataEnd handlers.

We should probably do something to make the following serer side and
client side patterns simpler:

void handler(HTTPRequest request, HTTPResponse response) {
  ...
  StringBuffer body = new StringBuffer();
  StringInputStream input = new StringInputStream(request.inputStream);
  input.dataHandler = () => body.add(input.read());
  input.closeHandler = () {
    String data = body.toString();
    ...
  }
}

HTTPClientConnection conn = ...
  conn.responseHandler = (HTTPClientResponse r) {
  ...
  StringBuffer body = new StringBuffer();
  StringInputStream input = new StringInputStream(request.inputStream);
  input.dataHandler = () => body.add(input.read());
  input.closeHandler = () {
    String data = body.toString();
    ...
  }
}

R=ager@google.com,ajohnsen@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9495007
------------------------------------------------------------------------
r4677 | ager@google.com | 2012-02-28 21:28:42 +0900 (火, 28  2月 2012) | 7 lines

Move back to having File.open{Input,Output}Stream return the stream directly.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9487005
------------------------------------------------------------------------
r4672 | whesse@google.com | 2012-02-28 20:09:41 +0900 (火, 28  2月 2012) | 6 lines

Fix type warnings in dart:io library.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9494004
------------------------------------------------------------------------
r4663 | ager@google.com | 2012-02-28 17:51:07 +0900 (火, 28  2月 2012) | 7 lines

Fix type warning.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9487003
------------------------------------------------------------------------
r4662 | ager@google.com | 2012-02-28 17:38:25 +0900 (火, 28  2月 2012) | 13 lines

Make FileInputStream and FileOutputStream actually asynchronous.

Use the async API of the underlying file.

This also means that openInputStream and openOutputStream can
directly return the stream without performing IO. I'll do that
change as a follow-up.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9474004
------------------------------------------------------------------------
r4647 | sigmund@google.com | 2012-02-28 07:50:44 +0900 (火, 28  2月 2012) | 36 lines

isolates refactor: this change introduces 'dart:isolate' as a library. This is a
big global change, so let me explain in more detail. This refactoring CL does
the following:
- moves all the dart code for isolates in a common library (lib/isolate)

- changes frog to understand 'dart:isolate' imoprts by loading the code from the
  location above.

- changes the vm to undernstand 'dart:isolate' imports by creating a separate
  library that is part of the bootstrap. This follows the same code-structure
  that Todd suggested in his CL introducing the mirror library

- changes dartc to use the shared isolate library as the source of truth for
  type checking. I left around some of the internal js code in dartc so that the
  backend continues to work for apps that don't use isolates.

- changes all tests that use isolates to import the library explicitly (this is a large bulk of the files in this CL)

- changes test status for tests we can't fix in this repo (e.g. co19)

- splits the isolate library code to make it possible to preserve some tests
  without exposing internal types (e.g. tests about
  serialization/deserialization)

- changes the create_sdk script to copy the isolate library to the sdk

- includes the isolate library in dartdoc

I'll wait for at least one lgtm from each area (dartc, vm, frog, sdk)

There is one important pending thing this CL doesn't do:
- update test_runner.dart: This should be updated next time we upload the new
  binaries to tool/testing/bin
- dartium specific changes: Vijay, is there anything I need to do for dartium?

Review URL: https://chromiumcodereview.appspot.com//9422019
------------------------------------------------------------------------
r4568 | ager@google.com | 2012-02-24 22:31:38 +0900 (金, 24  2月 2012) | 10 lines

Implement File.{readAsBytes, readAsText, readAsLines}.

Convenience methods to use if all you care about is getting the
entire contents of a file.

R=sgjesse@google.com
BUG=1579
TEST=standalone/FileTest

Review URL: https://chromiumcodereview.appspot.com//9452014
------------------------------------------------------------------------
r4536 | whesse@google.com | 2012-02-23 23:52:40 +0900 (木, 23  2月 2012) | 6 lines

Use correct format for gyp file when adding -ldl linker flag.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9452013
------------------------------------------------------------------------
r4532 | whesse@google.com | 2012-02-23 23:25:52 +0900 (木, 23  2月 2012) | 6 lines

Add -ldl linker flag to libdart_builtin link step.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9447018
------------------------------------------------------------------------
r4530 | whesse@google.com | 2012-02-23 22:46:36 +0900 (木, 23  2月 2012) | 6 lines

Add -ldl linker flag to Dart shell extensions test shared library link.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9442016
------------------------------------------------------------------------
r4529 | whesse@google.com | 2012-02-23 22:25:11 +0900 (木, 23  2月 2012) | 6 lines

Add native extensions to the Dart shell, on the linux platform.

BUG=
TEST=standalone/TestExtensionTest

Review URL: https://chromiumcodereview.appspot.com//9430051
------------------------------------------------------------------------
r4521 | sgjesse@google.com | 2012-02-23 20:13:35 +0900 (木, 23  2月 2012) | 11 lines

Fix bug in Directory after porting to using native ports

The full path was no longer provided to the directory handler

R=ager@google.com

TEST=tests/standalone/src/DirectoryTest.dart

BUG=

Review URL: https://chromiumcodereview.appspot.com//9452009
------------------------------------------------------------------------
r4520 | sgjesse@google.com | 2012-02-23 20:11:48 +0900 (木, 23  2月 2012) | 5 lines

Port async file operations to be using native ports instead or an isolate

R=ager@google.com

Review URL: https://chromiumcodereview.appspot.com//9415043
------------------------------------------------------------------------
r4464 | ager@google.com | 2012-02-23 01:18:39 +0900 (木, 23  2月 2012) | 7 lines

Implement File.directory() and File.directorySync() to get
containing directory for a file.

BUG=dart:1618
TEST=standalone/FileTest

Review URL: https://chromiumcodereview.appspot.com//9416096
------------------------------------------------------------------------
r4452 | sgjesse@google.com | 2012-02-22 23:11:04 +0900 (水, 22  2月 2012) | 24 lines

Add both sync and async methods for getting streams for a File

The File class used to have two synchronous methods
openInputStream and openOutputStream for getting streams for a
file. These have now been changed to work asynchronously by the
associated callback inputStreamHandler or outputStreamHandler
when the stream is opened and available.

To support the synchronous API two new methods
openInputStreamSync and openOutputStreamSync which returns the
stream directly as before have been added.

The actual implemnetation of the file streams still uses the
synchronous file API internally. However this change
adds "simulated" handling of noPendingWriteHandler and
closeHandler for file output stream.

R=ager@google.com

BUG=dart:1784

TEST=

Review URL: https://chromiumcodereview.appspot.com//9432023
------------------------------------------------------------------------
r4416 | iposva@google.com | 2012-02-22 09:36:14 +0900 (水, 22  2月 2012) | 2 lines

- Windows only: Move the BN library link dependency into the standalone binaries.
Review URL: https://chromiumcodereview.appspot.com//9433021
------------------------------------------------------------------------
r4391 | sgjesse@google.com | 2012-02-21 22:29:52 +0900 (火, 21  2月 2012) | 10 lines

Fix bug from r4390 on Windows

The file handler did not pass the full path.

R=ager@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9428002
------------------------------------------------------------------------
r4390 | sgjesse@google.com | 2012-02-21 20:35:42 +0900 (火, 21  2月 2012) | 8 lines

Run all directory async operations on a separate thread using native ports

R=ager@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9310082
------------------------------------------------------------------------
r4388 | sgjesse@google.com | 2012-02-21 17:59:41 +0900 (火, 21  2月 2012) | 12 lines

Add utility functions for creating and accessing Dart_CObject structures

All allocation is done using Dart_ScopeAllocate, so no explicit feeing
is required. This also means that these utilities require an active
ApiZone.

R=ager@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9403012
------------------------------------------------------------------------
r4387 | ager@google.com | 2012-02-21 16:22:20 +0900 (火, 21  2月 2012) | 7 lines

Disallow opening of directories as files.

R=sgjesse@google.com
BUG=1614
TEST=tests/standalone/src/FileTest.dart

Review URL: https://chromiumcodereview.appspot.com//9427014
------------------------------------------------------------------------
r4336 | iposva@google.com | 2012-02-17 04:59:19 +0900 (金, 17  2月 2012) | 3 lines

- Add dart:json, dart:uri and dart:utf8 to the known and builtin libraries.
- Unify and simplify the building of the creation of the source file.
Review URL: https://chromiumcodereview.appspot.com//9417012
------------------------------------------------------------------------
r4281 | turnidge@google.com | 2012-02-16 04:25:22 +0900 (木, 16  2月 2012) | 2 lines

Revert my last change.  Windows dislikes long strings...
Review URL: https://chromiumcodereview.appspot.com//9407017
------------------------------------------------------------------------
r4280 | turnidge@google.com | 2012-02-16 04:14:03 +0900 (木, 16  2月 2012) | 36 lines

Make gen files more human-readable by using a string initializer
instead of an integer array initializer.

For example, the initializer in builtin_gen.cc now looks something like this:

const char Builtin::builtin_source_[] =
 
  // ----- bin/builtin.dart -----

  "// Copyright (c) 2011, the Dart project authors.  Please see the AUTHORS file\n"
  "// for details. All rights reserved. Use of this source code is governed by a\n"
  "// BSD-style license that can be found in the LICENSE file.\n"
  "\n"
  "#library(\"builtin\");\n"
  "#import(\"dart:nativewrappers\");\n"
  "#import(\"dart:coreimpl\");\n"
  "\n"
  "void print(arg) {\n"
  "  _Logger._printString(arg.toString());\n" /* L10 */
  "}\n"
  "\n"
  "void exit(int status) {\n"
  "  if (status is !int) {\n"
  "    throw new IllegalArgumentException(\"int status expected\");\n"
  "  }\n"
  "  _exit(status);\n"
  "}\n"
  "\n"
  "_exit(int status) native \"Exit\";\n" /* L20 */
  "\n"
  "class _Logger {\n"
  "  static void _printString(String s) native \"Logger_PrintString\";\n"
  "}\n"

;
Review URL: https://chromiumcodereview.appspot.com//9348112
------------------------------------------------------------------------
r4226 | sgjesse@google.com | 2012-02-15 00:20:27 +0900 (水, 15  2月 2012) | 27 lines

Handle stdio redirection in standalone VM

The recent change to epoll on Linux and kqueue on Mac OS for getting
notifications from file descriptors caused the redirection of stdin,
stdout and stderr for the stand alone VM to stop working.

On Linux epoll failed when file descriptor 0, 1 or 2 redirected from
or to a file war registered. On Mac OS there was just no events
generated from kqueue.

The streams created for stdio, stdout and stderr is now of the correct
type and for file redirections no longer a socket object holding a
file descriptor for a regular file.

Added testing of stdio redirection using both pipes and files. These
tests are currently skipped on Windows.

Fixed handlin of short socket read when reading the process exit code.

Always close the socket port when not waiting for any events.

R=iposva@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9360040
------------------------------------------------------------------------
r4199 | asiva@google.com | 2012-02-14 07:50:19 +0900 (火, 14  2月 2012) | 45 lines

Implement support for specifying string interopolation style variable substitution in the import and source statements.

e.g:
sivamach[runtime]>more /workspace/asiva/expr/test1.dart
#library('test1.dart');
#import('${GOOGLE}$SRC/test2.dart');
#import('$DART/test3.dart');
test1() {
  print("test1");
}
main() {
  test1();
  test2();
  test3();
}
sivamach[runtime]>more /workspace/asiva/expr/src/test2.dart
#library('test2.dart');
#source('$GOOGLE$SRC/test2a.dart');
test2() {
  print("test2");
  test2a();
}
sivamach[runtime]>more /workspace/asiva/expr/src/test2a.dart
test2a() {
  print("test2a");
}
sivamach[runtime]>more /workspace/asiva/expr/src/test3.dart
#library('test3.dart');
#source('test3a.dart');
test3() {
  print("test3");
  test3a();
}
sivamach[runtime]>more /workspace/asiva/expr/src/test3a.dart
test3a() {
  print("test3a");
}

sivamach[runtime]>out/Debug_ia32/dart --import_map=GOOGLE,/workspace/asiva/expr --import_map=SRC,src --import_map=DART,/workspace/asiva/expr/src /workspace/asiva/expr/test1.dart
test1
test2
test2a
test3
test3a
Review URL: https://chromiumcodereview.appspot.com//9359009
------------------------------------------------------------------------
r4189 | sgjesse@google.com | 2012-02-13 23:51:52 +0900 (月, 13  2月 2012) | 8 lines

Fix x64 compilation

R=srdjan@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9392003
------------------------------------------------------------------------
r4181 | sgjesse@google.com | 2012-02-13 21:05:08 +0900 (月, 13  2月 2012) | 19 lines

Refactored thread pool

The thread pool has been refactored to hold all implementation state
in the ThreadPool class and have all internal state protected by a
single monitor.

Added support for starting and stopping the same pool several
times. When stopping the queue can be drained or not.

Added two tests which handles messages.

This change is based on https://chromiumcodereview.appspot.com/9141005/.

R=iposva@google.com, ager@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9212043
------------------------------------------------------------------------
r4176 | sgjesse@google.com | 2012-02-13 18:16:57 +0900 (月, 13  2月 2012) | 13 lines

Fix kqueue handling of no timeout

Using a tiemout value of 0 when there was no timeout caused busy
looping int the eventhandler thread as that actually ment
immediate timeout. No timeout is specified using NULL.

BUG=dart:1641

R=iposva@google.com

TEST=

Review URL: https://chromiumcodereview.appspot.com//9350034
------------------------------------------------------------------------
r4132 | ager@google.com | 2012-02-10 21:41:13 +0900 (金, 10  2月 2012) | 9 lines

Set SO_LINGER on sockets on windows.

Uncovered by fixed Socket tests.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9381003
------------------------------------------------------------------------
r4127 | ager@google.com | 2012-02-10 20:00:15 +0900 (金, 10  2月 2012) | 15 lines

Another attempt at fixing the Socket tests.

The tests did not wait for the server isolate to finish before
exiting the main isolate.

The tests did not correctly count the number of bytes received on
the server-side. We have to count bytes per connection.

There were issues with close handlers being confused for timeouts.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9382001
------------------------------------------------------------------------
r4120 | ager@google.com | 2012-02-10 16:06:18 +0900 (金, 10  2月 2012) | 7 lines

Revert "Fix potential flakiness of SocketStreamCloseTest."

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9368058
------------------------------------------------------------------------
r4119 | ager@google.com | 2012-02-10 15:57:37 +0900 (金, 10  2月 2012) | 9 lines

Fix potential flakiness of SocketStreamCloseTest.

Not reading out all 5 bytes before moving on.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9361034
------------------------------------------------------------------------
r4035 | ager@google.com | 2012-02-08 23:28:24 +0900 (水, 08  2月 2012) | 7 lines

Fix event handler assert stupidity. :-)

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9361032
------------------------------------------------------------------------
r4028 | ager@google.com | 2012-02-08 21:18:29 +0900 (水, 08  2月 2012) | 7 lines

Move the event handler on macos from poll to kqueue. Simpler and faster.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9365010
------------------------------------------------------------------------
r4027 | ager@google.com | 2012-02-08 19:51:58 +0900 (水, 08  2月 2012) | 10 lines

Fix problem with socket input stream on MacOS when reading from tty.

This could cause an empty buffer to be added to an internal BufferList
which violates our assumptions.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9348050
------------------------------------------------------------------------
r3984 | ricow@google.com | 2012-02-07 18:34:12 +0900 (火, 07  2月 2012) | 4 lines

Change file opening operation to set position at the end of the file when FileMode.APPEND is used.

Additionally, allow File.openOutputStream to take a FileMode enum (only FileMode.WRITE and FileMode.APPEND is allowed).
Review URL: https://chromiumcodereview.appspot.com//9346015
------------------------------------------------------------------------
r3980 | ager@google.com | 2012-02-07 17:19:33 +0900 (火, 07  2月 2012) | 10 lines

Use epoll for the event handler on Linux.

epoll is faster than poll and we avoid iterating all potential
file descriptors all the time.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9332003
------------------------------------------------------------------------
r3955 | sgjesse@google.com | 2012-02-07 02:03:18 +0900 (火, 07  2月 2012) | 8 lines

Fix Windows build

TBR=asiva@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9335001
------------------------------------------------------------------------
r3949 | sgjesse@google.com | 2012-02-07 00:56:44 +0900 (火, 07  2月 2012) | 8 lines

Fix Windows build

TBR=asiva@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9309124
------------------------------------------------------------------------
r3948 | sgjesse@google.com | 2012-02-07 00:52:39 +0900 (火, 07  2月 2012) | 8 lines

Fix Windows and Mac OS builds

TBR=asiva@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9323082
------------------------------------------------------------------------
r3947 | sgjesse@google.com | 2012-02-07 00:42:15 +0900 (火, 07  2月 2012) | 20 lines

Implemented encoding af a Dart_CMessage structure into a Dart message. Currently supported types are:

  Boolean
  Smi
  Double
  String
  Array

The encoding uses the upper bits of the Dart_CObject type field for "marking" already written objects with their object id for generating backward references. After serialization these mark are removed.

Added the API Dart_PostCMessage for encoding and posting a Dart_CMessage structure.

Removed the API Dart_PostIntArray and used Dart_PostCMessage instead.

R=asive@google.com,turnidge@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9104041
------------------------------------------------------------------------
r3892 | ager@google.com | 2012-02-03 21:37:30 +0900 (金, 03  2月 2012) | 12 lines

Implement recursive directory deletion.

Additionally, make sure that the handler can be registered after
the operation in file and directory implementation:

  dir.delete();
  dir.deleteHandler = () => print('hest');

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9316066
------------------------------------------------------------------------
r3844 | ager@google.com | 2012-02-02 22:47:42 +0900 (木, 02  2月 2012) | 13 lines

Rework Windows process handling.

- Use only one thread to wait for multiple process objects.
- Fix issue where reading from a closed pipe would print an
  error message on stderr.
- Remove the need to go to dart before removing a processinfo
  object from the list. Sometimes you never get there so we
  have to remove the process info object always.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9310053
------------------------------------------------------------------------
r3830 | sgjesse@google.com | 2012-02-02 17:59:26 +0900 (木, 02  2月 2012) | 12 lines

Change the thread interface in runtime/platform and use it starting all threads

The platform thread interface (dart::thread) is now refactored to an
all static interface as suggested by iposva@ and asiva@. Use this
interface for running all threads in the VM.

R=ager@google.com, iposva@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9141005
------------------------------------------------------------------------
r3812 | ajohnsen@google.com | 2012-02-02 06:48:27 +0900 (木, 02  2月 2012) | 2 lines

Use ByteArray's native for Socket and File.
Review URL: https://chromiumcodereview.appspot.com//9235067
------------------------------------------------------------------------
r3801 | ager@google.com | 2012-02-02 03:16:45 +0900 (木, 02  2月 2012) | 12 lines

Wait for exit-code thread to terminate before terminating main.

The code is identical on Linux and Mac. Currently unimplemented on
Windows because I had to revert my change to the exit code handling
on Windows. I will revive that change tomorrow and implement this
as part of that change.

R=iposva@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9315037
------------------------------------------------------------------------
r3790 | ager@google.com | 2012-02-01 23:19:25 +0900 (水, 01  2月 2012) | 10 lines

Revert "Changes to the process implementation."

There is a race-condition on Windows and exit handling when a process
has been closed is incorrect.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9307033
------------------------------------------------------------------------
r3780 | ager@google.com | 2012-02-01 18:09:23 +0900 (水, 01  2月 2012) | 11 lines

Changes to the process implementation.

- Make the list of active processes thread safe on Windows.
- Use only one thread on Windows to detect process termination.
- Stop the process termination thread when the standalone VM terminates.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9307003
------------------------------------------------------------------------
r3711 | ager@google.com | 2012-01-31 18:10:24 +0900 (火, 31  1月 2012) | 12 lines

Move actual work out of the SIGCHLD signal handler for the dart:io
process library.

Use the self-pipe trick to signal a dedicated thread when a SIGCHLD
signal is received. The dedicated thread will perform the actual work
of extracting the exit code and posting it back to Dart.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9293030
------------------------------------------------------------------------
r3652 | ager@google.com | 2012-01-27 22:01:16 +0900 (金, 27  1月 2012) | 15 lines

Fix race condition between signal handler and main thread.

The signal handler could unblock the main thread. The main thread
could delete the Process object the signal handler is holding a
pointer to. The signal handler could then close a file descriptor
it got from the deleted memory.

The whole process exit handling infrastructure is pretty fragile.
We should attempt to come up with something simpler.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9225019
------------------------------------------------------------------------
r3629 | ajohnsen@google.com | 2012-01-27 07:56:50 +0900 (金, 27  1月 2012) | 2 lines

Fix type error
Review URL: https://chromiumcodereview.appspot.com//9249052
------------------------------------------------------------------------
r3628 | ajohnsen@google.com | 2012-01-27 07:50:26 +0900 (金, 27  1月 2012) | 2 lines

Send data in chunks when writing to socket.
Review URL: https://chromiumcodereview.appspot.com//9220008
------------------------------------------------------------------------
r3616 | ager@google.com | 2012-01-26 19:03:19 +0900 (木, 26  1月 2012) | 10 lines

Minor changes to the dart:io library files.

- Split some of the streams into an interface and an implementation file.
- Add documentation comments where missing.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9289042
------------------------------------------------------------------------
r3554 | ager@google.com | 2012-01-25 00:39:58 +0900 (水, 25  1月 2012) | 11 lines

Comment and white-space cleanup in IO libraries.

- use dart doc comment for interface comments.
- use '//' style comments for non-doc comments.
- remove some whitespace.

R=whesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9285017
------------------------------------------------------------------------
r3546 | ager@google.com | 2012-01-24 22:33:23 +0900 (火, 24  1月 2012) | 7 lines

Another round of minor fixes in the IO libraries.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9129020
------------------------------------------------------------------------
r3541 | ager@google.com | 2012-01-24 21:30:12 +0900 (火, 24  1月 2012) | 10 lines

Fix a couple of minor issues in IO libraries.

- Wrong type in createTempHandler callback.
- Missing implementation of errorHandler setter on StringInputStreams.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9117029
------------------------------------------------------------------------
r3539 | ager@google.com | 2012-01-24 18:52:53 +0900 (火, 24  1月 2012) | 7 lines

Add extra debug information when failing to deliver an interrupt message.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9212041
------------------------------------------------------------------------
r3537 | ager@google.com | 2012-01-24 16:36:59 +0900 (火, 24  1月 2012) | 13 lines

Split dart:builtin into dart:builtin and dart:io.

- dart:builtin is implicitly imported.
- dart:io has to be explicitly imported.

I will update the macos and windows stable test binaries when we
are happy with the solution.

R=iposva@google.com
BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9254026
------------------------------------------------------------------------
r3499 | ager@google.com | 2012-01-24 00:07:09 +0900 (火, 24  1月 2012) | 10 lines

Save and restore errno in signal handler.

Having a signal handler that clobbers errno can lead to spurious
behavior in other code that relies on errno. One example of this
is pthread_cond_wait.

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9193014
------------------------------------------------------------------------
r3485 | whesse@google.com | 2012-01-23 21:15:26 +0900 (月, 23  1月 2012) | 6 lines

Add script attribute to Options class, providing the name of the running script.

BUG=dart:409
TEST=standalone/OptionsTest

Review URL: https://chromiumcodereview.appspot.com//9159013
------------------------------------------------------------------------
r3484 | sgjesse@google.com | 2012-01-23 18:53:28 +0900 (月, 23  1月 2012) | 8 lines

Fix Mac OS build

TBR=ager@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9270039
------------------------------------------------------------------------
r3483 | sgjesse@google.com | 2012-01-23 18:10:51 +0900 (月, 23  1月 2012) | 14 lines

Use hash map for event handler file descriptor map

Instead of using an array indexed using the file descriptor for
looking up data associated with a socket (SocketData objects) this is
now stored in a hash map using the file descriptor as key.

Added hash map implementation like the one used in the V8 project.

R=ager@google.com, whesse@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9186035
------------------------------------------------------------------------
r3433 | sgjesse@google.com | 2012-01-19 22:37:26 +0900 (木, 19  1月 2012) | 8 lines

Add additional include guard in platform specific .h files

R=ager@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9264006
------------------------------------------------------------------------
r3428 | sgjesse@google.com | 2012-01-19 17:49:30 +0900 (木, 19  1月 2012) | 14 lines

Make sure to use an ObjectArray when writing to a socket

This improves performance of the native code accessing the data in the
supplied buffer when it is no already an ObjectArray.

The code is duplicated as refactoring into a separate function was not
feasible.

R=ager@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9254022
------------------------------------------------------------------------
r3424 | iposva@google.com | 2012-01-19 11:48:47 +0900 (木, 19  1月 2012) | 4 lines

- Fix the return type of File.openSync.
- Ensure to always hand a ObjectArray to the native code.
- Start making private methods private.
Review URL: https://chromiumcodereview.appspot.com//9264001
------------------------------------------------------------------------
r3420 | hausner@google.com | 2012-01-19 08:15:56 +0900 (木, 19  1月 2012) | 4 lines

Set breakpoint at url, line number

Add debugger functionality to set breakpoint at given url and line number.
Review URL: https://chromiumcodereview.appspot.com//9240014
------------------------------------------------------------------------
r3416 | turnidge@google.com | 2012-01-19 06:46:27 +0900 (木, 19  1月 2012) | 61 lines

Give isolates names to be used during debugging.

Implement --trace_isolates.

-------------

Sample output of --trace_isolates for the CrossIsolateMessageTest:

[+] Starting isolate:
    isolate:    CrossIsolateMessageTest.dart/main-7112
[+] Starting isolate:
    isolate:    CrossIsolateMessageTest.dart/CrossIsolate1.main-7114
[+] Starting isolate:
    isolate:    CrossIsolateMessageTest.dart/CrossIsolate2.main-7115
[>] Posting message:
    source:     CrossIsolateMessageTest.dart/main-7112
    reply_port: 7117
    dest:       CrossIsolateMessageTest.dart/CrossIsolate2.main-7115
    dest_port:  7115
[>] Posting message:
    source:     CrossIsolateMessageTest.dart/CrossIsolate2.main-7115
    reply_port: 7118
    dest:       CrossIsolateMessageTest.dart/main-7112
    dest_port:  7117
[>] Posting message:
    source:     CrossIsolateMessageTest.dart/main-7112
    reply_port: 7119
    dest:       CrossIsolateMessageTest.dart/CrossIsolate1.main-7114
    dest_port:  7114
[>] Posting message:
    source:     CrossIsolateMessageTest.dart/CrossIsolate1.main-7114
    reply_port: 7120
    dest:       CrossIsolateMessageTest.dart/main-7112
    dest_port:  7119
[>] Posting message:
    source:     CrossIsolateMessageTest.dart/main-7112
    reply_port: 0
    dest:       CrossIsolateMessageTest.dart/CrossIsolate1.main-7114
    dest_port:  7120
[>] Posting message:
    source:     CrossIsolateMessageTest.dart/CrossIsolate1.main-7114
    reply_port: 0
    dest:       CrossIsolateMessageTest.dart/CrossIsolate2.main-7115
    dest_port:  7118
[>] Posting message:
    source:     CrossIsolateMessageTest.dart/CrossIsolate2.main-7115
    reply_port: 0
    dest:       CrossIsolateMessageTest.dart/main-7112
    dest_port:  7116
[>] Posting message:
    source:     CrossIsolateMessageTest.dart/main-7112
    reply_port: 0
    dest:       CrossIsolateMessageTest.dart/main-7112
    dest_port:  7113
[-] Stopping isolate:
    isolate:    CrossIsolateMessageTest.dart/CrossIsolate2.main-7115
[-] Stopping isolate:
    isolate:    CrossIsolateMessageTest.dart/CrossIsolate1.main-7114
[-] Stopping isolate:
    isolate:    CrossIsolateMessageTest.dart/main-7112
Review URL: https://chromiumcodereview.appspot.com//9242035
------------------------------------------------------------------------
r3387 | sgjesse@google.com | 2012-01-18 18:48:30 +0900 (水, 18  1月 2012) | 10 lines

Add MutexLocker and MonitorLocker to runtime/bin

These complements the MutexLocker and MonitorLocker in runtime/vm which have the same logic, but are also VM stack resources.

R=ager@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9255012
------------------------------------------------------------------------
r3362 | sgjesse@google.com | 2012-01-18 00:36:35 +0900 (水, 18  1月 2012) | 12 lines

Use platform implementation of Monitor in thread pool

This removes the direct use of pthread API for the thread pool monitor now that that code is shared. It also gets the Windows implementation for free.

Next step will be to get rid of using the pthread API for handling the threads as well, but that requires additional operations on the Thread class in platform/thread.h.

R=ager@google.com

BUG=
TEST=

Review URL: https://chromiumcodereview.appspot.com//9231020
------------------------------------------------------------------------
r3335 | sgjesse@google.com | 2012-01-16 21:28:10 +0900 (月, 16  1月 2012) | 29 lines

Move assert.h/assert.cc from runtime/vm to runtime/platform

The purpose of this change is twofold:

1. Source in the bin directory can now use the same assertions as
   source in the vm directory. The ASSERT macro used by the code
   in runtime/bin was just defined to use assert from the standard
   C library.
2. Moving other implementation parts from runtime/vm to
   runtime/platform (e.g. classes Monitor and Mutex) for sharing
   between runtime/bin and runtime/vm will be easier as these
   implementations rely on these assertion macros.

Created two gypi files for the platform directory. One for the
headers and one for the source. The source one is only included
when building the VM library and will be present in libdart.a
when the dart executable is linked.

All the code for asserts is still in the dart namespace.

Also re-arranged the order of includes to be alphabetically in
the files touched.

R=ager@google.com, iposva@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//9189003
------------------------------------------------------------------------
r3250 | asiva@google.com | 2012-01-13 04:32:06 +0900 (金, 13  1月 2012) | 17 lines

Fix failure
  ../runtime/vm/object.cc:7149: error: unimplemented code
  Abort
in standalone tests when run with 64bit dart.

The ioctl function when used with FIONREAD was being passed a 64 bit
argument which is incorrect.

Documentation on ioctl:
FIONREAD
The FIONREAD ioctl returns the number of data bytes (in all data
messages queued) in the location pointed to by the arg parameter. The
ioctl returns a 32-bit quantity for both 32-bit and 64-bit
application., Therefore, code that passes the address of a long
variable needs to be changed to pass an int variable for 64–bit
applications.
Review URL: http://codereview.chromium.org//9194002
------------------------------------------------------------------------
r3185 | sgjesse@google.com | 2012-01-12 00:12:27 +0900 (木, 12  1月 2012) | 10 lines

Handle EINTR on all IO operations

There have been spurious FileIOExceptions seen on some Mac OS machines.

R=ager@google.com,whesse@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//9139011
------------------------------------------------------------------------
r3155 | ager@google.com | 2012-01-11 01:50:14 +0900 (水, 11  1月 2012) | 8 lines

Cleanup gypi mess.

My change that introduced a platform directory shared between vm and bin runtime components did not correctly update gypi files.

BUG=
TEST=

Review URL: http://codereview.chromium.org//9124030
------------------------------------------------------------------------
r3137 | ricow@google.com | 2012-01-10 21:42:02 +0900 (火, 10  1月 2012) | 2 lines

Fix a few nits in comments in input_stream.dart
Review URL: http://codereview.chromium.org//9155007
------------------------------------------------------------------------
r3079 | sgjesse@google.com | 2012-01-09 16:38:30 +0900 (月, 09  1月 2012) | 17 lines

Thread pool changes

Make one global thread pool instead of a thread pool for each
eventhandler (i.e. isolate).

Also:

* Added handler function for thread pool tasks.
* Added thread pool shutdown.
* Added a simple test.

R=ager@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//9112013
------------------------------------------------------------------------
r3038 | whesse@google.com | 2012-01-06 22:54:31 +0900 (金, 06  1月 2012) | 6 lines

Fix assertion failure in Process object, where non-integer pid could be passed to kill.

BUG=
TEST=

Review URL: http://codereview.chromium.org//9120004
------------------------------------------------------------------------
r3036 | sgjesse@google.com | 2012-01-06 22:11:13 +0900 (金, 06  1月 2012) | 8 lines

Remove reference to removed bin/global.h from .gypi file

TBR=ahe@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//9123005
------------------------------------------------------------------------
r3035 | sgjesse@google.com | 2012-01-06 21:59:39 +0900 (金, 06  1月 2012) | 8 lines

Remove bin/global.h now that the buildbot is green again

TBR=ahe@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//9125003
------------------------------------------------------------------------
r3034 | sgjesse@google.com | 2012-01-06 21:51:43 +0900 (金, 06  1月 2012) | 8 lines

Add back bin/globals.h to help buildbot

TBR=ahe@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//9110030
------------------------------------------------------------------------
r3032 | sgjesse@google.com | 2012-01-06 21:40:31 +0900 (金, 06  1月 2012) | 8 lines

Dummy update to gypi file to force rebuild on buildbot

TBR=ahe@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//9124003
------------------------------------------------------------------------
r3030 | ager@google.com | 2012-01-06 20:28:21 +0900 (金, 06  1月 2012) | 11 lines

Introduce runtime/platform directory for code shared between vm
and bin.

Cleaned up globals.h. Common parts now in platform/globals.h.
vm specific parts are in vm/globals.h and bin/globals.h is gone.

R=sgjesse@google.com,iposva@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//9114008
------------------------------------------------------------------------
r2987 | ajohnsen@google.com | 2012-01-05 18:54:54 +0900 (木, 05  1月 2012) | 2 lines

Add optional workingDirectory argument to Process.start.
Review URL: http://codereview.chromium.org//9108008
------------------------------------------------------------------------
r2981 | ager@google.com | 2012-01-05 17:43:21 +0900 (木, 05  1月 2012) | 7 lines

Fix wrong return type on fullPath in File API.

R=ajohnsen@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//9111009
------------------------------------------------------------------------
r2946 | sgjesse@google.com | 2012-01-05 00:16:06 +0900 (木, 05  1月 2012) | 21 lines

Start of thread pool implementation

This the initial commit for adding a thread pool to the Dart
server. For now it is hidden behind a flag (--enable_thread_pool)
and when enabled just starts up and processes 100 void tasks.

Mac OS implementation is not tested and Windows implementation is
still pending.

As we are currently not sharing anything between bin/ and vm/ I
have just used pthread calls directly in the Linux and Mac OS
implementation code. However with Monitor and Thread classes from
vm/ the thread pool could be written platform independently. This
can always be changed later.

R=ager@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//8983017
------------------------------------------------------------------------
r2941 | ager@google.com | 2012-01-04 21:23:01 +0900 (水, 04  1月 2012) | 12 lines

Change the behavior of open on files to not truncate by default
when opening for writing.

We have an explicit truncate method in the API and truncating
the file is a bit hostile to users who want to modify or append
to an existing file. :-)

R=whesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//9034005
------------------------------------------------------------------------
r2907 | sgjesse@google.com | 2012-01-03 21:26:48 +0900 (火, 03  1月 2012) | 13 lines

Make sure to close when _BaseDataInputStream reaches the end

This will close the opened file used by a FileInputStream when the
input stream is read to the end.

Should get rid of the current Windows buildbot redness.

R=ager@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//9072004
------------------------------------------------------------------------
r2906 | sgjesse@google.com | 2012-01-03 20:16:56 +0900 (火, 03  1月 2012) | 11 lines

Handle reading byte past the end of file

When reading a byte past the end of file an error is now triggered.

R=ager@google.com

BUG=dart:1017

TEST=

Review URL: http://codereview.chromium.org//9072003
------------------------------------------------------------------------
r2904 | sgjesse@google.com | 2012-01-03 19:17:17 +0900 (火, 03  1月 2012) | 10 lines

Refactor the file input stream

Inherit FileInputStream from _BaseDataInputStream.

R=ager@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//9067004
------------------------------------------------------------------------
r2895 | sgjesse@google.com | 2012-01-02 22:10:48 +0900 (月, 02  1月 2012) | 8 lines

Fix checked mode failure

TBR=ager@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//9065006
------------------------------------------------------------------------
r2893 | sgjesse@google.com | 2012-01-02 22:00:59 +0900 (月, 02  1月 2012) | 15 lines

Add close to input stream and cleanup socket and streams

* All input streams now have a close method for just cutting
  the stream
* Removed interfaces FileInputStream and FileOutputStream
* Added exceptions to socket to avoid mixing stream and non-stream
  use of the same socket
* Added special handling of the socket connect handler callback

R=ager@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//9029001
------------------------------------------------------------------------
r2753 | ager@google.com | 2011-12-22 22:43:43 +0900 (木, 22 12月 2011) | 14 lines

Change the process API to be completely asynchronous.

Some of the implementation is still not asynchronous but the API is
now prepared for it.

This is a breaking change for the dart test scripts. Once the
change has its final form I will add new stable builds of the
VM to the changelist for running tests.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//9024008
------------------------------------------------------------------------
r2707 | iposva@google.com | 2011-12-22 02:26:02 +0900 (木, 22 12月 2011) | 3 lines

- Fix outdated use of factory clause.
- Update error messages.
Review URL: http://codereview.chromium.org//8949043
------------------------------------------------------------------------
r2687 | sgjesse@google.com | 2011-12-21 17:33:02 +0900 (水, 21 12月 2011) | 10 lines

Fix list output stream

The write and writeFrom where missing their boolean return value.

R=ager@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//9021008
------------------------------------------------------------------------
r2641 | sgjesse@google.com | 2011-12-21 01:03:29 +0900 (水, 21 12月 2011) | 8 lines

Implement list based output stream and add pipe to list based input streams

R=ager@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//8989019
------------------------------------------------------------------------
r2621 | sgjesse@google.com | 2011-12-20 19:07:02 +0900 (火, 20 12月 2011) | 18 lines

Add input streams based on supplying data from lists

Two new streams are added ListInputStream and
DynamicListInputStream. ListInputStream takes all the data in the
stream in the constructor whereas DynamicListInputStream can get data
added dynamically using the write method and have end of stream
indicated using the method markEndOfStream.

In a separate change I expect to have the current FileInputStream be
based on the _BaseDataInputStream as it currently used the same logic
with the sync file API.

R=ager@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//8953030
------------------------------------------------------------------------
r2620 | ager@google.com | 2011-12-20 19:06:35 +0900 (火, 20 12月 2011) | 12 lines

Undo change that converted exit code 255 to -1.

It seems that most systems do not perform that conversion and it
could therefore be confusing.

Simplify the crash handling in the test scripts accordingly.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8989011
------------------------------------------------------------------------
r2618 | ager@google.com | 2011-12-20 18:38:20 +0900 (火, 20 12月 2011) | 7 lines

Fix type typo. :-)

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8956022
------------------------------------------------------------------------
r2617 | ager@google.com | 2011-12-20 18:28:28 +0900 (火, 20 12月 2011) | 12 lines

Add asynchronous versions of the methods on Directory.

For now, use an isolate to make the operations async from the
point of view of the main Dart thread.

Clean up the directory tests a bit by removing code that didn't do anything and by removing file testing that is already covered by the file tests.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8965036
------------------------------------------------------------------------
r2609 | asiva@google.com | 2011-12-20 11:04:24 +0900 (火, 20 12月 2011) | 5 lines

Changes to create an application snapshot which can be layered on top
after an isolate is created and initialized.

Added an option --use_script_snapshot which creates a snapshot of the specified script in an isolate, shuts that down and restarts on a new isolate and loads the script from the snapshot buffer and executes it.
Review URL: http://codereview.chromium.org//8970004
------------------------------------------------------------------------
r2577 | ager@google.com | 2011-12-19 21:34:12 +0900 (月, 19 12月 2011) | 7 lines

Make the repeating argument to timers optional.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8992007
------------------------------------------------------------------------
r2564 | sgjesse@google.com | 2011-12-19 18:14:19 +0900 (月, 19 12月 2011) | 11 lines

Add pipe to input stream

Using the pipe method the data from an input stream can be piped
directly to an output stream.

R=whesse@google.com, ager@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//8933029
------------------------------------------------------------------------
r2529 | turnidge@google.com | 2011-12-17 03:41:20 +0900 (土, 17 12月 2011) | 15 lines

Add support for interrupting an isolate in the vm.  Interrupts are
implemented by extending the existing support for stack overflow
checking in the vm.  When an interrupt is scheduled for an isolate, we
overwrite the isolate's stack limit with a value guaranteed to cause a
stack overflow.

We support multiple kinds of interrupts, encoded in the low bits of
the stack limit.

Add Dart_InterruptIsolate and Dart_InterruptIsolateCallback to the
dart embedding api to allow the embedder to request and handle
interrupts.

Add EXPECT_SUBSTRING(needle, haystack) testing macro.
Review URL: http://codereview.chromium.org//8851008
------------------------------------------------------------------------
r2500 | iposva@google.com | 2011-12-16 10:25:47 +0900 (金, 16 12月 2011) | 5 lines

Fix bug 846:
- Only execute timers which were pending prior to the wakeup to
  avoid busy looping.
- Prevent double notification for timers.
Review URL: http://codereview.chromium.org//8973005
------------------------------------------------------------------------
r2426 | sgjesse@google.com | 2011-12-14 22:41:35 +0900 (水, 14 12月 2011) | 8 lines

Update comments for streams

R=whesse@google.com, ager@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//8916003
------------------------------------------------------------------------
r2417 | sgjesse@google.com | 2011-12-14 16:25:09 +0900 (水, 14 12月 2011) | 13 lines

Change temp dir generation on Windows to use UUIDs instead of random numbers

This avoids having to generate random numbers for all platforms as
only Windows was using them. Also when the andom number generator is
deterministic the Windows implementation using random numbers could
end up running out of temporary files.

R=whesse@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//8879058
------------------------------------------------------------------------
r2385 | sgjesse@google.com | 2011-12-13 23:22:50 +0900 (火, 13 12月 2011) | 8 lines

Add support for getting OS error information for creating temporary directories

R=whesse@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//8934004
------------------------------------------------------------------------
r2317 | cshapiro@google.com | 2011-12-10 02:25:44 +0900 (土, 10 12月 2011) | 7 lines

Add an interface for retrieving the value of unsigned 64-bit integers.

With this change, IntegerValue is renamed to IntegerToInt64 for symmetry
with the new IntegerToUint64 interface.  Also uses of UInt64 have been
replaced with Uint64 for naming consistency.

Review URL: http://codereview.chromium.org//8585049
------------------------------------------------------------------------
r2311 | sgjesse@google.com | 2011-12-09 23:11:47 +0900 (金, 09 12月 2011) | 12 lines

Don't treat stdin from a terminal differently from piped input

Both piped input (when using the "<" to pipe in a file) and terminal
input from stdin can set POLLIN with 0 bytes available without POLLHUP
when end of file is reached.

R=ager@google.com

BUG=dart:782
TEST=none

Review URL: http://codereview.chromium.org//8879053
------------------------------------------------------------------------
r2310 | sgjesse@google.com | 2011-12-09 23:08:47 +0900 (金, 09 12月 2011) | 29 lines

Improve the event handling for string input stream

1. The string input stream now calls the data or line handler if there
   is still data available after returning from the data or line
   handler. These callbacks are scheduled on the event loop.

2. The reading of data is now throtteld so that calls to read or
   readLine will not eagerly try to read from the wrapped input
   stream. After each call to read the data handler is installed if
   no more buffered data is available. Also when the data handler
   is called the data handler on the wrapped input stream is
   un-installed if no more data is required for the current data or
   line handler.

One side effect of this change is that just reading from an input
stream obtained from a file is no longer possible. One will have to
set up a data handler callback of some kind before any calls to read
will return data. We can of cause change this to allow synchronous
usage of an input stream obtained from a file (maybe with an optional
argument to openInputStream).

Fixed a related throtteling issue with the chunked input stream.

R=ager@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//8885032
------------------------------------------------------------------------
r2272 | ager@google.com | 2011-12-09 04:37:17 +0900 (金, 09 12月 2011) | 9 lines

Split File into File and RandomAccessFile.

Update all users of the API.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8883017
------------------------------------------------------------------------
r2246 | ager@google.com | 2011-12-08 22:44:06 +0900 (木, 08 12月 2011) | 8 lines

Make the write end of the interrupt pipe in the eventhandler blocking on mac and linux.
The messages written are small control messages that we do want to succeed now.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8890009
------------------------------------------------------------------------
r2228 | sgjesse@google.com | 2011-12-08 17:38:11 +0900 (木, 08 12月 2011) | 8 lines

Only schedule one data callback at the time for chunked input stream

R=ager@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//8839012
------------------------------------------------------------------------
r2198 | hausner@google.com | 2011-12-08 07:13:49 +0900 (木, 08 12月 2011) | 5 lines

First bits of external debugger API

The debugger API is in a separate set of files. Embedders do not have
to include the debug api if they don't need to.
Review URL: http://codereview.chromium.org//8826007
------------------------------------------------------------------------
r2166 | sgjesse@google.com | 2011-12-07 17:57:31 +0900 (水, 07 12月 2011) | 14 lines

Simulate data and close callbacks on a synchronous file input stream

A input stream obtained from File.openInputStream() can now be used
with code that expects data and close callbacks.

Before the input stream obtained from File.openInputStream() did not
generate any callbacks.

R=ager@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//8819021
------------------------------------------------------------------------
r2164 | sgjesse@google.com | 2011-12-07 17:34:17 +0900 (水, 07 12月 2011) | 8 lines

Fix running tests with --checked

TBR=ager@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//8836005
------------------------------------------------------------------------
r2163 | sgjesse@google.com | 2011-12-07 17:00:19 +0900 (水, 07 12月 2011) | 11 lines

Add chunked input stream

The chunked input stream can deliver data fron an input stream as
fixed sized blocks of data.

R=ager@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//8818009
------------------------------------------------------------------------
r2088 | asiva@google.com | 2011-12-06 06:11:00 +0900 (火, 06 12月 2011) | 2 lines

Restore the rule to build a no snapshot binary of dart as Srdjan feels it is still needed for debugging some corelib issues.
Review URL: http://codereview.chromium.org//8805014
------------------------------------------------------------------------
r2067 | ager@google.com | 2011-12-05 22:34:12 +0900 (月, 05 12月 2011) | 13 lines

Add support for client/dartc compilation only tests.

These tests do not fit in that nicely. They have an interesting
way of finding out what are test cases. They use the .dart
suffix in the status file.

Implement directory createTempSync.

R=whesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8799009
------------------------------------------------------------------------
r2023 | sgjesse@google.com | 2011-12-02 23:38:46 +0900 (金, 02 12月 2011) | 12 lines

Fix performance of readLine

Using getRange to chop off the front of the list of char codes for
each line read was to slow. Use an offset into the list instead and
throw away the list when all char codes have been read.

R=ager@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//8769039
------------------------------------------------------------------------
r2016 | sgjesse@google.com | 2011-12-02 20:59:02 +0900 (金, 02 12月 2011) | 19 lines

Add line handler to string stream

This adds the line handler to the string stream to provide callbacks
when a line is known to be available.

This change also refactors parts of the string stream to avoid
converting decoded char codes to a string before checking for line
break sequences. With this change the string decoder tracks all line
breaks.

There is still room for improvement as e.g. the coping of the list of
char codes when reading lines can be avoided by using anoher offset.

R=ager@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//8772008
------------------------------------------------------------------------
r1999 | asiva@google.com | 2011-12-02 08:04:22 +0900 (金, 02 12月 2011) | 2 lines

Refactor the gypi files to eliminate some redundancy.
Review URL: http://codereview.chromium.org//8772016
------------------------------------------------------------------------
r1972 | podivilov@google.com | 2011-12-01 20:59:35 +0900 (木, 01 12月 2011) | 5 lines

Introduce Dart_SetVMFlags API function.

It should be possible to set command line arguments without providing isolate init callback.

Review URL: http://codereview.chromium.org//8713012
------------------------------------------------------------------------
r1971 | ager@google.com | 2011-12-01 20:44:29 +0900 (木, 01 12月 2011) | 7 lines

Fix HTTP sample implementation to actually wait for connections before attempting to write.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8776001
------------------------------------------------------------------------
r1958 | asiva@google.com | 2011-12-01 09:30:25 +0900 (木, 01 12月 2011) | 4 lines

- Refactor the isolate callback mechanism to also include creation of the
  isolate, this enables creation of isolates using a snapshot
- remove source buffers of corelib, coreimpl-lib and builtin-lib from the binary
Review URL: http://codereview.chromium.org//8673002
------------------------------------------------------------------------
r1922 | ager@google.com | 2011-11-30 22:32:26 +0900 (水, 30 11月 2011) | 7 lines

Only report poll failures when it is something we cannot recover from.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8742013
------------------------------------------------------------------------
r1889 | sgjesse@google.com | 2011-11-29 21:02:01 +0900 (火, 29 11月 2011) | 18 lines

Change handling of accepting socket connections

The accept method have been removed from the ServerSocket class and
the signature for the connectionHandler callback have been changed to
provide the accepted socket as an argument.

This is to avoid the possibility for accept to return null even in the
case of pending connection. This could happen if an error like EAGAIN,
EWOULDBLOCK and EINTR was returned by it OS accept call and previously
there was no way of propagating this without returning null from the
Dart call to accept.

R=ager@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//8726031
------------------------------------------------------------------------
r1887 | ager@google.com | 2011-11-29 19:10:07 +0900 (火, 29 11月 2011) | 14 lines

Fix memory leak in MacOS process handling.

Report error for failing writes. We used to enter a poll loop
because we kept on attempting to write.

Currently the error handling in the socket interface is inconsistent.
We have a big TODO item on general error handling including the socket
interface.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8659032
------------------------------------------------------------------------
r1828 | iposva@google.com | 2011-11-24 10:03:21 +0900 (木, 24 11月 2011) | 2 lines

- Remove the redundant dart_bin executable.
Review URL: http://codereview.chromium.org//8682031
------------------------------------------------------------------------
r1824 | hausner@google.com | 2011-11-24 08:44:14 +0900 (木, 24 11月 2011) | 4 lines

Undo some of the initializing formal change 1755

I didn't undo those initializing formas that are initializing a private field.
Review URL: http://codereview.chromium.org//8677027
------------------------------------------------------------------------
r1800 | ager@google.com | 2011-11-24 00:42:20 +0900 (木, 24 11月 2011) | 7 lines

Add truncate operation to File API.

R=whesse@google.com
BUG=264
TEST=

Review URL: http://codereview.chromium.org//8679005
------------------------------------------------------------------------
r1793 | sgjesse@google.com | 2011-11-23 23:49:18 +0900 (水, 23 11月 2011) | 23 lines

Fix a number of issues with the process handling

1. Ignore the signal SIGPIPE on Linux and Mac OS

When reading from or writing to a closed pipe the signal SIGPIPE
is raised. The default handling of this is to terminate the
program. When signal SIGPIPE is ignored the read and write
returns EPIPE.

2. Wrong return type for stdio getter

3. When there is an error on a socket mark it as closed

4. Mark the pipe used for process exit status as a one way pipe

5. Add tests to test stdin, stdout and stderr in Dart scripts

R=ager@google.com

BUG=dart:536, dart:454
TEST=

Review URL: http://codereview.chromium.org//8662006
------------------------------------------------------------------------
r1779 | ager@google.com | 2011-11-23 19:22:48 +0900 (水, 23 11月 2011) | 9 lines

Update test scripts to deal with current VM behavior on optional constructor arguments.

Find binaries in tests based on the platform we are running on.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8662004
------------------------------------------------------------------------
r1777 | whesse@google.com | 2011-11-23 18:10:38 +0900 (水, 23 11月 2011) | 6 lines

Fix excess memory usage problem in StringInputStream.

BUG=dart:555
TEST=

Review URL: http://codereview.chromium.org//8639004
------------------------------------------------------------------------
r1755 | hausner@google.com | 2011-11-23 04:09:54 +0900 (水, 23 11月 2011) | 6 lines

Initializing formals can't be optional parameters

Add new error message to VM compiler.
Remove all optional initializing formals from library
and tests.
Review URL: http://codereview.chromium.org//8619008
------------------------------------------------------------------------
r1741 | whesse@google.com | 2011-11-22 22:06:39 +0900 (火, 22 11月 2011) | 6 lines

Add Directory.createTemp() to asynchronously create a temporary directory.

BUG=
TEST=

Review URL: http://codereview.chromium.org//8588029
------------------------------------------------------------------------
r1730 | ager@google.com | 2011-11-22 17:34:16 +0900 (火, 22 11月 2011) | 6 lines

Use relative path to cygwin on Windows for the runtime
build.

The DEPTH variable is apparently not stable across a 
full checkout or a checkout with only the runtime.
Review URL: http://codereview.chromium.org//8636006
------------------------------------------------------------------------
r1706 | ager@google.com | 2011-11-22 00:47:21 +0900 (火, 22 11月 2011) | 10 lines

Fix gclient runhooks on Windows for a full checkout.

The problem was incorrect setting of and use of the DEPTH gyp
variable.

R=whesse@google.com
BUG=496
TEST=

Review URL: http://codereview.chromium.org//8472007
------------------------------------------------------------------------
r1692 | iposva@google.com | 2011-11-21 14:56:00 +0900 (月, 21 11月 2011) | 3 lines

- Build libdart as a static library. First step towards
  removing dart_bin.
Review URL: http://codereview.chromium.org//8610004
------------------------------------------------------------------------
r1665 | asiva@google.com | 2011-11-19 03:24:04 +0900 (土, 19 11月 2011) | 2 lines

Refactor the library tag handler to share code between standalone dart and the snapshot generator.
Review URL: http://codereview.chromium.org//8549009
------------------------------------------------------------------------
r1652 | ager@google.com | 2011-11-18 21:27:56 +0900 (金, 18 11月 2011) | 7 lines

Implement delete on File objects.

R=whesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8598011
------------------------------------------------------------------------
r1635 | asiva@google.com | 2011-11-18 06:59:38 +0900 (金, 18 11月 2011) | 2 lines

Fix prototype of Dart_Initialize.
Review URL: http://codereview.chromium.org//8574075
------------------------------------------------------------------------
r1632 | asiva@google.com | 2011-11-18 06:26:02 +0900 (金, 18 11月 2011) | 2 lines

When URL mapping was specified, library loads where not being called for the URLs that were mapped.
Review URL: http://codereview.chromium.org//8588016
------------------------------------------------------------------------
r1629 | asiva@google.com | 2011-11-18 06:04:43 +0900 (金, 18 11月 2011) | 5 lines

Implement automatic loading of dart:core_native_fields library
with predefined classes having native fields.
Classes that need native fields in them can import this library and
extend these predefined classes.
Review URL: http://codereview.chromium.org//8537023
------------------------------------------------------------------------
r1604 | ager@google.com | 2011-11-17 15:57:39 +0900 (木, 17 11月 2011) | 10 lines

Test for immutable Lists in ListSet API methods.

Using the file and socket API it was possible to modify immutable
arrays.

R=sgjesse@google.com,turnidge@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8575004
------------------------------------------------------------------------
r1574 | ager@google.com | 2011-11-17 00:53:29 +0900 (木, 17 11月 2011) | 7 lines

Fix Windows build.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8488007
------------------------------------------------------------------------
r1573 | ager@google.com | 2011-11-17 00:50:55 +0900 (木, 17 11月 2011) | 7 lines

Implement setPosition on File to seek to a byte position.

R=sgjesse@google.com
BUG=dart:263
TEST=standalone/FileTest

Review URL: http://codereview.chromium.org//8578003
------------------------------------------------------------------------
r1554 | turnidge@google.com | 2011-11-16 09:18:03 +0900 (水, 16 11月 2011) | 2 lines

Provide better error messages when we fail to build the builtin lib.
Review URL: http://codereview.chromium.org//8571020
------------------------------------------------------------------------
r1550 | asiva@google.com | 2011-11-16 06:19:27 +0900 (水, 16 11月 2011) | 2 lines

Support command line parameters to specify a url to file name mapping. This is used during snapshot generation so that a URL is mapped to a physical file name.
Review URL: http://codereview.chromium.org//8439061
------------------------------------------------------------------------
r1538 | iposva@google.com | 2011-11-16 02:47:21 +0900 (水, 16 11月 2011) | 4 lines

- Avoid allocating variable length arrays on the stack.
- Fix C++ warning about copying vtables.
- Use correct delete for PortMap entries.
Review URL: http://codereview.chromium.org//8555024
------------------------------------------------------------------------
r1535 | sgjesse@google.com | 2011-11-15 23:14:16 +0900 (火, 15 11月 2011) | 8 lines

Remove invalid assert

TBR=ager@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//8568007
------------------------------------------------------------------------
r1533 | sgjesse@google.com | 2011-11-15 22:19:07 +0900 (火, 15 11月 2011) | 19 lines

Handle stdin/stdout/stderr on Windows

Create handle objects for stdin/stdout/stderr. For Mac OS and
Linus the file descriptor numbers are used but on Windows the
handles are wrapped in an object.

The system handles for stdin/stdout/stderr on Windows does not
support overlapped IO. To mittigate this the write calls are
performed synchronously and the read calls are preformed in a
thread which posts the result through the completion potr where
it is handled as if it originated from overlapped IO through the
completion port. For now each call to read starts a new thread.

R=ager@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//8574002
------------------------------------------------------------------------
r1532 | sgjesse@google.com | 2011-11-15 21:41:14 +0900 (火, 15 11月 2011) | 8 lines

Rephrase some comments.

R=whesse@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//8502011
------------------------------------------------------------------------
r1507 | sgjesse@google.com | 2011-11-14 23:47:58 +0900 (月, 14 11月 2011) | 21 lines

Better handling of stdin/stdout/stderr

When using stdout/stderr it is no longer necessary to explicitly
close the streams for the program to terminate. The automatic
close is handled by always closing the associated receive port
for write only streams when not waiting for any events. If a
close or error handler is installed for stdout/stderr these will
still keep the program alive.

For stdin better handling of the difference between sockets and
pipes have been immplemented. As a special case for stdin when
reading from a terminal the a POLLIN signal with 0 available
bytes is treated as end-of-file. This will trigger when pressing
ctrl-d in a terminal as POLLHUP is not set in that situation.

R=ager@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//8533005
------------------------------------------------------------------------
r1470 | turnidge@google.com | 2011-11-12 04:31:04 +0900 (土, 12 11月 2011) | 37 lines

Deal with unhandled exceptions the same way in all Dart api functions.

--

Terminology change: invalid handles are now called error handles.

Unhandled exceptions used to be a kind of valid handle.  Now they are
a kind of error handle.

For the Dart_Invoke* functions, this means that the standard
error-checking blob drops from two tests to one test and is
harder to mess up.

Many other Dart api functions (Dart_ToString, for example) previously
dealt with unhandled exceptions by turning them into terse error
messages.  Now these functions preserve information about the
exceptions and generate better error messages.

Changed Dart_HandleMessage to return success/failure.  It seemed to fit.

--

Details:

Dart_IsValid becomes Dart_IsError (negated sense).

Dart_GetError now knows how to print a stack trace semi-nicely.

Dart_ExceptionOccurred -> Dart_IsUnhandledException.

Renamed ApiFailure class to ApiError to fit better.

ApiError now has a "data" pointer that points to either an error
message string or to an unhandled exception object.

Documentation changes aplenty.
Review URL: http://codereview.chromium.org//8501034
------------------------------------------------------------------------
r1456 | sgjesse@google.com | 2011-11-11 20:45:53 +0900 (金, 11 11月 2011) | 8 lines

Provide access to stdin, stdout and stderr

R=ager@google.com, iposva@google.com

BUG=dart:402
TEST=

Review URL: http://codereview.chromium.org//8525002
------------------------------------------------------------------------
r1406 | sgjesse@google.com | 2011-11-11 01:35:55 +0900 (金, 11 11月 2011) | 12 lines

Set closed for read state on a socket when indicated by the system

Without setting this state sockets would not always be closed
automatically when the input stream is read to the end and the output
stream is closed.

R=ager@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//8513006
------------------------------------------------------------------------
r1367 | asiva@google.com | 2011-11-10 03:59:29 +0900 (木, 10 11月 2011) | 2 lines

Fix generation of pprof output.
Review URL: http://codereview.chromium.org//8497028
------------------------------------------------------------------------
r1356 | ager@google.com | 2011-11-10 00:37:40 +0900 (木, 10 11月 2011) | 6 lines

Correct the sign of exit codes for the process library.

BUG=
TEST=

Review URL: http://codereview.chromium.org//8506013
------------------------------------------------------------------------
r1354 | ager@google.com | 2011-11-09 22:35:14 +0900 (水, 09 11月 2011) | 10 lines

Simplify SIGCLD handler on linux and mac.

Handle all dead processes on sigal. This avoids hanging because we
missed some process terminations when they happened simultaneously.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8506010
------------------------------------------------------------------------
r1347 | ager@google.com | 2011-11-09 21:05:44 +0900 (水, 09 11月 2011) | 7 lines

Avoid creating zombie processes by waiting for the terminated process.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8506009
------------------------------------------------------------------------
r1344 | ager@google.com | 2011-11-09 20:22:33 +0900 (水, 09 11月 2011) | 9 lines

Reapply directory error handling change.

Refactor code to have Platform::StrError(int error_code) on all
platforms. Use that to get better error messages on Windows as well.

BUG=
TEST=

Review URL: http://codereview.chromium.org//8511001
------------------------------------------------------------------------
r1342 | sgjesse@google.com | 2011-11-09 19:52:20 +0900 (水, 09 11月 2011) | 8 lines

Merge the two buffer list implementations

R=ager@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//8506005
------------------------------------------------------------------------
r1339 | ager@google.com | 2011-11-09 17:33:43 +0900 (水, 09 11月 2011) | 9 lines

Revert "Post on the error handler in the Directory API when errors are encountered."

Breaks the mac build because of differences in strerror_r behavior.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8509002
------------------------------------------------------------------------
r1338 | ager@google.com | 2011-11-09 17:08:50 +0900 (水, 09 11月 2011) | 9 lines

Post on the error handler in the Directory API when errors are encountered.

Terminate the listing operation at that point.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8499018
------------------------------------------------------------------------
r1326 | turnidge@google.com | 2011-11-09 04:18:22 +0900 (水, 09 11月 2011) | 13 lines

Renaming:

Dart_ObjectToString -> Dart_ToString
Dart_Objects_Equal -> Dart_ObjectEquals
Dart_IsInstanceOf -> Dart_ObjectIsType
Dart_ReThrowException -> Dart_RethrowException

Added:

Dart_IsSame: === operation

Added a couple of tests.
Review URL: http://codereview.chromium.org//8490016
------------------------------------------------------------------------
r1310 | ager@google.com | 2011-11-08 22:26:51 +0900 (火, 08 11月 2011) | 11 lines

Fix hang when opening sockets on ports that are not available.

Fix TimeoutTest to use free ports instead of using the same port
always. This does not work because tests are run in parallel and
we can have more than one instance of TimeoutTest running.

R=sgjesse@google.com,whesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8498009
------------------------------------------------------------------------
r1308 | sgjesse@google.com | 2011-11-08 22:13:26 +0900 (火, 08 11月 2011) | 12 lines

Fix handling of async IO from pipes on Windows

The handling of async IO on Windows wrongly casted everything to a socket connection. For named pipe based connections this caused reading of invalid memory.

Moved some of the functions to a common superclass and only call showdown for socket connections. For named pipe based connections the Dart part of the code will never send shutdown commands as named pipe based connections start out being closed in one direction and closing the other direction causes a close command.

R=ager@google.com

BUG=dart:363
TEST=

Review URL: http://codereview.chromium.org//8503006
------------------------------------------------------------------------
r1299 | sgjesse@google.com | 2011-11-08 19:02:44 +0900 (火, 08 11月 2011) | 8 lines

Fix build

TBR=ager@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//8498005
------------------------------------------------------------------------
r1293 | sgjesse@google.com | 2011-11-08 18:42:20 +0900 (火, 08 11月 2011) | 12 lines

Change the default for the len argument to writeFrom on OutputStream

Fixed a bug in the writing code as a result.

Also added copyByffer argument to one of the write methods on the OutputStream interface.

R=ager@google.com

BUG=dart:292
TEST=EchoServerStreamTest.dart

Review URL: http://codereview.chromium.org//8493002
------------------------------------------------------------------------
r1260 | ager@google.com | 2011-11-08 00:04:42 +0900 (火, 08 11月 2011) | 7 lines

Implementation of Platform class that exposes information about the machine and the OS.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8492007
------------------------------------------------------------------------
r1255 | sgjesse@google.com | 2011-11-07 23:02:22 +0900 (月, 07 11月 2011) | 8 lines

Fix build

TBR=whesse@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//8494009
------------------------------------------------------------------------
r1253 | sgjesse@google.com | 2011-11-07 22:51:37 +0900 (月, 07 11月 2011) | 13 lines

Change the handling of the close event in the StringInputStream

When the underlying InputStream issues a close event keep track of
when the final string data have been read from the
StringInputStream. When all string data have been read schedule a
callback of the close event.

R=whesse@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//8477026
------------------------------------------------------------------------
r1251 | ager@google.com | 2011-11-07 22:23:28 +0900 (月, 07 11月 2011) | 7 lines

Handling of wrong types of arguments in the File API.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8491014
------------------------------------------------------------------------
r1196 | sgjesse@google.com | 2011-11-04 21:34:43 +0900 (金, 04 11月 2011) | 22 lines

Change the handling of closing sockets

Sockets now supports being half-closed for either reading or writing. When a socket is closed it is by default closed for both read and write and the underlying file descriptor is destroyed. However the socket close can be asked to only half-close the socket to send end of stream to the other end and still have the ability to receive more data.

The close event on a socket is only emitted when the socket is closed by the other end. Both half-close and full-close by the other end is reported as a close event. If a socket is already half closed the close event will automatically destroy the socket.

The streams on the sockets also takes advantage of this. A socket input stream will report a close event when the other end closed. A socket output stream will half-close the socket when close is called making it possible to still receive data on the input stream. When both streams have been closed the socket is destroyed.

For sockets operating on pipes they are initially created as half-closed for either reading or writing depending on which type of pipe a socket object is based on. A pipe for writing will start half-closed for reading so if it is only half-closed for writing the socket will still be destroyed. Same with a pipe for reading that will start half-closed for writing and when a close event is received half-closing the other direction will destroy the socket. Socket objects based on pipes are only exposed through streams.

Extended the socket close test to test a number of different scenarios.

Also refactor the socket data C++ object to encapsulate more socket information and operations.

Now the Linux and Mac OS versions are 100% the same as it turned out that using POLLRDHUP on Linux was not required any more.

R=ager@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//8437090
------------------------------------------------------------------------
r1195 | ager@google.com | 2011-11-04 21:25:53 +0900 (金, 04 11月 2011) | 6 lines

Renaming Array -> List in the VM API.

BUG=
TEST=

Review URL: http://codereview.chromium.org//8372094
------------------------------------------------------------------------
r1169 | iposva@google.com | 2011-11-04 06:45:03 +0900 (金, 04 11月 2011) | 2 lines

- Add the implementation of the Options interface to the runtime.
Review URL: http://codereview.chromium.org//8437075
------------------------------------------------------------------------
r1137 | ager@google.com | 2011-11-03 19:06:55 +0900 (木, 03 11月 2011) | 7 lines

Fix type mismatch in File.fullPathSync.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8351094
------------------------------------------------------------------------
r1134 | ager@google.com | 2011-11-03 17:28:16 +0900 (木, 03 11月 2011) | 7 lines

Implement fullPath method on File objects.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8439067
------------------------------------------------------------------------
r1100 | mattsh@google.com | 2011-11-03 01:58:25 +0900 (木, 03 11月 2011) | 6 lines

use more distinctive pattern to mark where dart source goes

BUG=
TEST=

Review URL: http://codereview.chromium.org//8363018
------------------------------------------------------------------------
r1095 | ager@google.com | 2011-11-03 00:57:54 +0900 (木, 03 11月 2011) | 7 lines

Implemented File create API.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8437056
------------------------------------------------------------------------
r1088 | ager@google.com | 2011-11-02 22:53:10 +0900 (水, 02 11月 2011) | 9 lines

Refactor async file implementation.

Use FileOperation classes instead of maps.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8440037
------------------------------------------------------------------------
r1084 | ager@google.com | 2011-11-02 21:50:59 +0900 (水, 02 11月 2011) | 7 lines

Fix process test and implementation after change to setter for registering event handler.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8440035
------------------------------------------------------------------------
r1083 | ager@google.com | 2011-11-02 21:12:43 +0900 (水, 02 11月 2011) | 7 lines

Consistently use setters to set event handlers in native APIs.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8386029
------------------------------------------------------------------------
r1062 | asiva@google.com | 2011-11-02 10:22:40 +0900 (水, 02 11月 2011) | 2 lines

Fix return statement to return the right result.
Review URL: http://codereview.chromium.org//8439028
------------------------------------------------------------------------
r1060 | cshapiro@google.com | 2011-11-02 09:54:02 +0900 (水, 02 11月 2011) | 3 lines

Fail if an imported file cannot be read.

Review URL: http://codereview.chromium.org//8439025
------------------------------------------------------------------------
r1012 | ager@google.com | 2011-11-01 23:07:30 +0900 (火, 01 11月 2011) | 13 lines

Implement async file API on top of isolates.

This is not going to be efficient but will give us the right
semantics of the operations. We should be using native async
operations for this.

Fixed a bug in VM implementation of List.setRange.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8431028
------------------------------------------------------------------------
r1001 | sgjesse@google.com | 2011-11-01 20:54:14 +0900 (火, 01 11月 2011) | 14 lines

Some Linux and Mac OS event handler refactoring

This moved some of the handling of the data on a socket to a socket data object.

This is a step in preparation for another change where more state will be stored on socket data object.

This is also a step in moving from an array of socket data objects indexed by the file descriptor to a hash map of socket data objects.

R=ager@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//8431027
------------------------------------------------------------------------
r997 | sgjesse@google.com | 2011-11-01 19:10:37 +0900 (火, 01 11月 2011) | 8 lines

New OutputStream interface

R=ager@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//8413034
------------------------------------------------------------------------
r971 | asiva@google.com | 2011-11-01 05:53:44 +0900 (火, 01 11月 2011) | 2 lines

When generating snapshots for a specified script don't include the builtin library by default. The DOM snap shot for instance does not want the builtin library. If the builtin library is needed it needs to be explicitly imported in the specified script.
Review URL: http://codereview.chromium.org//8343071
------------------------------------------------------------------------
r940 | ager@google.com | 2011-10-31 18:37:07 +0900 (月, 31 10月 2011) | 7 lines

Add type checks to directory listing.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8417023
------------------------------------------------------------------------
r917 | asiva@google.com | 2011-10-29 05:22:34 +0900 (土, 29 10月 2011) | 3 lines

Allocate and pass a resolved_path buffer to realpath as older macos versions
do not work when a NULL is passed in for resolved_path
Review URL: http://codereview.chromium.org//8400070
------------------------------------------------------------------------
r893 | rchandia@google.com | 2011-10-29 00:32:33 +0900 (土, 29 10月 2011) | 9 lines

Added builtin native call to exit the running vm

Total uses exit(int) to signal whether to stop or restart

R=iposva@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8317006
------------------------------------------------------------------------
r892 | srdjan@google.com | 2011-10-29 00:21:42 +0900 (土, 29 10月 2011) | 2 lines

More strict non-equal cleanups in library code
Review URL: http://codereview.chromium.org//8413018
------------------------------------------------------------------------
r878 | sgjesse@google.com | 2011-10-28 18:30:42 +0900 (金, 28 10月 2011) | 10 lines

Explicitly handle listen sockets and connection sockets differently in Linux and Mac OS eventhandler

Previously the assumption was that an POLLIN event with no data available was from a listen socket with pending accepts. However a POLLIN event from a connection socket can have no data available if the data has been read before the event is processed.

R=ager@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//8399039
------------------------------------------------------------------------
r859 | srdjan@google.com | 2011-10-28 07:11:16 +0900 (金, 28 10月 2011) | 2 lines

Use strict equality when comparing with null, especially when null is a default value.
Review URL: http://codereview.chromium.org//8400038
------------------------------------------------------------------------
r819 | ager@google.com | 2011-10-27 22:33:18 +0900 (木, 27 10月 2011) | 17 lines

First round of changes to the file interface.

Have both async and sync version for the file operations. The
thinking is that once you have used an async operation you will
not be allowed to use a sync one. Only sync versions currently
implemented.

Instead of having one input and one output stream associated with a
file we create new streams whenever needed. These get their own
underlying file descriptor so they do not interfere. This means
that FileStreams have to be explicitly closed.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8399033
------------------------------------------------------------------------
r809 | sgjesse@google.com | 2011-10-27 19:08:08 +0900 (木, 27 10月 2011) | 8 lines

Only call the dataReceived callback for sockets if there is actually data available

R=ager@google.com

BUG=
TEST=EchoServerStreamTest.dart

Review URL: http://codereview.chromium.org//8363044
------------------------------------------------------------------------
r778 | turnidge@google.com | 2011-10-27 05:38:41 +0900 (木, 27 10月 2011) | 14 lines

Refactor the dart api a bit:

- Dart_Result is gone.  Dart_Handle mostly replaces it.
- Name/signature changes
  - IsValidResult -> IsValid
  - GetErrorCString -> GetError
  - many more...
- Make details of persistent handle freelist private.
- Add persistent "True" handle to api state.

Things I am not doing in this changelist:

- Documentation updates
Review URL: http://codereview.chromium.org//8380020
------------------------------------------------------------------------
r747 | sgjesse@google.com | 2011-10-26 22:17:28 +0900 (水, 26 10月 2011) | 10 lines

This contains a new InputStream and StringInputStream interfaces.

The readUntil is only supported through readLine on the StringInputStream.

The StringInputStream implementation in string_stream.dart could live outside the VM as it is plain Dart code.

BUG=
TEST=

Review URL: http://codereview.chromium.org//8318009
------------------------------------------------------------------------
r744 | ager@google.com | 2011-10-26 21:44:16 +0900 (水, 26 10月 2011) | 7 lines

Implement path canonicalization on Windows to fix infinite loop on cyclic includes.

R=sgjesse@google.com
BUG=179
TEST=language/CyclicImportTest

Review URL: http://codereview.chromium.org//8394041
------------------------------------------------------------------------
r715 | asiva@google.com | 2011-10-26 06:09:44 +0900 (水, 26 10月 2011) | 4 lines

Fix windows build.

TBR=regis.
Review URL: http://codereview.chromium.org//8341032
------------------------------------------------------------------------
r714 | asiva@google.com | 2011-10-26 06:01:07 +0900 (水, 26 10月 2011) | 2 lines

Fix infinite recursion when dealing with cyclic library dependencies.
Review URL: http://codereview.chromium.org//8371016
------------------------------------------------------------------------
r691 | ager@google.com | 2011-10-25 21:20:33 +0900 (火, 25 10月 2011) | 7 lines

Fix Mac build.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8375052
------------------------------------------------------------------------
r690 | ager@google.com | 2011-10-25 21:16:04 +0900 (火, 25 10月 2011) | 11 lines

Improve error handling in the process library.

Verify that the arguments have the types expected by the
implementation. Require a List instance containing builtin
Strings as the arguments. Require a builtin String path.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8383037
------------------------------------------------------------------------
r628 | ager@google.com | 2011-10-24 21:58:07 +0900 (月, 24 10月 2011) | 5 lines

Use realpath on Linux and MacOS to compute the full path for directory listing.

R=sgjesse@google.com

Review URL: http://codereview.chromium.org//8351003
------------------------------------------------------------------------
r604 | sgjesse@google.com | 2011-10-22 00:36:15 +0900 (土, 22 10月 2011) | 5 lines

Added file missing from last commit

TBR=rchandia@google.com

Review URL: http://codereview.chromium.org//8364041
------------------------------------------------------------------------
r602 | sgjesse@google.com | 2011-10-22 00:22:35 +0900 (土, 22 10月 2011) | 12 lines

Rename getters in process object

  stdinStream -> stdin
  stdoutStream -> stdout
  stderrStream -> stderr

R=rchandia@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//8359033
------------------------------------------------------------------------
r555 | iposva@google.com | 2011-10-20 00:44:40 +0900 (木, 20 10月 2011) | 2 lines

- Fix which headers are included.
Review URL: http://codereview.chromium.org//8347023
------------------------------------------------------------------------
r547 | jrgfogh@google.com | 2011-10-19 19:00:19 +0900 (水, 19 10月 2011) | 3 lines

Fixed NullPointerException in Timer.

Review URL: http://codereview.chromium.org//8346030
------------------------------------------------------------------------
r530 | rchandia@google.com | 2011-10-19 06:06:01 +0900 (水, 19 10月 2011) | 7 lines

Flush stdout on calls to PrintString

R=iposva@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8345009
------------------------------------------------------------------------
r435 | sgjesse@google.com | 2011-10-14 22:03:39 +0900 (金, 14 10月 2011) | 4 lines

Get the OS error message for process exceptions on Windows

R=ager@google.com
Review URL: http://codereview.chromium.org//8277035
------------------------------------------------------------------------
r434 | ager@google.com | 2011-10-14 21:57:42 +0900 (金, 14 10月 2011) | 7 lines

Fix type annotation error in directory implementation.

TBR=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8273038
------------------------------------------------------------------------
r432 | ager@google.com | 2011-10-14 21:42:44 +0900 (金, 14 10月 2011) | 10 lines

Add exists, create and delete to directory implementation on Linux and Mac.

All of the directory implementations on Linux and Mac are identical
and uncontroversial. Join the implementations in directory_posix for
now. I will split it into the two files again if it becomes necessary.

BUG=
TEST=

Review URL: http://codereview.chromium.org//8277033
------------------------------------------------------------------------
r422 | sgjesse@google.com | 2011-10-14 16:34:05 +0900 (金, 14 10月 2011) | 4 lines

Use UUIDs for named pipe names on Windows instead of counter

R=ager@google.com
Review URL: http://codereview.chromium.org//8276002
------------------------------------------------------------------------
r396 | sgjesse@google.com | 2011-10-13 22:34:36 +0900 (木, 13 10月 2011) | 4 lines

Make sure that the named pipe created for signalling the exit code is not inheritable

R=ager@google.com
Review URL: http://codereview.chromium.org//8267006
------------------------------------------------------------------------
r395 | sgjesse@google.com | 2011-10-13 22:31:51 +0900 (木, 13 10月 2011) | 10 lines

Fix the handling of exceptions from process start

The privious change in r389 where the sockets used to communicate with the chile process did not work. Even though the Socket objects are not assigned any file descriptor they should still have their Dart port closed. If not the VM will not terminate.

TBR=ager@google.com

TEST=ProcessStartExceptionTest.dart
BUG=none

Review URL: http://codereview.chromium.org//8270001
------------------------------------------------------------------------
r389 | sgjesse@google.com | 2011-10-13 19:38:37 +0900 (木, 13 10月 2011) | 6 lines

Implement the full process interface for Windows

There are still a couple of TODOs in the code.

R=ager@google.com
Review URL: http://codereview.chromium.org//8249007
------------------------------------------------------------------------
r388 | sgjesse@google.com | 2011-10-13 19:14:31 +0900 (木, 13 10月 2011) | 16 lines

Add the ability to run tests with several sets of VM flags

The test-option VMOptions that can be placed in .dart test files can now be specified several times like this:

// VMOptions=
// VMOptions=--short_socket_read
// VMOptions=--short_socket_write
// VMOptions=--short_socket_read --short_socket_write

For each time VMOptions is specified a seperate test will be bun with the specified flags.

Used this to run the tests that uses sockets with short read and writes. Fixed a number of bugs in both stream implementation and in tests revealed by this.

R=iposva@google.com, ngeoffray@google.com

Review URL: http://codereview.chromium.org//8226016
------------------------------------------------------------------------
r364 | ager@google.com | 2011-10-12 22:03:06 +0900 (水, 12 10月 2011) | 7 lines

Directory: implement recursive listing on Windows.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8244004
------------------------------------------------------------------------
r363 | ager@google.com | 2011-10-12 21:53:39 +0900 (水, 12 10月 2011) | 7 lines

Directory: implement recursive directory listing on Linux and Mac.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8243005
------------------------------------------------------------------------
r362 | ager@google.com | 2011-10-12 19:39:30 +0900 (水, 12 10月 2011) | 10 lines

Clean up directory listing interface.

Remove open and close. A directory instance just holds a string
representing the path to the directory.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8244001
------------------------------------------------------------------------
r331 | sgjesse@google.com | 2011-10-12 00:05:32 +0900 (水, 12 10月 2011) | 10 lines

Fix wrong pointer arithmetic when extending the file descripter list in the eventhandler

This caused random crashes due to memory corruption when the file descripter list in the eventhandler needed to be extended.

R=ager@google.com

BUG=none
TEST=tests/dart/src/SocketManyConnectionsTest.dart

Review URL: http://codereview.chromium.org//8231005
------------------------------------------------------------------------
r328 | ager@google.com | 2011-10-11 22:19:19 +0900 (火, 11 10月 2011) | 7 lines

Fix type mismatch in directory listing.

R=sgjesse@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8227014
------------------------------------------------------------------------
r327 | ager@google.com | 2011-10-11 22:12:14 +0900 (火, 11 10月 2011) | 12 lines

Use isolates for directory listing.

Use isolates to make directory listing asynchroneous from the point
of view of the main Dart isolate. Each listing operation will spawn
a new heavy isolate to perform the actually directory listing using
the synchroneous OS primitives.

R=sgjesse@google.com,iposva@google.com
BUG=
TEST=

Review URL: http://codereview.chromium.org//8232005
------------------------------------------------------------------------
r326 | sgjesse@google.com | 2011-10-11 20:45:17 +0900 (火, 11 10月 2011) | 8 lines

Fix Windows build

TBR=ager@google.com

BUG=
TEST=

Review URL: http://codereview.chromium.org//8233008
------------------------------------------------------------------------
r325 | sgjesse@google.com | 2011-10-11 20:26:12 +0900 (火, 11 10月 2011) | 14 lines

Fix deadlock in process exit handling

As glibc allocation routines are not re-entrant avoid calling delete in signal handler.

Instead the message send from the signal handler on process exit contains both the pid and the exit code. The internal _Process object always installs a data handler for the exit message and calls back into C++ to cleanup the resources allocated for running a process.

Changed the ActiveProcess (renamed to ProcessInfo) to form an explicitly linked list.

R=ager@google.com

BUG=dart:1
TEST=

Review URL: http://codereview.chromium.org//8227010
------------------------------------------------------------------------
r209 | ager@google.com | 2011-10-07 20:17:58 +0900 (金, 07 10月 2011) | 11 lines

Windows Sockets: handle client socket close correctly.

When the client closes the socket on which it is listening
GetQueuedCompletionsStatus can return with the error
ERROR_NETNAME_DELETED.

R=sgjesse@google.com
BUG=2
TEST=EchoServerTest.dart

Review URL: https://chromereviews.googleplex.com/3573014
------------------------------------------------------------------------
r140 | asiva@google.com | 2011-10-07 03:33:36 +0900 (金, 07 10月 2011) | 5 lines

5419598: Add a setjmp around the isolate spawning code so that parse errors
are caught and reported as errors.
5417103: Add a setjmp around Dart_Run_Loop so that parse errors
are caught and reported as errors.
Review URL: https://chromereviews.googleplex.com/3553012
------------------------------------------------------------------------
r126 | sgjesse@google.com | 2011-10-06 23:47:49 +0900 (木, 06 10月 2011) | 12 lines

Restructured socket tests and fixed readUntil on InputStream

Most of the socket tests where written with closing both the server and client ends of the socket. However on Windows this can lead to errors once in a while (WSAECONNRESET). The tests now closes the socket in the client and and waits for a close event on the server side.

The readUntil on InputStream did not take data in the internal buffer into account. This has been fixed and the related test have been rewritten to check for two patterns which together will match all the input.

R=ager@google.com

BUG=
TEST=

Review URL: https://chromereviews.googleplex.com/3536016
------------------------------------------------------------------------
r123 | ager@google.com | 2011-10-06 23:28:05 +0900 (木, 06 10月 2011) | 7 lines

Implement first version of directory listing library on Windows.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromereviews.googleplex.com/3543018
------------------------------------------------------------------------
r107 | floitsch@google.com | 2011-10-06 19:14:49 +0900 (木, 06 10月 2011) | 3 lines

Rename DateTime to Date.

Review URL: https://chromereviews.googleplex.com/3529013
------------------------------------------------------------------------
r98 | sgjesse@google.com | 2011-10-06 16:57:34 +0900 (木, 06 10月 2011) | 11 lines

Minor changes to Socket and File

* align the definition of the exception class with how ProcessException ended up
* add constants for redability

R=ager@google.com

BUG=
TEST=

Review URL: https://chromereviews.googleplex.com/3551012
------------------------------------------------------------------------
r44 | ager@google.com | 2011-10-06 00:02:27 +0900 (木, 06 10月 2011) | 7 lines

Fix Windows build after directory library changes.

R=sgjesse@google.com
BUG=
TEST=

Review URL: https://chromereviews.googleplex.com/3527012
------------------------------------------------------------------------
r43 | ager@google.com | 2011-10-05 23:33:49 +0900 (水, 05 10月 2011) | 17 lines

Finish non-recursive synchronous directory listing on Linux and Mac.

Next steps: Testing, Windows support and using isolates to make
listing async.

We should probably change the API to not tie a Directory object
to a given OS directory structure. When spawning an isolate to
perform a listing operation, that will open the directory,
list its contents and close the directory. That way we can
do multiple listing operations with the same Directory object
without having interference.

R=sgjesse@google.com,iposva@google.com
BUG=
TEST=

Review URL: https://chromereviews.googleplex.com/3511020
------------------------------------------------------------------------
r15 | dgrove@google.com | 2011-10-05 14:20:07 +0900 (水, 05 10月 2011) | 1 line

Initial checkin.
------------------------------------------------------------------------
